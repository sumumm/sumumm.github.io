<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha256-wiz7ZSCn/btzhjKDQBms9Hx4sSeUYsDrTLg7roPstac=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.css" integrity="sha256-6cQIC71/iBIYXFK+0RHAvwmjwWzkWd+r7v/BX3/vZDc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/green/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"sumumm.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.19.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":300},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="怎么写一个设备树文件，怎么修改？若笔记中有错误或者不合适的地方，欢迎批评指正😃。">
<meta property="og:type" content="article">
<meta property="og:title" content="LV06-10-设备树-02-设备树语法">
<meta property="og:url" content="https://sumumm.github.io/post/3a7cdf02.html">
<meta property="og:site_name" content="苏木">
<meta property="og:description" content="怎么写一个设备树文件，怎么修改？若笔记中有错误或者不合适的地方，欢迎批评指正😃。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250218090419908.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250218185719092.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250309151938826.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250309152429056.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250309152522796.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250218191119287.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250220091647571.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250220092740884.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250220093228164.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250220163438114.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250220092740884.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250221093009766.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250221093125213.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250221093144491.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250221092855296.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250221093541551.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250221093551160.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250221095145496.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250221095201552.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250221100143833.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250221100203516.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250221100310837.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250221100328129.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250221100415836.png">
<meta property="article:published_time" content="2025-03-16T23:45:51.000Z">
<meta property="article:modified_time" content="2025-06-13T16:25:57.054Z">
<meta property="article:author" content="苏木">
<meta property="article:tag" content="LV06-驱动开发">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250218090419908.png">


<link rel="canonical" href="https://sumumm.github.io/post/3a7cdf02.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":"","permalink":"https://sumumm.github.io/post/3a7cdf02.html","path":"post/3a7cdf02.html","title":"LV06-10-设备树-02-设备树语法"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>LV06-10-设备树-02-设备树语法 | 苏木</title>
  








    <script src="/js/browser_tools_disable.js"></script>

  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start --><link rel="stylesheet" href="https://unpkg.com/hexo-next-tags-plus@latest/lib/tag_plus.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">苏木</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">我的学习之路</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>苏木的家</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类页<span class="badge">42</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档页<span class="badge">673</span></a></li><li class="menu-item menu-item-flink"><a href="/flink/" rel="section"><i class="fa fa-link fa-fw"></i>友人帐</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于我</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="nav-text">一、基本语法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-DTS-%E6%96%87%E4%BB%B6%E7%9A%84%E6%A0%BC%E5%BC%8F"><span class="nav-text">1. DTS 文件的格式   </span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E6%A0%B9%E8%8A%82%E7%82%B9"><span class="nav-text">1.1 根节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E5%AD%90%E8%8A%82%E7%82%B9"><span class="nav-text">1.2 子节点  </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%A4%BA%E4%BE%8B"><span class="nav-text">1.3 一个简单示例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E8%8A%82%E7%82%B9%E5%B1%9E%E6%80%A7"><span class="nav-text">2. 节点属性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E5%B1%9E%E6%80%A7%E6%A0%BC%E5%BC%8F"><span class="nav-text">2.1 属性格式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-1-Property-%E6%A0%BC%E5%BC%8F-1"><span class="nav-text">2.1.1 Property 格式 1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-2-Property-%E6%A0%BC%E5%BC%8F-2-%E6%B2%A1%E6%9C%89%E5%80%BC"><span class="nav-text">2.1.2 Property 格式 2(没有值)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7"><span class="nav-text">2.2 常用属性</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1-compatible"><span class="nav-text">2.2.1 compatible  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-mode"><span class="nav-text">2.2.2 mode</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-3-status"><span class="nav-text">2.2.3 status  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-4-reg"><span class="nav-text">2.2.4 reg  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-5-address-cells-%E5%92%8C-size-cells"><span class="nav-text">2.2.5 address-cells 和 size-cells </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-6-ranges"><span class="nav-text">2.2.6 ranges  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-7-name"><span class="nav-text">2.2.7 name</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-8-device-type"><span class="nav-text">2.2.8 device_type</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-9-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B1%9E%E6%80%A7"><span class="nav-text">2.2.9 自定义属性</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E4%BF%AE%E6%94%B9%E8%8A%82%E7%82%B9"><span class="nav-text">2.3 修改节点</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-1-%E4%BF%AE%E6%94%B9%E6%96%B9%E5%BC%8F"><span class="nav-text">2.3.1 修改方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-2-%E4%BF%AE%E6%94%B9%E5%AE%9E%E4%BE%8B"><span class="nav-text">2.3.2 修改实例</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E7%89%B9%E6%AE%8A%E8%8A%82%E7%82%B9"><span class="nav-text">3. 特殊节点</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E6%A0%B9%E8%8A%82%E7%82%B9"><span class="nav-text">3.1 根节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-CPU-%E8%8A%82%E7%82%B9"><span class="nav-text">3.2 CPU 节点  </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-memory-%E8%8A%82%E7%82%B9"><span class="nav-text">3.3 memory 节点  </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-chosen-%E8%8A%82%E7%82%B9"><span class="nav-text">3.4 chosen 节点  </span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-1-%E8%8A%82%E7%82%B9%E8%AF%B4%E6%98%8E"><span class="nav-text">3.4.1 节点说明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-2-%E8%8A%82%E7%82%B9%E7%A4%BA%E4%BE%8B"><span class="nav-text">3.4.2 节点示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-3-%E5%8F%82%E6%95%B0%E7%9A%84%E4%BC%A0%E9%80%92"><span class="nav-text">3.4.3 参数的传递</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-aliases-%E8%8A%82%E7%82%B9"><span class="nav-text">3.5 aliases 节点</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%AE%9E%E4%BE%8B%E5%88%86%E6%9E%90"><span class="nav-text">二、实例分析</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E4%B8%AD%E6%96%AD"><span class="nav-text">1. 中断</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E4%B8%AD%E6%96%AD%E7%9B%B8%E5%85%B3%E5%B1%9E%E6%80%A7"><span class="nav-text">1.1 中断相关属性</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-1-interrupts"><span class="nav-text">1.1.1 interrupts  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-2-interrupt-controller"><span class="nav-text">1.1.2 interrupt-controller  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-3-interrupt-parent"><span class="nav-text">1.1.3 interrupt-parent  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-4-interrupt-cells"><span class="nav-text">1.1.4 #interrupt-cells  </span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E4%B8%AD%E6%96%AD%E5%AE%9E%E4%BE%8B"><span class="nav-text">1.2 中断实例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-1-%E7%A1%AC%E4%BB%B6%E5%8E%9F%E7%90%86%E5%9B%BE"><span class="nav-text">1.2.1 硬件原理图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-2-%E4%B8%AD%E6%96%AD%E5%8F%B7%E6%80%8E%E4%B9%88%E7%A1%AE%E5%AE%9A%EF%BC%9F"><span class="nav-text">1.2.2 中断号怎么确定？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-3-%E8%A7%A6%E5%8F%91%E6%96%B9%E5%BC%8F%E9%80%89%E6%8B%A9"><span class="nav-text">1.2.3 触发方式选择</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-4-%E6%8C%89%E9%94%AE%E4%B8%AD%E6%96%AD%E8%8A%82%E7%82%B9"><span class="nav-text">1.2.4 按键中断节点</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%97%B6%E9%92%9F"><span class="nav-text">2. 时钟</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E6%97%B6%E9%92%9F%E7%94%9F%E4%BA%A7%E8%80%85%EF%BC%88clock-provider%EF%BC%89"><span class="nav-text">2.1 时钟生产者（clock provider）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E6%97%B6%E9%92%9F%E6%B6%88%E8%B4%B9%E8%80%85%EF%BC%88clock-consumer%EF%BC%89"><span class="nav-text">2.2 时钟消费者（clock consumer）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-CPU"><span class="nav-text">3. CPU</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-cpus-%E8%8A%82%E7%82%B9"><span class="nav-text">3.1 cpus 节点  </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-cpu-map%E3%80%81-socket%E3%80%81-cluster-%E8%8A%82%E7%82%B9"><span class="nav-text">3.2 cpu-map、 socket、 cluster 节点  </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-core%E3%80%81-thread-%E8%8A%82%E7%82%B9"><span class="nav-text">3.3 core、 thread 节点  </span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-GPIO"><span class="nav-text">4. GPIO</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-gpio%E7%9B%B8%E5%85%B3%E5%B1%9E%E6%80%A7"><span class="nav-text">4.1 gpio相关属性</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-1-gpio-controller"><span class="nav-text">4.1.1 gpio-controller</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-2-gpio-cells"><span class="nav-text">4.1.2 #gpio-cells  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-3-gpio-ranges"><span class="nav-text">4.1.3 gpio-ranges</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-4-gpio-%E5%BC%95%E8%84%9A%E6%8F%8F%E8%BF%B0%E5%B1%9E%E6%80%A7"><span class="nav-text">4.1.4 gpio 引脚描述属性  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-5-%E5%85%B6%E4%BB%96%E5%B1%9E%E6%80%A7"><span class="nav-text">4.1.5 其他属性  </span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-GPIO%E5%AE%9E%E4%BE%8B"><span class="nav-text">4.2 GPIO实例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-1-%E7%A1%AC%E4%BB%B6%E5%8E%9F%E7%90%86%E5%9B%BE"><span class="nav-text">4.2.1 硬件原理图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-2-led%E7%81%AF%E8%8A%82%E7%82%B9"><span class="nav-text">4.2.2 led灯节点</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-pinctrl"><span class="nav-text">5. pinctrl  </span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-pinmux-%E7%AE%80%E4%BB%8B"><span class="nav-text">5.1 pinmux 简介  </span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-1-%E4%BB%80%E4%B9%88%E6%98%AFpinmux"><span class="nav-text">5.1.1 什么是pinmux</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-2-imx6ull%E7%9A%84%E5%BC%95%E8%84%9A%E5%A4%8D%E7%94%A8"><span class="nav-text">5.1.2 imx6ull的引脚复用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-3-RK3568%E7%9A%84%E5%BC%95%E8%84%9A%E5%A4%8D%E7%94%A8"><span class="nav-text">5.1.3 RK3568的引脚复用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-4-%E6%80%BB%E7%BB%93"><span class="nav-text">5.1.4 总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-RK3568%E4%B8%AD%E4%BD%BF%E7%94%A8-pinctrl-%E8%AE%BE%E7%BD%AE%E5%A4%8D%E7%94%A8%E5%85%B3%E7%B3%BB"><span class="nav-text">5.2 RK3568中使用 pinctrl 设置复用关系  </span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-1-%E5%AE%A2%E6%88%B7%E7%AB%AF%EF%BC%88client%EF%BC%89"><span class="nav-text">5.2.1 客户端（client）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-2-%E6%9C%8D%E5%8A%A1%E7%AB%AF%EF%BC%88server%EF%BC%89"><span class="nav-text">5.2.2 服务端（server）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-RK3568%E5%BC%80%E5%8F%91%E6%9D%BF%E7%9A%84%E4%B8%80%E4%B8%AA%E5%AE%9E%E4%BE%8B"><span class="nav-text">5.3 RK3568开发板的一个实例</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="苏木"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">苏木</p>
  <div class="site-description" itemprop="description">莫道桑榆晚，为霞尚满天</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">673</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">42</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/sumumm" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;sumumm" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sumumm.github.io/post/3a7cdf02.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="苏木">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="苏木">
      <meta itemprop="description" content="莫道桑榆晚，为霞尚满天">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="LV06-10-设备树-02-设备树语法 | 苏木">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          LV06-10-设备树-02-设备树语法
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-03-17 07:45:51" itemprop="dateCreated datePublished" datetime="2025-03-17T07:45:51+08:00">2025-03-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">嵌入式开发</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/" itemprop="url" rel="index"><span itemprop="name">02IMX6ULL平台</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">LV06-驱动开发</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>21k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1:18</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>怎么写一个设备树文件，怎么修改？若笔记中有错误或者不合适的地方，欢迎批评指正😃。</p>
<span id="more"></span>

<!-- Photo: https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/ -->

<details class="folding-tag" blue><summary> 点击查看使用工具及版本 </summary>
              <div class='content'>
              <table>    <tr>        <td align="center" rowspan="5">PC端开发环境</td>        <td align="center" width=150px>Windows</td>        <td align="left">Windows11</td>    </tr>    <tr>        <td align="center">Ubuntu</td>        <td align="left">Ubuntu20.04.2的64位版本</td>      </tr>    <tr>        <td align="center">VMware® Workstation 17 Pro</td>        <td align="left">17.6.0 build-24238078</td>      </tr>    <tr>        <td align="center">终端软件</td>        <td align="left">MobaXterm(Professional Edition v23.0 Build 5042 (license))</td>    </tr>    <tr>        <td align="center">Win32DiskImager</td>        <td align="left">Win32DiskImager v1.0</td>      </tr>    <tr>        <td align="center" rowspan="3">Linux开发板环境</td>        <td align="center">Linux开发板</td>        <td align="left">正点原子 i.MX6ULL Linux 阿尔法开发板</td>      </tr>    <tr>        <td align="center">uboot</td>        <td align="left">NXP官方提供的uboot，使用的uboot版本为U-Boot 2019.04</td>      </tr>    <tr>        <td align="center">linux内核</td>        <td align="left">linux-4.19.71(NXP官方提供)</td>      </tr></table>
              </div>
            </details>

<details class="folding-tag" blue><summary> 点击查看本文参考资料 </summary>
              <div class='content'>
              <table>    <tr>        <td align="center">分类</td>        <td align="center">网址</td>        <td align="center">说明</td>    </tr>    <tr>        <td align="center" rowspan="5">官方网站</td>        <td align="left"><a href="https://www.arm.com/" target="_blank">https://www.arm.com/</a></td>        <td align="left">ARM官方网站，在这里我们可以找到Cotex-Mx以及ARMVx的一些文档</td>    </tr>    <tr>        <td align="left"><a href="https://www.nxp.com.cn/" target="_blank">https://www.nxp.com.cn/ </a></td>        <td align="left">NXP官方网站</td>    </tr>    <tr>        <td align="left"><a href="https://www.nxpic.org.cn/" target="_blank">https://www.nxpic.org.cn/</a></td><td align="left">NXP 官方社区</td>    </tr>    <tr>        <td align="left"><a href="https://u-boot.readthedocs.io/en/latest/" target="_blank">https://u-boot.readthedocs.io/en/latest/</a></td><td align="left">u-boot官网</td>    </tr>    <tr>        <td align="left"><a href="https://www.kernel.org/" target="_blank">https://www.kernel.org/</a></td><td align="left">linux内核官网</td>    </tr></table>
              </div>
            </details>

<details class="folding-tag" blue><summary> 点击查看相关文件下载 </summary>
              <div class='content'>
              <table>    <tr>        <td align="center">分类</td>        <td align="center">网址</td>        <td align="center">说明</td>    </tr>    <tr>        <td align="center" rowspan="3">NXP</td>        <td align="left"><a href="https://github.com/nxp-imx" target="_blank">https://github.com/nxp-imx</a></td>        <td align="left">NXP imx开发资源GitHub组织，里边会有u-boot和linux内核的仓库</td>    </tr>    <tr>        <td align="left"><a href="https://github.com/nxp-imx/linux-imx/releases/tag/v4.19.71" target="_blank">nxp-imx/linux-imx/releases/tag/v4.19.71</a></td>        <td align="left">NXP linux内核仓库tags中的v4.19.71</td>    </tr>    <tr>        <td align="left"><a href="https://github.com/nxp-imx/uboot-imx/releases/tag/rel_imx_4.19.35_1.1.0" target="_blank">nxp-imx/uboot-imx/releases/tag/rel_imx_4.19.35_1.1.0</a></td>        <td align="left">NXP u-boot仓库tags中的rel_imx_4.19.35_1.1.0</td>    </tr>    <tr>        <td align="center" rowspan="2">I.MX6ULL</td>        <td align="left"><a href="https://www.nxp.com.cn/docs/en/data-sheet/IMX6ULLIEC.pdf" target="_blank">i.MX 6ULL Applications Processors for Industrial Products</a></td>        <td align="left">I.MX6ULL 芯片手册（datasheet，可以在线查看）</td>    </tr>    <tr>        <td align="left"><a href="https://www.nxp.com.cn/webapp/Download?colCode=IMX6ULLRM&lang_cd=zh" target="_blank">i.MX 6ULL Applications ProcessorReference Manual</a></td>        <td align="left">I.MX6ULL 参考手册（下载后才能查看，需要登录NXP官网）</td>    </tr>    <tr>        <td align="center" rowspan="3">Source Code</td>        <td align="left"><a href="https://elixir.bootlin.com/linux/latest/source" target="_blank">https://elixir.bootlin.com/linux/latest/source</a></td>        <td align="left">linux kernel源码</td>    </tr>    <tr>        <td align="left"><a href="https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/tree/?h=v4.19.71&id=e7d2672c66e4d3675570369bf20856296da312c4" target="_blank">kernel/git/stable/linux.git - Linux kernel stable tree</a></td>        <td align="left">linux kernel源码(官网,tag 4.19.71)</td>    </tr>    <tr>        <td align="left"><a href="https://elixir.bootlin.com/u-boot/latest/source" target="_blank">https://elixir.bootlin.com/u-boot/latest/source</a></td>        <td align="left">uboot源码</td>    </tr></table>
              </div>
            </details>

<h1 id="一、基本语法"><a href="#一、基本语法" class="headerlink" title="一、基本语法"></a><font size=3>一、基本语法</font></h1><h2 id="1-DTS-文件的格式"><a href="#1-DTS-文件的格式" class="headerlink" title="1. DTS 文件的格式   "></a><font size=3>1. DTS 文件的格式   </font></h2><h3 id="1-1-根节点"><a href="#1-1-根节点" class="headerlink" title="1.1 根节点"></a><font size=3>1.1 根节点</font></h3><p>设备树使用一种层次结构， 其中的根节点（Root Node） 是整个设备树的起始点和顶层节点。 根节点由一个以 &#x2F;开头的标识符来表示， 然后使用{}来包含根节点所在的内容  ，DTS 文件布局(layout):  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/dts-v1/; <span class="comment">// 设备树版本信息</span></span><br><span class="line">[memory reservations] <span class="comment">// 格式为: /memreserve/ &lt;address&gt; &lt;length&gt;;</span></span><br><span class="line">/ &#123;</span><br><span class="line">    [property definitions]</span><br><span class="line">    [child nodes]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>其中第一行的设备树中的版本信息行 dts-v1 是可选的， 可以根据需要选择是否保留。 这行注释通常用于指定设备树的语法版本。 如果不需要在设备树中指定版本信息， 可以将其删除。  </p>
<h3 id="1-2-子节点"><a href="#1-2-子节点" class="headerlink" title="1.2 子节点  "></a><font size=3>1.2 子节点  </font></h3><p>设备树中的子节点是根节点的直接子项， 用于描述具体的硬件设备或设备集合。 子节点采用以下特定的格式来表示 ：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[label:] node-name@[unit-address] &#123;</span><br><span class="line">    [properties definitions]</span><br><span class="line">    [child nodes]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>（1） 节点标签（Label） （可选） ： 节点标签是一个可选的标识符， 用于在设备树中引用该节点。 标签允许其他节点直接引用此节点， 以便在设备树中建立引用关系。  </p>
<p>（2） 节点名称（Node Name） ： 节点名称是一个字符串， 用于唯一标识该节点在设备树中的位置。 节点名称通常是硬件设备的名称， 但必须在设备树中是唯一的。  </p>
<p>（ 3） 单元地址（Unit Address） （ 可选） ： 单元地址用于标识设备的实例。 它可以是一个整数、 一个十六进制值或一个字符串， 具体取决于设备的要求。 单元地址的目的是区分相同类型的设备的不同实例， 例如在下图中名为 cpu 的节点通过它们的单元地址值 0 和 1 来区分， 名称为 ethernet 的节点通过其单元地址值 fe002000 和 fe003000 来区分。  </p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250218090419908.png" alt="image-20250218090419908" style="zoom:50%;" />

<p>（ 4） 属性定义（ Properties Definitions） ： 属性定义是一组键值对， 用于描述设备的配置和特性。 属性可以根据设备的需求进行定义， 例如寄存器地址、 中断号、 时钟频率等， 关于这些属性会在后面的小节中学习。</p>
<p>（ 5） 子节点（ Child Nodes） ： 子节点是当前节点的子项， 用于进一步描述硬件设备的子组件或配置。 子节点可以包含自己的属性定义和更深层次的子节点， 形成设备树的层次结构。</p>
<h3 id="1-3-一个简单示例"><a href="#1-3-一个简单示例" class="headerlink" title="1.3 一个简单示例"></a><font size=3>1.3 一个简单示例</font></h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/dts-v1/;</span><br><span class="line">/ &#123;</span><br><span class="line">    uart0: uart@fe001000 &#123;</span><br><span class="line">        compatible=<span class="string">&quot;ns16550&quot;</span>;</span><br><span class="line">        reg=&lt;<span class="number">0xfe001000</span> <span class="number">0x100</span>&gt;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="2-节点属性"><a href="#2-节点属性" class="headerlink" title="2. 节点属性"></a><font size=3>2. 节点属性</font></h2><p>节点是由一堆的属性组成，节点都是具体的设备，不同的设备需要的属性不同，用户可以自定义属性。除了用户自定义属性，有很多属性是标准属性， Linux 下的很多外设驱动都会使用这些标准属性。</p>
<h3 id="2-1-属性格式"><a href="#2-1-属性格式" class="headerlink" title="2.1 属性格式"></a><font size=3>2.1 属性格式</font></h3><p>简单地说， properties 就是“name&#x3D;value”， value 有多种取值方式。  </p>
<h4 id="2-1-1-Property-格式-1"><a href="#2-1-1-Property-格式-1" class="headerlink" title="2.1.1 Property 格式 1"></a><font size=3>2.1.1 Property 格式 1</font></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[label:] property-name = value;</span><br></pre></td></tr></table></figure>

<p>Property 取值可以有以下几种：</p>
<ul>
<li>arrays of cells(1 个或多个 32 位数据, 64 位数据使用 2 个 32 位数据表示)。cell 就是一个 32 位的数据，用尖括号包围起来</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">interrupts = &lt;<span class="number">17</span> <span class="number">0xc</span>&gt;;</span><br></pre></td></tr></table></figure>

<p>64bit 数据使用 2 个 cell 来表示，用尖括号包围起来:  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clock-frequency = &lt;<span class="number">0x00000001</span> <span class="number">0x00000000</span>&gt;;</span><br></pre></td></tr></table></figure>

<ul>
<li>string(字符串)</li>
</ul>
<p>A null-terminated string (有结束符的字符串)，用双引号包围起来:  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compatible = <span class="string">&quot;simple-bus&quot;</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>bytestring(1 个或多个字节)</li>
</ul>
<p>A bytestring(字节序列) ，用中括号包围起来:  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">local-mac-address = [<span class="number">00</span> <span class="number">00</span> <span class="number">12</span> <span class="number">34</span> <span class="number">56</span> <span class="number">78</span>]; <span class="comment">// 每个 byte 使用 2 个 16 进制数来表示</span></span><br><span class="line">local-mac-address = [<span class="number">000012345678</span>]; <span class="comment">// 每个 byte 使用 2 个 16 进制数来表示</span></span><br></pre></td></tr></table></figure>

<ul>
<li>也可以是各种值的组合, 用逗号隔开:</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">compatible = <span class="string">&quot;ns16550&quot;</span>, <span class="string">&quot;ns8250&quot;</span>;</span><br><span class="line">example = &lt;<span class="number">0xf00f0000</span> <span class="number">19</span>&gt;, <span class="string">&quot;a strange property format&quot;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="2-1-2-Property-格式-2-没有值"><a href="#2-1-2-Property-格式-2-没有值" class="headerlink" title="2.1.2 Property 格式 2(没有值)"></a><font size=3>2.1.2 Property 格式 2(没有值)</font></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[label:] property-name;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-常用属性"><a href="#2-2-常用属性" class="headerlink" title="2.2 常用属性"></a><font size=3>2.2 常用属性</font></h3><h4 id="2-2-1-compatible"><a href="#2-2-1-compatible" class="headerlink" title="2.2.1 compatible  "></a><font size=3>2.2.1 compatible  </font></h4><p>在设备树中， compatible 属性用于描述设备的兼容性信息。 它是设备树中重要的属性之一，用于识别设备节点与驱动程序之间的匹配关系。  </p>
<p>compatible 属性的值是一个字符串或字符串列表， 用于指定设备节点与相应的驱动程序或设备描述符兼容的规则。 通常， compatible 属性的值由设备的厂商定义， 并且在设备树中使用。  </p>
<p>一般格式如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;manufacturer,model&quot;</span></span><br></pre></td></tr></table></figure>

<p>其中 manufacturer 表示厂商， model 一般是模块对应的驱动名字。比如 imx6ull-alpha-emmc.dts 中 sound 节点是 I.MX6U-ALPHA 开发板的音频设备节点， I.MX6U-ALPHA 开发板上的音频芯片采用的欧胜(WOLFSON)出品的 WM8960， sound 节点的 compatible 属性值如下：    </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compatible = <span class="string">&quot;fsl,imx6ul-evk-wm8960&quot;</span>,<span class="string">&quot;fsl,imx-audio-wm8960&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>属性值有两个，分别为“fsl,imx6ul-evk-wm8960”和“fsl,imx-audio-wm8960”，其中“fsl”表示厂商是飞思卡尔，“imx6ul-evk-wm8960”和“imx-audio-wm8960”表示驱动模块名字。 sound这个设备首先使用第一个兼容值在 Linux 内核里面查找，看看能不能找到与之匹配的驱动文件，如果没有找到的话就使用第二个兼容值查。</p>
<p>一般驱动程序文件都会有一个 OF 匹配表，此 OF 匹配表保存着一些 compatible 值，如果设备节点的 compatible 属性值和 OF 匹配表中的任何一个值相等，那么就表示设备可以使用这个驱动。比如在文件 imx-wm8960.c 中有如下内容：  </p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">of_device_id</span> <span class="title">imx_wm8960_dt_ids</span>[] =</span> &#123;</span><br><span class="line">    &#123;</span><br><span class="line">        .compatible = <span class="string">&quot;fsl,imx-audio-wm8960&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;<span class="comment">/* sentinel */</span>&#125;&#125;;</span><br><span class="line">MODULE_DEVICE_TABLE(of, imx_wm8960_dt_ids);</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">platform_driver</span> <span class="title">imx_wm8960_driver</span> =</span> &#123;</span><br><span class="line">    .driver = &#123;</span><br><span class="line">        .name = <span class="string">&quot;imx-wm8960&quot;</span>,</span><br><span class="line">        .pm = &amp;snd_soc_pm_ops,</span><br><span class="line">        .of_match_table = imx_wm8960_dt_ids,</span><br><span class="line">    &#125;,</span><br><span class="line">    .probe = imx_wm8960_probe,</span><br><span class="line">    .remove = imx_wm8960_remove,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>第 1 - 5 行：数组 imx_wm8960_dt_ids 就是 imx-wm8960.c 这个驱动文件的匹配表，此匹配表只有一个匹配值“fsl,imx-audio-wm8960”。如果在设备树中有哪个节点的 compatible 属性值与此相等，那么这个节点就会使用此驱动文件。</p>
<p>第 12 行， wm8960 采用了 platform_driver 驱动模式，关于 platform_driver 驱动后面会讲解。此行设置.of_match_table 为 imx_wm8960_dt_ids，也就是设置这个 platform_driver 所使用的OF 匹配表。    </p>
<blockquote>
<p>总的来说，这个属性可能的取值有以下几种：</p>
<p>（1） 单个字符串值： 例如 “vendor,device”， 用于指定设备节点与特定厂商的特定设备兼容。</p>
<p>（2） 字符串列表： 例如 [“vendor,device1”, “vendor,device2”]， 用于指定设备节点与多个设备兼容， 通常用于设备节点具有多种变体或配置。可以用于指定设备节点与多个设备或驱动程序的兼容性规则。   </p>
<p>（3） 通配符匹配： 例如 “vendor,*”， 用于指定设备节点与特定厂商的所有设备兼容， 不考虑具体的设备标识。 </p>
</blockquote>
<h4 id="2-2-2-mode"><a href="#2-2-2-mode" class="headerlink" title="2.2.2 mode"></a><font size=3>2.2.2 mode</font></h4><p>在设备树中， model 属性用于描述设备的型号或者名称。 它通常作为设备节点的一个属性，用来提供关于设备的标识信息。 model 属性是可选的， 但在实际应用中经常被使用。  </p>
<p>model 属性的值是一个字符串， 可以是设备的型号、 名称、 或者其他标识符， 用来识别设备。 该值通常由设备的厂商定义， 并且在设备树中使用。  </p>
<p>model 属性与 compatible 属性有些类似，但是有差别。model 属性通常用于标识和区分不同的设备， 特别是当设备节点的 compatible 属性相同或相似时。 通过使用不同的 model 属性值， 可以更加准确地确定所使用的设备类型。  比如 compatible 属性是一个字符串列表，表示我们的硬件可以兼容 A、 B、 C 等驱动；model 用来准确地定义这个硬件是什么。</p>
<p>比如根节点中可以这样写：  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">my_device &#123;</span><br><span class="line">    compatible = <span class="string">&quot;samsung,smdk2440&quot;</span>, <span class="string">&quot;samsung,mini2440&quot;</span>;</span><br><span class="line">    model = <span class="string">&quot;jz2440_v3&quot;</span>;</span><br><span class="line">    <span class="comment">// 其他属性和子节点的定义</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>它表示这个单板，可以兼容内核中的“ smdk2440”，也兼容“ mini2440”。从 compatible 属性中可以知道它兼容哪些板，但是它到底是什么板？用model 属性来明确。</p>
<h4 id="2-2-3-status"><a href="#2-2-3-status" class="headerlink" title="2.2.3 status  "></a><font size=3>2.2.3 status  </font></h4><p>在设备树中， status 属性用于描述设备或节点的状态。 它是设备树中常见的属性之一， 用于表示设备或节点的可用性或操作状态。可选的状态如下表：</p>
<table>
<thead>
<tr>
<th align="center">值</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">“okay”</td>
<td>表明设备是可操作的。</td>
</tr>
<tr>
<td align="center">“disabled”</td>
<td>表明设备当前是不可操作的，但是在未来可以变为可操作的，比如热插拔设备插入以后。至于 disabled 的具体含义还要看设备的绑定文档。</td>
</tr>
<tr>
<td align="center">“fail”</td>
<td>表明设备不可操作，设备检测到了一系列的错误，而且设备也不大可能变得可操作。</td>
</tr>
<tr>
<td align="center">“fail-sss”</td>
<td>含义和“fail”相同，后面的 sss 部分是检测到的错误内容。</td>
</tr>
</tbody></table>
<p>dtsi 文件中定义了很多设备，但是在我们的板子上某些设备是没有的。这时可以给这个设备节点添加一个 status 属性，设置为“disabled”：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&amp;uart1 &#123;</span><br><span class="line">    status = <span class="string">&quot;disabled&quot;</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过使用 status 属性， 设备树可以动态地控制设备的启用和禁用状态。 这对于在系统启动过程中选择性地启用或禁用设备， 或者在运行时根据特定条件调整设备状态非常有用。  </p>
<h4 id="2-2-4-reg"><a href="#2-2-4-reg" class="headerlink" title="2.2.4 reg  "></a><font size=3>2.2.4 reg  </font></h4><p>reg 的本意是 register，表示寄存器地址，很容易就知道这个属性用于在设备树中指定设备的寄存器地址和大小， 提供了与设备树中的物理设备之间的寄存器映射关系。  </p>
<p>在设备树里，它可以用来描述一段空间。反正对于 ARM 系统，寄存器和内存是统一编址的，即访问寄存器时用某块地址，访问内存时用某块地址，在访问方法上没有区别。  </p>
<p>reg 属性可以在设备节点中有单个值格式和列表值格式这两种常见格式。</p>
<ul>
<li>（1） 单个值格式如下：</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg = &lt;address size&gt;;</span><br></pre></td></tr></table></figure>

<p>这种格式适用于描述单个寄存器的情况。 其中， address 是设备的起始寄存器地址， 可以是一个整数或十六进制值。 size 表示寄存器的大小， 即占用的字节数。  </p>
<p>例如， 假设有一个设备节点 my_device， 使用单个值格式的 reg 属性来描述一个 4 字节寄存器的地址和大小， 可以这样定义：  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">my_device &#123;</span><br><span class="line">    compatible = <span class="string">&quot;vendor,device&quot;</span>;</span><br><span class="line">    reg = &lt;<span class="number">0x1000</span> <span class="number">0x4</span>&gt;;</span><br><span class="line">    <span class="comment">// 其他属性和子节点的定义</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个示例中， <code>my_device</code> 设备节点的 <code>reg</code> 属性值为 <code>&lt;0x1000 0x4&gt;</code>， 表示从地址<code>0x1000</code> 开始的 4 字节寄存器区域。</p>
<ul>
<li>（2） 列表值格式如下：</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg = &lt;address1 size1 address2 size2 ...&gt;;</span><br></pre></td></tr></table></figure>

<p>当设备具有多个寄存器区域时， 可以使用列表值格式的 reg 属性来描述每个寄存器区域的地址和大小。 通过这种方式， 可以指定多个寄存器的位置和大小， 以描述设备的完整寄存器映射。</p>
<p>例如， 考虑一个设备节点 my_device， 它具有两个寄存器区域， 分别是 8 字节和 4 字节大小的寄存器。 可以使用列表值格式的 reg 属性来描述这种情况：  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">my_device &#123;</span><br><span class="line">    compatible = <span class="string">&quot;vendor,device&quot;</span>;</span><br><span class="line">    reg = &lt;<span class="number">0x1000</span> <span class="number">0x8</span> <span class="number">0x2000</span> <span class="number">0x4</span>&gt;;</span><br><span class="line">    <span class="comment">// 其他属性和子节点的定义</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个示例中， my_device 设备节点的 reg 属性值为 &lt;0x1000 0x8 0x2000 0x4&gt;， 表示设备有两个寄存器区域。 第一个寄存器区域从地址 0x1000 开始， 大小为 8 字节； 第二个寄存器区域从地址 0x2000 开始， 大小为 4 字节。  </p>
<p>通过使用 reg 属性， 设备树可以提供有关设备寄存器布局和寄存器访问方式的信息。 这对于操作系统的设备驱动程序很重要， 因为它们需要了解设备的寄存器映射以正确地与设备进行交互和配置。  </p>
<h4 id="2-2-5-address-cells-和-size-cells"><a href="#2-2-5-address-cells-和-size-cells" class="headerlink" title="2.2.5 address-cells 和 size-cells "></a><font size=3>2.2.5 address-cells 和 size-cells </font></h4><p>#address-cells 和 #size-cells 这两个属性可以用在任何拥有子节点的设备中, 用于指定reg属性中要设置的设备树中地址单元和大小单元的位数。 它们提供了设备树解析所需的元数据， 以正确解释设备的地址和大小信息。</p>
<blockquote>
<p>Tips：总的来说，就是#address-cells 和#size-cells 表明了子节点应该如何编写 reg 属性值 。</p>
<ul>
<li>cell 指一个 32 位的数值  </li>
<li>address-cells： address 要用多少个 32 位数来表示  </li>
<li>size-cells： size 要用多少个 32 位数来表示</li>
</ul>
<p>也就是说#address-cells 属性值决定了子节点 reg 属性中地址信息所占用的字长(32 位)， #size-cells 属性值决定了子节点 reg 属性中长度信息所占的字长(32 位)。       </p>
</blockquote>
<ul>
<li>（1） #address-cells 属性</li>
</ul>
<p>#address-cells 属性是一个位于设备树根节点的特殊属性， 它指定了设备树中地址单元的位数。 地址单元是设备树中用于表示设备地址的单个单位。 它通常是一个整数， 可以是十进制或十六进制值。  </p>
<p>#address-cells 属性的值告诉解析设备树的软件在解释设备地址时应该使用多少位来表示一个地址单元。默认情况下， #address-cells 的值为 2， 表示使用两个单元来表示一个设备地址。 这意味着设备的地址将由两个整数（每个整数使用指定位数的位） 组成。</p>
<p>例如， 对于一个使用两个 32 位（4 字节） 整数表示地址的设备， 可以在设备树的根节点中设置 #address-cells 属性为 &lt;2&gt;。  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/ &#123;</span><br><span class="line">    <span class="meta">#address-cells = <span class="string">&lt;2&gt;</span>;</span></span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>（2） #size-cells 属性</li>
</ul>
<p>#size-cells 属性也是一个位于设备树根节点的特殊属性， 它指定了设备树中大小单元的位数。 大小单元是设备树中用于表示设备大小的单个单位。 它通常是一个整数， 可以是十进制或十六进制值。#size-cells 属性的值告诉解析设备树的软件在解释设备大小时应该使用多少位来表示一个大小单元。</p>
<p>默认情况下， #size-cells 的值为 1， 表示使用一个单元来表示一个设备的大小。 这意味着设备的大小将由一个整数（使用指定位数的位） 表示。      </p>
<p>例如， 对于一个使用一个 32 位（4 字节） 整数表示大小的设备， 可以在设备树的根节点中设置 #size-cells 属性为 &lt;1&gt;。  </p>
<p>这两个属性的存在是为了使设备树能够灵活地描述各种设备的地址和大小表示方式。 通过在设备树的根节点中设置适当的 #address-cells 和 #size-cells 值， 设备树解析软件能够正确地解释设备节点中的地址和大小信息。  </p>
<p><strong>示例 1：</strong>  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">node1 &#123;</span><br><span class="line">    <span class="meta">#address-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">    <span class="meta">#size-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">    node1-child &#123;</span><br><span class="line">        reg = &lt;<span class="number">0x02200000</span> <span class="number">0x4000</span>&gt;;</span><br><span class="line">        <span class="comment">// 其他属性和子节点的定义</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>在这个示例中， node1-child 节点的 reg 属性使用了 &lt;0x02200000 0x4000&gt; 表示地址和大小。由于 #address-cells 的值为 &lt;1&gt;， 表示使用一个单元来表示地址。 #size-cells 的值也为 &lt;1&gt;， 表示使用一个单元来表示大小。解释后的地址和大小值如下：      </p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">地址部分： 0x02200000 被解释为一个地址单元， 地址为 0x02200000。</span><br><span class="line">大小部分： 0x4000 被解释为一个大小单元， 大小为 0x4000。</span><br></pre></td></tr></table></figure>

<p><strong>示例 2：</strong>  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">node1 &#123;</span><br><span class="line">    <span class="meta">#address-cells = <span class="string">&lt;2&gt;</span>;</span></span><br><span class="line">    <span class="meta">#size-cells = <span class="string">&lt;0&gt;</span>;</span></span><br><span class="line">    node1-child &#123;</span><br><span class="line">        reg = &lt;<span class="number">0x0000</span> <span class="number">0x0001</span>&gt;;</span><br><span class="line">        <span class="comment">// 其他属性和子节点的定义</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>在这个示例中， node1-child 节点的 reg 属性使用了 &lt;0x0000 0x0001&gt; 表示地址。 由于 #address-cells 的值为 &lt;2&gt;， 表示使用两个单元来表示地址。 #size-cells 的值为 &lt;0&gt;， 表示不使用单元来表示大小。解释后的地址值如下：  </p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">地址部分：0x0000 0x0001 被解释为两个地址单元， 其中第一个地址单元为 0x0000， 第二个地址单元为 0x0001。</span><br><span class="line">大小部分：#size-cells为0，表示没有大小部分</span><br></pre></td></tr></table></figure>

<p><strong>示例3：</strong></p>
<p>一段内存，怎么描述它的起始地址和大小？如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/ &#123;</span><br><span class="line">    <span class="meta">#address-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">    <span class="meta">#size-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">    memory &#123;</span><br><span class="line">        reg = &lt;<span class="number">0x80000000</span> <span class="number">0x20000000</span>&gt;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>#address-cells 为 1，所以 reg 中用 1 个数来表示地址，即用0x80000000 来表示地址； #size-cells 为 1，所以 reg 中用 1 个数来表示大小，即用 0x20000000 表示大小  </p>
<p>这种使用 #address-cells 和 #size-cells 属性的方式使得设备树可以适应不同设备的寄存器映射和大小表示方式， 并确保设备树解析软件能够正确解释设备的地址和大小信息。  </p>
<h4 id="2-2-6-ranges"><a href="#2-2-6-ranges" class="headerlink" title="2.2.6 ranges  "></a><font size=3>2.2.6 ranges  </font></h4><p>ranges属性值可以为空或者按照(child-bus-address,parent-bus-address,length)格式编写的数字矩阵， ranges 是一个地址映射&#x2F;转换表， ranges 属性每个项目由子地址、父地址和地址空间长度这三部分组成：  </p>
<p><strong>child-bus-address</strong>：子总线地址空间的物理地址，由父节点的#address-cells 确定此物理地址所占用的字长。</p>
<p><strong>parent-bus-address</strong>： 父总线地址空间的物理地址，同样由父节点的#address-cells 确定此物理地址所占用的字长。</p>
<p><strong>length</strong>： 子地址空间的长度，由父节点的#size-cells 确定此地址长度所占用的字长。</p>
<p>如果 ranges 属性值为空值，说明子地址空间和父地址空间完全相同，不需要进行地址转换，对于我们所使用的 I.MX6ULL 来说，子地址空间和父地址空间完全相同，因此会在 imx6ull.dtsi中找到大量的值为空的 ranges 属性：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">soc &#123;</span><br><span class="line">	<span class="meta">#address-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">	<span class="meta">#size-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">	compatible = <span class="string">&quot;simple-bus&quot;</span>;</span><br><span class="line">	interrupt-parent = &lt;&amp;gpc&gt;;</span><br><span class="line">	ranges;</span><br><span class="line">	<span class="comment">//......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ranges 属性不为空的示例代码如下:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">soc &#123;</span><br><span class="line">	compatible = <span class="string">&quot;simple-bus&quot;</span>;</span><br><span class="line">	<span class="meta">#address-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">	<span class="meta">#size-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">	ranges = &lt;<span class="number">0x0</span> <span class="number">0xe0000000</span> <span class="number">0x00100000</span>&gt;;</span><br><span class="line"></span><br><span class="line">	serial &#123;</span><br><span class="line">		device_type = <span class="string">&quot;serial&quot;</span>;</span><br><span class="line">		compatible = <span class="string">&quot;ns16550&quot;</span>;</span><br><span class="line">		reg = &lt;<span class="number">0x4600</span> <span class="number">0x100</span>&gt;;</span><br><span class="line">		clock-frequency = &lt;<span class="number">0</span>&gt;;</span><br><span class="line">		interrupts = &lt;<span class="number">0xA</span> <span class="number">0x8</span>&gt;;</span><br><span class="line">		interrupt-parent = &lt;&amp;ipic&gt;;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>第5行：节点 soc 定义的 ranges 属性，值为&lt;0x0 0xe0000000 0x00100000&gt;，此属性值指定了一个 1024KB(0x00100000)的地址范围，子地址空间的物理起始地址为 0x0，父地址空间的物理起始地址为 0xe0000000。  </p>
<p>第 10 行， serial 是串口设备节点， reg 属性定义了 serial 设备寄存器的起始地址为 0x4600，寄存器长度为 0x100。经过地址转换， serial 设备可以从 0xe0004600 开始进行读写操作， 0xe0004600 &#x3D; 0x4600 + 0xe0000000。  </p>
<h4 id="2-2-7-name"><a href="#2-2-7-name" class="headerlink" title="2.2.7 name"></a><font size=3>2.2.7 name</font></h4><p>name 属性值为字符串， name 属性用于记录节点名字， name 属性已经被弃用，不推荐使用name 属性，一些老的设备树文件可能会使用此属性。  </p>
<h4 id="2-2-8-device-type"><a href="#2-2-8-device-type" class="headerlink" title="2.2.8 device_type"></a><font size=3>2.2.8 device_type</font></h4><p>device_type 属性值为字符串， IEEE 1275 会用到此属性，用于描述设备的 FCode，但是设备树没有 FCode，所以此属性也被抛弃了。此属性只能用于 cpu 节点或者 memory 节点。imx6ull.dtsi 的 cpu0 节点用到了此属性，内容如下所示：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cpu0: cpu@<span class="number">0</span> &#123;</span><br><span class="line">	compatible = <span class="string">&quot;arm,cortex-a7&quot;</span>;</span><br><span class="line">	device_type = <span class="string">&quot;cpu&quot;</span>;</span><br><span class="line">	reg = &lt;<span class="number">0</span>&gt;;</span><br><span class="line">	<span class="comment">// ......</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>device_type 节点的存在有助于操作系统或其他软件识别和处理设备。 它提供了设备的基本分类信息， 使得驱动程序、 设备树解析器或其他系统组件能够根据设备的类型执行相应的操作。常见的设备类型包括但不限于：</p>
<p>（1） cpu： 表示中央处理器。</p>
<p>（2） memory： 表示内存设备。</p>
<p>（3） display： 表示显示设备， 如液晶显示屏。</p>
<p>（4） serial： 表示串行通信设备， 如串口。</p>
<p>（5） ethernet： 表示以太网设备。</p>
<p>（6） usb： 表示通用串行总线设备。</p>
<p>（7） i2c： 表示使用 I2C (Inter-Integrated Circuit) 总线通信的设备。</p>
<p>（8） spi： 表示使用 SPI (Serial Peripheral Interface) 总线通信的设备。</p>
<p>（9） gpio： 表示通用输入&#x2F;输出设备。</p>
<p>（10） pwm： 表示脉宽调制设备。</p>
<p>这些只是一些常见的设备类型示例， 实际上， 设备类型可以根据具体的硬件和设备树的使用情况进行自定义和扩展。 根据设备类型， 操作系统或其他软件可以加载适当的驱动程序、 配置设备资源、 建立设备之间的连接等。  </p>
<h4 id="2-2-9-自定义属性"><a href="#2-2-9-自定义属性" class="headerlink" title="2.2.9 自定义属性"></a><font size=3>2.2.9 自定义属性</font></h4><p>设备树中的自定义属性是用户根据特定需求添加的属性。 这些属性可以用于提供额外的信息、 配置参数或元数据， 以满足设备或系统的特定要求。  </p>
<p>在设备树中添加自定义属性时， 可以在设备节点或其他适当的节点下定义新的属性。 自定义属性可以是整数、 字符串、 布尔值或其他数据类型。 它们的命名应遵循设备树的命名约定，并且应该与已有的属性名称避免冲突。  </p>
<p>例如可以在设备树中自定义一个管脚标号的属性 pinnum， 添加好的设备树源码如下所示  ：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">my_device &#123;</span><br><span class="line">    compatible = <span class="string">&quot;my_device&quot;</span>;</span><br><span class="line">    pinnum = &lt;<span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span>&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>在上述示例中， my_device 是一个自定义设备节点， 并添加了一个自定义属性 pinnum。 该属性的值 &lt;0 1 2 3 4&gt; 是一个整数数组， 表示管脚的标号（ PIN number） 。  </p>
<p>通过这样定义 pinnum 属性， 可以在设备树中为特定设备指定管教标号， 以便操作系统、驱动程序或其他软件组件使用。 这可以用于在设备初始化或配置过程中对特定管教进行操作或控制。  </p>
<h3 id="2-3-修改节点"><a href="#2-3-修改节点" class="headerlink" title="2.3 修改节点"></a><font size=3>2.3 修改节点</font></h3><h4 id="2-3-1-修改方式"><a href="#2-3-1-修改方式" class="headerlink" title="2.3.1 修改方式"></a><font size=3>2.3.1 修改方式</font></h4><p>产品开发过程中可能面临着频繁的需求更改，设备树节点可能也需要进行修改，可以有以下两种方式：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在根节点之外使用 label 引用 node：</span></span><br><span class="line">&amp;uart0 &#123;</span><br><span class="line">	status = “disabled”;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//或在根节点之外使用全路径：</span></span><br><span class="line">&amp;&#123;/uart@fe001000&#125; &#123;</span><br><span class="line">	status = “disabled”;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-3-2-修改实例"><a href="#2-3-2-修改实例" class="headerlink" title="2.3.2 修改实例"></a><font size=3>2.3.2 修改实例</font></h4><p>比如第一版硬件上有一个 IIC 接口的六轴芯片 MPU6050，第二版硬件又要把这个 MPU6050 更换为 MPU9250 等。一旦硬件修改了，我们就要同步的修改设备树文件，毕竟设备树是描述板子硬件信息的文件。假设现在有个六轴芯片fxls8471， fxls8471 要接到 I.MX6U-ALPHA 开发板的 I2C1 接口上，那么相当于需要在 i2c1 这个节点上添加一个 fxls8471 子节点。  先看一下 I2C1 接口对应的节点，打开文件 <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/arch/arm/boot/dts/imx6ul.dtsi#L886">imx6ul.dtsi</a> 文件，找到如下所示内容：  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">i2c1: i2c@<span class="number">21</span>a0000 &#123;</span><br><span class="line">    <span class="meta">#address-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">    <span class="meta">#size-cells = <span class="string">&lt;0&gt;</span>;</span></span><br><span class="line">    compatible = <span class="string">&quot;fsl,imx6ul-i2c&quot;</span>, <span class="string">&quot;fsl,imx21-i2c&quot;</span>;</span><br><span class="line">    reg = &lt;<span class="number">0x021a0000</span> <span class="number">0x4000</span>&gt;;</span><br><span class="line">    interrupts = &lt;GIC_SPI <span class="number">36</span> IRQ_TYPE_LEVEL_HIGH&gt;;</span><br><span class="line">    clocks = &lt;&amp;clks IMX6UL_CLK_I2C1&gt;;</span><br><span class="line">    status = <span class="string">&quot;disabled&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>这个就是 I.MX6ULL 的 I2C1 节点，现在要在 i2c1 节点下创建一个子节点，这个子节点就是 fxls8471，最简单的方法就是在 i2c1 下直接添加一个名为 fxls8471 的子节点，如下所示：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">i2c1: i2c@<span class="number">21</span>a0000 &#123;</span><br><span class="line">    <span class="meta">#address-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">    <span class="meta">#size-cells = <span class="string">&lt;0&gt;</span>;</span></span><br><span class="line">    compatible = <span class="string">&quot;fsl,imx6ul-i2c&quot;</span>, <span class="string">&quot;fsl,imx21-i2c&quot;</span>;</span><br><span class="line">    reg = &lt;<span class="number">0x021a0000</span> <span class="number">0x4000</span>&gt;;</span><br><span class="line">    interrupts = &lt;GIC_SPI <span class="number">36</span> IRQ_TYPE_LEVEL_HIGH&gt;;</span><br><span class="line">    clocks = &lt;&amp;clks IMX6UL_CLK_I2C1&gt;;</span><br><span class="line">    status = <span class="string">&quot;disabled&quot;</span>;</span><br><span class="line">    <span class="comment">//fxls8471 子节点</span></span><br><span class="line">    fxls8471@<span class="number">1</span>e &#123;</span><br><span class="line">        compatible = <span class="string">&quot;fsl,fxls8471&quot;</span>;</span><br><span class="line">        reg = &lt;<span class="number">0x1e</span>&gt;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>第 10 ~ 12 行就是添加的 fxls8471 这个芯片对应的子节点。但是这样会有个问题！ i2c1 节点是定义在  <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/arch/arm/boot/dts/imx6ul.dtsi#L886">imx6ul.dtsi</a> 文件中的，而 <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/arch/arm/boot/dts/imx6ul.dtsi#L886">imx6ul.dtsi</a> 是设备树头文件，其他所有使用到 I.MX6ULL这颗 SOC 的板子都会引用  <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/arch/arm/boot/dts/imx6ul.dtsi#L886">imx6ul.dtsi</a> 这个文件。直接在 i2c1 节点中添加 fxls8471 就相当于在其他的所有板子上都添加了 fxls8471 这个设备，但是其他的板子并没有这个设备！因此，按照上面这样写肯定是不行的。  </p>
<p>这里就要引入另外一个内容，那就是如何向节点追加数据，我们现在要解决的就是如何向i2c1 节点追加一个名为 fxls8471 的子节点，而且不能影响到其他使用到 I.MX6ULL 的板子。I.MX6U-ALPHA 开发板使用的设备树文件为 imx6ull-alpha-emmc.dts，因此我们需要在imx6ull-alpha-emmc.dts 文件中完成数据追加的内容，方式如下:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&amp;i2c1 &#123;</span><br><span class="line">	<span class="comment">/* 要追加或修改的内容 */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>&amp;i2c1 表示要访问 i2c1 这个 label 所对应的节点，也就是 <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/arch/arm/boot/dts/imx6ul.dtsi#L886">imx6ul.dtsi</a> 中的“i2c1: i2c@021a0000”。花括号内就是要向 i2c1 这个节点添加的内容，包括修改某些属性的值。  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&amp;i2c1 &#123;</span><br><span class="line">	clock-frequency = &lt;<span class="number">100000</span>&gt;;</span><br><span class="line">	pinctrl-names = <span class="string">&quot;default&quot;</span>;</span><br><span class="line">	pinctrl<span class="number">-0</span> = &lt;&amp;pinctrl_i2c1&gt;;</span><br><span class="line">	status = <span class="string">&quot;okay&quot;</span>;</span><br><span class="line">	<span class="comment">//fxls8471 子节点</span></span><br><span class="line">	fxls8471@<span class="number">1</span>e &#123;</span><br><span class="line">		compatible = <span class="string">&quot;fsl,fxls8471&quot;</span>;</span><br><span class="line">		reg = &lt;<span class="number">0x1e</span>&gt;;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>因为示例代码中的内容是 imx6ull-alpha-emmc.dts 这个文件内的，所以不会对使用 I.MX6ULL 这颗 SOC 的其他板子造成任何影响。这个就是向节点追加或修改内容，重点就是通过&amp;label 来访问节点，然后直接在里面编写要追加或者修改的内容。  </p>
<h2 id="3-特殊节点"><a href="#3-特殊节点" class="headerlink" title="3. 特殊节点"></a><font size=3>3. 特殊节点</font></h2><h3 id="3-1-根节点"><a href="#3-1-根节点" class="headerlink" title="3.1 根节点"></a><font size=3>3.1 根节点</font></h3><p>dts 文件中必须有一个根节点：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/dts-v1/;</span><br><span class="line">/ &#123;</span><br><span class="line">    model = <span class="string">&quot;SMDK24440&quot;</span>;</span><br><span class="line">    compatible = <span class="string">&quot;samsung,smdk2440&quot;</span>;</span><br><span class="line">    <span class="meta">#address-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">    <span class="meta">#size-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>根节点中至少应该有这些属性:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">compatible  <span class="comment">// 定义一系列的字符串, 用来指定内核中哪个 machine_desc 可以支持本设备</span></span><br><span class="line">			<span class="comment">// 即这个板子兼容哪些平台</span></span><br><span class="line">			<span class="comment">// uImage : smdk2410 smdk2440 mini2440 ==&gt; machine_desc</span></span><br><span class="line">model       <span class="comment">// 这个板子是什么</span></span><br><span class="line">			<span class="comment">// 比如有 2 款板子配置基本一致, 它们的 compatible 是一样的</span></span><br><span class="line">			<span class="comment">// 那么就通过 model 来分辨这 2 款板子</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-CPU-节点"><a href="#3-2-CPU-节点" class="headerlink" title="3.2 CPU 节点  "></a><font size=3>3.2 CPU 节点  </font></h3><p>一般不需要我们设置，在 dtsi 文件中都定义好了：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cpus &#123;</span><br><span class="line">    <span class="meta">#address-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">    <span class="meta">#size-cells = <span class="string">&lt;0&gt;</span>;</span></span><br><span class="line">    cpu0: cpu@<span class="number">0</span> &#123;</span><br><span class="line">    	<span class="comment">// .......</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-memory-节点"><a href="#3-3-memory-节点" class="headerlink" title="3.3 memory 节点  "></a><font size=3>3.3 memory 节点  </font></h3><p>芯片厂家不可能事先确定我们的板子使用多大的内存，所以 memory 节点需要板厂设置，比如：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">memory &#123;</span><br><span class="line">	reg = &lt;<span class="number">0x80000000</span> <span class="number">0x20000000</span>&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-chosen-节点"><a href="#3-4-chosen-节点" class="headerlink" title="3.4 chosen 节点  "></a><font size=3>3.4 chosen 节点  </font></h3><h4 id="3-4-1-节点说明"><a href="#3-4-1-节点说明" class="headerlink" title="3.4.1 节点说明"></a><font size=3>3.4.1 节点说明</font></h4><p>chosen 并不是一个真实的设备， chosen 节点主要是为了 uboot 向 Linux 内核传递数据，重点是 bootargs 参数。它位于设备树的根部， 并具有路径&#x2F;chosen。    </p>
<p>chosen 节点通常包含以下子节点和属性：</p>
<p>（1） bootargs： 用于存储引导内核时传递的命令行参数。 它可以包含诸如内核参数、 设备树参数等信息。 在引导过程中， 操作系统或引导加载程序可以读取该属性来获取启动参数。</p>
<p>（2） stdout-path： 用于指定用于标准输出的设备路径。 在引导过程中， 操作系统可以使用该属性来确定将控制台输出发送到哪个设备， 例如串口或显示屏。</p>
<p>（ 3） firmware-name： 用于指定系统固件的名称。 它可以用于标识所使用的引导加载程序或固件的类型和版本。</p>
<p>（ 4） linux,initrd-start 和 linux,initrd-end： 这些属性用于指定 Linux 内核初始化 RAM 磁盘（ initrd） 的起始地址和结束地址。 这些信息在引导过程中被引导加载程序使用， 以将 initrd 加载到内存中供内核使用。</p>
<p>（ 5） 其他自定义属性： chosen 节点还可以包含其他自定义属性， 用于存储特定于系统引导和配置的信息。 这些属性的具体含义和用法取决于设备树的使用和上下文。</p>
<p>通过使用 chosen 节点， 系统引导过程中的相关信息可以方便地传递给操作系统或引导加载程序。 这样， 系统引导和配置的各个组件可以共享和访问这些信息， 从而实现更灵活和可配置的系统引导流程。 chosen 节点提供了一种通用的机制， 使得不同的设备树和引导系统可以在传递信息方面保持一致性， 并且可以根据具体需求扩展和自定义。  </p>
<h4 id="3-4-2-节点示例"><a href="#3-4-2-节点示例" class="headerlink" title="3.4.2 节点示例"></a><font size=3>3.4.2 节点示例</font></h4><p>关于 chosen 节点的实际例子如下所示：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chosen &#123;</span><br><span class="line">        bootargs=<span class="string">&quot;quiet initcall_debug=y earlycon console=ttyS0,115200&quot;</span>;</span><br><span class="line">        <span class="built_in">stdout</span>-path = &amp;uart0;</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>

<p>我们可以看一下chosen节点中bootargs的值：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/device-tree/chosen/bootargs</span><br></pre></td></tr></table></figure>

<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250218185719092.png" alt="image-20250218185719092"  />

<p>但是有一些chosen节点是这样的，可以看一下 <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/arch/arm/boot/dts/imx6ul-14x14-evk.dtsi#L10">imx6ul-14x14-evk.dtsi</a>，在一开始的时候，这个评估板默认的设备树中这个节点是这样的：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chosen &#123;</span><br><span class="line">    <span class="built_in">stdout</span>-path = &amp;uart1;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>可以看出， chosen 节点仅仅设置了属性“stdout-path”，表示标准输出使用 uart1。但是当我们进入到&#x2F;proc&#x2F;device-tree&#x2F;chosen 目录里面，会发现多了 bootargs 这个属性，输入 cat 命令查看 bootargs 这个文件的内容，结果如图:</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250309151938826.png"  />

<h4 id="3-4-3-参数的传递"><a href="#3-4-3-参数的传递" class="headerlink" title="3.4.3 参数的传递"></a><font size=3>3.4.3 参数的传递</font></h4><p>上面imx6ull的例子中，bootargs 这个文件的内容为“console&#x3D;ttymxc0,115200……”，仔细一看，这个不就是我们在 uboot 中设置的 bootargs 环境变量的值吗？</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250309152429056.png" alt="image-20250309152429056" />

<p>根据设备树的chosen节点情况，现在有两个疑点 ：</p>
<p>（1）我们并没有在设备树中设置 chosen 节点的 bootargs 属性，那么图 43.6.2.1 中 bootargs这个属性是怎么产生的？</p>
<p>（2）为何 bootargs 文件的内容和 uboot 中 bootargs 环境变量的值一样？它们之间有什么关系？</p>
<p>前面学习 uboot 的时候应该有了解过， uboot 在启动 Linux 内核的时候会将 bootargs 的值传递给 Linux内核， bootargs 会作为 Linux 内核的命令行参数， Linux 内核启动的时候会打印出命令行参数(也就是 uboot 传递进来的 bootargs 的值)，如图：</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250309152522796.png" alt="image-20250309152522796" />

<p>既然 chosen 节点的 bootargs 属性不是我们在设备树里面设置的，那么只有一种可能，那就是 uboot 自己在 chosen 节点里面添加了 bootargs 属性！并且设置 bootargs 属性的值为 bootargs环境变量的值。因为在启动 Linux 内核之前，只有 uboot 知道 bootargs 环境变量的值，并且 uboot也知道.dtb 设备树文件在 DRAM 中的位置。在 uboot 源码中全局搜索“ chosen”这个字符串，果然不出所料，在<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/u-boot/v2019.04/source/common/fdt_support.c#L274">fdt_support.c - common&#x2F;fdt_support.c</a> 文件中发现了“chosen”的身影，文件中有个 fdt_chosen 函数，此函数内容如下所示：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">fdt_chosen</span><span class="params">(<span class="type">void</span> *fdt)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span>   nodeoffset;</span><br><span class="line">	<span class="type">int</span>   err;</span><br><span class="line">	<span class="type">char</span>  *str;		<span class="comment">/* used to set string properties */</span></span><br><span class="line"></span><br><span class="line">	err = fdt_check_header(fdt);</span><br><span class="line">	<span class="keyword">if</span> (err &lt; <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;fdt_chosen: %s\n&quot;</span>, fdt_strerror(err));</span><br><span class="line">		<span class="keyword">return</span> err;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* find or create &quot;/chosen&quot; node. */</span></span><br><span class="line">	nodeoffset = fdt_find_or_add_subnode(fdt, <span class="number">0</span>, <span class="string">&quot;chosen&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span> (nodeoffset &lt; <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">return</span> nodeoffset;</span><br><span class="line"></span><br><span class="line">	str = env_get(<span class="string">&quot;bootargs&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span> (str) &#123;</span><br><span class="line">		err = fdt_setprop(fdt, nodeoffset, <span class="string">&quot;bootargs&quot;</span>, str,</span><br><span class="line">				  <span class="built_in">strlen</span>(str) + <span class="number">1</span>);</span><br><span class="line">		<span class="keyword">if</span> (err &lt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;WARNING: could not set bootargs %s.\n&quot;</span>,</span><br><span class="line">			       fdt_strerror(err));</span><br><span class="line">			<span class="keyword">return</span> err;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> fdt_fixup_stdout(fdt, nodeoffset);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第 <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/u-boot/v2019.04/source/common/fdt_support.c#L287">287</a> 行，调用函数 fdt_find_or_add_subnode 从设备树(.dtb)中找到 chosen 节点，如果没有找到的话就会自己创建一个 chosen 节点。</p>
<p>第 <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/u-boot/v2019.04/source/common/fdt_support.c#L291">291</a> 行，读取 uboot 中 bootargs 环境变量的内容。</p>
<p>第 <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/u-boot/v2019.04/source/common/fdt_support.c#L293">293</a> 行，调用函数 fdt_setprop 向 chosen 节点添加 bootargs 属性，并且 bootargs 属性的值就是环境变量 bootargs 的内容。</p>
<p>就是 uboot 中的 fdt_chosen 函数在设备树的 chosen 节点中加入了 bootargs属性，并且还设置了 bootargs 属性值。fdt_chosen 函数调用流程 如下：</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250218191119287.png" alt="image-20250218191119287"  />

<p>框起来的部分就是函数 <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/u-boot/v2019.04/source/arch/arm/lib/bootm.c#L412">do_bootm_linux()</a> 函数的执行流程，也就是说 <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/u-boot/v2019.04/source/arch/arm/lib/bootm.c#L412">do_bootm_linux()</a> 函数会通过一系列复杂的调用，最终通过 <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/u-boot/v2019.04/source/common/fdt_support.c#L274">fdt_chosen()</a> 函数在 chosen 节点中加入了 bootargs 属性。而我们通过 bootz 命令启动 Linux 内核的时候会运行 <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/u-boot/v2019.04/source/arch/arm/lib/bootm.c#L412">do_bootm_linux()</a> 函数，而运行到这个函数，是因为启动的时候是这样的：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bootz 80800000 – 83000000</span><br></pre></td></tr></table></figure>

<p>当我们输入上述命令并执行以后， <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/u-boot/v2019.04/source/cmd/bootz.c#L60">do_bootz()</a> 函数就会执行，然后一切就按照上图中所示的流程开始运行。  </p>
<h3 id="3-5-aliases-节点"><a href="#3-5-aliases-节点" class="headerlink" title="3.5 aliases 节点"></a><font size=3>3.5 aliases 节点</font></h3><p>aliases 节点是一个特殊的节点， 用于定义设备别名。 该节点位于设备树的根部， 并具有节点路径 &#x2F;aliases。</p>
<p>aliases 节点是一个容器节点， 包含一组属性， 每个属性都代表一个设备别名。 每个属性的名称是别名的标识符， 而属性的值是被引用设备节点的路径或设备树中其他节点的路径。</p>
<p>如何在设备树中使用 aliases 节点呢，可以看一下下面的例子：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">aliases &#123;</span><br><span class="line">	mmc0 = &amp;sdmmc0;</span><br><span class="line">    mmc1 = &amp;sdmmc1;</span><br><span class="line">    mmc2 = &amp;sdhci;</span><br><span class="line">    serial0 = <span class="string">&quot;/simple@fe000000/seria1@11c500&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>（1） mmc0 别名与设备树中的 sdmmc0 节点相关联。 通过使用别名 mmc0， 其他设备节点或客户端程序可以更方便地引用 sdmmc0 节点， 而不必直接使用其完整路径。</p>
<p>（2） mmc1 别名与设备树中的 sdmmc1 节点相关联。 通过使用别名 mmc1， 其他设备节点或客户端程序可以更方便地引用 sdmmc1 节点， 而不必直接使用其完整路径。</p>
<p>（3） mmc2 别名与设备树中的 sdhci 节点相关联。 通过使用别名 mmc2， 其他设备节点或客户端程序可以更方便地引用 sdhci 节点， 而不必直接使用其完整路径。</p>
<p>（4） serial0 别名与设备树中的路径 &#x2F;simple@fe000000&#x2F;seria1@11c500 相关联。 通过使用别名 serial0， 其他设备节点或客户端程序可以更方便地引用该路径， 而不必记住整个路径字符串</p>
<p>在别名的定义中， &amp; 符号用于引用设备树中的节点。 别名的目的是提供可读性更高的名称，使设备树更易于理解和维护。 通过使用别名， 可以简化设备节点之间的关联， 并减少重复输入设备节点的路径。不过我们一般会在节点命名的时候会加上 label，然后通过&amp;label来访问节点，这样也很方便，而且设备树里面大量的使用&amp;label 的形式来访问节点。  </p>
<p>客户端程序可以使用别名属性名称来引用完整的设备路径或部分路径。 当客户端程序将别名字符串视为设备路径时， 应检测并使用别名。 这样， 设备树的使用者可以更方便地引用设备节点， 而不必记住复杂的路径结构。</p>
<p>需要注意的是， aliases 节点中定义的别名只在<strong>设备树内部可见</strong>， 不能在设备树之外引用。它们主要用于设备树的内部组织和引用， 以提高可读性和可维护性。</p>
<h1 id="二、实例分析"><a href="#二、实例分析" class="headerlink" title="二、实例分析"></a><font size=3>二、实例分析</font></h1><p>这里我们对着设备树中不同的节点做具体的分析，来了解一下常用的节点的一些属性的写法。这里我是看的rk3568的教程学习的，这里就以rk3568为例，虽然芯片不同，但是设备树的语法都是一样的。</p>
<h2 id="1-中断"><a href="#1-中断" class="headerlink" title="1. 中断"></a><font size=3>1. 中断</font></h2><h3 id="1-1-中断相关属性"><a href="#1-1-中断相关属性" class="headerlink" title="1.1 中断相关属性"></a><font size=3>1.1 中断相关属性</font></h3><p>下面展示的是 iTOP-RK3568 开发板 SDK 源码中的 ft5x06 设备树， 其中就是关于中断相关的描述， 包括了 interrupts、 interrupt-controller、 #interrupt-cells、 interrupt-parent四种常见属性： </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">gpio0: gpio@fdd60000 &#123;</span><br><span class="line">    compatible = <span class="string">&quot;rockchip,gpio-bank&quot;</span>;</span><br><span class="line">    reg = &lt;<span class="number">0x0</span> <span class="number">0xfdd60000</span> <span class="number">0x0</span> <span class="number">0x100</span>&gt;;</span><br><span class="line">    interrupts = &lt;GIC_SPI <span class="number">33</span> IRQ_TYPE_LEVEL_HIGH&gt;;</span><br><span class="line">    clocks = &lt;&amp;pmucru PCLK_GPI00&gt;, &lt;&amp;pmucru DBCLK_GPI00&gt;;</span><br><span class="line">    gpio-controller;</span><br><span class="line">    <span class="meta">#gpio-cells = <span class="string">&lt;2&gt;</span>;</span></span><br><span class="line">    gpio-ranges = &lt;&amp;pinctrl <span class="number">0</span> <span class="number">0</span> <span class="number">32</span>&gt;;</span><br><span class="line">    interrupt-controller;</span><br><span class="line">    <span class="meta">#interrupt-cells = <span class="string">&lt;2&gt;</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line">ft5x06: ft5x06@<span class="number">38</span> &#123;</span><br><span class="line">    status = <span class="string">&quot;disabled&quot;</span>;</span><br><span class="line">    compatible = <span class="string">&quot;edt,edt-ft5306&quot;</span>;</span><br><span class="line">    reg = &lt;<span class="number">0x38</span>&gt;;</span><br><span class="line">    touch-gpio = &lt;&amp;gpio0 RK_PB5 IRQ_TYPE_EDGE_RISING&gt;;</span><br><span class="line">    interrupt-parent = &lt;&amp;gpio0&gt;;</span><br><span class="line">    interrupts = &lt;RK_PB5 IRQ_TYPE_LEVEL_LOW&gt;;</span><br><span class="line">    reset-gpios = &lt;&amp;gpio0 RK_PB6 GPIO_ACTIVE_LOW&gt;;</span><br><span class="line">    touchscreen-size-x = &lt;<span class="number">800</span>&gt;;</span><br><span class="line">    touchscreen-size-y = &lt;<span class="number">1280</span>&gt;;</span><br><span class="line">    touch_type = &lt;<span class="number">1</span>&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="1-1-1-interrupts"><a href="#1-1-1-interrupts" class="headerlink" title="1.1.1 interrupts  "></a><font size=3>1.1.1 interrupts  </font></h4><p>interrupts 属性用于指定设备的中断相关信息。 它描述了中断控制器的类型、 中断号以及中断触发类型。前面列举的设备树源码中的gpio0节点和ft5x06节点都涉及到了interrupts 属性，如下所示：     </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">gpio0: gpio@fdd60000 &#123;</span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line">    interrupts = &lt;GIC_SPI <span class="number">33</span> IRQ_TYPE_LEVEL_HIGH&gt;;</span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line">&#125;;</span><br><span class="line">ft5x06: ft5x06@<span class="number">38</span> &#123;</span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line">    interrupts = &lt;RK_PB5 IRQ_TYPE_LEVEL_LOW&gt;;</span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>gpio0 节点的 interrupts 具有三个参数， 分别表示中断控制器类型、 中断号和中断触发类型，每个参数的具体描述如下所示：  </p>
<ul>
<li>（1） 中断控制器类型</li>
</ul>
<p>interrupts 属性的第一个参数指定了中断控制器的类型。 常见的类型包括 GIC (Generic Interrupt Controller)、 IRQ (Basic Interrupt Handling) 等。 例如， 在给定的代码片段中， GIC_SPI 表示中断控制器的类型为 GIC SPI 中断。  </p>
<p>中断控制器负责管理系统中的中断信号， 它可以是硬件中的专用中断控制器， 也可以是处理器内部的中断控制器。  </p>
<ul>
<li>（2）中断号</li>
</ul>
<p>interrupts 属性的第二个参数指定了设备所使用的中断号。 中断号是一个唯一标识符， 用于区分不同的中断信号源。 系统使用中断号来识别中断源并进行相应的中断处理。</p>
<p>中断号可以是一个整数值， 也可以是一个宏定义或符号引用。 在给定的代码片段中， 33 表示该设备使用的中断号为 33。</p>
<ul>
<li>（3） 中断触发类型</li>
</ul>
<p>interrupts 属性的第三个参数指定了中断的触发类型， 即中断信号的触发条件。 常见的触发类型包括边沿触发和电平触发。  </p>
<p>边沿触发表示中断信号在从低电平到高电平或从高电平到低电平的变化时触发。 触发类型可以是上升沿触发、 下降沿触发或双边沿触发。 电平触发表示中断信号在保持特定电平状态时触发， 可以是高电平触发或低电平触发。</p>
<p>在给定的代码片段中， IRQ_TYPE_LEVEL_HIGH 表示中断的触发类型为高电平触发。 触发类型的宏定义在内核源码“<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/dt-bindings/interrupt-controller/irq.h">irq.h - include&#x2F;dt-bindings&#x2F;interrupt-controller&#x2F;irq.h</a>” 目录下， 具体内容如下所示：  </p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> IRQ_TYPE_NONE 0 		<span class="comment">// 无中断触发类型</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRQ_TYPE_EDGE_RISING 1  <span class="comment">// 上升沿触发</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRQ_TYPE_EDGE_FALLING 2 <span class="comment">// 下降沿触发</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRQ_TYPE_EDGE_BOTH (IRQ_TYPE_EDGE_FALLING | IRQ_TYPE_EDGE_RISING)<span class="comment">// 双边沿触发</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRQ_TYPE_LEVEL_HIGH 4 	<span class="comment">// 高电平触发</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRQ_TYPE_LEVEL_LOW 8 	<span class="comment">// 低电平触发</span></span></span><br></pre></td></tr></table></figure>

<p>而在 ft5x06 节点中只有中断号和中断触发类型两个参数， 这是为什么呢?我们继续往下学习。</p>
<h4 id="1-1-2-interrupt-controller"><a href="#1-1-2-interrupt-controller" class="headerlink" title="1.1.2 interrupt-controller  "></a><font size=3>1.1.2 interrupt-controller  </font></h4><p>interrupt-controller 属性是设备树中用于描述中断控制器的属性之一。 它提供了关于中断控制器的相关信息， 以便操作系统和其他设备能够正确配置和使用中断系统。  </p>
<p>interrupt-controller 属性用于标识当前节点所描述的设备是一个中断控制器。 中断控制器是硬件或软件模块， 负责管理和分发中断信号。 它接收来自各种设备的中断请求， 并根据优先级和配置规则分发中断给相应的处理器或设备。  </p>
<p>interrupt-controller 属性本身没有特定的属性值， 只需出现在节点的属性列表中即可。 出现该属性的存在即表示该节点描述的设备是中断控制器。  </p>
<h4 id="1-1-3-interrupt-parent"><a href="#1-1-3-interrupt-parent" class="headerlink" title="1.1.3 interrupt-parent  "></a><font size=3>1.1.3 interrupt-parent  </font></h4><p>interrupt-parent 属性是设备树中用于建立中断信号源与中断控制器之间关联的属性。 它指定了中断信号源所属的中断控制器节点， 以确保正确的中断处理和分发。  </p>
<p>interrupt-parent 属性用于指定中断信号源所属的中断控制器。 中断信号源是产生中断的设备或其他中断源节点。 通过指定中断控制器， 操作系统可以正确地将中断请求传递给相应的中断控制器节点进行处理和分发。  </p>
<p>interrupt-parent 属性值是一个引用， 它指向中断控制器节点的路径或标签。 可以使用路径来引用中断控制器节点， 如&#x2F;interrupt-controller-node， 或使用标签来引用中断控制器节点， 如&amp;interrupt-controller-label， 在前面例子中的 ft5x06 就是通过中断控制器节点和 gpio0 中断控制器建立了联系， 如下所示：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ft5x06: ft5x06@<span class="number">38</span> &#123;</span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line">    interrupt-parent = &lt;&amp;gpio0&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>中断信号源节点（例如设备节点或其他中断源节点） 中的 interrupt-parent 属性用于指定中断信号源所属的中断控制器节点。 这样， 中断信号源就可以将中断请求传递给正确的中断控制器进行处理。 中断信号源节点的 interrupts 属性中的中断号和其他相关信息将与指定的中断控制器关联起来。  </p>
<p>在某些情况下， 中断控制器可以形成多级结构， 其中一个中断控制器节点可能是另一个中断控制器的父节点。 在这种情况下， interrupt-parent 属性可以用于指定层次结构中的上级中断控制器。  </p>
<h4 id="1-1-4-interrupt-cells"><a href="#1-1-4-interrupt-cells" class="headerlink" title="1.1.4 #interrupt-cells  "></a><font size=3>1.1.4 #interrupt-cells  </font></h4><p>#interrupt-cells 属性用于描述中断控制器中每个中断信号源的中断编号单元的数量。 中断编号单元是指用于表示中断号和其他相关信息的固定大小的单元。 通过指定中断编号单元的数量， 操作系统可以正确解析和处理中断信息， 并将其与中断控制器和中断信号源进行关联。  </p>
<p>#interrupt-cells 属性的值是一个整数， 表示中断编号单元的数量。 通常， 这个值是一个正整数， 例如 1、 2 或 3， 取决于中断控制器和设备的要求。  </p>
<p>在 gpio0 的中断控制器为 gic， 在 gic 节点中#interrupt-cells 属性被设置为 3， 这也就是为什么在 gpio0 节点中 interrupts 属性有三个值， 而 ft5x06 的中断控制器为 gpio0， 在 gpio0 节点中#interrupt-cells 属性被设置为 2， 所以 ft5x06 节点的 interrupts 属性只有两个值。</p>
<h3 id="1-2-中断实例"><a href="#1-2-中断实例" class="headerlink" title="1.2 中断实例"></a><font size=3>1.2 中断实例</font></h3><h4 id="1-2-1-硬件原理图"><a href="#1-2-1-硬件原理图" class="headerlink" title="1.2.1 硬件原理图"></a><font size=3>1.2.1 硬件原理图</font></h4><p>这里我们还是来看我们的imx6ull，alpha有一个按键：</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250220091647571.png" alt="image-20250220091647571" style="zoom: 33%;" />

<p>按键 KEY0 是连接到 I.MX6U 的 UART1_CTS 这个 IO 上的， KEY0接了一个 10K 的上拉电阻，因此 KEY0 没有按下的时候 UART1_CTS 应该是高电平，当 KEY0按下以后 UART1_CTS 就是低电平。搜一下参考手册就会发现，这个引脚是GPIO1_IO18  </p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250220092740884.png" alt="image-20250220092740884"  />

<h4 id="1-2-2-中断号怎么确定？"><a href="#1-2-2-中断号怎么确定？" class="headerlink" title="1.2.2 中断号怎么确定？"></a><font size=3>1.2.2 中断号怎么确定？</font></h4><p>可以看这个笔记《<a href="https://sumumm.github.io/post/b3d7ec66.html#2-%E5%A6%82%E4%BD%95%E7%A1%AE%E8%AE%A4%E4%B8%AD%E6%96%AD%E5%8F%B7">LV04-07-中断与异常-05-IMX6ULL按键中断实例 | 苏木</a>》这里再简单了解一下。我们前边知道了按键接在了GPIO1_IO18上边，我们可以查看《I.MX6UL参考手册》的3.2 Cortex A7 interrupts一节，找到这个GPIO管脚对应的中断号：</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250220093228164.png" alt="image-20250220093228164"  />

<p>可以看到GPIO1的0 -15管脚使用的是66，16 - 31使用的是67，这里只是IRQ的编号，对应到 GIC 的 SPI中断号需要在此编号基础上加上 32，所以这里的按键中断号实际为99（67+32）。但是其实在linux中开发的时候，会有函数（例如<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/arch/arm/include/asm/gpio.h#L23">gpio_to_irq()</a>）自动帮我们计算，我们只需要知道是哪个引脚就可以了。</p>
<h4 id="1-2-3-触发方式选择"><a href="#1-2-3-触发方式选择" class="headerlink" title="1.2.3 触发方式选择"></a><font size=3>1.2.3 触发方式选择</font></h4><p>触发方式就可以看这个<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/dt-bindings/interrupt-controller/irq.h">irq.h - include&#x2F;dt-bindings&#x2F;interrupt-controller&#x2F;irq.h</a>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> IRQ_TYPE_NONE 0 		<span class="comment">// 无中断触发类型</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRQ_TYPE_EDGE_RISING 1  <span class="comment">// 上升沿触发</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRQ_TYPE_EDGE_FALLING 2 <span class="comment">// 下降沿触发</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRQ_TYPE_EDGE_BOTH (IRQ_TYPE_EDGE_FALLING | IRQ_TYPE_EDGE_RISING)<span class="comment">// 双边沿触发</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRQ_TYPE_LEVEL_HIGH 4 	<span class="comment">// 高电平触发</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRQ_TYPE_LEVEL_LOW 8 	<span class="comment">// 低电平触发</span></span></span><br></pre></td></tr></table></figure>

<h4 id="1-2-4-按键中断节点"><a href="#1-2-4-按键中断节点" class="headerlink" title="1.2.4 按键中断节点"></a><font size=3>1.2.4 按键中断节点</font></h4><p>按键 KEY0 使用中断模式，需要在“key”节点下添加中断相关属性，添加完成以后的“key”节点内容如下所示：  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sdev_key &#123;</span><br><span class="line">    <span class="meta">#address-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">    <span class="meta">#size-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">    compatible = <span class="string">&quot;sdev_key&quot;</span>;</span><br><span class="line">    pinctrl-names = <span class="string">&quot;default&quot;</span>;</span><br><span class="line">    pinctrl<span class="number">-0</span> = &lt;&amp;pinctrl_key&gt;;</span><br><span class="line">    key-gpio = &lt;&amp;gpio1 <span class="number">18</span> GPIO_ACTIVE_LOW&gt;; <span class="comment">/* KEY0 */</span></span><br><span class="line">    interrupt-parent = &lt;&amp;gpio1&gt;;</span><br><span class="line">    interrupts = &lt;<span class="number">18</span> IRQ_TYPE_EDGE_BOTH&gt;; <span class="comment">/* FALLING RISING */</span></span><br><span class="line">    status = <span class="string">&quot;okay&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>第 8 行，设置 interrupt-parent 属性值为“gpio1”，因为 KEY0 所使用的 GPIO 为GPIO1_IO18，也就是设置 KEY0 的 GPIO 中断控制器为 gpio1。</p>
<p>第 9 行，设置 interrupts 属性，也就是设置中断源，第一个 cells 的 18 表示 GPIO1 组的 18号 IO。</p>
<p>这个gpio1是在 <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/arch/arm/boot/dts/imx6ul.dtsi#L432">imx6ul.dtsi</a>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">gpio1: gpio@<span class="number">209</span>c000 &#123;</span><br><span class="line">    compatible = <span class="string">&quot;fsl,imx6ul-gpio&quot;</span>, <span class="string">&quot;fsl,imx35-gpio&quot;</span>;</span><br><span class="line">    reg = &lt;<span class="number">0x0209c000</span> <span class="number">0x4000</span>&gt;;</span><br><span class="line">    interrupts = &lt;GIC_SPI <span class="number">66</span> IRQ_TYPE_LEVEL_HIGH&gt;,</span><br><span class="line">    &lt;GIC_SPI <span class="number">67</span> IRQ_TYPE_LEVEL_HIGH&gt;;</span><br><span class="line">    clocks = &lt;&amp;clks IMX6UL_CLK_GPIO1&gt;;</span><br><span class="line">    gpio-controller;</span><br><span class="line">    <span class="meta">#gpio-cells = <span class="string">&lt;2&gt;</span>;</span></span><br><span class="line">    interrupt-controller;</span><br><span class="line">    <span class="meta">#interrupt-cells = <span class="string">&lt;2&gt;</span>;</span></span><br><span class="line">    gpio-ranges = &lt;&amp;iomuxc  <span class="number">0</span> <span class="number">23</span> <span class="number">10</span>&gt;, &lt;&amp;iomuxc <span class="number">10</span> <span class="number">17</span> <span class="number">6</span>&gt;,</span><br><span class="line">    &lt;&amp;iomuxc <span class="number">16</span> <span class="number">33</span> <span class="number">16</span>&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="2-时钟"><a href="#2-时钟" class="headerlink" title="2. 时钟"></a><font size=3>2. 时钟</font></h2><p>时钟（Clock） 用于描述硬件设备和系统中的时钟源以及时钟相关的配置和连接关系。 时钟在计算机系统中起着至关重要的作用， 用于同步和定时各种硬件设备的操作。 时钟可以分为两个主要角色： 时钟生产者（clock provider） 和时钟消费者（clock consumer） 。</p>
<h3 id="2-1-时钟生产者（clock-provider）"><a href="#2-1-时钟生产者（clock-provider）" class="headerlink" title="2.1 时钟生产者（clock provider）"></a><font size=3>2.1 时钟生产者（clock provider）</font></h3><p>时钟生产者是负责生成和提供时钟信号的硬件或软件模块。 它可以是时钟控制器、PLL、 时钟发生器等。时钟节点属性如下：</p>
<ul>
<li>（1） clock-cells</li>
</ul>
<p>属性用于指定时钟编号的位数。 它是一个整数值， 表示时钟编号的位数。 通常情况下， 当 clock-cells 为 0 时表示一个时钟， 为 1 表示多个时钟。 具体示例如下所示  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//示例 1： 单个时钟</span></span><br><span class="line">osc24m: osc24m &#123;</span><br><span class="line">    compatible = <span class="string">&quot;clock&quot;</span>;</span><br><span class="line">    clock-frequency = &lt;<span class="number">24000000</span>&gt;;</span><br><span class="line">    clock-output-names = <span class="string">&quot;osc24m&quot;</span>;</span><br><span class="line">    <span class="meta">#clock-cells = <span class="string">&lt;O&gt;</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//示例 2： 多个时钟</span></span><br><span class="line">clock: clock &#123;</span><br><span class="line">    <span class="meta">#clock-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">    clock-output-names = <span class="string">&quot;clock1&quot;</span>, <span class="string">&quot;clock2&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>（2） clock-frequency</li>
</ul>
<p>clock-frequency 属性是设备树中用于指定时钟频率的属性。 它用于描述时钟节点所提供的时钟信号的频率， 使用 Hertz (Hz) 作为单位。 对于时钟生产者节点， clock-frequency 属性表示该节点生成的时钟信号的频率。 它用于描述时钟控制器、 晶振、 PLL 等产生时钟信号的硬件或软件模块的输出频率， 例如指定时钟频率为 24000000 的具体示例如下所示：  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">osc24m: osc24m &#123;</span><br><span class="line">    compatible = <span class="string">&quot;clock&quot;</span>;</span><br><span class="line">    clock-frequency = &lt;<span class="number">24000000</span>&gt;;</span><br><span class="line">    clock-output-names = <span class="string">&quot;osc24m&quot;</span>;</span><br><span class="line">    <span class="meta">#clock-cells = <span class="string">&lt;O&gt;</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>（3） assigned-clocks 和 assigned-clock-rates</li>
</ul>
<p>assigned-clocks 和 assigned-clock-rates 是设备树中用于描述多路时钟的属性， 通常一起使用。</p>
<p>assigned-clocks 属性用于标识时钟消费者节点所使用的时钟源。 它是一个整数数组， 每个元素对应一个时钟编号。 时钟编号是指时钟生产者节点（如时钟控制器） 所提供的时钟源的编号。 通过在时钟消费者节点中使用 assigned-clocks 属性， 可以指定该节点所需的时钟源。  </p>
<p>assigned-clock-rates 属性用于指定每个时钟源的时钟频率。 它是一个整数数组， 每个元素对应一个时钟源的频率。 时钟频率以 Hz (赫兹) 为单位表示。 assigned-clock-rates 属性的元素数量和顺序应与 assigned-clocks 属性中的时钟编号相对应。  </p>
<p>关于 assigned-clocks 和 assigned-clock-rates 属性的一个具体示例如下所示：  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cru: clock-controller@fdd20000 &#123;</span><br><span class="line">    <span class="meta">#clock-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">    assigned-clocks = &lt;&amp;pmucru CLK_RTC_32K&gt;, &lt;&amp;cru ACLK_RKVDEC_PRE&gt;;</span><br><span class="line">    assigned-clock-rates = &lt;<span class="number">32768</span>&gt;, &lt;<span class="number">300000000</span>&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>（4） clock-indices</li>
</ul>
<p>clock-indices 属性用于指定时钟消费者节点所使用的时钟源的索引值。它是一个整数数组， 每个元素对应一个时钟源的索引。</p>
<p>时钟索引是指时钟生产者节点（如时钟控制器） 所提供的时钟源的编号。 通过在时钟消费者节点中使用 clock-indices 属性， 可以明确指定该节点所需的时钟源， 并按照特定的顺序进行匹配。 一个 clock-indices 示例如下所示：    </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">scpi_dvfs: clocks<span class="number">-0</span> &#123;</span><br><span class="line">    <span class="meta">#clock-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">    clock-indices = &lt;<span class="number">0</span>&gt;, &lt;<span class="number">1</span>&gt;, &lt;<span class="number">2</span>&gt;;</span><br><span class="line">    clock-output-names = <span class="string">&quot;atlclk&quot;</span>, <span class="string">&quot;aplclk&quot;</span>, <span class="string">&quot;gpuclk&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line">scpi_clk: clocks<span class="number">-1</span> &#123;</span><br><span class="line">    <span class="meta">#clock-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">    clock-indices = &lt;<span class="number">3</span>&gt;;</span><br><span class="line">    clock-output-names = <span class="string">&quot;pxlclk&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>在第一个节点中”atlclk”, “aplclk”, “gpuclk”三个时钟源的索引就分别被设置为了 0、 1、 2， 在第二个节点中”pxlclk”时钟源的索引值被设置为了 3.  </p>
<ul>
<li>（5） assigned-clock-parents</li>
</ul>
<p>assigned-clock-parents 属性用于指定时钟消费者节点所使用的时钟源的父时钟源。它是一个时钟源引用的数组， 每个元素对应一个父时钟源的引用。 在时钟的层次结构中， 某些时钟源可能是其他时钟源的父时钟源， 即它们提供时钟信号给其他时钟源作为输入。 通过在时钟消费者节点中使用 assigned-clock-parents 属性， 可以明确指定该节点所需的父时钟源， 并按照特定的顺序进行匹配。 一个实际的 assigned-clock-parents 属性例子如下所示：  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">clock: clock &#123;</span><br><span class="line">    assigned-clocks = &lt;&amp;clkcon <span class="number">0</span>&gt;, &lt;&amp;pll <span class="number">2</span>&gt;;</span><br><span class="line">    assigned-clock-parents = &lt;&amp;pll <span class="number">2</span>&gt;;</span><br><span class="line">    assigned-clock-rates = &lt;<span class="number">115200</span>&gt;, &lt;<span class="number">9600</span>&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>上述设备树表示了一个名为 clock 的时钟消费者节点， 具有以下属性：  </p>
<p>assigned-clocks 属性指定了该节点使用的时钟源， 引用了两个时钟源节点： clkcon 0 和 pll 2。assigned-clock-parents 属性指定了这些时钟源的父时钟源， 引用了 pll 2 时钟源节点。assigned-clock-rates 属性指定了每个时钟源的时钟频率， 分别是 115200 和 9600。  </p>
<h3 id="2-2-时钟消费者（clock-consumer）"><a href="#2-2-时钟消费者（clock-consumer）" class="headerlink" title="2.2 时钟消费者（clock consumer）"></a><font size=3>2.2 时钟消费者（clock consumer）</font></h3><p>定义： 时钟消费者是依赖时钟信号的硬件设备或模块。 它们通过引用时钟生产者节点提供的时钟源来获取时钟信号。  时钟消费者属性如下：</p>
<ul>
<li>（1） clocks</li>
</ul>
<p>该属性用于指定时钟消费者节点所需的时钟源。 它是一个整数数组， 每个元素是一个时钟编号， 表示时钟消费者需要的一个时钟源。  </p>
<ul>
<li>（2） clock-names</li>
</ul>
<p>可选属性， 用于指定时钟消费者节点所需时钟源的名称。 它是一个字符串数组， 与 clocks 数组一一对应， 用于提供时钟源的描述性名称。</p>
<p>一个时钟消费者示例如下所示：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">clock: clock &#123;</span><br><span class="line">    clocks = &lt;&amp;cru CLK_VOP&gt;;</span><br><span class="line">    clock-names = <span class="string">&quot;clk_vop&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>clocks 属性指定了该节点使用的时钟源， 引用了 cru 节点中的 CLK_VOP 时钟源。clock-names 属性指定了时钟源的名称， 这里是 “clk_vop”。  </p>
<h2 id="3-CPU"><a href="#3-CPU" class="headerlink" title="3. CPU"></a><font size=3>3. CPU</font></h2><h3 id="3-1-cpus-节点"><a href="#3-1-cpus-节点" class="headerlink" title="3.1 cpus 节点  "></a><font size=3>3.1 cpus 节点  </font></h3><p>设备树的 cpus 节点是用于描述系统中的处理器的一个重要节点。 它是处理器拓扑结构的顶层节点， 包含了所有处理器相关的信息。   </p>
<ul>
<li>节点结构</li>
</ul>
<p>cpus 节点是一个容器节点， 其下包含了系统中每个处理器的子节点。 每个子节点的名称通常为 cpu@X， 其中 X 是处理器的索引号。 每个子节点都包含了与处理器相关的属性， 例如时钟频率、 缓存大小等。</p>
<ul>
<li>处理器属性</li>
</ul>
<p>cpu@X 子节点中的属性可以包括以下信息：  </p>
<p>（1） device_type： 指示设备类型为处理器（”cpu”） 。</p>
<p>（2） reg： 指定处理器的地址范围， 通常是物理地址或寄存器地址。</p>
<p>（3） compatible： 指定处理器的兼容性信息， 用于匹配相应的设备驱动程序。</p>
<p>（4） clock-frequency： 指定处理器的时钟频率。</p>
<p>（5） cache-size： 指定处理器的缓存大小。</p>
<ul>
<li>处理器拓扑关系</li>
</ul>
<p>除了处理器的基本属性， cpus 节点还可以包含其他用于描述处理器拓扑关系的节点， 以提供更详细的处理器拓扑信息。 这些节点可以帮助操作系统和软件了解处理器之间的连接关系、组织结构和特性。  </p>
<p>（1）cpu-map 节点： 描述处理器的映射关系， 通常在多核处理器系统中使用。</p>
<p>（2）socket 节点： 描述多处理器系统中的物理插槽或芯片组。</p>
<p>（3）cluster 节点： 描述处理器集群， 即将多个处理器组织在一起形成的逻辑组。</p>
<p>（4）core 节点： 描述处理器核心， 即一个物理处理器内的独立执行单元。</p>
<p>（5）thread 节点： 描述处理器线程， 即一个物理处理器核心内的线程。</p>
<p>这些节点的嵌套关系可以在 cpus 节点下形成一个层次结构， 反映了处理器的拓扑结构。上述这些节点会在后面的小节进行介绍。 一个单核 CPU 设备树和一个四核 CPU 设备树示例如下所示：  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 单核CPU</span></span><br><span class="line">cpus &#123;</span><br><span class="line">    <span class="meta">#address-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">    <span class="meta">#size-cells = <span class="string">&lt;0&gt;</span>;</span></span><br><span class="line">    cpu0: cpu@<span class="number">0</span> &#123;</span><br><span class="line">        compatible = <span class="string">&quot;arm,cortex-a7&quot;</span>;</span><br><span class="line">        device_type = <span class="string">&quot;cpu&quot;</span>;</span><br><span class="line">        <span class="comment">// 其他属性...</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 多核CPU</span></span><br><span class="line">cpus &#123;</span><br><span class="line">    <span class="meta">#address-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">    <span class="meta">#size-cells = <span class="string">&lt;0&gt;</span>;</span></span><br><span class="line">    cpu0: cpu@<span class="number">0</span> &#123;</span><br><span class="line">        device_type = <span class="string">&quot;cpu&quot;</span>;</span><br><span class="line">        compatible = <span class="string">&quot;arm,cortex-a9&quot;</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    cpu1: cpu@<span class="number">1</span> &#123;</span><br><span class="line">        device_type = <span class="string">&quot;cpu&quot;</span>;</span><br><span class="line">        compatible = <span class="string">&quot;arm,cortex-a9&quot;</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    cpu2: cpu@<span class="number">2</span> &#123;</span><br><span class="line">        device_type = <span class="string">&quot;cpu&quot;</span>;</span><br><span class="line">        compatible = <span class="string">&quot;arm,cortex-a9&quot;</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    cpu3: cpu@<span class="number">3</span> &#123;</span><br><span class="line">        device_type = <span class="string">&quot;cpu&quot;</span>;</span><br><span class="line">        compatible = <span class="string">&quot;arm,cortex-a9&quot;</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>c pus 节点是一个容器节点， 包含了 cpu0 子节点。 该节点使用了 #address-cells 和 #size-cell s 属性来指定地址和大小的单元数量。cpu0 子节点代表第一个处理器，compatible 属性指定了处理器的兼容性信息，device_type 属性指示设备类型为处理器。还可以在此基础上继续添加其他属性来描述处理器的特性， 如时钟频率、 缓存大小等。    </p>
<h3 id="3-2-cpu-map、-socket、-cluster-节点"><a href="#3-2-cpu-map、-socket、-cluster-节点" class="headerlink" title="3.2 cpu-map、 socket、 cluster 节点  "></a><font size=3>3.2 cpu-map、 socket、 cluster 节点  </font></h3><p>cpu-map 节点是设备树中用于描述大小核架构处理器的映射关系的节点之一。 它的父节点必须是 cpus 节点， 而子节点可以是一个或多个 cluster 和 socket 节点。 通过 cpu-map 节点， 可以定义不同核心和集群之间的连接和组织结构。  </p>
<p>socket 节点用于描述处理器插槽（socket） 之间的映射关系。 每个 socket 子节点表示一个处理器插槽， 可以使用 cpu-map-mask 属性来指定该插槽使用的核心。 通过为每个 socket 子节点指定适当的 cpu-map-mask， 可以定义不同插槽中使用的核心。 这样， 操作系统和软件可以了解到不同插槽之间的核心分配情况。    </p>
<p>cluster 节点用于描述核心（cluster） 之间的映射关系。 每个 cluster 子节点表示一个核心集群， 可以使用 cpu-map-mask 属性来指定该集群使用的核心。 通过为每个 cluster 子节点指定适当的 cpu-map-mask， 可以定义每个集群中使用的核心。 这样， 操作系统和软件可以了解到不同集群之间的核心分配情况。  </p>
<p>通过在 cpu-map 节点中定义 socket 和 cluster 子节点， 并为它们指定适当的 cpu-map-mask，可以提供处理器的拓扑结构信息。 这对于操作系统和软件来说非常有用， 因为它们可以根据这些信息进行任务调度和资源分配的优化， 以充分利用大小核架构处理器的性能和能效特性。  </p>
<p>一个大小核架构的具体示例如下所示：  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">cpus &#123;</span><br><span class="line">    <span class="meta">#address-cells = <span class="string">&lt;2&gt;</span>;</span></span><br><span class="line">    <span class="meta">#size-cells = <span class="string">&lt;0&gt;</span>;</span></span><br><span class="line">    cpu-<span class="built_in">map</span> &#123;</span><br><span class="line">        cluster0 &#123;</span><br><span class="line">            core0 &#123;</span><br><span class="line">                cpu = &lt;&amp;cpu_l0&gt;;</span><br><span class="line">            &#125;;</span><br><span class="line">            core1 &#123;</span><br><span class="line">                cpu = &lt;&amp;cpu_l1&gt;;</span><br><span class="line">            &#125;;</span><br><span class="line">            core2 &#123;</span><br><span class="line">                cpu = &lt;&amp;cpu_l2&gt;;</span><br><span class="line">            &#125;;</span><br><span class="line">            core3 &#123;</span><br><span class="line">                cpu = &lt;&amp;cpu_l3&gt;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">        cluster1 &#123;</span><br><span class="line">            core0 &#123;</span><br><span class="line">                cpu = &lt;&amp;cpu_b0&gt;;</span><br><span class="line">            &#125;;</span><br><span class="line">            core1 &#123;</span><br><span class="line">                cpu = &lt;&amp;cpu_b1&gt;;</span><br><span class="line">            &#125;;</span><br><span class="line">		&#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">    cpu_l0: cpu@<span class="number">0</span> &#123;</span><br><span class="line">        device_type = <span class="string">&quot;cpu&quot;</span>;</span><br><span class="line">    	compatible = <span class="string">&quot;arm,cortex-a53&quot;</span>, <span class="string">&quot;arm,armv8&quot;</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    cpu_l1: cpu@<span class="number">1</span> &#123;</span><br><span class="line">        device_type = <span class="string">&quot;cpu&quot;</span>;</span><br><span class="line">        compatible = <span class="string">&quot;arm,cortex-a53&quot;</span>, <span class="string">&quot;arm,armv8&quot;</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    cpu_l2: cpu@<span class="number">2</span> &#123;</span><br><span class="line">        device_type = <span class="string">&quot;cpu&quot;</span>;</span><br><span class="line">        compatible = <span class="string">&quot;arm,cortex-a53&quot;</span>, <span class="string">&quot;arm,armv8&quot;</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    cpu_l3: cpu@<span class="number">3</span> &#123;</span><br><span class="line">        device_type = <span class="string">&quot;cpu&quot;</span>;</span><br><span class="line">        compatible = <span class="string">&quot;arm,cortex-a53&quot;</span>, <span class="string">&quot;arm,armv8&quot;</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    cpu_b0: cpu@<span class="number">100</span> &#123;</span><br><span class="line">        device_type = <span class="string">&quot;cpu&quot;</span>;</span><br><span class="line">        compatible = <span class="string">&quot;arm,cortex-a72&quot;</span>, <span class="string">&quot;arm,armv8&quot;</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    cpu_b1: cpu@<span class="number">101</span> &#123;</span><br><span class="line">        device_type = <span class="string">&quot;cpu&quot;</span>;</span><br><span class="line">        compatible = <span class="string">&quot;arm,cortex-a72&quot;</span>, <span class="string">&quot;arm,armv8&quot;</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个设备树描述了一个具有多个 CPU 核心的系统， 包括四个 Cortex-A53 核心和两个Cortex-A72 核心。 </p>
<p>（1）#address-cells &#x3D; &lt;2&gt;; 和 #size-cells &#x3D; &lt;0&gt;;： 这些属性指定了设备树中地址和大小的编码方式。</p>
<p>（2）cpu-map ： 这个节点定义了CPU的映射关系。它包含了两个簇（ clusters ） ： cluster0 和 cluster1。 cluster0 包含了四个核心： core0、 core1、 core2 和 core3， 分别对应 cpu_l0、cpu_l1、 cpu_l2 和 cpu_l3。 cluster1 包含了两个核心： core0 和 core1， 分别对应 cpu_b0 和 cpu_b1。    </p>
<p>（3）cpu_l0、 cpu_l1、 cpu_l2 和 cpu_l3： 这些节点描述了 Cortex-A53 核心。 它们具有相同的设备类型 cpu 和兼容性属性 “arm,cortex-a53”, “arm,armv8”。  </p>
<p>（4）cpu_b0 和 cpu_b1： 这些节点描述了 Cortex-A72 核心。 它们具有相同的设备类型 cpu 和兼容性属性 “arm,cortex-a72”, “arm,armv8”。    </p>
<h3 id="3-3-core、-thread-节点"><a href="#3-3-core、-thread-节点" class="headerlink" title="3.3 core、 thread 节点  "></a><font size=3>3.3 core、 thread 节点  </font></h3><p>“core” 和 “thread” 节点通常用于描述处理器核心和线程的配置。</p>
<ul>
<li><p>Core 节点用于描述处理器的核心。 一个处理器通常由多个核心组成， 每个核心可以独立执行指令和任务。</p>
</li>
<li><p>Thread 节点用于描述处理器的线程。 线程是在处理器核心上执行的基本执行单元， 每个核心可以支持多个线程。</p>
</li>
</ul>
<p>通过使用 Core 和 Thread 节点， 设备树可以准确描述处理器的核心和线程的配置， 例如可以使用设备树来描述一个具有 16 个核心的 CPU， 一个物理插槽， 每个集群中有两个核心，每个核心有两个线程的设备树示例， 具体设备树如下所示：  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">cpus &#123;</span><br><span class="line">    <span class="meta">#address-cells = <span class="string">&lt;2&gt;</span>;</span></span><br><span class="line">    cpu-<span class="built_in">map</span> &#123;</span><br><span class="line">        socket0 &#123;</span><br><span class="line">            cluster0 &#123;</span><br><span class="line">                core0 &#123;</span><br><span class="line">                    thread0 &#123;</span><br><span class="line">                        cpu = &lt;&amp;CPU0&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                    thread1 &#123;</span><br><span class="line">                        cpu = &lt;&amp;CPU1&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">                    core1 &#123;</span><br><span class="line">                    thread0 &#123;</span><br><span class="line">                        cpu = &lt;&amp;CPU2&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                    thread1 &#123;</span><br><span class="line">                        cpu = &lt;&amp;CPU3&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">            cluster1 &#123;</span><br><span class="line">                core0 &#123;</span><br><span class="line">                    thread0 &#123;</span><br><span class="line">                        cpu = &lt;&amp;CPU4&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                    thread1 &#123;</span><br><span class="line">                        cpu = &lt;&amp;CPU5&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">                core1 &#123;</span><br><span class="line">                    thread0 &#123;</span><br><span class="line">                        cpu = &lt;&amp;CPU6&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                    thread1 &#123;</span><br><span class="line">                        cpu = &lt;&amp;CPU7&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">        socket1 &#123;</span><br><span class="line">            cluster0 &#123;</span><br><span class="line">                core0 &#123;</span><br><span class="line">                    thread0 &#123;</span><br><span class="line">                        cpu = &lt;&amp;CPU8&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                    thread1 &#123;</span><br><span class="line">                        cpu = &lt;&amp;CPU9&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">                core1 &#123;</span><br><span class="line">                    thread0 &#123;</span><br><span class="line">                        cpu = &lt;&amp;CPU10&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                    thread1 &#123;</span><br><span class="line">                        cpu = &lt;&amp;CPU11&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">            cluster1 &#123;</span><br><span class="line">                core0 &#123;</span><br><span class="line">                    thread0 &#123;</span><br><span class="line">                        cpu = &lt;&amp;CPU12&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                    thread1 &#123;</span><br><span class="line">                        cpu = &lt;&amp;CPU13&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">                core1 &#123;</span><br><span class="line">                    thread0 &#123;</span><br><span class="line">                        cpu = &lt;&amp;CPU14&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                    thread1 &#123;</span><br><span class="line">                        cpu = &lt;&amp;CPU15&gt;;</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="4-GPIO"><a href="#4-GPIO" class="headerlink" title="4. GPIO"></a><font size=3>4. GPIO</font></h2><h3 id="4-1-gpio相关属性"><a href="#4-1-gpio相关属性" class="headerlink" title="4.1 gpio相关属性"></a><font size=3>4.1 gpio相关属性</font></h3><p>下面的是 iTOP-RK3568 开发板 SDK 源码中的 ft5x06 设备树中关于 gpio 相关的描述， 包括了 interrupts、 interrupt-controller、 #interrupt-cells、 interrupt-parent四种常见属性：  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">gpio0: gpio@fdd60000 &#123;</span><br><span class="line">    compatible = <span class="string">&quot;rockchip,gpio-bank&quot;</span>;</span><br><span class="line">    reg = &lt;<span class="number">0x0</span> <span class="number">0xfdd60000</span> <span class="number">0x0</span> <span class="number">0x100</span>&gt;;</span><br><span class="line">    interrupts = &lt;GIC_SPI <span class="number">33</span> IRQ_TYPE_LEVEL_HIGH&gt;;</span><br><span class="line">    clocks = &lt;&amp;pmucru PCLK_GPI00&gt;, &lt;&amp;pmucru DBCLK_GPI00&gt;;</span><br><span class="line">    gpio-controller;</span><br><span class="line">    <span class="meta">#gpio-cells = <span class="string">&lt;2&gt;</span>;</span></span><br><span class="line">    gpio-ranges = &lt;&amp;pinctrl <span class="number">0</span> <span class="number">0</span> <span class="number">32</span>&gt;;</span><br><span class="line">    interrupt-controller;</span><br><span class="line">    <span class="meta">#interrupt-cells = <span class="string">&lt;2&gt;</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line">ft5x06: ft5x06@<span class="number">38</span> &#123;</span><br><span class="line">    status = <span class="string">&quot;disabled&quot;</span>;</span><br><span class="line">    compatible = <span class="string">&quot;edt,edt-ft5306&quot;</span>;</span><br><span class="line">    reg = &lt;<span class="number">0x38</span>&gt;;</span><br><span class="line">    touch-gpio = &lt;&amp;gpio0 RK_PB5 IRQ_TYPE_EDGE_RISING&gt;;</span><br><span class="line">    interrupt-parent = &lt;&amp;gpio0&gt;;</span><br><span class="line">    interrupts = &lt;RK_PB5 IRQ_TYPE_LEVEL_LOW&gt;;</span><br><span class="line">    reset-gpios = &lt;&amp;gpio0 RK_PB6 GPIO_ACTIVE_LOW&gt;;</span><br><span class="line">    touchscreen-size-x = &lt;<span class="number">800</span>&gt;;</span><br><span class="line">    touchscreen-size-y = &lt;<span class="number">1280</span>&gt;;</span><br><span class="line">    touch_type = &lt;<span class="number">1</span>&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="4-1-1-gpio-controller"><a href="#4-1-1-gpio-controller" class="headerlink" title="4.1.1 gpio-controller"></a><font size=3>4.1.1 gpio-controller</font></h4><p>gpio-controller 属性用于标识一个设备节点作为 GPIO 控制器。 GPIO 控制器是负责管理和控制 GPIO 引脚的硬件模块或驱动程序。通常作为设备节点的一个属性出现， 位于设备节点的属性列表中。    </p>
<p>当一个设备节点被标识为 GPIO 控制器时， 它通常会定义一组 GPIO 引脚， 并提供相关的GPIO 控制和配置功能。 其他设备节点可以使用该 GPIO 控制器来控制和管理其 GPIO 引脚。  </p>
<p>通过使用 gpio-controller 属性， 设备树可以明确标识出 GPIO 控制器设备节点， 使系统可以正确识别和管理 GPIO 引脚的配置和控制。  </p>
<h4 id="4-1-2-gpio-cells"><a href="#4-1-2-gpio-cells" class="headerlink" title="4.1.2 #gpio-cells  "></a><font size=3>4.1.2 #gpio-cells  </font></h4><p>#gpio-cells 属性用于指定 GPIO 引脚描述符的编码方式。 GPIO 引脚描述符是用于标识和配置 GPIO 引脚的一组值， 例如引脚编号、 引脚属性等。这个属性的属性值是一个整数， 表示用于编码 GPIO 引脚描述符的单元数。 通常，这个值为 2。  </p>
<p>在示例中有 1 个 gpio 引脚描述属性,由于#gpio-cells 属性被设置为了 2， 所以每个引脚描述属性中会有两个整数， 具体内容如下所示：  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ft5x06: ft5x06@<span class="number">38</span> &#123;</span><br><span class="line">    <span class="comment">//.....</span></span><br><span class="line">    reset-gpios = &lt;&amp;gpio0 RK_PB6 GPIO_ACTIVE_LOW&gt;;</span><br><span class="line">    <span class="comment">//.....</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>通过使用#gpio-cells 属性， 设备树可以指定 GPIO 引脚描述符的编码方式， 使系统能够正确识别和解析 GPIO 引脚的配置和控制。  </p>
<h4 id="4-1-3-gpio-ranges"><a href="#4-1-3-gpio-ranges" class="headerlink" title="4.1.3 gpio-ranges"></a><font size=3>4.1.3 gpio-ranges</font></h4><p>gpio-ranges 属性是设备树中一个用于描述 GPIO 范围映射的属性。 它通常用于描述具有大量 GPIO 引脚的 GPIO 控制器， 以简化 GPIO 引脚的编码和访问。  </p>
<p>在设备树中， GPIO 控制器的每个引脚都有一个本地编号， 用于在控制器内部进行引脚寻址。 然而， 这些本地编号并不一定与外部引脚的物理编号或其他系统中使用的编号一致。 为了解决这个问题， 可以使用 gpio-ranges 属性将本地编号映射到实际的引脚编号。  </p>
<p>gpio-ranges属性是一个包含一系列整数值的列表， 每个整数值对应于设备树中的一个GPIO控制器。 列表中的每个整数值按照特定的顺序提供以下信息：  </p>
<p>（1） 外部引脚编号的起始值。</p>
<p>（2） GPIO 控制器内部本地编号的起始值。</p>
<p>（3） 引脚范围的大小（引脚数量） 。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gpio0: gpio@fdd60000 &#123;</span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">    gpio-controller;</span><br><span class="line">    <span class="meta">#gpio-cells = <span class="string">&lt;2&gt;</span>;</span></span><br><span class="line">    gpio-ranges = &lt;&amp;pinctrl <span class="number">0</span> <span class="number">0</span> <span class="number">32</span>&gt;;</span><br><span class="line">	<span class="comment">//......</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>gpio-ranges 属性的值为&lt;&amp;pinctrl 0 0 32&gt;， 其中&lt;&amp;pinctrl&gt;表示引用了名为 pinctrl 的引脚控制器节点， 0 0 32 表示外部引脚从 0 开始， 控制器本地编号从 0 开始， 共映射了 32 个引脚。  </p>
<p>这样， gpio-ranges 属性将 GPIO 控制器的本地编号直接映射到外部引脚编号， 使得 GPIO 引脚的编码和访问更加简洁和直观。  </p>
<h4 id="4-1-4-gpio-引脚描述属性"><a href="#4-1-4-gpio-引脚描述属性" class="headerlink" title="4.1.4 gpio 引脚描述属性  "></a><font size=3>4.1.4 gpio 引脚描述属性  </font></h4><p>示例中设备树中关于 gpio 引脚描述属性相关内容如下所示：  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">gpio0: gpio@fdd60000 &#123;</span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">    <span class="meta">#gpio-cells = <span class="string">&lt;2&gt;</span>;</span></span><br><span class="line">	<span class="comment">//......</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ft5x06: ft5x06@<span class="number">38</span> &#123;</span><br><span class="line">    <span class="comment">//.....</span></span><br><span class="line">    reset-gpios = &lt;&amp;gpio0 RK_PB6 GPIO_ACTIVE_LOW&gt;;</span><br><span class="line">    <span class="comment">//.....</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>gpio 引脚描述属性个数由#gpio-cells 所决定， 因为 gpio0 节点中的#gpio-cells 属性设置为了2， 所以上面设备树 gpio 引脚描述属性个数也为 2。  RK_PB6是引脚名，GPIO_ACTIVE_LOW  表示设置为低电平。</p>
<h4 id="4-1-5-其他属性"><a href="#4-1-5-其他属性" class="headerlink" title="4.1.5 其他属性  "></a><font size=3>4.1.5 其他属性  </font></h4><p>根据下面的设备树示例学习一下 gpio 的其他重要属性， 设备树具体内容如下所示：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">gpio-controller@<span class="number">00000000</span> &#123;</span><br><span class="line">    compatible = <span class="string">&quot;foo&quot;</span>;</span><br><span class="line">    reg = &lt;<span class="number">0x00000000</span> <span class="number">0x1000</span>&gt;;</span><br><span class="line">    gpio-controller;</span><br><span class="line">    <span class="meta">#gpio-cells = <span class="string">&lt;2&gt;</span>;</span></span><br><span class="line">    ngpios = &lt;<span class="number">18</span>&gt;;</span><br><span class="line">    gpio-reserved-ranges = &lt;<span class="number">0</span> <span class="number">4</span>&gt;, &lt;<span class="number">12</span> <span class="number">2</span>&gt;;</span><br><span class="line">    gpio-line-names = <span class="string">&quot;MMC-CD&quot;</span>, <span class="string">&quot;MMC-WP&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;voD eth&quot;</span>, <span class="string">&quot;RST eth&quot;</span>, <span class="string">&quot;LED R&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;LED G&quot;</span>, <span class="string">&quot;LED B&quot;</span>, <span class="string">&quot;col A&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;col B&quot;</span>, <span class="string">&quot;col C&quot;</span>, <span class="string">&quot;col D&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;NMI button&quot;</span>, <span class="string">&quot;Row A&quot;</span>, <span class="string">&quot;Row B&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;Row C&quot;</span>, <span class="string">&quot;Row D&quot;</span>, <span class="string">&quot;poweroff&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;reset&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>第 6 行的 ngpios 属性指定了 GPIO 控制器所支持的 GPIO 引脚数量。 它表示该设备上可用的 GPIO 引脚的总数。 在这个例子中， ngpios 的值为 18， 意味着该 GPIO 控制器支持 18个 GPIO 引脚。  </p>
<p>第 7 行的 gpio-reserved-ranges 属性定义了保留的 GPIO 范围。每个范围由两个整数值表示，用尖括号括起来。 保留的 GPIO 范围意味着这些 GPIO 引脚不可用或已被其他设备或功能保留。在这个例子中， 有两个保留范围： &lt;0 4&gt;和&lt;12 2&gt;。 &lt;0 4&gt;表示从第 0 个引脚开始的连续 4 个引脚被保留， 而&lt;12 2&gt;表示从第 12 个引脚开始的连续 2 个引脚被保留。  </p>
<p>第 8 行的 gpio-line-names 属性定义了 GPIO 引脚的名称， 以逗号分隔。 每个名称对应一个GPIO 引脚。 这些名称用于标识和识别每个 GPIO 引脚的作用或连接的设备。 在这个例子中， gpio-line-names 属性列出了多个 GPIO 引脚的名称， 如 “MMC-CD”、 “MMC-WP”、 “voD eth” 等等。 通过这些名称， 可以清楚地了解每个 GPIO 引脚的功能或用途。  </p>
<h3 id="4-2-GPIO实例"><a href="#4-2-GPIO实例" class="headerlink" title="4.2 GPIO实例"></a><font size=3>4.2 GPIO实例</font></h3><h4 id="4-2-1-硬件原理图"><a href="#4-2-1-硬件原理图" class="headerlink" title="4.2.1 硬件原理图"></a><font size=3>4.2.1 硬件原理图</font></h4><img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250220163438114.png" alt="image-20250220163438114" style="zoom: 50%;" />

<p>查看原理图会发现LED0 接到了 GPIO_3 上， 这里的GPIO_3 就是 GPIO1_IO03，当 GPIO1_IO03输出低电平(0)的时候发光二极管 LED0 就会导通点亮，当 GPIO1_IO03 输出高电平(1)的时候发光二极管 LED0 不会导通，因此 LED0 也就不会点亮。所以 LED0 的亮灭取决于 GPIO1_IO03的输出电平，输出 0 就亮，输出 1 就灭。  </p>
<h4 id="4-2-2-led灯节点"><a href="#4-2-2-led灯节点" class="headerlink" title="4.2.2 led灯节点"></a><font size=3>4.2.2 led灯节点</font></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sdev_led &#123;</span><br><span class="line">	<span class="meta">#address-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">	<span class="meta">#size-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">	compatible = <span class="string">&quot;sdev-led&quot;</span>;</span><br><span class="line">	status = <span class="string">&quot;okay&quot;</span>;</span><br><span class="line">	reg = &lt; <span class="number">0X020C406C</span> <span class="number">0X04</span> <span class="comment">/* CCM_CCGR1_BASE */</span></span><br><span class="line">			<span class="number">0X020E0068</span> <span class="number">0X04</span> <span class="comment">/* SW_MUX_GPIO1_IO03_BASE */</span></span><br><span class="line">			<span class="number">0X020E02F4</span> <span class="number">0X04</span> <span class="comment">/* SW_PAD_GPIO1_IO03_BASE */</span></span><br><span class="line">			<span class="number">0X0209C000</span> <span class="number">0X04</span> <span class="comment">/* GPIO1_DR_BASE */</span></span><br><span class="line">			<span class="number">0X0209C004</span> <span class="number">0X04</span> &gt;; <span class="comment">/* GPIO1_GDIR_BASE */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>第 2、 3 行，属性#address-cells 和#size-cells 都为 1，表示 reg 属性中起始地址占用一个字长(cell)，地址长度也占用一个字长(cell)。</p>
<p>第 4 行，属性 compatbile 设置 alphaled 节点兼容性为“sdev-led”。</p>
<p>第 5 行，属性 status 设置状态为“okay”。</p>
<p>第 6 ~ 10 行， reg 属性设置了驱动里面所要使用的寄存器物理地址，比如第 6 行的“0X020C406C 0X04”表示 I.MX6ULL 的 CCM_CCGR1 寄存器，其中寄存器首地址为 0X020C406C，长度为 4 个字节。</p>
<h2 id="5-pinctrl"><a href="#5-pinctrl" class="headerlink" title="5. pinctrl  "></a><font size=3>5. pinctrl  </font></h2><h3 id="5-1-pinmux-简介"><a href="#5-1-pinmux-简介" class="headerlink" title="5.1 pinmux 简介  "></a><font size=3>5.1 pinmux 简介  </font></h3><h4 id="5-1-1-什么是pinmux"><a href="#5-1-1-什么是pinmux" class="headerlink" title="5.1.1 什么是pinmux"></a><font size=3>5.1.1 什么是pinmux</font></h4><p>Pinmux（ 引脚复用） 是指在系统中配置和管理引脚功能的过程。 在许多现代集成电路中，单个引脚可以具有多个功能， 例如作为 GPIO、 UART、 SPI 或 I2C 等。 通过使用引脚复用功能，可以在这些不同的功能之间切换。  </p>
<p>引脚复用通过硬件和软件的方式实现。 硬件层面， 芯片设计会为每个引脚提供多个功能的选择。 这些功能通常由芯片厂商在芯片规格文档中定义。 通过编程设置寄存器或开关， 可以选择某个功能来连接引脚。 这种硬件层面的配置通常是由引脚控制器（Pin Controller） 或引脚复用控制器（ Pin Mux Controller） 负责管理。  </p>
<p>软件层面， 操作系统或设备驱动程序需要了解和配置引脚的功能。 它们使用设备树（ Device Tree） 或设备树绑定（ Device Tree Bindings） 来描述和配置引脚的功能。 在设备树中， 可以指定引脚的复用功能， 将其连接到特定的硬件接口或功能。 操作系统或设备驱动程序在启动过程中解析设备树， 并根据配置对引脚进行初始化和设置。  </p>
<h4 id="5-1-2-imx6ull的引脚复用"><a href="#5-1-2-imx6ull的引脚复用" class="headerlink" title="5.1.2 imx6ull的引脚复用"></a><font size=3>5.1.2 imx6ull的引脚复用</font></h4><p>那我们要怎样知晓每一个管脚都可以复用成什么功能呢，对于我使用的alpha-imx6ull开发板，我们可以直接查看《i.MX 6ULL Applications Processor Reference Manual.pdf》手册的32.6 IOMUXC Memory Map&#x2F;Register Definition 。例如前面按键是接在GPIO1_IO18上，这个引脚默认是UART1_CTS_B，这个引脚复用情况如下：</p>
  <img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250220092740884.png" alt="image-20250220092740884"  />

<h4 id="5-1-3-RK3568的引脚复用"><a href="#5-1-3-RK3568的引脚复用" class="headerlink" title="5.1.3 RK3568的引脚复用"></a><font size=3>5.1.3 RK3568的引脚复用</font></h4><p>有一些厂家给的原理图甚至会在核心板原理图标注出每个管脚的复用功能，例如讯为的RK3568开发板：</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250221093009766.png" alt="image-20250221093009766"  />

<p>从上图可以看到 UART4_RX_M1 对应的引脚可以复用为以下 6 个功能 LCDC_D16、VOP_BT1120_D7、 GMAC1_RXD0_M0、 UART4_RX_M1、 PWM8_M0、 GPIO3_B1_d， 那么对于RK3568来说，对应的 BGA引脚标号为 AG1,那这里的 AG1 是如何定位的呢。</p>
<p>在 BGA（Ball Grid Array， 球栅阵列） 封装中， 引脚标号是用于唯一标识每个引脚的标识符。这些标号通常由芯片制造商定义， 并在芯片的规格文档或数据手册中提供。  </p>
<p>BGA 芯片的引脚标号通常由字母和数字的组合构成。 它们用于在芯片的封装底部的焊盘上进行标记。 每个引脚标号都与芯片内部的功能或信号相对应， 以便正确连接到印刷电路板（ PCB） 上的目标位置。 RK3568 的引脚标号图如下：</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250221093125213.png" alt="image-20250221093125213" style="zoom: 25%;" />

<p>可以看到纵向为 A-AH 的 28 个字母类型标号， 横向为 1-28 的 28 个字母类型标号， 瑞芯微也在对应的 3568 数据手册中加入了根据 BGA 位置制作的复用功能图， 部分内容如下图  </p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250221093144491.png" alt="image-20250221093144491"  />

<p>其中黑色框代表被保留的引脚， 其他有颜色的框一般为电源和地， 白色的框代表有具体复用功能的引脚。  </p>
<h4 id="5-1-4-总结"><a href="#5-1-4-总结" class="headerlink" title="5.1.4 总结"></a><font size=3>5.1.4 总结</font></h4><p>引脚复用提高了芯片的灵活性和可重用性， 通过允许同一个引脚在不同的功能之间切换， 可以减少硬件设计的复杂性和成本。 此外， 引脚复用还使得在使用相同芯片的不同应用中可以更加灵活地配置和定制引脚功能。 </p>
<h3 id="5-2-RK3568中使用-pinctrl-设置复用关系"><a href="#5-2-RK3568中使用-pinctrl-设置复用关系" class="headerlink" title="5.2 RK3568中使用 pinctrl 设置复用关系  "></a><font size=3>5.2 RK3568中使用 pinctrl 设置复用关系  </font></h3><p>pinctrl（引脚控制） 用于描述和配置硬件设备上的引脚功能和连接方式。 它是设备树的一部分， 用于在启动过程中传递引脚配置信息给操作系统和设备驱动程序， 以便正确地初始化和控制引脚。  </p>
<p>在设备树中， pinctrl（引脚控制） 使用了客户端和服务端的概念来描述引脚控制的关系和配置。  </p>
<h4 id="5-2-1-客户端（client）"><a href="#5-2-1-客户端（client）" class="headerlink" title="5.2.1 客户端（client）"></a><font size=3>5.2.1 客户端（client）</font></h4><p>接下来将使用三个例子对客户端要用到的属性进行说明。</p>
<ul>
<li>示例1</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">node &#123;</span><br><span class="line">    pinctrl-names = <span class="string">&quot;default&quot;</span>;</span><br><span class="line">    pinctrl<span class="number">-0</span> = &lt;&amp;pinctrl_hog_1&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>pinctrl-names 属性定义了一个状态名称： default。pinctrl-0 属性指定了第一个状态 default 对应的引脚配置。&lt;&amp;pinctrl_hog_1&gt; 是一个引脚描述符， 它引用了一个名为 pinctrl_hog_1 的引脚控制器节点。 这表示在 default 状态下， 设备的引脚配置将使用 pinctrl_hog_1 节点中定义的配置。    </p>
<ul>
<li>示例2</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">node &#123;</span><br><span class="line">    pinctrl-names = <span class="string">&quot;default&quot;</span>, <span class="string">&quot;wake up&quot;</span>;</span><br><span class="line">    pinctrl<span class="number">-0</span> = &lt;&amp;pinctrl_hog_1&gt;;</span><br><span class="line">    pinctrl<span class="number">-1</span> = &lt;&amp;pinctrl_hog_2&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>pinctrl-names 属性定义了两个状态名称： default 和 wake up。pinctrl-0 属性指定了第一个状态 default 对应的引脚配置， 引用了 pinctrl_hog_1 节点。pinctrl-1 属性指定了第二个状态 wake up 对应的引脚配置， 引用了 pinctrl_hog_2 节点。</p>
<p>这意味着设备可以处于两个不同的状态之一， 每个状态分别使用不同的引脚配置。  </p>
<ul>
<li>示例3</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">node &#123;</span><br><span class="line">    pinctrl-names = <span class="string">&quot;default&quot;</span>;</span><br><span class="line">    pinctrl<span class="number">-0</span> = &lt;&amp;pinctrl_hog_1 &amp;pinctrl_hog_2&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个例子中， pinctrl-names 属性仍然定义了一个状态名称： default。pinctrl-0 属性指定了第一个状态 default 对应的引脚配置， 但与之前的例子不同的是， 它引用了两个引脚描述符： pinctrl_hog_1 和 pinctrl_hog_2。    </p>
<p>这表示在 default 状态下， 设备的引脚配置将使用 pinctrl_hog_1 和 pinctrl_hog_2 两个节点中定义的配置。 这种方式可以将多个引脚控制器的配置组合在一起， 以满足特定状态下的引脚需求。  </p>
<p>关于客户端的内容， 不同厂家的编写格式是相同的，而服务端每个厂家就有区别了。</p>
<h4 id="5-2-2-服务端（server）"><a href="#5-2-2-服务端（server）" class="headerlink" title="5.2.2 服务端（server）"></a><font size=3>5.2.2 服务端（server）</font></h4><p>服务端是设备树中定义引脚配置的部分。 它包含引脚组和引脚描述符， 为客户端提供引脚配置选择。 服务端在设备树中定义了 pinctrl 节点， 其中包含引脚组和引脚描述符的定义。  </p>
<p>这里以瑞芯微的 RK3568 为例进行 pinctrl 服务端的学习， 瑞芯微原厂 BSP 工程师为了方便用户通过 pinctrl 设置管脚的复用关系， 将包含所有复用关系的配置写在了内核（5.19.17版本，主要是因为有些版本还没加入RK系列的芯片）目录下的  <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v5.19.17/source/arch/arm64/boot/dts/rockchip/rk3568-pinctrl.dtsi">rk3568-pinctrl.dtsi - arch&#x2F;arm64&#x2F;boot&#x2F;dts&#x2F;rockchip&#x2F;rk3568-pinctrl.dtsi - Linux source code v5.19.17</a> 中。我们来看一下这个 <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v5.19.17/source/arch/arm64/boot/dts/rockchip/rk3568-pinctrl.dtsi#L13">pinctrl</a> 节点：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&amp;pinctrl &#123;</span><br><span class="line">	acodec &#123;</span><br><span class="line">		/omit-<span class="keyword">if</span>-no-ref/</span><br><span class="line">		acodec_pins: acodec-pins &#123;</span><br><span class="line">			rockchip,pins =</span><br><span class="line">				<span class="comment">/* acodec_adc_sync */</span></span><br><span class="line">				&lt;<span class="number">1</span> RK_PB1 <span class="number">5</span> &amp;pcfg_pull_none&gt;,</span><br><span class="line">				<span class="comment">/* acodec_adcclk */</span></span><br><span class="line">				&lt;<span class="number">1</span> RK_PA1 <span class="number">5</span> &amp;pcfg_pull_none&gt;,</span><br><span class="line">				<span class="comment">/* acodec_adcdata */</span></span><br><span class="line">				&lt;<span class="number">1</span> RK_PA0 <span class="number">5</span> &amp;pcfg_pull_none&gt;,</span><br><span class="line">				<span class="comment">/* acodec_dac_datal */</span></span><br><span class="line">				&lt;<span class="number">1</span> RK_PA7 <span class="number">5</span> &amp;pcfg_pull_none&gt;,</span><br><span class="line">				<span class="comment">/* acodec_dac_datar */</span></span><br><span class="line">				&lt;<span class="number">1</span> RK_PB0 <span class="number">5</span> &amp;pcfg_pull_none&gt;,</span><br><span class="line">				<span class="comment">/* acodec_dacclk */</span></span><br><span class="line">				&lt;<span class="number">1</span> RK_PA3 <span class="number">5</span> &amp;pcfg_pull_none&gt;,</span><br><span class="line">				<span class="comment">/* acodec_dacsync */</span></span><br><span class="line">				&lt;<span class="number">1</span> RK_PA5 <span class="number">5</span> &amp;pcfg_pull_none&gt;;</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>在 pinctrl 节点中就是每个节点的复用功能， 然后我们以 uart4 的引脚复用为例进行学习，<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v5.19.17/source/arch/arm64/boot/dts/rockchip/rk3568-pinctrl.dtsi#L2572">uart4</a>的 pinctrl 服务端内容如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">uart4 &#123;</span><br><span class="line">	<span class="comment">//......</span></span><br><span class="line">	/omit-<span class="keyword">if</span>-no-ref/</span><br><span class="line">	uart4m1_xfer: uart4m1-xfer &#123;</span><br><span class="line">		rockchip,pins =</span><br><span class="line">			<span class="comment">/* uart4_rxm1 */</span></span><br><span class="line">			&lt;<span class="number">3</span> RK_PB1 <span class="number">4</span> &amp;pcfg_pull_up&gt;,</span><br><span class="line">			<span class="comment">/* uart4_txm1 */</span></span><br><span class="line">			&lt;<span class="number">3</span> RK_PB2 <span class="number">4</span> &amp;pcfg_pull_up&gt;;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>其中&lt;3 RK_PB1 4 &amp;pcfg_pull_up&gt;和&lt;3 RK_PB2 4 &amp;pcfg_pull_up&gt;分别表示将 GPIO3 的 PB1 引脚设置为功能 4， 将 GPIO3 的 PB2 也设置为功能 4， 且电气属性都会设置为上拉。   </p>
<p>通过查找原理图可以得到两个引脚在 BGA 封装位置分别为 AG1 和 AF2， 如下图  ：</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250221092855296.png" alt="image-20250221092855296"  />

<p>然后在 rk3568 的数据手册中找到引脚复用表对应的位置， 具体内容如下图所示  </p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250221093541551.png" alt="image-20250221093541551" style="zoom:50%;" />

<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250221093551160.png" alt="image-20250221093551160"  />

<p>可以看到功能 4 对应串口 4 的发送端和接收端， pinctrl 服务端的配置和数据手册中的引脚复用功能是一一对应， 那如果要将 RK_PB1 和 RK_PB2 设置为 GPIO 功能要如何设置呢，从上图可以看到 GPIO 对应功能 0， 所以可以通过以下 pinctrl 内容将设置 RK_PB1 和 RK_PB2 设置为 GPIO 功能（事实上如果不对该管脚进行功能复用该引脚默认就会设置为 GPIO 功能） ：     </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="number">3</span> RK_PB1 <span class="number">0</span> &amp;pcfg_pull_up&gt;,</span><br><span class="line">&lt;<span class="number">3</span> RK_PB2 <span class="number">0</span> &amp;pcfg_pull_up&gt;;</span><br></pre></td></tr></table></figure>

<p>最后来看客户端对 uart4 服务端的引用，可能会这样写：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&amp;uart4 &#123;</span><br><span class="line">	status = <span class="string">&quot;okay&quot;</span>;</span><br><span class="line">       pinctrl-names = <span class="string">&quot;default&quot;</span>;</span><br><span class="line">       pinctrl<span class="number">-0</span> = &lt;&amp;uart4m1_xfer&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>通过在客户端中引用服务端的引脚描述符， 设备树可以将客户端和服务端的引脚配置关联起来。 这样， 在设备树被解析和处理时， 操作系统和设备驱动程序可以根据客户端的需求， 查找并应用适当的引脚配置。  </p>
<h3 id="5-3-RK3568开发板的一个实例"><a href="#5-3-RK3568开发板的一个实例" class="headerlink" title="5.3 RK3568开发板的一个实例"></a><font size=3>5.3 RK3568开发板的一个实例</font></h3><blockquote>
<p>说明：我没有这个开发板，这里是学习教程的时候直接复制过来作为参考笔记，后面在imx6ull开发板中是会再学习pinctrl 子系统，这里也能帮助理解。</p>
</blockquote>
<p>通过上面学到的 pinctrl 相关知识， 将 led 的控制引脚复用为 GPIO 模式。首先来对 rk3568 的设备树结构进行以下介绍， 根据 sdk 源码目录下的“device&#x2F;rockchip&#x2F;rk356x&#x2F;BoardConfig-rk3568-evb1-ddr4-v10.mk” 默认配置文件可以了解到编译的设备树为 rk3568 -evb1-ddr4-v10-linux.dts,整理好的设备树之间包含关系列表如下所示：</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250221095145496.png" alt="image-20250221095145496"  />

<p>Led 在 rk3568-evb.dtsi 设备树中已经被正常配置了， 如下图:</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250221095201552.png" alt="image-20250221095201552"  />

<p>这里也并没有配置 pinctrl 呀， 那为什么 led 最后能正常使用呢， 这个原因之前其实已经提到了， 当一个引脚没有被复用为任何功能时， 默认就是 GPIO 功能， 所以这里没有 pinctrl led 功能也可以正常使用。  </p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250221100143833.png" alt="image-20250221100143833"  />

<p>保存退出之后， 然后进入到 rk3568-evb1-ddr4-v10.dtsi 设备树中， 找到 rk_485_ctl 节点， 如下图  ：</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250221100203516.png" alt="image-20250221100203516"  />

<p>这是根节点的最后一个节点， 而且也是用来控制一个 GPIO 的， 我们完全可以仿照该节点，在该节点下方编写 led 控制节点， 仿写完成的设备树内容如下所示  ：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">my_led: led &#123;</span><br><span class="line">    compatible = <span class="string">&quot;topeet,led&quot;</span>;</span><br><span class="line">    gpios = &lt;&amp;gpio0 RK_PB7 GPIO_ACTIVE_HIGH&gt;;</span><br><span class="line">    pinctrl-names = <span class="string">&quot;default&quot;</span>;</span><br><span class="line">    pinctrl<span class="number">-0</span> = &lt;&amp;rk_led_gpio&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>第 1 行： 节点名称为 led， 标签名为 my_led。</p>
<p>第 2 行： compatible 属性指定了设备的兼容性标识， 即设备与驱动程序之间的匹配规则。在这里， 设备标识为 “topeet,led”， 表示该 LED 设备与名为 “topeet,led” 的驱动程序兼容。</p>
<p>第 3 行： gpios 属性指定了与 LED 相关的 GPIO（通用输入&#x2F;输出） 引脚配置。</p>
<p>第 4 行： pinctrl-names 属性指定了与引脚控制相关的命名。 default 表示状态 0</p>
<p>第 5 行： pinctrl-0 属性指定了与 pinctrl-names 属性中命名的引脚控制相关联的实际引脚控制器配置。 &lt;&amp;rk_led_gpio&gt; 表示引用了名为 rk_led_gpio 的引脚控制器配置。</p>
<p>添加完成如下图:</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250221100310837.png" alt="image-20250221100310837"  />

<p>然后继续找到在同一设备树文件的 485 pinctrl 服务端节点， 具体内容如下  ：</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250221100328129.png" alt="image-20250221100328129"  />

<p>然后在该节点下方仿写 led 控制引脚 pinctrl 服务端节点， 仿写完成的节点内容如下所示：  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rk_led&#123;</span><br><span class="line">    rk_led_gpio:rk-led-gpio &#123;</span><br><span class="line">    	rockchip,pins = &lt;<span class="number">0</span> RK_PB7 RK_FUNC_GPIO &amp;pcfg_pull_none&gt;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>添加完成之后如下图:</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-02-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%AF%AD%E6%B3%95/img/image-20250221100415836.png" alt="image-20250221100415836"  />

<p>至此， led 的控制引脚就通过 pinctrl 被复用为了 GPIO 功能， 保存退出之后， 重新编译内核，没有报错就证明我们的实例完成了。  </p>

    </div>

    
    
    

    <footer class="post-footer">




    <div>
        
            <div style="text-align:center;color: #ccc;font-size:14px;">
            ----------本文结束
            <i class="fas fa-fan fa-spin" style="color: #FF1493; font-size: 1rem"></i>
            感谢您的阅读----------
            </div>
        
    </div>





  
  <div class="my_post_copyright"> 
    <p><span>文章标题:</span><a href="/post/3a7cdf02.html">LV06-10-设备树-02-设备树语法</a></p>
    <p><span>文章作者:</span><a href="/" title="欢迎访问 《苏木》 的学习笔记">苏木</a></p>
    <p><span>发布时间:</span>2025年03月17日 - 07:45</p>
    <p><span>最后更新:</span>2025年06月14日 - 00:25</p>
    <p><span>原始链接:</span><a href="/post/3a7cdf02.html" title="LV06-10-设备树-02-设备树语法">https://sumumm.github.io/post/3a7cdf02.html</a></p>
    <p><span>许可协议:</span><i class="fab fa-creative-commons"></i> <a rel="license" href= "https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p>  
  </div>
  


          <div class="post-tags">
              <a href="/tags/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/" rel="tag"><i class="fa fa-tag"></i> LV06-驱动开发</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/post/cb9c294a.html" rel="prev" title="LV06-10-设备树-03-设备树深入分析">
                  <i class="fa fa-angle-left"></i> LV06-10-设备树-03-设备树深入分析
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/post/ad7cbef7.html" rel="next" title="LV06-10-设备树-01-设备树基础">
                  LV06-10-设备树-01-设备树基础 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2017 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">苏木</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">3.7m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">225:26</span>
  </span>
</div>




    <span id="sitetime"></span>
    <script defer language=javascript>
        function siteTime()
        {
            window.setTimeout("siteTime()", 1000);
            var seconds = 1000;
            var minutes = seconds * 60;
            var hours = minutes * 60;
            var days = hours * 24;
            var years = days * 365;
            var today = new Date();
            var todayYear = today.getFullYear();
            var todayMonth = today.getMonth()+1;
            var todayDate = today.getDate();
            var todayHour = today.getHours();
            var todayMinute = today.getMinutes();
            var todaySecond = today.getSeconds();
            /*==================================================
            Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
            year        - 作为date对象的年份，为4位年份值
            month       - 0-11之间的整数，做为date对象的月份
            day         - 1-31之间的整数，做为date对象的天数
            hours       - 0(午夜24点)-23之间的整数，做为date对象的小时数
            minutes     - 0-59之间的整数，做为date对象的分钟数
            seconds     - 0-59之间的整数，做为date对象的秒数
            microseconds - 0-999之间的整数，做为date对象的毫秒数
            ==================================================*/
            var t1 = Date.UTC(2017, 
                              5, 
                              19, 
                              0, 
                              0, 
                              0); //北京时间
            var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond);
            var diff = t2-t1;
            var diffYears = Math.floor(diff/years);
            var diffDays = Math.floor((diff/days)-diffYears*365);
            var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours);
            var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes);
            var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds);
            document.getElementById("sitetime").innerHTML="已在这里 "+diffYears+" 年 "+diffDays+" 天 "+diffHours+" 小时 "+diffMinutes+" 分钟 "+diffSeconds+" 秒";
        }
        siteTime();
    </script>



    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.umd.js" integrity="sha256-ytMJGN3toR+a84u7g7NuHm91VIR06Q41kMWDr2pq7Zo=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>


  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


 
        <div id="click-show-text"
            data-mobile = false
            data-text = 富强,民主,文明,和谐,自由,平等,公正,法制,爱国,敬业,诚信,友善
            data-fontsize = 15px
            data-random= false>
        </div>
       

      
        <script async src=https://cdn.jsdelivr.net/npm/hexo-next-mouse-effect@latest/click/showText.js></script>
      

      
    




    <script async src="/js/fancybox_param.js"></script>





<!-- APlayer本体 -->



</body>
</html>
