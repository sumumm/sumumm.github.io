<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha256-wiz7ZSCn/btzhjKDQBms9Hx4sSeUYsDrTLg7roPstac=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.css" integrity="sha256-6cQIC71/iBIYXFK+0RHAvwmjwWzkWd+r7v/BX3/vZDc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/green/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"sumumm.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.19.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":300},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="æœ¬æ–‡ä¸»è¦æ˜¯ä½¿ç”¨repoâ€”â€”repoåŸºæœ¬åŸç†çš„ç›¸å…³ç¬”è®°ï¼Œè‹¥ç¬”è®°ä¸­æœ‰é”™è¯¯æˆ–è€…ä¸åˆé€‚çš„åœ°æ–¹ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ğŸ˜ƒã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="LV03-repo-02-repoåŸºæœ¬åŸç†">
<meta property="og:url" content="https://sumumm.github.io/post/d94f8cde.html">
<meta property="og:site_name" content="è‹æœ¨">
<meta property="og:description" content="æœ¬æ–‡ä¸»è¦æ˜¯ä½¿ç”¨repoâ€”â€”repoåŸºæœ¬åŸç†çš„ç›¸å…³ç¬”è®°ï¼Œè‹¥ç¬”è®°ä¸­æœ‰é”™è¯¯æˆ–è€…ä¸åˆé€‚çš„åœ°æ–¹ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ğŸ˜ƒã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/02%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/03%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/LV03-repo-02-repo%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/img/image-20240926231102172.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/02%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/03%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/LV03-repo-02-repo%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/img/image-20240926231714368.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/02%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/03%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/LV03-repo-02-repo%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/img/image-20240926232134894.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/02%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/03%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/LV03-repo-02-repo%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/img/image-20240926232219048.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/02%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/03%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/LV03-repo-02-repo%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/img/image-20240926232316884.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/02%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/03%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/LV03-repo-02-repo%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/img/image-20240926232355572.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/02%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/03%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/LV03-repo-02-repo%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/img/image-20240926232520935.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/02%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/03%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/LV03-repo-02-repo%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/img/image-20240926232626470.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/02%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/03%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/LV03-repo-02-repo%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/img/image-20240927063837299.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/02%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/03%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/LV03-repo-02-repo%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/img/image-20240927063525511.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/02%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/03%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/LV03-repo-02-repo%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/img/image-20240927064108549.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/02%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/03%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/LV03-repo-02-repo%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/img/image-20240927064649242.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/02%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/03%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/LV03-repo-02-repo%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/img/image-20240927070242090.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/02%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/03%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/LV03-repo-02-repo%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/img/image-20240926233044031.png">
<meta property="article:published_time" content="2024-10-26T14:40:57.000Z">
<meta property="article:modified_time" content="2025-06-13T16:25:57.071Z">
<meta property="article:author" content="è‹æœ¨">
<meta property="article:tag" content="Git">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/02%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/03%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/LV03-repo-02-repo%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/img/image-20240926231102172.png">


<link rel="canonical" href="https://sumumm.github.io/post/d94f8cde.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":"","permalink":"https://sumumm.github.io/post/d94f8cde.html","path":"post/d94f8cde.html","title":"LV03-repo-02-repoåŸºæœ¬åŸç†"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>LV03-repo-02-repoåŸºæœ¬åŸç† | è‹æœ¨</title>
  








    <script src="/js/browser_tools_disable.js"></script>

  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start --><link rel="stylesheet" href="https://unpkg.com/hexo-next-tags-plus@latest/lib/tag_plus.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">è‹æœ¨</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">æˆ‘çš„å­¦ä¹ ä¹‹è·¯</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>è‹æœ¨çš„å®¶</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»é¡µ<span class="badge">42</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£é¡µ<span class="badge">673</span></a></li><li class="menu-item menu-item-flink"><a href="/flink/" rel="section"><i class="fa fa-link fa-fw"></i>å‹äººå¸</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äºæˆ‘</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86"><span class="nav-text">ä¸€ã€åŸºæœ¬åŸç†</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%85%88%E5%88%9D%E5%A7%8B%E5%8C%96%E4%B8%80%E4%B8%AArepo%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="nav-text">1. å…ˆåˆå§‹åŒ–ä¸€ä¸ªrepoå®¢æˆ·ç«¯</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E5%91%BD%E4%BB%A4%E6%80%8E%E4%B9%88%E6%89%A7%E8%A1%8C%E7%9A%84%EF%BC%9F"><span class="nav-text">2. å‘½ä»¤æ€ä¹ˆæ‰§è¡Œçš„ï¼Ÿ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-repo%E4%BB%93%E5%BA%93"><span class="nav-text">2.1 repoä»“åº“</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-1-ParseArguments"><span class="nav-text">2.1.1Â _ParseArguments()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-2-FindRepo"><span class="nav-text">2.1.2 _FindRepo</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-3-RunSelf"><span class="nav-text">2.1.3 _RunSelf()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-4-SetDefaultsTo"><span class="nav-text">2.1.4 _SetDefaultsTo()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-5-Init"><span class="nav-text">2.1.5 _Init()</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-Manifest%E4%BB%93%E5%BA%93"><span class="nav-text">2.3 Manifestä»“åº“</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-AOSP%E5%AD%90%E9%A1%B9%E7%9B%AE%E4%BB%93%E5%BA%93"><span class="nav-text">2.4 AOSPå­é¡¹ç›®ä»“åº“</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-%E5%9C%A8AOSP%E4%B8%8A%E5%88%9B%E5%BB%BATopic"><span class="nav-text">2.5 åœ¨AOSPä¸Šåˆ›å»ºTopic</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8C%E3%80%81-repo%E7%9B%B8%E5%85%B3%E7%9B%AE%E5%BD%95"><span class="nav-text">äºŒã€.repoç›¸å…³ç›®å½•</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E9%A1%B9%E7%9B%AE%E6%B8%85%E5%8D%95%E5%BA%93-repo-manifests"><span class="nav-text">1. é¡¹ç›®æ¸…å•åº“(.repo&#x2F;manifests)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-repo%E8%84%9A%E6%9C%AC%E5%BA%93-repo-repo"><span class="nav-text">2. repoè„šæœ¬åº“(.repo&#x2F;repo)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E4%BB%93%E5%BA%93%E7%9B%AE%E5%BD%95%E5%92%8C%E5%B7%A5%E4%BD%9C%E7%9B%AE%E5%BD%95"><span class="nav-text">3.Â ä»“åº“ç›®å½•å’Œå·¥ä½œç›®å½•</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="è‹æœ¨"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">è‹æœ¨</p>
  <div class="site-description" itemprop="description">è«é“æ¡‘æ¦†æ™šï¼Œä¸ºéœå°šæ»¡å¤©</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">673</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">42</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">æ ‡ç­¾</span>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/sumumm" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;sumumm" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sumumm.github.io/post/d94f8cde.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="è‹æœ¨">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è‹æœ¨">
      <meta itemprop="description" content="è«é“æ¡‘æ¦†æ™šï¼Œä¸ºéœå°šæ»¡å¤©">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="LV03-repo-02-repoåŸºæœ¬åŸç† | è‹æœ¨">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          LV03-repo-02-repoåŸºæœ¬åŸç†
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2024-10-26 22:40:57" itemprop="dateCreated datePublished" datetime="2024-10-26T22:40:57+08:00">2024-10-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">å¼€å‘å·¥å…·</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/03%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/" itemprop="url" rel="index"><span itemprop="name">03ç‰ˆæœ¬æ§åˆ¶</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>15k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>55 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>æœ¬æ–‡ä¸»è¦æ˜¯ä½¿ç”¨repoâ€”â€”repoåŸºæœ¬åŸç†çš„ç›¸å…³ç¬”è®°ï¼Œè‹¥ç¬”è®°ä¸­æœ‰é”™è¯¯æˆ–è€…ä¸åˆé€‚çš„åœ°æ–¹ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ğŸ˜ƒã€‚</p>
<span id="more"></span>

<!-- Photo: https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/02%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/03%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/LV03-repo-02-repo%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/img/ -->

<details class="folding-tag" blue><summary> ç‚¹å‡»æŸ¥çœ‹ä½¿ç”¨å·¥å…·åŠç‰ˆæœ¬ </summary>
              <div class='content'>
              <table>    <tr>        <td align="center" rowspan="5">PCç«¯å¼€å‘ç¯å¢ƒ</td>        <td align="center" width=150px>Windows</td>        <td align="left">Windows11</td>    </tr>    <tr>        <td align="center">Ubuntu</td>        <td align="left">Ubuntu20.04.2çš„64ä½ç‰ˆæœ¬</td>      </tr>    <tr>        <td align="center">VMwareÂ® Workstation 17 Pro</td>        <td align="left">17.6.0 build-24238078</td>      </tr>    <tr>        <td align="center">ç»ˆç«¯è½¯ä»¶</td>        <td align="left">MobaXterm(Professional Edition v23.0 Build 5042 (license))</td>    </tr>    <tr>        <td align="center">Win32DiskImager</td>        <td align="left">Win32DiskImager v1.0</td>      </tr>    <tr>        <td align="center" rowspan="3">Linuxå¼€å‘æ¿ç¯å¢ƒ</td>        <td align="center">Linuxå¼€å‘æ¿</td>        <td align="left">æ­£ç‚¹åŸå­ i.MX6ULL Linux é˜¿å°”æ³•å¼€å‘æ¿</td>      </tr>    <tr>        <td align="center">uboot</td>        <td align="left">NXPå®˜æ–¹æä¾›çš„ubootï¼ŒNXPæä¾›çš„ç‰ˆæœ¬ä¸ºuboot-imx-rel_imx_4.1.15_2.1.0_ga(ä½¿ç”¨çš„ubootç‰ˆæœ¬ä¸ºU-Boot 2016.03)</td>      </tr>    <tr>        <td align="center">linuxå†…æ ¸</td>        <td align="left">linux-4.15(NXPå®˜æ–¹æä¾›)</td>      </tr></table>
              </div>
            </details>

<details class="folding-tag" blue><summary> ç‚¹å‡»æŸ¥çœ‹æœ¬æ–‡å‚è€ƒèµ„æ–™ </summary>
              <div class='content'>
              <table>    <tr><td align="center">å‚è€ƒèµ„æ–™  </td><td align="center">ç›¸å…³è¯´æ˜</td></tr>    <tr><td align="left">Git å®˜ç½‘</td><td align="left"><a href="https://git-scm.com/" target="_blank">https://git-scm.com/ <i class="fa fa-external-link-alt"></i> </a></td></tr>    <tr><td align="left">Git å®˜æ–¹æ–‡æ¡£</td><td align="left"><a href="https://git-scm.com/doc" target="_blank">https://git-scm.com/doc <i class="fa fa-external-link-alt"></i> </a></td></tr>    <tr><td align="left">Pro Git Book</td><td align="left"><a href="https://git-scm.com/book/zh/v2" target="_blank">https://git-scm.com/book/zh/v2 <i class="fa fa-external-link-alt"></i> </a></td></tr>    <tr><td align="left">Git å¿«é€Ÿä½¿ç”¨æŒ‡å—</td><td align="left"><a href="https://training.github.com/downloads/zh_CN/github-git-cheat-sheet/" target="_blank">https://training.github.com/downloads/zh_CN/github-git-cheat-sheet/ <i class="fa fa-external-link-alt"></i> </a></td></tr>    <tr><td align="left">Visual Git Cheat Sheet</td><td align="left"><a href="https://ndpsoftware.com/git-cheatsheet.html#loc=index" target="_blank">https://ndpsoftware.com/git-cheatsheet.html#loc=index <i class="fa fa-external-link-alt"></i> </a></td></tr>    <tr><td align="left">Repo å·¥å…·ä½¿ç”¨ä»‹ç» - Gitee.com</td><td align="left"><a href="https://gitee.com/help/articles/4316#article-header0" target="_blank">https://gitee.com/help/articles/4316#article-header0 <i class="fa fa-external-link-alt"></i> </a></td></tr></table>
              </div>
            </details>

<details class="folding-tag" blue><summary> ç‚¹å‡»æŸ¥çœ‹ç›¸å…³æ–‡ä»¶ä¸‹è½½ </summary>
              <div class='content'>
              <table>    <tr>        <td align="center">åˆ†ç±»</td>        <td align="center">ç½‘å€</td>        <td align="center">è¯´æ˜</td>    </tr>    <tr>        <td align="center" rowspan="0">---</td>        <td align="left"><a href="" target="_blank">---</a></td>        <td align="left">---</td>    </tr></table>
              </div>
            </details>

<h1 id="ä¸€ã€åŸºæœ¬åŸç†"><a href="#ä¸€ã€åŸºæœ¬åŸç†" class="headerlink" title="ä¸€ã€åŸºæœ¬åŸç†"></a><font size=3>ä¸€ã€åŸºæœ¬åŸç†</font></h1><img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/02%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/03%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/LV03-repo-02-repo%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/img/image-20240926231102172.png" alt="image-20240926231102172" style="zoom: 50%;" />

<p>å‰é¢æˆ‘ä»¬çŸ¥é“repoéœ€è¦å…³æ³¨å½“å‰gitåº“çš„æ•°é‡ã€åç§°ã€è·¯å¾„ç­‰ï¼Œæœ‰äº†è¿™äº›åŸºæœ¬ä¿¡æ¯ï¼Œæ‰èƒ½å¯¹è¿™äº›gitåº“è¿›è¡Œæ“ä½œã€‚é€šè¿‡é›†ä¸­ç»´æŠ¤æ‰€æœ‰gitåº“çš„æ¸…å•ï¼Œrepoå¯ä»¥æ–¹ä¾¿çš„ä»æ¸…å•ä¸­è·å–gitåº“çš„ä¿¡æ¯ã€‚ è¿™ä»½æ¸…å•ä¼šéšç€ç‰ˆæœ¬æ¼”è¿›å‡çº§è€Œäº§ç”Ÿå˜åŒ–ï¼ŒåŒæ—¶ä¹Ÿæœ‰ä¸€äº›æœ¬åœ°çš„ä¿®æ”¹å®šåˆ¶éœ€æ±‚ï¼Œæ‰€ä»¥ï¼Œrepoæ˜¯é€šè¿‡ä¸€ä¸ªgitåº“æ¥ç®¡ç†é¡¹ç›®çš„æ¸…å•æ–‡ä»¶çš„ï¼Œè¿™ä¸ªgitåº“åå­—å«manifestsã€‚</p>
<p>å½“æ‰“å¼€repoè¿™ä¸ªå¯æ‰§è¡Œçš„pythonè„šæœ¬åï¼Œå‘ç°ä»£ç é‡å¹¶ä¸å¤§(ä¸è¶…è¿‡1000è¡Œ)ï¼Œéš¾é“ä»…è¿™ä¸€ä¸ªè„šæœ¬å°±å®Œæˆäº†AOSPæ•°ç™¾ä¸ªgitåº“çš„ç®¡ç†å—ï¼Ÿå¹¶éå¦‚æ­¤ã€‚ repoæ˜¯ä¸€ç³»åˆ—è„šæœ¬çš„é›†åˆï¼Œè¿™äº›è„šæœ¬ä¹Ÿæ˜¯é€šè¿‡gitåº“æ¥ç»´æŠ¤çš„ï¼Œè¿™ä¸ªgitåº“åå­—å«repoã€‚</p>
<p>åœ¨å®¢æˆ·ç«¯ä½¿ç”¨repoåˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›®æ—¶ï¼Œå°±ä¼šä»è¿œç¨‹æŠŠmanifestså’Œrepoè¿™ä¸¤ä¸ªgitåº“æ‹·è´åˆ°æœ¬åœ°ï¼Œä½†è¿™å¯¹äºAndroidå¼€å‘äººå‘˜æ¥è¯´ï¼Œåˆæ˜¯è¿‘ä¹æ— å½¢çš„(ä¸€èˆ¬é€šè¿‡æ–‡ä»¶ç®¡ç†å™¨ï¼Œæ˜¯æ— æ³•çœ‹åˆ°è¿™ä¸¤ä¸ªgitåº“çš„)ã€‚ repoå°†è‡ªåŠ¨åŒ–çš„ç®¡ç†ä¿¡æ¯éƒ½éšè—æ ¹ç›®å½•çš„.repoå­ç›®å½•ä¸­ã€‚</p>
<h2 id="1-å…ˆåˆå§‹åŒ–ä¸€ä¸ªrepoå®¢æˆ·ç«¯"><a href="#1-å…ˆåˆå§‹åŒ–ä¸€ä¸ªrepoå®¢æˆ·ç«¯" class="headerlink" title="1. å…ˆåˆå§‹åŒ–ä¸€ä¸ªrepoå®¢æˆ·ç«¯"></a><font size=3>1. å…ˆåˆå§‹åŒ–ä¸€ä¸ªrepoå®¢æˆ·ç«¯</font></h2><p>è¿™é‡Œæˆ‘ä»¬ç›´æ¥å‚è€ƒå®‰å“çš„æºç æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://source.android.google.cn/docs/setup/download/downloading?hl=zh-cn">ä¸‹è½½æºä»£ç   | Android Open Source Project (google.cn)</a>ï¼Œä»æ–‡æ¡£ä¸­å¯çŸ¥ï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œrepo init è·å–æœ€æ–°ç‰ˆæœ¬çš„ Repo åŠå…¶æœ€æ–°çš„ bug ä¿®å¤ã€‚Android æºä»£ç ä¸­åŒ…å«çš„å„ä¸ªä»“åº“åœ¨å·¥ä½œç›®å½•ä¸­çš„æ”¾ç½®ä½ç½®æ˜¯é€šè¿‡æ¸…å•æ–‡ä»¶æ¥æŒ‡å®šçš„ï¼Œå¿…é¡»ä¸ºè¯¥æ¸…å•æŒ‡å®šä¸€ä¸ªç½‘å€ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repo init -u https://android.googlesource.com/platform/manifest</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‘½ä»¤å®é™…ä¸Šæ˜¯åŒ…å«äº†ä¸¤ä¸ªæ“ä½œï¼šå®‰è£…Repoä»“åº“å’ŒManifestä»“åº“ã€‚å…¶ä¸­ï¼ŒManifestä»“åº“çš„åœ°å€ç”±-uåæ¥å¸¦çš„å‚æ•°ç»™å‡ºã€‚æˆ‘ä»¬æ‰§è¡Œåï¼Œä¸å‡ºæ„å¤–çš„è¯å°±å‡ºæ„å¤–äº†ï¼š</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/02%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/03%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/LV03-repo-02-repo%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/img/image-20240926231714368.png" alt="image-20240926231714368" style="zoom:50%;" />

<p>è¿™é‡Œå¤§æ¦‚è¿˜æ˜¯å› ä¸ºç½‘ç»œçš„é—®é¢˜ï¼Œæˆ‘ä»¬æ¢ç”¨å›½å†…çš„ï¼š<a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/help/AOSP/">AOSP | é•œåƒç«™ä½¿ç”¨å¸®åŠ© | æ¸…åå¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™ | Tsinghua Open Source Mirror</a>ï¼Œä»è¿™é‡Œå¯çŸ¥ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œä¸‹é¢è¿™ä¸ªå‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repo init -u https://mirrors.tuna.tsinghua.edu.cn/git/AOSP/platform/manifest</span><br></pre></td></tr></table></figure>

<p>ä¸å‡ºæ„å¤–çš„è¯ï¼Œåˆåˆåˆå‡ºæ„å¤–äº†ï¼š</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/02%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/03%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/LV03-repo-02-repo%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/img/image-20240926232134894.png" alt="image-20240926232134894" style="zoom:50%;" />

<p>è¿™é‡Œæˆ‘ä»¬çœ‹æ¸…åæºå“ªé‡Œçš„å¸®åŠ©æ–‡æ¡£å§ï¼š</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/02%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/03%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/LV03-repo-02-repo%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/img/image-20240926232219048.png" alt="image-20240926232219048" style="zoom:50%;" />

<p>æˆ‘ä»¬æ¥åˆ°å¸®åŠ©é¡µé¢<a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/help/git-repo/">git-repo | é•œåƒç«™ä½¿ç”¨å¸®åŠ© | æ¸…åå¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™ | Tsinghua Open Source Mirror</a>ï¼š</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/02%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/03%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/LV03-repo-02-repo%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/img/image-20240926232316884.png" alt="image-20240926232316884" style="zoom:50%;" />

<p>é‚£æˆ‘ä»¬å°±æŒ‰ç…§è¿™é‡Œè¯´çš„æ“ä½œå§ï¼Œæå®Œä¹‹åï¼Œå°±å¯ä»¥æˆåŠŸå•¦ï¼š</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/02%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/03%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/LV03-repo-02-repo%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/img/image-20240926232355572.png" alt="image-20240926232355572" style="zoom:50%;" />

<p>å…¶å®è¿™é‡Œè¦æ˜¯è‡ªå·±åœ¨giteeä¸Šforkäº†repoæºç ä»“åº“çš„èŠ±ï¼Œä¹Ÿå¯ä»¥å†™æˆè‡ªå·±çš„ã€‚å›¾ä¸­æ¡†å‡ºæ¥çš„åœ°æ–¹æˆ‘é€‰äº†yã€‚ç„¶åæˆ‘ä»¬çœ‹ä¸€ä¸‹éƒ½ç”Ÿæˆäº†ä»€ä¹ˆï¼š</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/02%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/03%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/LV03-repo-02-repo%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/img/image-20240926232520935.png" alt="image-20240926232520935" style="zoom:50%;" />

<p>ä¼šå‘ç°å¤šäº†ä¸€ä¸ª.repoçš„ç›®å½•ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç›®å½•é‡Œé¢éƒ½æœ‰ä»€ä¹ˆï¼š</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/02%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/03%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/LV03-repo-02-repo%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/img/image-20240926232626470.png" alt="image-20240926232626470" style="zoom:50%;" />

<h2 id="2-å‘½ä»¤æ€ä¹ˆæ‰§è¡Œçš„ï¼Ÿ"><a href="#2-å‘½ä»¤æ€ä¹ˆæ‰§è¡Œçš„ï¼Ÿ" class="headerlink" title="2. å‘½ä»¤æ€ä¹ˆæ‰§è¡Œçš„ï¼Ÿ"></a><font size=3>2. å‘½ä»¤æ€ä¹ˆæ‰§è¡Œçš„ï¼Ÿ</font></h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ˜æ˜æ€ä¹ˆæ‰§è¡Œçš„ï¼Œæ€ä¹ˆå¾—åˆ°ä¸Šé¢å“ªäº›ç›®å½•çš„ã€‚è¿™ä¸ªå‘½ä»¤å®é™…ä¸Šæ˜¯åŒ…å«äº†ä¸¤ä¸ªæ“ä½œï¼šå®‰è£…Repoä»“åº“å’ŒManifestä»“åº“ã€‚å…¶ä¸­ï¼ŒManifestä»“åº“çš„åœ°å€ç”±-uåæ¥å¸¦çš„å‚æ•°ç»™å‡ºã€‚</p>
<h3 id="2-1-repoä»“åº“"><a href="#2-1-repoä»“åº“" class="headerlink" title="2.1 repoä»“åº“"></a><font size=3>2.1 repoä»“åº“</font></h3><p>æˆ‘ä»¬çœ‹çœ‹Repoè„šæœ¬æ˜¯å¦‚ä½•æ‰§è¡Œrepo initå‘½ä»¤çš„ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">orig_args</span>):</span><br><span class="line">    cmd, opt, args = _ParseArguments(orig_args)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># We run this early as we run some git commands ourselves.</span></span><br><span class="line">    SetGitTrace2ParentSid()</span><br><span class="line"></span><br><span class="line">    repo_main, rel_repo_dir = <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line">    <span class="comment"># Don&#x27;t use the local repo copy, make sure to switch to the gitc client first.</span></span><br><span class="line">    <span class="keyword">if</span> cmd != <span class="string">&quot;gitc-init&quot;</span>:</span><br><span class="line">        repo_main, rel_repo_dir = _FindRepo()</span><br><span class="line"></span><br><span class="line">    wrapper_path = os.path.abspath(__file__)</span><br><span class="line">    my_main, my_git = _RunSelf(wrapper_path)</span><br><span class="line"></span><br><span class="line">    cwd = os.getcwd()</span><br><span class="line">    <span class="keyword">if</span> get_gitc_manifest_dir() <span class="keyword">and</span> cwd.startswith(get_gitc_manifest_dir()):</span><br><span class="line">        <span class="built_in">print</span>(</span><br><span class="line">            <span class="string">&quot;error: repo cannot be used in the GITC local manifest directory.&quot;</span></span><br><span class="line">            <span class="string">&quot;\nIf you want to work on this GITC client please rerun this &quot;</span></span><br><span class="line">            <span class="string">&quot;command from the corresponding client under /gitc/&quot;</span>,</span><br><span class="line">            file=sys.stderr,</span><br><span class="line">        )</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> repo_main:</span><br><span class="line">        <span class="comment"># Only expand aliases here since we&#x27;ll be parsing the CLI ourselves.</span></span><br><span class="line">        <span class="comment"># If we had repo_main, alias expansion would happen in main.py.</span></span><br><span class="line">        cmd, alias_args = _ExpandAlias(cmd)</span><br><span class="line">        args = alias_args + args</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> opt.<span class="built_in">help</span>:</span><br><span class="line">            _Usage()</span><br><span class="line">        <span class="keyword">if</span> cmd == <span class="string">&quot;help&quot;</span>:</span><br><span class="line">            _Help(args)</span><br><span class="line">        <span class="keyword">if</span> opt.version <span class="keyword">or</span> cmd == <span class="string">&quot;version&quot;</span>:</span><br><span class="line">            _Version()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> cmd:</span><br><span class="line">            _NotInstalled()</span><br><span class="line">        <span class="keyword">if</span> cmd == <span class="string">&quot;init&quot;</span> <span class="keyword">or</span> cmd == <span class="string">&quot;gitc-init&quot;</span>:</span><br><span class="line">            <span class="keyword">if</span> my_git:</span><br><span class="line">                _SetDefaultsTo(my_git)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                _Init(args, gitc_init=(cmd == <span class="string">&quot;gitc-init&quot;</span>))</span><br><span class="line">            <span class="keyword">except</span> CloneFailure:</span><br><span class="line">                path = os.path.join(repodir, S_repo)</span><br><span class="line">                <span class="built_in">print</span>(</span><br><span class="line">                    <span class="string">&quot;fatal: cloning the git-repo repository failed, will remove &quot;</span></span><br><span class="line">                    <span class="string">&quot;&#x27;%s&#x27; &quot;</span> % path,</span><br><span class="line">                    file=sys.stderr,</span><br><span class="line">                )</span><br><span class="line">                shutil.rmtree(path, ignore_errors=<span class="literal">True</span>)</span><br><span class="line">                shutil.rmtree(path + <span class="string">&quot;.tmp&quot;</span>, ignore_errors=<span class="literal">True</span>)</span><br><span class="line">                sys.exit(<span class="number">1</span>)</span><br><span class="line">            repo_main, rel_repo_dir = _FindRepo()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            _NoCommands(cmd)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> my_main:</span><br><span class="line">        repo_main = my_main</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> repo_main:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;fatal: unable to find repo entry point&quot;</span>, file=sys.stderr)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    reqs = Requirements.from_dir(os.path.dirname(repo_main))</span><br><span class="line">    <span class="keyword">if</span> reqs:</span><br><span class="line">        reqs.assert_all()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Python 3.11 introduces PYTHONSAFEPATH and the -P flag which, if enabled,</span></span><br><span class="line">    <span class="comment"># does not prepend the script&#x27;s directory to sys.path by default.</span></span><br><span class="line">    <span class="comment"># repo relies on this import path, so add directory of REPO_MAIN to</span></span><br><span class="line">    <span class="comment"># PYTHONPATH so that this continues to work when PYTHONSAFEPATH is enabled.</span></span><br><span class="line">    python_paths = os.environ.get(<span class="string">&quot;PYTHONPATH&quot;</span>, <span class="string">&quot;&quot;</span>).split(os.pathsep)</span><br><span class="line">    new_python_paths = [os.path.join(rel_repo_dir, S_repo)] + python_paths</span><br><span class="line">    os.environ[<span class="string">&quot;PYTHONPATH&quot;</span>] = os.pathsep.join(new_python_paths)</span><br><span class="line"></span><br><span class="line">    ver_str = <span class="string">&quot;.&quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, VERSION))</span><br><span class="line">    me = [</span><br><span class="line">        sys.executable,</span><br><span class="line">        repo_main,</span><br><span class="line">        <span class="string">&quot;--repo-dir=%s&quot;</span> % rel_repo_dir,</span><br><span class="line">        <span class="string">&quot;--wrapper-version=%s&quot;</span> % ver_str,</span><br><span class="line">        <span class="string">&quot;--wrapper-path=%s&quot;</span> % wrapper_path,</span><br><span class="line">        <span class="string">&quot;--&quot;</span>,</span><br><span class="line">    ]</span><br><span class="line">    me.extend(orig_args)</span><br><span class="line">    exec_command(me)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;fatal: unable to start %s&quot;</span> % repo_main, file=sys.stderr)</span><br><span class="line">    sys.exit(<span class="number">148</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main(sys.argv[<span class="number">1</span>:])</span><br></pre></td></tr></table></figure>

<h4 id="2-1-1-ParseArguments"><a href="#2-1-1-ParseArguments" class="headerlink" title="2.1.1Â _ParseArguments()"></a><font size=3>2.1.1Â _ParseArguments()</font></h4><p>_ParseArgumentsæ— éæ˜¯å¯¹Repoçš„å‚æ•°è¿›è¡Œè§£æï¼Œå¾—åˆ°è¦æ‰§è¡Œçš„å‘½ä»¤åŠå…¶å¯¹åº”çš„å‚æ•°ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬è°ƒç”¨ä¸‹é¢è¿™ä¸ªå‘½ä»¤çš„æ—¶å€™ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repo init -u https://android.googlesource.com/platform/manifest</span><br></pre></td></tr></table></figure>

<p>å°±è¡¨ç¤ºè¦æ‰§è¡Œçš„å‘½ä»¤æ˜¯initï¼Œè¿™ä¸ªå‘½ä»¤åé¢è·Ÿçš„å‚æ•°æ˜¯<code>-u https://android.googlesource.com/platform/manifest</code>ã€‚åŒæ—¶ï¼Œå¦‚æœæˆ‘ä»¬è°ƒç”¨â€œrepo syncâ€ï¼Œå°±è¡¨ç¤ºè¦æ‰§è¡Œçš„å‘½ä»¤æ˜¯syncï¼Œè¿™ä¸ªå‘½ä»¤æ²¡æœ‰å‚æ•°ã€‚</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/02%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/03%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/LV03-repo-02-repo%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/img/image-20240927063837299.png" alt="image-20240927063837299" />

<p>_ParseArgumentså‡½æ•°å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">_ParseArguments</span>(<span class="params">args</span>):</span><br><span class="line">    cmd = <span class="literal">None</span></span><br><span class="line">    opt = _Options()</span><br><span class="line">    arg = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(args)):</span><br><span class="line">        a = args[i]</span><br><span class="line">        <span class="keyword">if</span> a == <span class="string">&quot;-h&quot;</span> <span class="keyword">or</span> a == <span class="string">&quot;--help&quot;</span>:</span><br><span class="line">            opt.<span class="built_in">help</span> = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">elif</span> a == <span class="string">&quot;--version&quot;</span>:</span><br><span class="line">            opt.version = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">elif</span> a == <span class="string">&quot;--trace&quot;</span>:</span><br><span class="line">            trace.<span class="built_in">set</span>(<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="keyword">not</span> a.startswith(<span class="string">&quot;-&quot;</span>):</span><br><span class="line">            cmd = a</span><br><span class="line">            arg = args[i + <span class="number">1</span> :]</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> cmd, opt, arg</span><br></pre></td></tr></table></figure>

<h4 id="2-1-2-FindRepo"><a href="#2-1-2-FindRepo" class="headerlink" title="2.1.2 _FindRepo"></a><font size=3>2.1.2 _FindRepo</font></h4><p>_FindRepo() åœ¨ä»å½“å‰ç›®å½•å¼€å§‹å¾€ä¸Šéå†ç›´åˆ°æ ¹æ®ç›®å½•ã€‚</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/02%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/03%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/LV03-repo-02-repo%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/img/image-20240927063525511.png" alt="image-20240927063525511"  />

<p>å¦‚æœä¸­é—´æŸä¸€ä¸ªç›®å½•ä¸‹é¢å­˜åœ¨ä¸€ä¸ª.repo&#x2F;repoç›®å½•ï¼Œå¹¶ä¸”è¯¥.repo&#x2F;repoå­˜åœ¨ä¸€ä¸ªmain.pyæ–‡ä»¶ï¼Œé‚£ä¹ˆå°±ä¼šè®¤ä¸ºå½“å‰æ˜¯AOSPä¸­æ‰§è¡ŒRepoè„šæœ¬ï¼Œè¿™æ—¶å€™å®ƒå°±ä¼šè¿”å›æ–‡ä»¶main.pyçš„ç»å¯¹è·¯å¾„å’Œå½“å‰æŸ¥æ‰¾ç›®å½•ä¸‹çš„.repoå­ç›®å½•çš„ç»å¯¹è·¯å¾„ç»™è°ƒç”¨è€…ã€‚åœ¨ä¸Šè¿°æƒ…å†µä¸‹ï¼Œå®é™…ä¸Šæ˜¯è¯´æ˜Repoä»“åº“å·²ç»å®‰è£…è¿‡äº†ã€‚_FindRepoçš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">_FindRepo</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Look for a repo installation, starting at the current directory.&quot;&quot;&quot;</span></span><br><span class="line">    curdir = os.getcwd()</span><br><span class="line">    repo = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    olddir = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">while</span> curdir != olddir <span class="keyword">and</span> <span class="keyword">not</span> repo:</span><br><span class="line">        repo = os.path.join(curdir, repodir, REPO_MAIN)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(repo):</span><br><span class="line">            repo = <span class="literal">None</span></span><br><span class="line">            olddir = curdir</span><br><span class="line">            curdir = os.path.dirname(curdir)</span><br><span class="line">    <span class="keyword">return</span> (repo, os.path.join(curdir, repodir))</span><br></pre></td></tr></table></figure>

<h4 id="2-1-3-RunSelf"><a href="#2-1-3-RunSelf" class="headerlink" title="2.1.3 _RunSelf()"></a><font size=3>2.1.3 _RunSelf()</font></h4><p>_RunSelfæ£€æŸ¥Repoè„šæœ¬æ‰€åœ¨ç›®å½•æ˜¯å¦å­˜åœ¨ä¸€ä¸ªRepoä»“åº“ï¼Œå¦‚æœå­˜åœ¨çš„è¯ï¼Œå°±ä»è¯¥ä»“åº“å…‹éš†ä¸€ä¸ªæ–°çš„ä»“åº“åˆ°æ‰§è¡ŒRepoè„šæœ¬çš„ç›®å½•æ¥ã€‚</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/02%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/03%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/LV03-repo-02-repo%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/img/image-20240927064108549.png" alt="image-20240927064108549" />

<p>å®é™…ä¸Šå°±æ˜¯ä»æœ¬åœ°å…‹éš†ä¸€ä¸ªæ–°çš„Repoä»“åº“ã€‚å¦‚æœä¸å­˜åœ¨çš„è¯ï¼Œé‚£ä¹ˆå°±éœ€è¦ä»è¿œç¨‹åœ°å€å…‹éš†ä¸€ä¸ªRepoä»“åº“åˆ°æœ¬åœ°æ¥ã€‚è¿™ä¸ªè¿œç¨‹åœ°å€æ˜¯Hard Codeåœ¨Repoè„šæœ¬é‡Œé¢ã€‚_RunSelfçš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">_RunSelf</span>(<span class="params">wrapper_path</span>):</span><br><span class="line">    my_dir = os.path.dirname(wrapper_path)</span><br><span class="line">    my_main = os.path.join(my_dir, <span class="string">&quot;main.py&quot;</span>)</span><br><span class="line">    my_git = os.path.join(my_dir, <span class="string">&quot;.git&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> os.path.isfile(my_main) <span class="keyword">and</span> os.path.isdir(my_git):</span><br><span class="line">        <span class="keyword">for</span> name <span class="keyword">in</span> [<span class="string">&quot;git_config.py&quot;</span>, <span class="string">&quot;project.py&quot;</span>, <span class="string">&quot;subcmds&quot;</span>]:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(os.path.join(my_dir, name)):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line">        <span class="keyword">return</span> my_main, my_git</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span>, <span class="literal">None</span></span><br></pre></td></tr></table></figure>

<p>ä»è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœRepoè„šæœ¬æ‰€åœ¨çš„ç›®å½•å­˜åœ¨ä¸€ä¸ªRepoä»“åº“ï¼Œé‚£ä¹ˆè¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p>
<p>ï¼ˆ1ï¼‰å­˜åœ¨ä¸€ä¸ª.gitç›®å½•ï¼›</p>
<p>ï¼ˆ2ï¼‰å­˜åœ¨ä¸€ä¸ªmain.pyæ–‡ä»¶ï¼›</p>
<p>ï¼ˆ3ï¼‰å­˜åœ¨ä¸€ä¸ªgit_config.pyæ–‡ä»¶ï¼›</p>
<p>ï¼ˆ4ï¼‰å­˜åœ¨ä¸€ä¸ªproject.pyæ–‡ä»¶ï¼›</p>
<p>ï¼ˆ5ï¼‰å­˜åœ¨ä¸€ä¸ªsubcmdsç›®å½•ã€‚</p>
<p>è¿™äº›ç›®å½•å’Œæ–‡ä»¶å®é™…ä¸Šéƒ½æ˜¯ä¸€ä¸ªæ ‡å‡†çš„Repoä»“åº“æ‰€å…·æœ‰çš„ã€‚</p>
<h4 id="2-1-4-SetDefaultsTo"><a href="#2-1-4-SetDefaultsTo" class="headerlink" title="2.1.4 _SetDefaultsTo()"></a><font size=3>2.1.4 _SetDefaultsTo()</font></h4><p>æˆ‘ä»¬å†å›åˆ°mainå‡½æ•°ä¸­ã€‚å¦‚æœè°ƒç”¨_FindRepoå¾—åˆ°çš„repo_mainçš„å€¼ç­‰äºç©ºï¼Œé‚£ä¹ˆå°±è¯´æ˜å½“å‰ç›®å½•è¿˜æ²¡æœ‰å®‰è£…Repoä»“åº“ï¼Œè¿™æ—¶å€™Repoåé¢æ‰€è·Ÿçš„å‚æ•°åªèƒ½æ˜¯helpæˆ–è€…initï¼Œå¦åˆ™çš„è¯ï¼Œå°±ä¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ã€‚å¦‚æœRepoåé¢è·Ÿçš„å‚æ•°æ˜¯helpï¼Œå°±æ‰“å°å‡ºRepoè„šæœ¬çš„å¸®åŠ©æ–‡æ¡£ã€‚</p>
<p>æˆ‘ä»¬å…³æ³¨Repoåé¢è·Ÿçš„å‚æ•°æ˜¯initçš„æƒ…å†µã€‚è¿™æ—¶å€™çœ‹ä¸€ä¸‹è°ƒç”¨_RunSelfçš„è¿”å›å€¼my_gitæ˜¯å¦ä¸ç­‰äºç©ºã€‚å¦‚æœä¸ç­‰äºç©ºçš„è¯ï¼Œé‚£ä¹ˆå°±è¯´æ˜Repoè„šæœ¬æ‰€åœ¨ç›®å½•å­˜ä¸€ä¸ªRepoä»“åº“ï¼Œè¿™æ—¶å€™å°±è°ƒç”¨_SetDefaultsToè®¾ç½®ç­‰ä¸€ä¼šè¦å…‹éš†çš„Repoä»“åº“æºã€‚</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/02%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/03%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/LV03-repo-02-repo%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/img/image-20240927064649242.png" alt="image-20240927064649242"  />

<p>_SetDefaultsToçš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">_SetDefaultsTo</span>(<span class="params">gitdir</span>):</span><br><span class="line">    <span class="keyword">global</span> REPO_URL</span><br><span class="line">    <span class="keyword">global</span> REPO_REV</span><br><span class="line"></span><br><span class="line">    REPO_URL = gitdir</span><br><span class="line">    ret = run_git(<span class="string">&quot;--git-dir=%s&quot;</span> % gitdir, <span class="string">&quot;symbolic-ref&quot;</span>, <span class="string">&quot;HEAD&quot;</span>, check=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">if</span> ret.returncode:</span><br><span class="line">        <span class="comment"># If we&#x27;re not tracking a branch (bisect/etc...), then fall back to commit.</span></span><br><span class="line">        <span class="built_in">print</span>(</span><br><span class="line">            <span class="string">&quot;repo: warning: %s has no current branch; using HEAD&quot;</span> % gitdir,</span><br><span class="line">            file=sys.stderr,</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            ret = run_git(<span class="string">&quot;rev-parse&quot;</span>, <span class="string">&quot;HEAD&quot;</span>, cwd=gitdir)</span><br><span class="line">        <span class="keyword">except</span> CloneFailure:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;fatal: %s has invalid HEAD&quot;</span> % gitdir, file=sys.stderr)</span><br><span class="line">            sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    REPO_REV = ret.stdout.strip()</span><br></pre></td></tr></table></figure>

<p>æœ€å¼€å§‹çš„å˜é‡æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘ä»¬å¯ä»¥æœç´¢ä¸€ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># repo default configuration</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">REPO_URL = os.environ.get(<span class="string">&quot;REPO_URL&quot;</span>, <span class="literal">None</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> REPO_URL:</span><br><span class="line">    REPO_URL = <span class="string">&quot;https://gerrit.googlesource.com/git-repo&quot;</span></span><br><span class="line">REPO_REV = os.environ.get(<span class="string">&quot;REPO_REV&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> REPO_REV:</span><br><span class="line">    REPO_REV = <span class="string">&quot;stable&quot;</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœRepoè„šæœ¬æ‰€åœ¨ç›®å½•ä¸å­˜åœ¨ä¸€ä¸ªRepoä»“åº“ï¼Œé‚£ä¹ˆé»˜è®¤å°±å°†<a target="_blank" rel="noopener" href="https://gerrit.googlesource.com/git-repo">https://gerrit.googlesource.com/git-repo</a>è®¾ç½®ä¸ºä¸€ä¼šè¦å…‹éš†çš„Repoä»“åº“æºï¼Œå¹¶ä¸”è¦å…‹éš†çš„åˆ†æ”¯æ˜¯stableã€‚å¦åˆ™çš„è¯ï¼Œå°±ä»¥è¯¥Repoä»“åº“ä½œä¸ºå…‹éš†æºï¼Œå¹¶ä¸”ä»¥è¯¥Repoä»“åº“çš„å½“å‰åˆ†æ”¯ä½œä¸ºè¦å…‹éš†çš„åˆ†æ”¯ã€‚</p>
<p>ä»å‰é¢çš„åˆ†æå°±å¯ä»¥çŸ¥é“ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œâ€repo initâ€å‘½ä»¤çš„æ—¶å€™ï¼š</p>
<p>ï¼ˆ1ï¼‰å¦‚æœæˆ‘ä»¬åªæ˜¯ä»ç½‘ä¸Šä¸‹è½½äº†ä¸€ä¸ªRepoè„šæœ¬ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡ŒRepoå‘½ä»¤çš„æ—¶å€™ï¼Œå°±ä¼šä»è¿œç¨‹å…‹éš†ä¸€ä¸ªRepoä»“åº“åˆ°å½“å‰æ‰§è¡ŒRepoè„šæœ¬çš„ç›®å½•æ¥ã€‚</p>
<p>ï¼ˆ2ï¼‰å¦‚æœæˆ‘ä»¬ä»ç½‘ä¸Šä¸‹è½½çš„æ˜¯ä¸€ä¸ªå¸¦æœ‰Repoä»“åº“çš„Repoè„šæœ¬ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡ŒRepoå‘½ä»¤çš„æ—¶å€™ï¼Œå°±å¯ä»¥ä»æœ¬åœ°å…‹éš†ä¸€ä¸ªRepoä»“åº“åˆ°å½“å‰æ‰§è¡ŒRepoè„šæœ¬çš„ç›®å½•æ¥ã€‚</p>
<h4 id="2-1-5-Init"><a href="#2-1-5-Init" class="headerlink" title="2.1.5 _Init()"></a><font size=3>2.1.5 _Init()</font></h4><p>æˆ‘ä»¬å†ç»§ç»­çœ‹mainå‡½æ•°çš„å®ç°ï¼Œå®ƒæ¥ä¸‹æ¥è°ƒç”¨_Initåœ¨å½“å‰æ‰§è¡ŒRepoè„šæœ¬çš„ç›®å½•ä¸‹å®‰è£…ä¸€ä¸ªRepoä»“åº“ï¼š</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/02%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/03%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/LV03-repo-02-repo%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/img/image-20240927070242090.png" alt="image-20240927070242090" />

<p>è¿™ä¸ªå‡½æ•°çš„å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">_Init</span>(<span class="params">args, gitc_init=<span class="literal">False</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Installs repo by cloning it over the network.&quot;&quot;&quot;</span></span><br><span class="line">    parser = GetParser(gitc_init=gitc_init)</span><br><span class="line">    opt, args = parser.parse_args(args)</span><br><span class="line">    <span class="keyword">if</span> args:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> opt.manifest_url:</span><br><span class="line">            opt.manifest_url = args.pop(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> args:</span><br><span class="line">            parser.print_usage()</span><br><span class="line">            sys.exit(<span class="number">1</span>)</span><br><span class="line">    opt.quiet = opt.output_mode <span class="keyword">is</span> <span class="literal">False</span></span><br><span class="line">    opt.verbose = opt.output_mode <span class="keyword">is</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> opt.clone_bundle <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        opt.clone_bundle = <span class="literal">False</span> <span class="keyword">if</span> opt.partial_clone <span class="keyword">else</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    url = opt.repo_url <span class="keyword">or</span> REPO_URL</span><br><span class="line">    rev = opt.repo_rev <span class="keyword">or</span> REPO_REV</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        os.mkdir(repodir)</span><br><span class="line">    <span class="keyword">except</span> OSError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">if</span> e.errno != errno.EEXIST:</span><br><span class="line">            <span class="built_in">print</span>(</span><br><span class="line">                <span class="string">f&quot;fatal: cannot make <span class="subst">&#123;repodir&#125;</span> directory: <span class="subst">&#123;e.strerror&#125;</span>&quot;</span>,</span><br><span class="line">                file=sys.stderr,</span><br><span class="line">            )</span><br><span class="line">            <span class="comment"># Don&#x27;t raise CloneFailure; that would delete the</span></span><br><span class="line">            <span class="comment"># name. Instead exit immediately.</span></span><br><span class="line">            <span class="comment">#</span></span><br><span class="line">            sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    _CheckGitVersion()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> opt.quiet:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Downloading Repo source from&quot;</span>, url)</span><br><span class="line">        dst_final = os.path.abspath(os.path.join(repodir, S_repo))</span><br><span class="line">        dst = dst_final + <span class="string">&quot;.tmp&quot;</span></span><br><span class="line">        shutil.rmtree(dst, ignore_errors=<span class="literal">True</span>)</span><br><span class="line">        _Clone(url, dst, opt.clone_bundle, opt.quiet, opt.verbose)</span><br><span class="line"></span><br><span class="line">        remote_ref, rev = check_repo_rev(</span><br><span class="line">            dst, rev, opt.repo_verify, quiet=opt.quiet</span><br><span class="line">        )</span><br><span class="line">        _Checkout(dst, remote_ref, rev, opt.quiet)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(os.path.join(dst, <span class="string">&quot;repo&quot;</span>)):</span><br><span class="line">            <span class="built_in">print</span>(</span><br><span class="line">                <span class="string">&quot;fatal: &#x27;%s&#x27; does not look like a git-repo repository, is &quot;</span></span><br><span class="line">                <span class="string">&quot;--repo-url set correctly?&quot;</span> % url,</span><br><span class="line">                file=sys.stderr,</span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">raise</span> CloneFailure()</span><br><span class="line"></span><br><span class="line">        os.rename(dst, dst_final)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> CloneFailure:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;fatal: double check your --repo-rev setting.&quot;</span>, file=sys.stderr)</span><br><span class="line">        <span class="keyword">if</span> opt.quiet:</span><br><span class="line">            <span class="built_in">print</span>(</span><br><span class="line">                <span class="string">&quot;fatal: repo init failed; run without --quiet to see why&quot;</span>,</span><br><span class="line">                file=sys.stderr,</span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">raise</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœæˆ‘ä»¬åœ¨æ‰§è¡ŒRepoè„šæœ¬çš„æ—¶å€™ï¼Œæ²¡æœ‰é€šè¿‡â€“repo-urlå’Œâ€“repo-branchæ¥æŒ‡å®šRepoä»“åº“çš„æºåœ°å€å’Œåˆ†æ”¯ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨ç”±REPO_URLå’ŒREPO_REVæ‰€æŒ‡å®šçš„æºåœ°å€å’Œåˆ†æ”¯ã€‚ä»å‰é¢çš„åˆ†æå¯ä»¥çŸ¥é“ï¼ŒREPO_URLå’ŒREPO_REVè¦ä¹ˆæŒ‡å‘è¿œç¨‹åœ°å€<a target="_blank" rel="noopener" href="https://gerrit.googlesource.com/git-repo">https://gerrit.googlesource.com/git-repo</a>å’Œåˆ†æ”¯stableï¼Œè¦ä¹ˆæŒ‡å‘Repoè„šæœ¬æ‰€åœ¨ç›®å½•çš„Repoä»“åº“å’Œè¯¥ä»“åº“çš„å½“å‰åˆ†æ”¯ã€‚</p>
<p>_Initå‡½æ•°ç»§ç»­æ£€æŸ¥å½“å‰æ‰§è¡ŒRepoè„šæœ¬çš„ç›®å½•æ˜¯å¦å­˜åœ¨ä¸€ä¸ª.repoç›®å½•ã€‚å¦‚æœä¸å­˜åœ¨çš„è¯ï¼Œé‚£ä¹ˆå°±æ–°åˆ›å»ºä¸€ä¸ªã€‚æ¥ç€æ˜¯å¦éœ€è¦éªŒè¯ç­‰ä¸€ä¼šå…‹éš†å›æ¥çš„Repoä»“åº“çš„GPGã€‚å¦‚æœéœ€è¦éªŒè¯çš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨è°ƒç”¨_Cloneå‡½æ•°æ¥å…‹éš†å¥½Repoä»“åº“ä¹‹åï¼Œè°ƒç”¨_Verifyå‡½æ•°æ¥éªŒè¯è¯¥Repoä»“åº“çš„GPGã€‚</p>
<p>æœ€å…³é”®çš„åœ°æ–¹å°±åœ¨äºå‡½æ•°_Cloneå‡½æ•°å’Œ_Checkoutå‡½æ•°çš„è°ƒç”¨ï¼Œå‰è€…ç”¨æ¥ä»urlæŒ‡å®šçš„åœ°æ–¹å…‹éš†ä¸€ä¸ªä»“åº“åˆ°dstæŒ‡å®šçš„åœ°æ–¹æ¥ï¼Œå®é™…ä¸Šå°±æ˜¯å…‹éš†åˆ°å½“å‰ç›®å½•ä¸‹çš„.&#x2F;repo&#x2F;repoç›®å½•æ¥ï¼Œåè€…åœ¨å…‹éš†å›æ¥çš„ä»“åº“ä¸­å°†branchåˆ†æ”¯checkoutå‡ºæ¥ã€‚</p>
<p>å‡½æ•°_Cloneçš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">_Clone</span>(<span class="params">url, cwd, clone_bundle, quiet, verbose</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Clones a git repository to a new subdirectory of repodir&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> verbose:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Cloning git repository&quot;</span>, url)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        os.mkdir(cwd)</span><br><span class="line">    <span class="keyword">except</span> OSError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(</span><br><span class="line">            <span class="string">f&quot;fatal: cannot make <span class="subst">&#123;cwd&#125;</span> directory: <span class="subst">&#123;e.strerror&#125;</span>&quot;</span>,</span><br><span class="line">            file=sys.stderr,</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">raise</span> CloneFailure()</span><br><span class="line"></span><br><span class="line">    run_git(<span class="string">&quot;init&quot;</span>, <span class="string">&quot;--quiet&quot;</span>, cwd=cwd)</span><br><span class="line"></span><br><span class="line">    _InitHttp()</span><br><span class="line">    _SetConfig(cwd, <span class="string">&quot;remote.origin.url&quot;</span>, url)</span><br><span class="line">    _SetConfig(</span><br><span class="line">        cwd, <span class="string">&quot;remote.origin.fetch&quot;</span>, <span class="string">&quot;+refs/heads/*:refs/remotes/origin/*&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">if</span> clone_bundle <span class="keyword">and</span> _DownloadBundle(url, cwd, quiet, verbose):</span><br><span class="line">        _ImportBundle(cwd)</span><br><span class="line">    _Fetch(url, cwd, <span class="string">&quot;origin&quot;</span>, quiet, verbose)</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‡½æ•°é¦–å…ˆæ˜¯è°ƒç”¨â€git initâ€åœ¨å½“å‰ç›®å½•ä¸‹çš„.repo&#x2F;repoå­ç›®å½•åˆå§‹åŒ–ä¸€ä¸ªGitä»“åº“ï¼Œæ¥ç€å†è°ƒç”¨_SetConfigå‡½æ¥è®¾ç½®è¯¥Gitä»“åº“çš„urlä¿¡æ¯ç­‰ã€‚å†æ¥ç€è°ƒç”¨_DownloadBundleæ¥æ£€æŸ¥æŒ‡å®šçš„urlæ˜¯å¦å­˜åœ¨ä¸€ä¸ªclone.bundleæ–‡ä»¶ã€‚å¦‚æœå­˜åœ¨è¿™ä¸ªclone.bundleæ–‡ä»¶çš„è¯ï¼Œå°±ä»¥å®ƒä½œä¸ºRepoä»“åº“çš„å…‹éš†æºã€‚</p>
<p>å‡½æ•°_DownloadBundleçš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">_DownloadBundle</span>(<span class="params">url, cwd, quiet, verbose</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> url.endswith(<span class="string">&quot;/&quot;</span>):</span><br><span class="line">        url += <span class="string">&quot;/&quot;</span></span><br><span class="line">    url += <span class="string">&quot;clone.bundle&quot;</span></span><br><span class="line"></span><br><span class="line">    ret = run_git(</span><br><span class="line">        <span class="string">&quot;config&quot;</span>, <span class="string">&quot;--get-regexp&quot;</span>, <span class="string">&quot;url.*.insteadof&quot;</span>, cwd=cwd, check=<span class="literal">False</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> ret.stdout.splitlines():</span><br><span class="line">        m = re.<span class="built_in">compile</span>(<span class="string">r&quot;^url\.(.*)\.insteadof (.*)$&quot;</span>).<span class="keyword">match</span>(line)</span><br><span class="line">        <span class="keyword">if</span> m:</span><br><span class="line">            new_url = m.group(<span class="number">1</span>)</span><br><span class="line">            old_url = m.group(<span class="number">2</span>)</span><br><span class="line">            <span class="keyword">if</span> url.startswith(old_url):</span><br><span class="line">                url = new_url + url[<span class="built_in">len</span>(old_url) :]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> url.startswith(<span class="string">&quot;http:&quot;</span>) <span class="keyword">and</span> <span class="keyword">not</span> url.startswith(<span class="string">&quot;https:&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    dest = <span class="built_in">open</span>(os.path.join(cwd, <span class="string">&quot;.git&quot;</span>, <span class="string">&quot;clone.bundle&quot;</span>), <span class="string">&quot;w+b&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = urllib.request.urlopen(url)</span><br><span class="line">        <span class="keyword">except</span> urllib.error.HTTPError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">if</span> e.code <span class="keyword">not</span> <span class="keyword">in</span> [<span class="number">400</span>, <span class="number">401</span>, <span class="number">403</span>, <span class="number">404</span>, <span class="number">501</span>]:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;warning: Cannot get %s&quot;</span> % url, file=sys.stderr)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;warning: HTTP error %s&quot;</span> % e.code, file=sys.stderr)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">except</span> urllib.error.URLError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;fatal: Cannot get %s&quot;</span> % url, file=sys.stderr)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;fatal: error %s&quot;</span> % e.reason, file=sys.stderr)</span><br><span class="line">            <span class="keyword">raise</span> CloneFailure()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> verbose:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Downloading clone bundle %s&quot;</span> % url, file=sys.stderr)</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                buf = r.read(<span class="number">8192</span>)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> buf:</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">                dest.write(buf)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            r.close()</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        dest.close()</span><br></pre></td></tr></table></figure>

<p>Bundleæ–‡ä»¶æ˜¯Gitæä¾›çš„ä¸€ç§æœºåˆ¶ï¼Œç”¨æ¥è§£å†³ä¸èƒ½æ­£å¸¸é€šè¿‡gitã€sshå’Œhttpç­‰ç½‘ç»œåè®®ä»è¿œç¨‹åœ°å€å…‹éš†Gitä»“åº“çš„é—®é¢˜ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨â€œgit bundleâ€å‘½ä»¤æ¥åœ¨ä¸€ä¸ªGitä»“åº“åˆ›å»ºä¸€ä¸ªBundleæ–‡ä»¶ï¼Œè¿™ä¸ªBundleæ–‡ä»¶å°±ä¼šåŒ…å«Gitä»“åº“çš„æäº¤å†å²ã€‚æŠŠè¿™ä¸ªBundleæ–‡ä»¶é€šè¿‡å…¶å®ƒæ–¹å¼æ‹·è´åˆ°å¦ä¸€å°æœºå™¨ä¸Šï¼Œå°±å¯ä»¥å°†å®ƒä½œä¸ºä¸€ä¸ªæœ¬åœ°Gitä»“åº“æ¥ä½¿ç”¨ï¼Œè€Œä¸ç”¨å»è®¿é—®è¿œç¨‹ç½‘ç»œã€‚</p>
<p>å›åˆ°å‡½æ•°_Cloneä¸­ï¼Œå¦‚æœå­˜åœ¨å¯¹åº”çš„clone.bundleæ–‡ä»¶ï¼Œå¹¶ä¸”èƒ½æˆåŠŸä¸‹è½½åˆ°è¯¥clone.bundleï¼Œæ¥ä¸‹æ¥å°±è°ƒç”¨å‡½æ•°_ImportBundleå°†å®ƒä½œä¸ºæºä»“åº“å…‹éš†ä¸ºæ–°çš„Repoä»“åº“ã€‚å‡½æ•°_ImportBundleçš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">_ImportBundle</span>(<span class="params">cwd</span>):</span><br><span class="line">    path = os.path.join(cwd, <span class="string">&quot;.git&quot;</span>, <span class="string">&quot;clone.bundle&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        _Fetch(cwd, cwd, path, <span class="literal">True</span>, <span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        os.remove(path)</span><br></pre></td></tr></table></figure>

<p>ç»“åˆ_Cloneå‡½æ•°å’Œ_ImportBundleå‡½æ•°å°±å¯ä»¥çœ‹å‡ºï¼Œä»clone.bundleæ–‡ä»¶å…‹éš†Repoä»“åº“å’Œä»è¿œç¨‹urlå…‹éš†Repoä»“åº“éƒ½æ˜¯é€šè¿‡å‡½æ•°_Fetchæ¥å®ç°çš„ã€‚åŒºåˆ«å°±åœ¨äºè°ƒç”¨å‡½æ•°_Fetchæ—¶æŒ‡å®šçš„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå‰è€…æ˜¯å·²ç»ä¸‹è½½åˆ°æœ¬åœ°çš„ä¸€ä¸ªclone.bundleæ–‡ä»¶è·¯å¾„ï¼Œåè€…æ˜¯originï¼ˆè¡¨ç¤ºè¿œç¨‹ä»“åº“åç§°ï¼‰ã€‚å‡½æ•°_Fetchçš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">_Fetch</span>(<span class="params">url, cwd, src, quiet, verbose</span>):</span><br><span class="line">    cmd = [<span class="string">&quot;fetch&quot;</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> verbose:</span><br><span class="line">        cmd.append(<span class="string">&quot;--quiet&quot;</span>)</span><br><span class="line">    err = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> quiet <span class="keyword">and</span> sys.stdout.isatty():</span><br><span class="line">        cmd.append(<span class="string">&quot;--progress&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">not</span> verbose:</span><br><span class="line">        err = subprocess.PIPE</span><br><span class="line">    cmd.append(src)</span><br><span class="line">    cmd.append(<span class="string">&quot;+refs/heads/*:refs/remotes/origin/*&quot;</span>)</span><br><span class="line">    cmd.append(<span class="string">&quot;+refs/tags/*:refs/tags/*&quot;</span>)</span><br><span class="line">    run_git(*cmd, stderr=err, capture_output=<span class="literal">False</span>, cwd=cwd)</span><br></pre></td></tr></table></figure>

<p>å‡½æ•°_Fetchå®é™…ä¸Šå°±æ˜¯é€šè¿‡â€œgit fetchâ€ä»æŒ‡å®šçš„ä»“åº“æºå…‹éš†ä¸€ä¸ªæ–°çš„Repoä»“åº“åˆ°å½“å‰ç›®å½•ä¸‹çš„.repo&#x2F;repoå­ç›®å½•æ¥ã€‚</p>
<p>æ³¨æ„ï¼Œä»¥ä¸Šåªæ˜¯å…‹éš†å¥½äº†ä¸€ä¸ªRepoä»“åº“ï¼Œæ¥ä¸‹æ¥è¿˜éœ€è¦ä»è¿™ä¸ªRepoä»“åº“checkoutå‡ºä¸€ä¸ªåˆ†æ”¯æ¥ï¼Œæ‰èƒ½æ­£å¸¸å·¥ä½œã€‚ä»Repoä»“åº“checkoutå‡ºä¸€ä¸ªåˆ†æ”¯æ˜¯é€šè¿‡è°ƒç”¨å‡½æ•°_Checkoutæ¥å®ç°çš„ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">_Checkout</span>(<span class="params">cwd, remote_ref, rev, quiet</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Checkout an upstream branch into the repository and track it.&quot;&quot;&quot;</span></span><br><span class="line">    run_git(<span class="string">&quot;update-ref&quot;</span>, <span class="string">&quot;refs/heads/default&quot;</span>, rev, cwd=cwd)</span><br><span class="line"></span><br><span class="line">    _SetConfig(cwd, <span class="string">&quot;branch.default.remote&quot;</span>, <span class="string">&quot;origin&quot;</span>)</span><br><span class="line">    _SetConfig(cwd, <span class="string">&quot;branch.default.merge&quot;</span>, remote_ref)</span><br><span class="line"></span><br><span class="line">    run_git(<span class="string">&quot;symbolic-ref&quot;</span>, <span class="string">&quot;HEAD&quot;</span>, <span class="string">&quot;refs/heads/default&quot;</span>, cwd=cwd)</span><br><span class="line"></span><br><span class="line">    cmd = [<span class="string">&quot;read-tree&quot;</span>, <span class="string">&quot;--reset&quot;</span>, <span class="string">&quot;-u&quot;</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> quiet:</span><br><span class="line">        cmd.append(<span class="string">&quot;-v&quot;</span>)</span><br><span class="line">    cmd.append(<span class="string">&quot;HEAD&quot;</span>)</span><br><span class="line">    run_git(*cmd, cwd=cwd)</span><br></pre></td></tr></table></figure>

<p>è¦checkoutå‡ºæ¥çš„åˆ†æ”¯ç”±å‚æ•°branchæŒ‡å®šã€‚ä»å‰é¢çš„åˆ†æå¯ä»¥çŸ¥é“ï¼Œå¦‚æœå½“å‰æ‰§è¡Œçš„Repoè„šæœ¬æ‰€åœ¨ç›®å½•å­˜åœ¨ä¸€ä¸ªRepoä»“åº“ï¼Œé‚£ä¹ˆå‚æ•°branchæè¿°çš„å°±æ˜¯è¯¥ä»“åº“å½“å‰checkoutå‡ºæ¥çš„åˆ†æ”¯ã€‚å¦åˆ™çš„è¯ï¼Œå‚æ•°branchæè¿°çš„å°±æ˜¯ä»è¿œç¨‹ä»“åº“å…‹éš†å›æ¥çš„â€œstableâ€åˆ†æ”¯ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œä»ä»“åº“checkoutå‡ºåˆ†æ”¯ä¸æ˜¯ä½¿ç”¨â€œgit checkoutâ€å‘½ä»¤æ¥å®ç°çš„ï¼Œè€Œæ˜¯é€šè¿‡æ›´åº•å±‚çš„Gitå‘½ä»¤â€œgit update-refâ€æ¥å®ç°çš„ã€‚å®é™…ä¸Šï¼Œâ€œgit checkoutâ€å‘½ä»¤ä¹Ÿæ˜¯é€šè¿‡â€œgit update-refâ€å‘½ä»¤æ¥å®ç°çš„ï¼Œåªä¸è¿‡å®ƒè¿›è¡Œäº†æ›´é«˜å±‚çš„å°è£…ï¼Œæ›´æ–¹ä¾¿ä½¿ç”¨ã€‚å¦‚æœæˆ‘ä»¬å»åˆ†æç»„æˆRepoä»“åº“çš„é‚£äº›Pythonè„šæœ¬å‘½ä»¤ï¼Œå°±ä¼šå‘ç°å®ƒä»¬åŸºæœ¬ä¸Šéƒ½æ˜¯é€šè¿‡åº•å±‚çš„Gitå‘½ä»¤æ¥å®ŒæˆGitåŠŸèƒ½çš„ã€‚</p>
<h3 id="2-3-Manifestä»“åº“"><a href="#2-3-Manifestä»“åº“" class="headerlink" title="2.3 Manifestä»“åº“"></a><font size=3>2.3 Manifestä»“åº“</font></h3><blockquote>
<p>ã€æ³¨æ„ã€‘è¿™ä¸€éƒ¨åˆ†æˆ‘å°±ä¸æ˜¯æŒ‰è‡ªå·±ä¸‹è½½çš„æœ€æ–°çš„repoä»“åº“æºç åˆ†æçš„äº†ï¼Œç›´æ¥å¤åˆ¶çš„åŸæ–‡ï¼š<a target="_blank" rel="noopener" href="https://www.jb51.net/article/131935.htm">Androidæºä»£ç ä»“åº“åŠå…¶ç®¡ç†å·¥å…·Repoåˆ†æè¯¦è§£_Android_è„šæœ¬ä¹‹å®¶ (jb51.net)</a>ï¼Œä¸»è¦æ˜¯è¿™é‡Œæ²¡çœ‹æ‡‚ã€‚å“ˆå“ˆã€‚</p>
</blockquote>
<p>æˆ‘ä»¬æ¥ç€å†åˆ†æä¸‹é¢è¿™ä¸ªå‘½ä»¤çš„æ‰§è¡Œï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repo init -u https://android.googlesource.com/platform/manifest</span><br></pre></td></tr></table></figure>

<p>å¦‚å‰æ‰€è¿°ï¼Œè¿™ä¸ªå‘½ä»¤å®‰è£…å¥½Repoä»“åº“ä¹‹åï¼Œå°±ä¼šè°ƒç”¨è¯¥Repoä»“åº“ä¸‹é¢çš„main.pyè„šæœ¬ï¼Œå¯¹åº”çš„æ–‡ä»¶ä¸º.repo&#x2F;repo&#x2F;main.pyï¼Œå®ƒçš„å…¥å£å‡½æ•°çš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">_Main</span>(<span class="params">argv</span>): </span><br><span class="line"> result = <span class="number">0</span> </span><br><span class="line"> </span><br><span class="line"> opt = optparse.OptionParser(usage=<span class="string">&quot;repo wrapperinfo -- ...&quot;</span>) </span><br><span class="line"> opt.add_option(<span class="string">&quot;--repo-dir&quot;</span>, dest=<span class="string">&quot;repodir&quot;</span>, </span><br><span class="line">         <span class="built_in">help</span>=<span class="string">&quot;path to .repo/&quot;</span>) </span><br><span class="line"> <span class="comment">#...... </span></span><br><span class="line"> </span><br><span class="line"> repo = _Repo(opt.repodir) </span><br><span class="line"> <span class="keyword">try</span>: </span><br><span class="line">  <span class="keyword">try</span>: </span><br><span class="line">   init_ssh() </span><br><span class="line">   init_http() </span><br><span class="line">   result = repo._Run(argv) <span class="keyword">or</span> <span class="number">0</span> </span><br><span class="line">  <span class="keyword">finally</span>: </span><br><span class="line">   close_ssh() </span><br><span class="line"> <span class="keyword">except</span> KeyboardInterrupt: </span><br><span class="line">  <span class="comment">#...... </span></span><br><span class="line">  result = <span class="number">1</span> </span><br><span class="line"> <span class="keyword">except</span> ManifestParseError <span class="keyword">as</span> mpe: </span><br><span class="line">  <span class="comment">#...... </span></span><br><span class="line">  result = <span class="number">1</span> </span><br><span class="line"> <span class="keyword">except</span> RepoChangedException <span class="keyword">as</span> rce: </span><br><span class="line">  <span class="comment"># If repo changed, re-exec ourselves. </span></span><br><span class="line">  <span class="comment"># </span></span><br><span class="line">  argv = <span class="built_in">list</span>(sys.argv) </span><br><span class="line">  argv.extend(rce.extra_args) </span><br><span class="line">  <span class="keyword">try</span>: </span><br><span class="line">   os.execv(__file__, argv) </span><br><span class="line">  <span class="keyword">except</span> OSError <span class="keyword">as</span> e: </span><br><span class="line">   <span class="comment">#...... </span></span><br><span class="line">   result = <span class="number">128</span> </span><br><span class="line"> </span><br><span class="line"> sys.exit(result) </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>: </span><br><span class="line"> _Main(sys.argv[<span class="number">1</span>:]) </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä»å‰é¢çš„åˆ†æå¯ä»¥çŸ¥é“ï¼Œé€šè¿‡å‚æ•°â€“repo-dirä¼ è¿›æ¥çš„æ˜¯AOSPæ ¹ç›®å½•ä¸‹çš„.repoç›®å½•ï¼Œè¿™æ˜¯ä¸€ä¸ªéšè—ç›®å½•ï¼Œé‡Œé¢ä¿å­˜çš„æ˜¯Repoä»“åº“ã€Manifestä»“åº“ï¼Œä»¥åŠå„ä¸ªAOSPå­é¡¹ç›®ä»“åº“ã€‚å‡½æ•°_Mainä¼šè°ƒç”¨å‰é¢åˆ›å»ºçš„ä¸€ä¸ª_Repoå¯¹è±¡çš„æˆå‘˜å‡½æ•°_Runæ¥è§£æè¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œå¹¶ä¸”æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ã€‚_Repoç±»çš„æˆå‘˜å‡½æ•°_Runçš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> subcmds <span class="keyword">import</span> all_commands </span><br><span class="line"> <span class="keyword">class</span> <span class="title class_">_Repo</span>(<span class="title class_ inherited__">object</span>): </span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, repodir</span>): </span><br><span class="line">  self.repodir = repodir </span><br><span class="line">  self.commands = all_commands </span><br><span class="line">  <span class="comment"># add &#x27;branch&#x27; as an alias for &#x27;branches&#x27; </span></span><br><span class="line">  all_commands[<span class="string">&#x27;branch&#x27;</span>] = all_commands[<span class="string">&#x27;branches&#x27;</span>] </span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">_Run</span>(<span class="params">self, argv</span>): </span><br><span class="line">  result = <span class="number">0</span> </span><br><span class="line">  name = <span class="literal">None</span> </span><br><span class="line">  glob = [] </span><br><span class="line"> </span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(argv)): </span><br><span class="line">   <span class="keyword">if</span> <span class="keyword">not</span> argv[i].startswith(<span class="string">&#x27;-&#x27;</span>): </span><br><span class="line">    name = argv[i] </span><br><span class="line">    <span class="keyword">if</span> i &gt; <span class="number">0</span>: </span><br><span class="line">     glob = argv[:i] </span><br><span class="line">    argv = argv[i + <span class="number">1</span>:] </span><br><span class="line">    <span class="keyword">break</span> </span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> name: </span><br><span class="line">   glob = argv </span><br><span class="line">   name = <span class="string">&#x27;help&#x27;</span> </span><br><span class="line">   argv = [] </span><br><span class="line">  gopts, _gargs = global_options.parse_args(glob)  </span><br><span class="line">  <span class="comment">#......  </span></span><br><span class="line">  <span class="keyword">try</span>: </span><br><span class="line">   cmd = self.commands[name] </span><br><span class="line">  <span class="keyword">except</span> KeyError: </span><br><span class="line">   <span class="comment">#...... </span></span><br><span class="line">   <span class="keyword">return</span> <span class="number">1</span>  </span><br><span class="line">  cmd.repodir = self.repodir </span><br><span class="line">  cmd.manifest = XmlManifest(cmd.repodir)  </span><br><span class="line">  <span class="comment">#......  </span></span><br><span class="line">  <span class="keyword">try</span>: </span><br><span class="line">   result = cmd.Execute(copts, cargs) </span><br><span class="line">  <span class="keyword">except</span> DownloadError <span class="keyword">as</span> e: </span><br><span class="line">   <span class="comment">#...... </span></span><br><span class="line">   result = <span class="number">1</span> </span><br><span class="line">  <span class="keyword">except</span> ManifestInvalidRevisionError <span class="keyword">as</span> e: </span><br><span class="line">   <span class="comment">#...... </span></span><br><span class="line">   result = <span class="number">1</span> </span><br><span class="line">  <span class="keyword">except</span> NoManifestException <span class="keyword">as</span> e: </span><br><span class="line">   <span class="comment">#...... </span></span><br><span class="line">   result = <span class="number">1</span> </span><br><span class="line">  <span class="keyword">except</span> NoSuchProjectError <span class="keyword">as</span> e: </span><br><span class="line">   <span class="comment">#...... </span></span><br><span class="line">   result = <span class="number">1</span> </span><br><span class="line">  <span class="keyword">finally</span>: </span><br><span class="line">   <span class="comment">#......  </span></span><br><span class="line">  <span class="keyword">return</span> result </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Repoè„šæœ¬èƒ½æ‰§è¡Œçš„å‘½ä»¤éƒ½æ”¾åœ¨ç›®å½•.repo&#x2F;repo&#x2F;subcmdsä¸­ï¼Œè¯¥ç›®å½•æ¯ä¸€ä¸ªpythonæ–‡ä»¶éƒ½å¯¹åº”ä¸€ä¸ªRepoå‘½ä»¤ã€‚ä¾‹å¦‚ï¼Œâ€œrepo initâ€è¡¨ç¤ºè¦æ‰§è¡Œå‘½ä»¤è„šæœ¬æ˜¯.repo&#x2F;repo&#x2F;subcmds&#x2F;init.pyã€‚</p>
<p>_Repoç±»çš„æˆå‘˜å‡½æ•°_Runé¦–å…ˆæ˜¯åœ¨repoåé¢æ‰€å¸¦çš„å‚æ•°ä¸­ï¼Œä¸æ˜¯ä»¥æ¨ªçº¿â€œ-â€å¼€å§‹çš„ç¬¬ä¸€ä¸ªé€‰é¡¹ï¼Œè¯¥é€‰é¡¹å°±ä»£è¡¨è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œè¯¥å‘½ä»¤çš„åç§°å°±ä¿å­˜åœ¨å˜é‡nameä¸­ã€‚æ¥ç€æ ¹æ®å˜é‡nameçš„å€¼åœ¨_Repoç±»çš„æˆå‘˜å˜é‡commandsä¸­æ‰¾åˆ°å¯¹åº”çš„å‘½ä»¤æ¨¡å—cmdï¼Œå¹¶ä¸”æŒ‡å®šè¯¥å‘½ä»¤æ¨¡å—cmdçš„æˆå‘˜å˜é‡repodirå’Œmanifestçš„å€¼ã€‚å‘½ä»¤æ¨¡å—cmdçš„æˆå‘˜å˜é‡repodiræè¿°çš„å°±æ˜¯AOSPçš„.repoç›®å½•ï¼Œæˆå‘˜å˜é‡manifestæŒ‡å‘çš„æ˜¯ä¸€ä¸ªXmlManifestå¯¹è±¡ï¼Œå®ƒæè¿°çš„æ˜¯AOSPçš„Repoä»“åº“å’ŒManifestä»“åº“ã€‚</p>
<p>æˆ‘ä»¬çœ‹çœ‹XmlManifestç±»çš„æ„é€ å‡½æ•°ï¼Œå®ƒå®šä¹‰åœ¨æ–‡ä»¶.repo&#x2F;repo&#x2F;xml_manifest.pyæ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">XmlManifest</span>(<span class="title class_ inherited__">object</span>): </span><br><span class="line"> <span class="string">&quot;&quot;&quot;manages the repo configuration file&quot;&quot;&quot;</span>  </span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, repodir</span>): </span><br><span class="line">  self.repodir = os.path.abspath(repodir) </span><br><span class="line">  self.topdir = os.path.dirname(self.repodir) </span><br><span class="line">  self.manifestFile = os.path.join(self.repodir, MANIFEST_FILE_NAME) </span><br><span class="line">  <span class="comment">#......  </span></span><br><span class="line">  self.repoProject = MetaProject(self, <span class="string">&#x27;repo&#x27;</span>, </span><br><span class="line">   gitdir  = os.path.join(repodir, <span class="string">&#x27;repo/.git&#x27;</span>), </span><br><span class="line">   worktree = os.path.join(repodir, <span class="string">&#x27;repo&#x27;</span>))  </span><br><span class="line">  self.manifestProject = MetaProject(self, <span class="string">&#x27;manifests&#x27;</span>, </span><br><span class="line">   gitdir  = os.path.join(repodir, <span class="string">&#x27;manifests.git&#x27;</span>), </span><br><span class="line">   worktree = os.path.join(repodir, <span class="string">&#x27;manifests&#x27;</span>))  </span><br><span class="line">  <span class="comment">#...... </span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>XmlManifestä½œäº†æè¿°äº†AOSPçš„Repoç›®å½•ï¼ˆrepodirï¼‰ã€AOSP æ ¹ç›®å½•ï¼ˆtopdirï¼‰å’ŒManifest.xmlæ–‡ä»¶ï¼ˆmanifestFileï¼‰ä¹‹å¤–ï¼Œè¿˜ä½¿ç”¨ä¸¤ä¸ªMetaProjectå¯¹è±¡æè¿°äº†AOSPçš„Repoä»“åº“ï¼ˆrepoProjectï¼‰å’ŒManifestä»“åº“ï¼ˆmanifestProjectï¼‰ã€‚</p>
<p>åœ¨AOSPä¸­ï¼Œæ¯ä¸€ä¸ªå­é¡¹ç›®ï¼ˆæˆ–è€…è¯´ä»“åº“ï¼‰éƒ½ç”¨ä¸€ä¸ªProjectå¯¹è±¡æ¥æè¿°ã€‚Projectç±»å®šä¹‰åœ¨æ–‡ä»¶.repo&#x2F;repo&#x2F;project.pyæ–‡ä»¶ä¸­ï¼Œç”¨æ¥å°è£…å¯¹å„ä¸ªé¡¹ç›®çš„åŸºç¡€Gitæ“ä½œï¼Œä¾‹å¦‚ï¼Œå¯¹é¡¹ç›®è¿›è¡Œæš‚å­˜ã€æäº¤å’Œæ›´æ–°ç­‰ã€‚å®ƒçš„æ„é€ å‡½æ•°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Project</span>(<span class="title class_ inherited__">object</span>): </span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, </span></span><br><span class="line"><span class="params">        manifest, </span></span><br><span class="line"><span class="params">        name, </span></span><br><span class="line"><span class="params">        remote, </span></span><br><span class="line"><span class="params">        gitdir, </span></span><br><span class="line"><span class="params">        worktree, </span></span><br><span class="line"><span class="params">        relpath, </span></span><br><span class="line"><span class="params">        revisionExpr, </span></span><br><span class="line"><span class="params">        revisionId, </span></span><br><span class="line"><span class="params">        rebase = <span class="literal">True</span>, </span></span><br><span class="line"><span class="params">        groups = <span class="literal">None</span>, </span></span><br><span class="line"><span class="params">        sync_c = <span class="literal">False</span>, </span></span><br><span class="line"><span class="params">        sync_s = <span class="literal">False</span>, </span></span><br><span class="line"><span class="params">        clone_depth = <span class="literal">None</span>, </span></span><br><span class="line"><span class="params">        upstream = <span class="literal">None</span>, </span></span><br><span class="line"><span class="params">        parent = <span class="literal">None</span>, </span></span><br><span class="line"><span class="params">        is_derived = <span class="literal">False</span>, </span></span><br><span class="line"><span class="params">        dest_branch = <span class="literal">None</span></span>): </span><br><span class="line">  <span class="string">&quot;&quot;&quot;Init a Project object. </span></span><br><span class="line"><span class="string">  Args: </span></span><br><span class="line"><span class="string">   manifest: The XmlManifest object. </span></span><br><span class="line"><span class="string">   name: The `name` attribute of manifest.xml&#x27;s project element. </span></span><br><span class="line"><span class="string">   remote: RemoteSpec object specifying its remote&#x27;s properties. </span></span><br><span class="line"><span class="string">   gitdir: Absolute path of git directory. </span></span><br><span class="line"><span class="string">   worktree: Absolute path of git working tree. </span></span><br><span class="line"><span class="string">   relpath: Relative path of git working tree to repo&#x27;s top directory. </span></span><br><span class="line"><span class="string">   revisionExpr: The `revision` attribute of manifest.xml&#x27;s project element. </span></span><br><span class="line"><span class="string">   revisionId: git commit id for checking out. </span></span><br><span class="line"><span class="string">   rebase: The `rebase` attribute of manifest.xml&#x27;s project element. </span></span><br><span class="line"><span class="string">   groups: The `groups` attribute of manifest.xml&#x27;s project element. </span></span><br><span class="line"><span class="string">   sync_c: The `sync-c` attribute of manifest.xml&#x27;s project element. </span></span><br><span class="line"><span class="string">   sync_s: The `sync-s` attribute of manifest.xml&#x27;s project element. </span></span><br><span class="line"><span class="string">   upstream: The `upstream` attribute of manifest.xml&#x27;s project element. </span></span><br><span class="line"><span class="string">   parent: The parent Project object. </span></span><br><span class="line"><span class="string">   is_derived: False if the project was explicitly defined in the manifest; </span></span><br><span class="line"><span class="string">         True if the project is a discovered submodule. </span></span><br><span class="line"><span class="string">   dest_branch: The branch to which to push changes for review by default. </span></span><br><span class="line"><span class="string">  &quot;&quot;&quot;</span> </span><br><span class="line">  self.manifest = manifest </span><br><span class="line">  self.name = name </span><br><span class="line">  self.remote = remote </span><br><span class="line">  self.gitdir = gitdir.replace(<span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;/&#x27;</span>) </span><br><span class="line">  <span class="keyword">if</span> worktree: </span><br><span class="line">   self.worktree = worktree.replace(<span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;/&#x27;</span>) </span><br><span class="line">  <span class="keyword">else</span>: </span><br><span class="line">   self.worktree = <span class="literal">None</span> </span><br><span class="line">  self.relpath = relpath </span><br><span class="line">  self.revisionExpr = revisionExpr </span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span>  revisionId <span class="keyword">is</span> <span class="literal">None</span> \ </span><br><span class="line">   <span class="keyword">and</span> revisionExpr \ </span><br><span class="line">   <span class="keyword">and</span> IsId(revisionExpr): </span><br><span class="line">   self.revisionId = revisionExpr </span><br><span class="line">  <span class="keyword">else</span>: </span><br><span class="line">   self.revisionId = revisionId </span><br><span class="line"> </span><br><span class="line">  self.rebase = rebase </span><br><span class="line">  self.groups = groups </span><br><span class="line">  self.sync_c = sync_c </span><br><span class="line">  self.sync_s = sync_s </span><br><span class="line">  self.clone_depth = clone_depth </span><br><span class="line">  self.upstream = upstream </span><br><span class="line">  self.parent = parent </span><br><span class="line">  self.is_derived = is_derived </span><br><span class="line">  self.subprojects = [] </span><br><span class="line"> </span><br><span class="line">  self.snapshots = &#123;&#125; </span><br><span class="line">  self.copyfiles = [] </span><br><span class="line">  self.annotations = [] </span><br><span class="line">  self.config = GitConfig.ForRepository( </span><br><span class="line">          gitdir = self.gitdir, </span><br><span class="line">          defaults = self.manifest.globalConfig) </span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> self.worktree: </span><br><span class="line">   self.work_git = self._GitGetByExec(self, bare=<span class="literal">False</span>) </span><br><span class="line">  <span class="keyword">else</span>: </span><br><span class="line">   self.work_git = <span class="literal">None</span> </span><br><span class="line">  self.bare_git = self._GitGetByExec(self, bare=<span class="literal">True</span>) </span><br><span class="line">  self.bare_ref = GitRefs(gitdir) </span><br><span class="line">  self.dest_branch = dest_branch </span><br><span class="line"> </span><br><span class="line">  <span class="comment"># This will be filled in if a project is later identified to be the </span></span><br><span class="line">  <span class="comment"># project containing repo hooks. </span></span><br><span class="line">  self.enabled_repo_hooks = [] </span><br></pre></td></tr></table></figure>

<p>Projectç±»æ„é€ å‡½æ•°çš„å„ä¸ªå‚æ•°çš„å«ä¹‰è§æ³¨é‡Šï¼Œè¿™é‡Œä¸ºäº†æ–¹ä¾¿æè¿°ï¼Œç”¨ä¸­æ–‡æè¿°ä¸€ä¸‹ï¼š</p>
<p>manifestï¼šæŒ‡å‘ä¸€ä¸ªXmlManifestå¯¹è±¡ï¼Œæè¿°AOSPçš„Repoä»“åº“å’ŒManifestä»“åº“å…ƒä¿¡æ¯ã€‚</p>
<p>nameï¼šé¡¹ç›®åç§°ã€‚</p>
<p>remoteï¼šæè¿°é¡¹ç›®å¯¹åº”çš„è¿œç¨‹ä»“åº“å…ƒä¿¡æ¯ã€‚</p>
<p>gitdirï¼šé¡¹ç›®çš„Gitä»“åº“ç›®å½•ã€‚</p>
<p>worktreeï¼šé¡¹ç›®çš„å·¥ä½œç›®å½•ã€‚</p>
<p>relpathï¼šé¡¹ç›®çš„ç›¸å¯¹äºAOSPæ ¹ç›®å½•çš„å·¥ä½œç›®å½•ã€‚</p>
<p>revisionExprã€revisionIdã€rebaseã€groupsã€sync_cã€sync_så’Œupstreamï¼šæ¯ä¸€ä¸ªé¡¹ç›®åœ¨.repo&#x2F;repo&#x2F;manifest.xmlæ–‡ä»¶ä¸­éƒ½æœ‰å¯¹åº”çš„æè¿°ï¼Œè¿™å‡ ä¸ªå±æ€§çš„å€¼å°±æ¥è‡ªäºè¯¥manifest.xmlæ–‡ä»¶å¯¹è‡ªå·±çš„æè¿°çš„ï¼Œå®ƒä»¬çš„å«ä¹‰å¯ä»¥å‚è€ƒ.repo&#x2F;repo&#x2F;docs&#x2F;manifest-format.txtæ–‡ä»¶ã€‚</p>
<p>parentï¼šçˆ¶é¡¹ç›®</p>
<p>is_derivedï¼šå¦‚æœä¸€ä¸ªé¡¹ç›®å«æœ‰å­æ¨¡å—ï¼ˆä¹Ÿæ˜¯ä¸€ä¸ªGitä»“åº“ï¼‰ï¼Œé‚£ä¹ˆè¿™äº›å­æ¨¡å—ä¹Ÿä¼šç”¨ä¸€ä¸ªProjectå¯¹è±¡æ¥æè¿°ï¼Œè¿™äº›Projectçš„is_derivedå±æ€§ä¼šè®¾ç½®ä¸ºtrueã€‚</p>
<p>dest_branchï¼šç”¨æ¥code reviewçš„åˆ†æ”¯ã€‚</p>
<blockquote>
<p>è¿™é‡Œé‡ç‚¹å†äº†è§£ä¸‹é¡¹ç›®çš„Gitä»“åº“ç›®å½•å’Œå·¥ä½œç›®å½•çš„æ¦‚å¿µã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªé¡¹ç›®çš„Gitä»“åº“ç›®å½•ï¼ˆé»˜è®¤ä¸º.gitç›®å½•ï¼‰æ˜¯ä½äºå·¥ä½œç›®å½•ä¸‹é¢çš„ï¼Œä½†æ˜¯Gitæ”¯æŒå°†ä¸€ä¸ªé¡¹ç›®çš„Gitä»“åº“ç›®å½•å’Œå·¥ä½œç›®å½•åˆ†å¼€æ¥å­˜æ”¾ã€‚åœ¨AOSPä¸­ï¼ŒRepoä»“åº“çš„Gitç›®å½•ï¼ˆ.gitï¼‰ä½äºå·¥ä½œç›®å½•ï¼ˆ.repo&#x2F;repoï¼‰ä¸‹ï¼ŒManifestä»“åº“çš„Gitç›®å½•æœ‰ä¸¤ä»½æ‹·è´ï¼Œä¸€ä»½ï¼ˆ.gitï¼‰ä½äºå·¥ä½œç›®å½•ï¼ˆ.repo&#x2F;manifestsï¼‰ä¸‹ï¼Œå¦å¤–ä¸€ä»½ä½äº .repo&#x2F;manifests.git ç›®å½•ï¼Œå…¶ä½™çš„AOSPå­é¡¹ç›®çš„å·¥ä½œç›®å½•å’ŒGitç›®å½•éƒ½æ˜¯åˆ†å¼€å­˜æ”¾çš„ï¼Œå…¶ä¸­ï¼Œå·¥ä½œç›®å½•ä½äºAOSPæ ¹ç›®å½•ä¸‹ï¼ŒGitç›®å½•ä½äº.repo&#x2F;repo&#x2F;projectsç›®å½•ä¸‹ã€‚</p>
<p>æ­¤å¤–ï¼Œæ¯ä¸€ä¸ªAOSPå­é¡¹ç›®çš„å·¥ä½œç›®å½•ä¹Ÿæœ‰ä¸€ä¸ª.gitç›®å½•ï¼Œä¸è¿‡è¿™ä¸ª.gitç›®å½•æ˜¯ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼Œé“¾æ¥åˆ°.repo&#x2F;repo&#x2F;projectså¯¹åº”çš„Gitç›®å½•ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±æ—¢å¯ä»¥åœ¨AOSPå­é¡¹ç›®çš„å·¥ä½œç›®å½•ä¸‹æ‰§è¡ŒGitå‘½ä»¤ï¼Œä¹Ÿå¯ä»¥åœ¨å…¶å¯¹åº”çš„Gitç›®å½•ä¸‹æ‰§è¡ŒGitå‘½ä»¤ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¦è®¿é—®åˆ°å·¥ä½œç›®å½•çš„å‘½ä»¤ï¼ˆä¾‹å¦‚git statusï¼‰éœ€è¦åœ¨å·¥ä½œç›®å½•ä¸‹æ‰§è¡Œï¼Œè€Œä¸éœ€è¦è®¿é—®å·¥ä½œç›®å½•ï¼ˆä¾‹å¦‚git logï¼‰å¯ä»¥åœ¨Gitç›®å½•ä¸‹æ‰§è¡Œã€‚</p>
<p>Projectç±»æœ‰ä¸¤ä¸ªæˆå‘˜å˜é‡work_gitå’Œbare_gitï¼Œå®ƒä»¬æŒ‡å‘çš„éƒ½æ˜¯ä¸€ä¸ª_GitGetByExecå¯¹è±¡ã€‚ç”¨æ¥å°è£…å¯¹Gitå‘½ä»¤çš„æ‰§è¡Œã€‚å…¶ä¸­ï¼Œå‰è€…åœ¨æ‰§è¡ŒGitå‘½ä»¤çš„æ—¶å€™ï¼Œä¼šå°†å½“å‰ç›®å½•è®¾ç½®ä¸ºé¡¹ç›®çš„å·¥ä½œç›®å½•ï¼Œè€Œåè€…åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸ä¼šè®¾ç½®å½“å‰ç›®å½•ï¼Œä½†æ˜¯ä¼šå°†ç¯å¢ƒå˜é‡GIT_DIRçš„å€¼è®¾ç½®ä¸ºé¡¹ç›®çš„Gitç›®å½•ï¼Œä¹Ÿå°±æ˜¯.repo&#x2F;projectsç›®å½•ä¸‹é¢çš„é‚£äº›ç›®å½•ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒProjectç±»å°±å¯ä»¥æ ¹æ®éœ€è¦æ¥åœ¨å·¥ä½œç›®å½•æˆ–è€…Gitç›®å½•ä¸‹æ‰§è¡ŒGitå‘½ä»¤ã€‚</p>
</blockquote>
<p>å›åˆ°XmlManifestç±»çš„æ„é€ å‡½æ•°ä¸­ï¼Œç”±äºRepoå’ŒManifestä¹Ÿæ˜¯å±äºGitä»“åº“ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿéœ€è¦åˆ›å»ºä¸€ä¸ªProjectå¯¹è±¡æ¥æè¿°å®ƒä»¬ã€‚ä¸è¿‡ï¼Œç”±äºå®ƒä»¬æ˜¯æ¯”è¾ƒç‰¹æ®Šçš„Gitä»“åº“ï¼ˆç”¨æ¥æè¿°AOSPå­é¡¹ç›®å…ƒä¿¡æ¯çš„Gitä»“åº“ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ä½¿ç”¨å¦å¤–ä¸€ä¸ªç±»å‹ä¸ºMetaProjectçš„å¯¹è±¡æ¥æè¿°å®ƒä»¬ã€‚MetaProjectç±»æ˜¯ä»Projectç±»ç»§æ‰¿ä¸‹æ¥çš„ï¼Œå®šä¹‰åœ¨project.pyæ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MetaProject</span>(<span class="title class_ inherited__">Project</span>): </span><br><span class="line"> <span class="string">&quot;&quot;&quot;A special project housed under .repo. </span></span><br><span class="line"><span class="string"> &quot;&quot;&quot;</span> </span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, manifest, name, gitdir, worktree</span>): </span><br><span class="line">  Project.__init__(self, </span><br><span class="line">           manifest = manifest, </span><br><span class="line">           name = name, </span><br><span class="line">           gitdir = gitdir, </span><br><span class="line">           worktree = worktree, </span><br><span class="line">           remote = RemoteSpec(<span class="string">&#x27;origin&#x27;</span>), </span><br><span class="line">           relpath = <span class="string">&#x27;.repo/%s&#x27;</span> % name, </span><br><span class="line">           revisionExpr = <span class="string">&#x27;refs/heads/master&#x27;</span>, </span><br><span class="line">           revisionId = <span class="literal">None</span>, </span><br><span class="line">           groups = <span class="literal">None</span>) </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ—¢ç„¶MetaProjectç±»æ˜¯ä»Projectç±»ç»§æ‰¿ä¸‹æ¥çš„ï¼Œé‚£ä¹ˆå®ƒä»¬çš„Gitæ“ä½œå‡ ä¹éƒ½å¯ä»¥é€šè¿‡Projectç±»æ¥å®Œæˆçš„ã€‚å®é™…ä¸Šï¼ŒMetaProjectç±»å’ŒProjectç±»ç›®å‰çš„åŒºåˆ«ä¸æ˜¯å¤ªå¤§ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯åŸºæœ¬ç›¸åŒçš„ã€‚ä½¿ç”¨MetaProjectç±»æ¥æè¿°Repoä»“åº“å’ŒManifestä»“åº“ï¼Œä¸»è¦æ˜¯ä¸ºäº†å¼ºè°ƒå®ƒä»¬æ˜¯ç”¨æ¥æè¿°AOSPå­é¡¹ç›®ä»“åº“çš„å…ƒä¿¡æ¯çš„ã€‚</p>
<p>å›åˆ°_Repoç±»çš„æˆå‘˜å‡½æ•°_Runä¸­ï¼Œåˆ›å»ºå¥½ç”¨æ¥æè¿°Repoä»“åº“å’ŒManifestä»“åº“çš„XmlManifestå¯¹è±¡ä¹‹åï¼Œå°±å¼€å§‹æ‰§è¡Œè·Ÿåœ¨repoè„šæœ¬åé¢çš„ä¸å¸¦æ¨ªçº¿<code>-</code>çš„é€‰é¡¹æ‰€è¡¨ç¤ºçš„å‘½ä»¤ã€‚åœ¨æˆ‘ä»¬è¿™ä¸ªåœºæ™¯ä¸­ï¼Œè¿™ä¸ªå‘½ä»¤å°±æ˜¯initï¼Œå®ƒå¯¹åº”çš„Pythonæ¨¡å—ä¸º.repo&#x2F;repo&#x2F;subcmds&#x2F;init.pyï¼Œå…¥å£å‡½æ•°ä¸ºå®šä¹‰åœ¨è¯¥æ¨¡å—çš„Initç±»çš„æˆå‘˜å‡½æ•°Executeï¼Œå®ƒçš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Init</span>(InteractiveCommand, MirrorSafeCommand): </span><br><span class="line">  <span class="comment">#......  </span></span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">Execute</span>(<span class="params">self, opt, args</span>): </span><br><span class="line">  <span class="comment">#...... </span></span><br><span class="line"> </span><br><span class="line">  self._SyncManifest(opt) </span><br><span class="line">  self._LinkManifest(opt.manifest_name)  </span><br><span class="line">  <span class="comment">#...... </span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Initç±»çš„æˆå‘˜å‡½æ•°Executeä¸»è¦å°±æ˜¯è°ƒç”¨å¦å¤–ä¸¤ä¸ªæˆå‘˜å‡½æ•°_SyncManifestå’Œ_LinkManifestæ¥å®Œæˆå…‹éš†Manifestä»“åº“çš„å·¥ä½œã€‚Initç±»çš„æˆå‘˜å‡½æ•°_SyncManifestçš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Init</span>(InteractiveCommand, MirrorSafeCommand): </span><br><span class="line"> <span class="comment">#...... </span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">_SyncManifest</span>(<span class="params">self, opt</span>): </span><br><span class="line">  m = self.manifest.manifestProject </span><br><span class="line">  is_new = <span class="keyword">not</span> m.Exists </span><br><span class="line">   <span class="keyword">if</span> is_new: </span><br><span class="line">    <span class="comment">#......  </span></span><br><span class="line">   m._InitGitDir(mirror_git=mirrored_manifest_git) </span><br><span class="line"> </span><br><span class="line">   <span class="keyword">if</span> opt.manifest_branch: </span><br><span class="line">    m.revisionExpr = opt.manifest_branch </span><br><span class="line">   <span class="keyword">else</span>: </span><br><span class="line">    m.revisionExpr = <span class="string">&#x27;refs/heads/master </span></span><br><span class="line"><span class="string">  else: </span></span><br><span class="line"><span class="string">   if opt.manifest_branch: </span></span><br><span class="line"><span class="string">    m.revisionExpr = opt.manifest_branch </span></span><br><span class="line"><span class="string">   else: </span></span><br><span class="line"><span class="string">    m.PreSync() </span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">  #...... </span></span><br><span class="line"><span class="string">   if not m.Sync_NetworkHalf(is_new=is_new): </span></span><br><span class="line"><span class="string">   #...... </span></span><br><span class="line"><span class="string">   sys.exit(1)  </span></span><br><span class="line"><span class="string">  if opt.manifest_branch: </span></span><br><span class="line"><span class="string">   m.MetaBranchSwitch(opt.manifest_branch) </span></span><br><span class="line"><span class="string">  #......  </span></span><br><span class="line"><span class="string">  m.Sync_LocalHalf(syncbuf) </span></span><br><span class="line"><span class="string">  #......  </span></span><br><span class="line"><span class="string">  if is_new or m.CurrentBranch is None: </span></span><br><span class="line"><span class="string">   if not m.StartBranch(&#x27;</span>default<span class="string">&#x27;): </span></span><br><span class="line"><span class="string">    #...... </span></span><br><span class="line"><span class="string">    sys.exit(1) </span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<p> <strong>Initç±»çš„æˆå‘˜å‡½æ•°_SyncManifestæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</strong></p>
<p>ï¼ˆ1ï¼‰æ£€æŸ¥æœ¬åœ°æ˜¯å¦å­˜åœ¨Manifestä»“åº“ï¼Œå³æ£€æŸ¥ç”¨æ¥æè¿°Manifestä»“åº“MetaProjectå¯¹è±¡mçš„æˆå‘˜å˜é‡mExistså€¼æ˜¯å¦ç­‰äºtrueã€‚å¦‚æœä¸ç­‰äºçš„è¯ï¼Œé‚£ä¹ˆå°±è¯´æ˜æœ¬åœ°è¿˜æ²¡æœ‰å®‰è£…è¿‡Manifestä»“åº“ã€‚è¿™æ—¶å€™å°±éœ€è¦è°ƒç”¨è¯¥MetaProjectå¯¹è±¡mçš„æˆå‘˜å‡½æ•°_InitGitDiræ¥åœ¨ .repo&#x2F;manifests ç›®å½•åˆå§‹åŒ–ä¸€ä¸ªGitä»“åº“ã€‚</p>
<p>ï¼ˆ2ï¼‰è°ƒç”¨ç”¨æ¥æè¿°Manifestä»“åº“MetaProjectå¯¹è±¡mçš„æˆå‘˜å‡½æ•°Sync_NetworkHalfæ¥ä»è¿œç¨‹ä»“åº“ä¸­å…‹éš†ä¸€ä¸ªæ–°çš„Manifestä»“åº“åˆ°æœ¬åœ°æ¥ï¼Œæˆ–è€…æ›´æ–°æœ¬åœ°çš„Manifestä»“åº“ã€‚è¿™ä¸ªè¿œç¨‹ä»“åº“çš„åœ°å€å³ä¸ºåœ¨æ‰§è¡Œâ€repo initâ€å‘½ä»¤æ—¶ï¼Œé€šè¿‡-uæŒ‡å®šçš„urlï¼Œå³<a target="_blank" rel="noopener" href="https://android.googlesource.com/platform/manifest">https://android.googlesource.com/platform/manifest</a>ã€‚</p>
<p>ï¼ˆ3ï¼‰æ£€æŸ¥â€repo initâ€å‘½ä»¤åé¢æ˜¯å¦é€šè¿‡-bæŒ‡å®šè¦åœ¨Manifestä»“åº“ä¸­checkoutå‡ºæ¥çš„åˆ†æ”¯ã€‚å¦‚æœæœ‰çš„è¯ï¼Œé‚£ä¹ˆå°±è°ƒç”¨ç”¨æ¥æè¿°Manifestä»“åº“MetaProjectå¯¹è±¡mçš„æˆå‘˜å‡½æ•°MetaBranchSwitchåšä¸€äº›æ¸…ç†å·¥ä½œï¼Œä»¥ä¾¿æ¥ä¸‹æ¥å¯ä»¥checkoutåˆ°æŒ‡å®šçš„åˆ†æ”¯ã€‚</p>
<p>ï¼ˆ4ï¼‰è°ƒç”¨ç”¨æ¥æè¿°Manifestä»“åº“MetaProjectå¯¹è±¡mçš„æˆå‘˜å‡½æ•°Sync_LocaHalfæ¥æ‰§è¡Œcheckoutåˆ†æ”¯çš„æ“ä½œã€‚æ³¨æ„ï¼Œè¦åˆ‡æ¢çš„åˆ†æ”¯åœ¨å‰é¢å·²ç»è®°å½•åœ¨MetaProjectå¯¹è±¡mçš„æˆå‘˜å˜é‡revisionExprä¸­ã€‚</p>
<p>ï¼ˆ5ï¼‰å¦‚æœå‰é¢æ‰§è¡Œçš„æ˜¯æ–°å®‰è£…Manifestä»“åº“çš„æ“ä½œï¼Œå¹¶ä¸”æ²¡æœ‰é€šè¿‡-bé€‰é¡¹æŒ‡å®šè¦checkoutçš„åˆ†æ”¯ï¼Œé‚£ä¹ˆé»˜è®¤å°±checkoutå‡ºä¸€ä¸ªdefaultåˆ†æ”¯ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä¸»è¦åˆ†æMetaProjectç±»çš„æˆå‘˜å‡½æ•°_InitGitDirã€Sync_NetworkHalfå’ŒSync_LocaHalfçš„å®ç°ã€‚è¿™å‡ ä¸ªå‡½æ•°å®é™…ä¸Šéƒ½æ˜¯ç”±MetaProjectçš„çˆ¶ç±»Projectæ¥å®ç°çš„ï¼Œå› æ­¤ï¼Œä¸‹é¢æˆ‘ä»¬å°±åˆ†æProjectç±»çš„æˆå‘˜å‡½æ•°_InitGitDirã€Sync_NetworkHalfå’ŒSync_LocaHalfçš„å®ç°ã€‚</p>
<p>Projectç±»çš„æˆå‘˜å‡½æ•°_InitGitDirçš„æˆå‘˜å‡½æ•°çš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Project</span>(<span class="title class_ inherited__">object</span>): </span><br><span class="line"> <span class="comment">#...... </span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">_InitGitDir</span>(<span class="params">self, mirror_git=<span class="literal">None</span></span>): </span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(self.gitdir): </span><br><span class="line">   os.makedirs(self.gitdir) </span><br><span class="line">   self.bare_git.init() </span><br><span class="line">   <span class="comment">#...... </span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Projectç±»çš„æˆå‘˜å‡½æ•°_InitGitDiré¦–å…ˆæ˜¯æ£€æŸ¥é¡¹ç›®çš„Gitç›®å½•æ˜¯å¦å·²ç»å­˜åœ¨ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±ä¼šé¦–å…ˆåˆ›å»ºè¿™ä¸ªGitç›®å½•ï¼Œç„¶åå†è°ƒç”¨æˆå‘˜å˜é‡bare_gitæ‰€æè¿°çš„ä¸€ä¸ª_GitGetByExecå¯¹è±¡çš„æˆå‘˜å‡½æ•°initæ¥åœ¨è¯¥ç›®å½•ä¸‹åˆå§‹åŒ–ä¸€ä¸ªGitä»“åº“ã€‚</p>
<p>_GitGetByExecç±»çš„æˆå‘˜å‡½æ•°initæ˜¯é€šè¿‡å¦å¤–ä¸€ä¸ªæˆå‘˜å‡½æ•°__getattr__æ¥å®ç°çš„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Project</span>(<span class="title class_ inherited__">object</span>): </span><br><span class="line"> <span class="comment">#...... </span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">class</span> <span class="title class_">_GitGetByExec</span>(<span class="title class_ inherited__">object</span>): </span><br><span class="line">  <span class="comment">#...... </span></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">__getattr__</span>(<span class="params">self, name</span>): </span><br><span class="line">   <span class="string">&quot;&quot;&quot;Allow arbitrary git commands using pythonic syntax. </span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">   This allows you to do things like: </span></span><br><span class="line"><span class="string">    git_obj.rev_parse(&#x27;HEAD&#x27;) </span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">   Since we don&#x27;t have a &#x27;rev_parse&#x27; method defined, the __getattr__ will </span></span><br><span class="line"><span class="string">   run. We&#x27;ll replace the &#x27;_&#x27; with a &#x27;-&#x27; and try to run a git command. </span></span><br><span class="line"><span class="string">   Any other positional arguments will be passed to the git command, and the </span></span><br><span class="line"><span class="string">   following keyword arguments are supported: </span></span><br><span class="line"><span class="string">    config: An optional dict of git config options to be passed with &#x27;-c&#x27;. </span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">   Args: </span></span><br><span class="line"><span class="string">    name: The name of the git command to call. Any &#x27;_&#x27; characters will </span></span><br><span class="line"><span class="string">      be replaced with &#x27;-&#x27;. </span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">   Returns: </span></span><br><span class="line"><span class="string">    A callable object that will try to call git with the named command. </span></span><br><span class="line"><span class="string">   &quot;&quot;&quot;</span> </span><br><span class="line">   name = name.replace(<span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;-&#x27;</span>) </span><br><span class="line">   <span class="keyword">def</span> <span class="title function_">runner</span>(<span class="params">*args, **kwargs</span>): </span><br><span class="line">    cmdv = [] </span><br><span class="line">    config = kwargs.pop(<span class="string">&#x27;config&#x27;</span>, <span class="literal">None</span>) </span><br><span class="line">    <span class="comment">#...... </span></span><br><span class="line">    <span class="keyword">if</span> config <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>: </span><br><span class="line">     <span class="comment">#...... </span></span><br><span class="line">     <span class="keyword">for</span> k, v <span class="keyword">in</span> config.items(): </span><br><span class="line">      cmdv.append(<span class="string">&#x27;-c&#x27;</span>) </span><br><span class="line">      cmdv.append(<span class="string">&#x27;%s=%s&#x27;</span> % (k, v)) </span><br><span class="line">    cmdv.append(name) </span><br><span class="line">    cmdv.extend(args) </span><br><span class="line">    p = GitCommand(self._project, </span><br><span class="line">            cmdv, </span><br><span class="line">            bare = self._bare, </span><br><span class="line">            capture_stdout = <span class="literal">True</span>, </span><br><span class="line">            capture_stderr = <span class="literal">True</span>) </span><br><span class="line">    <span class="keyword">if</span> p.Wait() != <span class="number">0</span>: </span><br><span class="line">     <span class="comment">#...... </span></span><br><span class="line">    r = p.stdout </span><br><span class="line">    <span class="keyword">try</span>: </span><br><span class="line">     r = r.decode(<span class="string">&#x27;utf-8&#x27;</span>) </span><br><span class="line">    <span class="keyword">except</span> AttributeError: </span><br><span class="line">     <span class="keyword">pass</span> </span><br><span class="line">    <span class="keyword">if</span> r.endswith(<span class="string">&#x27;\n&#x27;</span>) <span class="keyword">and</span> r.index(<span class="string">&#x27;\n&#x27;</span>) == <span class="built_in">len</span>(r) - <span class="number">1</span>: </span><br><span class="line">     <span class="keyword">return</span> r[:-<span class="number">1</span>] </span><br><span class="line">    <span class="keyword">return</span> r </span><br><span class="line">   <span class="keyword">return</span> runner </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä»æ³¨é‡Šå¯ä»¥çŸ¥é“ï¼Œ_GitGetByExecç±»çš„æˆå‘˜å‡½æ•°__getattr__ä½¿ç”¨äº†ä¸€ä¸ªtrickï¼Œå°†_GitGetByExecç±»æ²¡æœ‰å®ç°çš„æˆå‘˜å‡½æ•°é—´æ¥åœ°ä»¥å±æ€§çš„å½¢å¼æ¥è·å¾—ï¼Œå¹¶ä¸”å°†è¯¥æ²¡æœ‰å®ç°çš„æˆå‘˜å‡½æ•°çš„åç§°ä½œä¸ºgitçš„ä¸€ä¸ªå‚æ•°æ¥æ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æ‰§è¡Œ_GitGetByExec.init()çš„æ—¶å€™ï¼Œå®é™…ä¸Šæ˜¯é€è¿‡æˆå‘˜å‡½æ•°__getattr__æ‰§è¡Œäº†ä¸€ä¸ªâ€git initâ€å‘½ä»¤ã€‚è¿™ä¸ªå‘½ä»¤å°±æ­£å¥½æ˜¯ç”¨æ¥åˆå§‹åŒ–ä¸€ä¸ªGitä»“åº“ã€‚</p>
<p>æˆ‘ä»¬å†æ¥çœ‹Projectç±»çš„æˆå‘˜å‡½æ•°Sync_NetworkHalfçš„å®ç°ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Project</span>(<span class="title class_ inherited__">object</span>): </span><br><span class="line"> <span class="comment">#......  </span></span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">Sync_NetworkHalf</span>(<span class="params">self, </span></span><br><span class="line"><span class="params">   quiet=<span class="literal">False</span>, </span></span><br><span class="line"><span class="params">   is_new=<span class="literal">None</span>, </span></span><br><span class="line"><span class="params">   current_branch_only=<span class="literal">False</span>, </span></span><br><span class="line"><span class="params">   clone_bundle=<span class="literal">True</span>, </span></span><br><span class="line"><span class="params">   no_tags=<span class="literal">False</span></span>): </span><br><span class="line">  <span class="string">&quot;&quot;&quot;Perform only the network IO portion of the sync process. </span></span><br><span class="line"><span class="string">    Local working directory/branch state is not affected. </span></span><br><span class="line"><span class="string">  &quot;&quot;&quot;</span> </span><br><span class="line">  <span class="keyword">if</span> is_new <span class="keyword">is</span> <span class="literal">None</span>: </span><br><span class="line">   is_new = <span class="keyword">not</span> self.Exists </span><br><span class="line">  <span class="keyword">if</span> is_new: </span><br><span class="line">   self._InitGitDir()  </span><br><span class="line">  <span class="comment">#......  </span></span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> self._RemoteFetch(initial=is_new, quiet=quiet, alt_dir=alt_dir, </span><br><span class="line">               current_branch_only=current_branch_only, </span><br><span class="line">               no_tags=no_tags): </span><br><span class="line">   <span class="keyword">return</span> <span class="literal">False</span> </span><br><span class="line">    <span class="comment">#...... </span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Projectç±»çš„æˆå‘˜å‡½æ•°Sync_NetworkHalfä¸»è¦æ‰§è¡Œä»¥ä¸‹çš„æ“ä½œï¼š</p>
<p>ï¼ˆ1ï¼‰æ£€æŸ¥æœ¬åœ°æ˜¯å¦å·²ç»å­˜åœ¨å¯¹åº”çš„Gitä»“åº“ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±å…ˆè°ƒç”¨å¦å¤–ä¸€ä¸ªæˆå‘˜å‡½æ•°_InitGitDiræ¥åˆå§‹åŒ–è¯¥Gitä»“åº“ã€‚</p>
<p>ï¼ˆ2ï¼‰è°ƒç”¨å¦å¤–ä¸€ä¸ªæˆå‘˜å‡½æ•°_RemoteFetchæ¥ä»è¿œç¨‹ä»“åº“æ›´æ–°æœ¬åœ°ä»“åº“ã€‚</p>
<p>Projectç±»çš„æˆå‘˜å‡½æ•°_RemoteFetchçš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Project</span>(<span class="title class_ inherited__">object</span>): </span><br><span class="line"><span class="comment">#......  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_RemoteFetch</span>(<span class="params">self, name=<span class="literal">None</span>, </span></span><br><span class="line"><span class="params">          current_branch_only=<span class="literal">False</span>, </span></span><br><span class="line"><span class="params">          initial=<span class="literal">False</span>, </span></span><br><span class="line"><span class="params">          quiet=<span class="literal">False</span>, </span></span><br><span class="line"><span class="params">          alt_dir=<span class="literal">None</span>, </span></span><br><span class="line"><span class="params">          no_tags=<span class="literal">False</span></span>): </span><br><span class="line">  <span class="comment">#......  </span></span><br><span class="line">  cmd = [<span class="string">&#x27;fetch&#x27;</span>] </span><br><span class="line">  <span class="comment">#......  </span></span><br><span class="line">  ok = <span class="literal">False</span> </span><br><span class="line">  <span class="keyword">for</span> _i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>): </span><br><span class="line">   ret = GitCommand(self, cmd, bare=<span class="literal">True</span>, ssh_proxy=ssh_proxy).Wait() </span><br><span class="line">   <span class="keyword">if</span> ret == <span class="number">0</span>: </span><br><span class="line">    ok = <span class="literal">True</span> </span><br><span class="line">    <span class="keyword">break</span> </span><br><span class="line">   <span class="keyword">elif</span> current_branch_only <span class="keyword">and</span> is_sha1 <span class="keyword">and</span> ret == <span class="number">128</span>: </span><br><span class="line">    <span class="comment"># Exit code 128 means &quot;couldn&#x27;t find the ref you asked for&quot;; if we&#x27;re in sha1 </span></span><br><span class="line">    <span class="comment"># mode, we just tried sync&#x27;ing from the upstream field; it doesn&#x27;t exist, thus </span></span><br><span class="line">    <span class="comment"># abort the optimization attempt and do a full sync. </span></span><br><span class="line">    <span class="keyword">break</span> </span><br><span class="line">   time.sleep(random.randint(<span class="number">30</span>, <span class="number">45</span>))    </span><br><span class="line">  <span class="comment">#...... </span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Projectç±»çš„æˆå‘˜å‡½æ•°_RemoteFetchçš„æ ¸å¿ƒæ“ä½œå°±æ˜¯è°ƒç”¨â€œgit fetchâ€å‘½ä»¤æ¥ä»è¿œç¨‹ä»“åº“æ›´æ–°æœ¬åœ°ä»“åº“ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å†çœ‹MetaProjectç±»çš„æˆå‘˜å‡½æ•°Sync_LocaHalfçš„å®ç°ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Project</span>(<span class="title class_ inherited__">object</span>): </span><br><span class="line"> <span class="comment">#......  </span></span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">Sync_LocalHalf</span>(<span class="params">self, syncbuf</span>): </span><br><span class="line">  <span class="string">&quot;&quot;&quot;Perform only the local IO portion of the sync process. </span></span><br><span class="line"><span class="string">    Network access is not required. </span></span><br><span class="line"><span class="string">  &quot;&quot;&quot;</span> </span><br><span class="line">  <span class="comment">#...... </span></span><br><span class="line">  revid = self.GetRevisionId(all_refs) </span><br><span class="line">   <span class="comment">#...... </span></span><br><span class="line">   self._InitWorkTree() </span><br><span class="line">  head = self.work_git.GetHead() </span><br><span class="line">  <span class="keyword">if</span> head.startswith(R_HEADS): </span><br><span class="line">   branch = head[<span class="built_in">len</span>(R_HEADS):] </span><br><span class="line">   <span class="keyword">try</span>: </span><br><span class="line">    head = all_refs[head] </span><br><span class="line">   <span class="keyword">except</span> KeyError: </span><br><span class="line">    head = <span class="literal">None</span> </span><br><span class="line">  <span class="keyword">else</span>: </span><br><span class="line">   branch = <span class="literal">None</span> </span><br><span class="line"> </span><br><span class="line">  <span class="comment">#......  </span></span><br><span class="line">  <span class="keyword">if</span> head == revid: </span><br><span class="line">   <span class="comment"># No changes; don&#x27;t do anything further. </span></span><br><span class="line">   <span class="comment"># </span></span><br><span class="line">   <span class="keyword">return</span> </span><br><span class="line"> </span><br><span class="line">  branch = self.GetBranch(branch) </span><br><span class="line">   <span class="comment">#......  </span></span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> branch.LocalMerge: </span><br><span class="line">   <span class="comment"># The current branch has no tracking configuration. </span></span><br><span class="line">   <span class="comment"># Jump off it to a detached HEAD. </span></span><br><span class="line">   <span class="comment"># </span></span><br><span class="line">   syncbuf.info(self, </span><br><span class="line">          <span class="string">&quot;leaving %s; does not track upstream&quot;</span>, </span><br><span class="line">          branch.name) </span><br><span class="line">   <span class="keyword">try</span>: </span><br><span class="line">    self._Checkout(revid, quiet=<span class="literal">True</span>) </span><br><span class="line">   <span class="keyword">except</span> GitError <span class="keyword">as</span> e: </span><br><span class="line">    syncbuf.fail(self, e) </span><br><span class="line">    <span class="keyword">return</span> </span><br><span class="line">   <span class="comment">#...... </span></span><br><span class="line">   <span class="keyword">return</span>  </span><br><span class="line">  <span class="comment">#...... </span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæˆ‘ä»¬åªåˆ†æä¸€ç§æ¯”è¾ƒç®€å•çš„æƒ…å†µï¼Œå°±æ˜¯å½“å‰è¦checkoutçš„åˆ†æ”¯æ˜¯ä¸€ä¸ªå¹²å‡€çš„åˆ†æ”¯ï¼Œå®ƒæ²¡æœ‰åšè¿‡ä¿®æ”¹ï¼Œä¹Ÿæ²¡æœ‰è®¾ç½®è·Ÿè¸ªè¿œç¨‹åˆ†æ”¯ã€‚è¿™æ—¶å€™Projectç±»çš„æˆå‘˜å‡½æ•°_RemoteFetchçš„ä¸»è¦æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<p>ï¼ˆ1ï¼‰è°ƒç”¨å¦å¤–ä¸€ä¸ªæˆå‘˜å‡½æ•°GetRevisionIdè·å¾—å³å°†è¦checkoutçš„åˆ†æ”¯ï¼Œä¿å­˜åœ¨å˜é‡revidä¸­ã€‚</p>
<p>ï¼ˆ2ï¼‰è°ƒç”¨æˆå‘˜å˜é‡work_gitæ‰€æè¿°çš„ä¸€ä¸ª_GitGetByExecå¯¹è±¡çš„æˆå‘˜å‡½æ•°GetHeadè·å¾—é¡¹ç›®å½“å‰checkoutçš„åˆ†æ”¯ï¼Œåªå­˜åœ¨å˜é‡headä¸­ã€‚</p>
<p>ï¼ˆ3ï¼‰å¦‚æœå³å°†è¦checkoutçš„åˆ†æ”¯revidå°±æ˜¯å½“å‰å·²ç»checkoutåˆ†æ”¯ï¼Œé‚£ä¹ˆå°±ä»€ä¹ˆä¹Ÿä¸ç”¨åšã€‚å¦åˆ™ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚</p>
<p>ï¼ˆ4ï¼‰è°ƒç”¨å¦å¤–ä¸€ä¸ªæˆå‘˜å‡½æ•°GetBranchè·å¾—ç”¨æ¥æè¿°å½“å‰åˆ†æ”¯çš„ä¸€ä¸ªBranchå¯¹è±¡ã€‚</p>
<p>ï¼ˆ5ï¼‰å¦‚æœä¸Šè¿°Branchå¯¹è±¡çš„å±æ€§LocalMergeçš„å€¼ç­‰äºNoneï¼Œä¹Ÿå°±æ˜¯å±äºæˆ‘ä»¬è®¨è®ºçš„æƒ…å†µï¼Œé‚£ä¹ˆå°±è°ƒç”¨å¦å¤–ä¸€ä¸ªæˆå‘˜å‡½æ•°_CheckoutçœŸæ­£æ‰§è¡Œcheckoutåˆ†æ”¯revidçš„æ“ä½œã€‚</p>
<p>å¦‚æœè¦checkoutçš„åˆ†æ”¯revidä¸æ˜¯ä¸€ä¸ªå¹²å‡€çš„åˆ†æ”¯ï¼Œä¹Ÿå°±æ˜¯å®ƒæ­£åœ¨è·Ÿè¸ªè¿œç¨‹åˆ†æ”¯ï¼Œå¹¶ä¸”åœ¨æœ¬åœ°åšè¿‡æäº¤ï¼Œè¿™äº›æäº¤åˆæ²¡æœ‰ä¸Šä¼ åˆ°è¿œç¨‹åˆ†æ”¯å»ï¼Œé‚£ä¹ˆå°±éœ€è¦æ‰§è¡Œä¸€äº›mergeæˆ–è€…rebaseçš„æ“ä½œã€‚ä¸è¿‡æ— è®ºå¦‚ä½•ï¼Œè¿™äº›æ“ä½œéƒ½æ˜¯é€šè¿‡æ ‡å‡†çš„Gitå‘½ä»¤æ¥å®Œæˆçš„ã€‚</p>
<p>æˆ‘ä»¬æ¥ç€å†çœ‹Projectç±»çš„æˆå‘˜å‡½æ•°_Checkoutçš„å®ç°ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Project</span>(<span class="title class_ inherited__">object</span>): </span><br><span class="line"> <span class="comment">#...... </span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">_Checkout</span>(<span class="params">self, rev, quiet=<span class="literal">False</span></span>): </span><br><span class="line">  cmd = [<span class="string">&#x27;checkout&#x27;</span>] </span><br><span class="line">  <span class="keyword">if</span> quiet: </span><br><span class="line">   cmd.append(<span class="string">&#x27;-q&#x27;</span>) </span><br><span class="line">  cmd.append(rev) </span><br><span class="line">  cmd.append(<span class="string">&#x27;--&#x27;</span>) </span><br><span class="line">  <span class="keyword">if</span> GitCommand(self, cmd).Wait() != <span class="number">0</span>: </span><br><span class="line">   <span class="keyword">if</span> self._allrefs: </span><br><span class="line">    <span class="keyword">raise</span> GitError(<span class="string">&#x27;%s checkout %s &#x27;</span> % (self.name, rev)) </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Projectç±»çš„æˆå‘˜å‡½æ•°_Checkoutçš„å®ç°å¾ˆç®€å•ï¼Œå®ƒé€šè¿‡GitCommandç±»æ„é€ äº†ä¸€ä¸ªâ€œgit checkoutâ€å‘½ä»¤ï¼Œå°†å‚æ•°revæè¿°çš„åˆ†æ”¯checkoutå‡ºæ¥ã€‚</p>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å°±å°†Manifestä»“åº“ä»è¿œç¨‹åœ°å€<a target="_blank" rel="noopener" href="https://android.googlesource.com/platform/manifest">https://android.googlesource.com/platform/manifest</a>å…‹éš†åˆ°æœ¬åœ°æ¥äº†ï¼Œå¹¶ä¸”checkoutå‡ºäº†æŒ‡å®šçš„åˆ†æ”¯ã€‚å›åˆ°Initç±»çš„æˆå‘˜å‡½æ•°Executeä¸­ï¼Œå®ƒæ¥ä¸‹æ¥è¿˜è¦è°ƒç”¨å¦å¤–ä¸€ä¸ªæˆå‘˜å‡½æ•°_LinkManifestæ¥æ‰§è¡Œä¸€ä¸ªç¬¦å·é“¾æ¥çš„æ“ä½œã€‚</p>
<p>Initç±»çš„æˆå‘˜å‡½æ•°_LinkManifestçš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Init</span>(InteractiveCommand, MirrorSafeCommand): </span><br><span class="line"> <span class="comment">#...... </span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">_LinkManifest</span>(<span class="params">self, name</span>): </span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> name: </span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&#x27;fatal: manifest name (-m) is required.&#x27;</span>, file=sys.stderr) </span><br><span class="line">   sys.exit(<span class="number">1</span>) </span><br><span class="line"> </span><br><span class="line">  <span class="keyword">try</span>: </span><br><span class="line">   self.manifest.Link(name) </span><br><span class="line">  <span class="keyword">except</span> ManifestParseError <span class="keyword">as</span> e: </span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;fatal: manifest &#x27;%s&#x27; not available&quot;</span> % name, file=sys.stderr) </span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&#x27;fatal: %s&#x27;</span> % <span class="built_in">str</span>(e), file=sys.stderr) </span><br><span class="line">   sys.exit(<span class="number">1</span>) </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å‚æ•°nameçš„å€¼ä¸€èˆ¬å°±ç­‰äºâ€œdefault.xmlâ€ï¼Œè¡¨ç¤ºManifestä»“åº“ä¸­çš„default.xmlæ–‡ä»¶ï¼ŒInitç±»çš„æˆå‘˜å‡½æ•°_LinkManifesté€šè¿‡è°ƒç”¨æˆå‘˜å˜é‡manifestæ‰€æè¿°çš„ä¸€ä¸ªXmlManifestå¯¹è±¡çš„æˆå‘˜å‡½æ•°Linkæ¥æ‰§è¡Œç¬¦å·é“¾æ¥çš„æ“ä½œï¼Œå®ƒå®šä¹‰åœ¨æ–‡ä»¶.repo&#x2F;repo&#x2F;xml_manifest.pyæ–‡ä»¶ï¼Œå®ƒçš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">XmlManifest</span>(<span class="title class_ inherited__">object</span>): </span><br><span class="line"> <span class="string">&quot;&quot;&quot;manages the repo configuration file&quot;&quot;&quot;</span> </span><br><span class="line"> <span class="comment">#...... </span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">Link</span>(<span class="params">self, name</span>): </span><br><span class="line">  <span class="string">&quot;&quot;&quot;Update the repo metadata to use a different manifest. </span></span><br><span class="line"><span class="string">  &quot;&quot;&quot;</span> </span><br><span class="line">  <span class="comment">#...... </span></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">try</span>: </span><br><span class="line">   <span class="keyword">if</span> os.path.lexists(self.manifestFile): </span><br><span class="line">    os.remove(self.manifestFile) </span><br><span class="line">   os.symlink(<span class="string">&#x27;manifests/%s&#x27;</span> % name, self.manifestFile) </span><br><span class="line">  <span class="keyword">except</span> OSError <span class="keyword">as</span> e: </span><br><span class="line">   <span class="keyword">raise</span> ManifestParseError(<span class="string">&#x27;cannot link manifest %s: %s&#x27;</span> % (name, <span class="built_in">str</span>(e))) </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>XmlManifestç±»çš„æˆå‘˜å˜é‡manifestFileçš„å€¼ç­‰äº<code>$(AOSP)/.repo/manifest.xml</code>ï¼Œé€šè¿‡è°ƒç”¨os.symlinkå°±å°†å®ƒç¬¦å·é“¾æ¥è‡³<code>$(AOSP)/.repo/manifests/&lt;name&gt;</code> æ–‡ä»¶å»ã€‚è¿™æ ·æ— è®ºManifestä»“åº“ä¸­ç”¨æ¥æè¿°AOSPå­é¡¹ç›®çš„xmlæ–‡ä»¶æ˜¯ä»€ä¹ˆåç§°ï¼Œéƒ½å¯ä»¥ç»Ÿä¸€é€šè¿‡<code>$(AOSP)/.repo/manifest.xml</code>æ–‡ä»¶æ¥è®¿é—®ã€‚</p>
<p>å‰é¢æåˆ°ï¼ŒManifestä»“åº“ä¸­ç”¨æ¥æè¿°AOSPå­é¡¹ç›®çš„xmlæ–‡ä»¶åç§°é»˜è®¤å°±ä¸ºdefault.xmlï¼Œå®ƒçš„å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span>&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;<span class="name">remote</span> <span class="attr">name</span>=<span class="string">&quot;aosp&quot;</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">fetch</span>=<span class="string">&quot;..&quot;</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">review</span>=<span class="string">&quot;https://android-review.googlesource.com/&quot;</span> /&gt;</span> </span><br><span class="line"> <span class="tag">&lt;<span class="name">default</span> <span class="attr">revision</span>=<span class="string">&quot;refs/tags/android-4.2_r1&quot;</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">remote</span>=<span class="string">&quot;aosp&quot;</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">sync-j</span>=<span class="string">&quot;4&quot;</span> /&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;<span class="name">project</span> <span class="attr">path</span>=<span class="string">&quot;build&quot;</span> <span class="attr">name</span>=<span class="string">&quot;platform/build&quot;</span> &gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">copyfile</span> <span class="attr">src</span>=<span class="string">&quot;core/root.mk&quot;</span> <span class="attr">dest</span>=<span class="string">&quot;Makefile&quot;</span> /&gt;</span> </span><br><span class="line"> <span class="tag">&lt;/<span class="name">project</span>&gt;</span> </span><br><span class="line"> <span class="tag">&lt;<span class="name">project</span> <span class="attr">path</span>=<span class="string">&quot;abi/cpp&quot;</span> <span class="attr">name</span>=<span class="string">&quot;platform/abi/cpp&quot;</span> /&gt;</span> </span><br><span class="line"> <span class="tag">&lt;<span class="name">project</span> <span class="attr">path</span>=<span class="string">&quot;bionic&quot;</span> <span class="attr">name</span>=<span class="string">&quot;platform/bionic&quot;</span> /&gt;</span> </span><br><span class="line"> <span class="comment">&lt;!-- ...... --&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span> </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å…³äºè¯¥xmlæ–‡ä»¶çš„è¯¦ç»†æè¿°å¯ä»¥å‚è€ƒ.repo&#x2F;repo&#x2F;docs&#x2F;manifest-format.txtæ–‡ä»¶ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¯¥xmlåŒ…å«æœ‰å››ç§ç±»å‹çš„æ ‡ç­¾ï¼š</p>
<p>remoteï¼šç”¨æ¥æŒ‡å®šè¿œç¨‹ä»“åº“ä¿¡æ¯ã€‚å±æ€§nameæè¿°çš„æ˜¯ä¸€ä¸ªè¿œç¨‹ä»“åº“çš„åç§°ï¼Œå±æ€§fetchç”¨ä½œé¡¹ç›®åç§°çš„å‰ç¼˜ï¼Œåœ¨æ„é€ é¡¹ç›®ä»“åº“è¿œç¨‹åœ°å€æ—¶ä½¿ç”¨åˆ°ï¼Œå±æ€§reviewæè¿°çš„æ˜¯ç”¨ä½œcode reviewçš„serveråœ°å€ã€‚</p>
<p>defaultï¼šå½“projectæ ‡ç­¾æ²¡æœ‰æŒ‡å®šdefaultæ ‡ç­¾çš„å±æ€§æ—¶ï¼Œé»˜è®¤å°±ä½¿ç”¨åœ¨defaultæ ‡ç­¾åˆ—å‡ºçš„å±æ€§ã€‚å±æ€§revisionæè¿°çš„æ˜¯é¡¹ç›®é»˜è®¤æ£€å‡ºçš„åˆ†æ”¯ï¼Œå±æ€§remoteæè¿°çš„æ˜¯é»˜è®¤ä½¿ç”¨çš„è¿œç¨‹ä»“åº“åç§°ï¼Œå¿…é¡»è¦å¯¹åº”çš„remoteæ ‡ç­¾çš„nameå±æ€§å€¼ï¼Œå±æ€§sync-jæè¿°çš„æ˜¯ä»è¿œç¨‹ä»“åº“æ›´æ–°é¡¹ç›®æ—¶ä½¿ç”¨çš„å¹¶è¡Œä»»åŠ¡æ•°ã€‚</p>
<p>projectï¼šæ¯ä¸€ä¸ªAOSPå­é¡¹ç›®åœ¨è¿™é‡Œéƒ½å¯¹åº”æœ‰ä¸€ä¸ªprojecæ ‡ç­¾ï¼Œç”¨æ¥æè¿°é¡¹ç›®çš„å…ƒä¿¡æ¯ã€‚å±æ€§pathæè¿°çš„æ˜¯é¡¹ç›®ç›¸å¯¹äºè¿œç¨‹ä»“åº“URLçš„è·¯å¾„ï¼Œå±æ€§nameæè¿°çš„æ˜¯é¡¹ç›®çš„åç§°ï¼Œä¹Ÿæ˜¯ç›¸å¯¹äº AOSPæ ¹ç›®å½•çš„ç›®å½•åç§°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¿œç¨‹ä»“åº“URLä¸º<a target="_blank" rel="noopener" href="https://android.googlesource.com/platform">https://android.googlesource.com/platform</a>ï¼Œé‚£ä¹ˆAOSPå­é¡¹ç›®bionicå¯¹åº”çš„è¿œç¨‹ä»“åº“URLå°±ä¸º<a target="_blank" rel="noopener" href="https://android.googlesource.com/platform/bionic">https://android.googlesource.com/platform/bionic</a>ï¼Œå¹¶ä¸”å®ƒçš„å·¥ä½œç›®å½•ä½äº<code>$(AOSP)/bionic</code>ã€‚</p>
<p>copyfileï¼šä½œä¸ºprojectçš„å­æ ‡ç­¾ï¼Œè¡¨ç¤ºè¦å°†ä»è¿œç¨‹ä»“åº“æ›´æ–°å›æ¥çš„æ–‡ä»¶æ‹·è´åˆ°æŒ‡å®šçš„å¦å¤–ä¸€ä¸ªæ–‡ä»¶å»ã€‚</p>
<p>è‡³äº›ï¼Œæˆ‘ä»¬å°±åˆ†æå®ŒæˆManifestä»“åº“çš„å…‹éš†è¿‡ç¨‹äº†ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å†åˆ†æAOSPå­é¡¹ç›®ä»“åº“çš„å…‹éš†è¿‡ç¨‹æˆ–è€…é’ˆå¯¹AOSPå­é¡¹ç›®çš„å„ç§Repoå‘½ä»¤å°±å®¹æ˜“å¤šäº†ã€‚</p>
<h3 id="2-4-AOSPå­é¡¹ç›®ä»“åº“"><a href="#2-4-AOSPå­é¡¹ç›®ä»“åº“" class="headerlink" title="2.4 AOSPå­é¡¹ç›®ä»“åº“"></a><font size=3>2.4 AOSPå­é¡¹ç›®ä»“åº“</font></h3><blockquote>
<p>ã€æ³¨æ„ã€‘è¿™ä¸€éƒ¨åˆ†æˆ‘å°±ä¸æ˜¯æŒ‰è‡ªå·±ä¸‹è½½çš„æœ€æ–°çš„repoä»“åº“æºç åˆ†æçš„äº†ï¼Œç›´æ¥å¤åˆ¶çš„åŸæ–‡ï¼š<a target="_blank" rel="noopener" href="https://www.jb51.net/article/131935.htm">Androidæºä»£ç ä»“åº“åŠå…¶ç®¡ç†å·¥å…·Repoåˆ†æè¯¦è§£_Android_è„šæœ¬ä¹‹å®¶ (jb51.net)</a>ï¼Œä¸»è¦æ˜¯è¿™é‡Œæ²¡çœ‹æ‡‚ã€‚å“ˆå“ˆã€‚</p>
</blockquote>
<p>æ‰§è¡Œå®Œæˆrepo initå‘½ä»¤ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»§ç»­æ‰§è¡Œrepo syncå‘½ä»¤æ¥å…‹éš†æˆ–è€…åŒæ­¥AOSPå­é¡¹ç›®äº†ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repo sync</span><br></pre></td></tr></table></figure>

<p>ä¸repo initå‘½ä»¤ç±»ä¼¼ï¼Œrepo syncå‘½ä»¤çš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>ï¼ˆ1ï¼‰Repoè„šæœ¬æ‰¾åˆ°Repoä»“åº“é‡Œé¢çš„main.pyæ–‡ä»¶ï¼Œå¹¶ä¸”æ‰§è¡Œå®ƒçš„å…¥å£å‡½æ•°_Mainï¼›</p>
<p>ï¼ˆ2ï¼‰Repoä»“åº“é‡Œé¢çš„main.pyæ–‡ä»¶çš„å…¥å£å‡½æ•°_Mainè°ƒç”¨_Repoç±»çš„æˆå‘˜å‡½æ•°_Runå¯¹Repoè„šæœ¬ä¼ é€’è¿›æ¥çš„å‚æ•°è¿›è¡Œè§£æï¼›</p>
<p>ï¼ˆ3ï¼‰_Repoç±»çš„æˆå‘˜å‡½æ•°_Runè§£æå‚æ•°å‘ç°è¦æ‰§è¡Œçš„å‘½ä»¤æ˜¯syncï¼Œäºæ˜¯å°±åœ¨subcmdsç›®å½•ä¸­æ‰¾åˆ°ä¸€ä¸ªåç§°ä¸ºsync.pyçš„æ–‡ä»¶ï¼Œå¹¶ä¸”è°ƒç”¨å®šä¹‰åœ¨å®ƒé‡Œé¢çš„ä¸€ä¸ªåç§°ä¸ºSyncçš„ç±»çš„æˆå‘˜å‡½æ•°Executeï¼›</p>
<p>ï¼ˆ4ï¼‰Syncç±»çš„æˆå‘˜å‡½æ•°Executeè§£æManifestä»“åº“çš„default.xmlæ–‡ä»¶ï¼Œå¹¶ä¸”å…‹éš†æˆ–è€…åŒæ­¥å‡ºåœ¨default.xmlæ–‡ä»¶é‡Œé¢åˆ—å‡ºçš„æ¯ä¸€ä¸ªAOSPå­é¡¹ç›®ã€‚</p>
<p>åœ¨ç¬¬ï¼ˆ3ï¼‰æ­¥ä¸­ï¼ŒRepoä»“åº“çš„æ¯ä¸€ä¸ªPythonæ–‡ä»¶æ˜¯å¦‚ä½•ä¸ä¸€ä¸ªRepoå‘½ä»¤å…³è”èµ·æ¥çš„å‘¢ï¼ŸåŸæ¥åœ¨Repoä»“åº“çš„subcmdsç›®å½•ä¸­ï¼Œæœ‰ä¸€ä¸ª__init__.pyæ–‡ä»¶ï¼Œæ¯å½“subcmdsè¢«importæ—¶ï¼Œå®šä¹‰åœ¨å®ƒé‡Œé¢çš„å‘½ä»¤å°±ä¼šè¢«æ‰§è¡Œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">all_commands = &#123;&#125;  </span><br><span class="line">my_dir = os.path.dirname(__file__) </span><br><span class="line"><span class="keyword">for</span> py <span class="keyword">in</span> os.listdir(my_dir): </span><br><span class="line"> <span class="keyword">if</span> py == <span class="string">&#x27;__init__.py&#x27;</span>: </span><br><span class="line">  <span class="keyword">continue</span>  </span><br><span class="line"> <span class="keyword">if</span> py.endswith(<span class="string">&#x27;.py&#x27;</span>): </span><br><span class="line">  name = py[:-<span class="number">3</span>] </span><br><span class="line">  clsn = name.capitalize() </span><br><span class="line">  <span class="keyword">while</span> clsn.find(<span class="string">&#x27;_&#x27;</span>) &gt; <span class="number">0</span>: </span><br><span class="line">   h = clsn.index(<span class="string">&#x27;_&#x27;</span>) </span><br><span class="line">   clsn = clsn[<span class="number">0</span>:h] + clsn[h + <span class="number">1</span>:].capitalize() </span><br><span class="line">   mod = <span class="built_in">__import__</span>(__name__, </span><br><span class="line">           <span class="built_in">globals</span>(), </span><br><span class="line">           <span class="built_in">locals</span>(), </span><br><span class="line">           [<span class="string">&#x27;%s&#x27;</span> % name]) </span><br><span class="line">  mod = <span class="built_in">getattr</span>(mod, name) </span><br><span class="line">  <span class="keyword">try</span>: </span><br><span class="line">   cmd = <span class="built_in">getattr</span>(mod, clsn)() </span><br><span class="line">  <span class="keyword">except</span> AttributeError: </span><br><span class="line">   <span class="keyword">raise</span> SyntaxError(<span class="string">&#x27;%s/%s does not define class %s&#x27;</span> % ( </span><br><span class="line">             __name__, py, clsn)) </span><br><span class="line"> </span><br><span class="line">  name = name.replace(<span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;-&#x27;</span>) </span><br><span class="line">  cmd.NAME = name </span><br><span class="line">  all_commands[name] = cmd </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>__init__.pyä¼šåˆ—å‡ºsubcmdsç›®å½•ä¸­çš„æ‰€æœ‰Pythonæ–‡ä»¶ï¼ˆé™¤äº†__init__.pyï¼‰ï¼Œå¹¶ä¸”é‡Œé¢æ‰¾åˆ°å¯¹åº”çš„ç±»ï¼Œç„¶åå†åˆ›å»ºè¿™ä¸ªç±»çš„ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸”ä»¥æ–‡ä»¶åä¸ºå…³é”®å­—å°†è¯¥å¯¹è±¡ä¿å­˜åœ¨å…¨å±€å˜é‡all_commandsä¸­ã€‚ä¾‹å¦‚ï¼Œå¯¹äºsync.pyæ–‡ä»¶ï¼Œå®ƒçš„æ–‡ä»¶åç§°å»æ‰åç¼€ååä¸ºsyncï¼Œå†å°†syncçš„é¦–å­—æ¯å¤§å†™ï¼Œå¾—åˆ°Syncã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œsync.pyéœ€è¦å®šä¹‰ä¸€ä¸ªSyncç±»ï¼Œå¹¶ä¸”è¿™ä¸ªç±»éœ€è¦ç›´æ¥æˆ–è€…é—´æ¥åœ°ä»Commandç±»ç»§æ‰¿ä¸‹æ¥ã€‚Command ç±»æœ‰ä¸€ä¸ªæˆå‘˜å‡½æ•°Executeï¼Œå®ƒçš„å„ä¸ªå­ç±»éœ€è¦å¯¹å®ƒè¿›è¡Œé‡å†™ï¼Œä»¥å®ç°å„è‡ªçš„åŠŸèƒ½ã€‚</p>
<p>_Repoç±»çš„æˆå‘˜å‡½æ•°_Runå°±æ˜¯é€šè¿‡subcmdsæ¨¡å—é‡Œé¢çš„å…¨å±€å˜é‡all_commandsï¼Œå¹¶ä¸”æ ¹æ®Repoè„šæœ¬ä¼ è¿›è¡Œæ¥çš„ç¬¬ä¸€ä¸ªä¸å¸¦æ¨ªçº¿â€œ-â€çš„å‚æ•°æ¥æ‰¾åˆ°å¯¹åº”çš„Commandå¯¹è±¡ï¼Œç„¶åè°ƒç”¨å®ƒçš„æˆå‘˜å‡½æ•°Executeçš„ã€‚</p>
<p>Syncç±»çš„æˆå‘˜å‡½æ•°Executeçš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Sync</span>(Command, MirrorSafeCommand): </span><br><span class="line"> <span class="comment">#...... </span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">Execute</span>(<span class="params">self, opt, args</span>): </span><br><span class="line">  <span class="comment">#...... </span></span><br><span class="line"> </span><br><span class="line">  mp = self.manifest.manifestProject </span><br><span class="line">  <span class="comment">#...... </span></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> opt.local_only: </span><br><span class="line">   mp.Sync_NetworkHalf(quiet=opt.quiet, </span><br><span class="line">             current_branch_only=opt.current_branch_only, </span><br><span class="line">             no_tags=opt.no_tags) </span><br><span class="line">  <span class="comment">#...... </span></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> mp.HasChanges: </span><br><span class="line">   ...... </span><br><span class="line">   mp.Sync_LocalHalf(syncbuf) </span><br><span class="line">   <span class="comment">#...... </span></span><br><span class="line"> </span><br><span class="line">  all_projects = self.GetProjects(args, </span><br><span class="line">                  missing_ok=<span class="literal">True</span>, </span><br><span class="line">                  submodules_ok=opt.fetch_submodules) </span><br><span class="line">  <span class="comment">#...... </span></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> opt.local_only: </span><br><span class="line">   to_fetch = [] </span><br><span class="line">   <span class="comment">#...... </span></span><br><span class="line">   to_fetch.extend(all_projects) </span><br><span class="line">   to_fetch.sort(key=self._fetch_times.Get, reverse=<span class="literal">True</span>) </span><br><span class="line"> </span><br><span class="line">   fetched = self._Fetch(to_fetch, opt) </span><br><span class="line">   <span class="comment">#...... </span></span><br><span class="line"> </span><br><span class="line">   <span class="keyword">if</span> opt.network_only: </span><br><span class="line">    <span class="comment"># bail out now; the rest touches the working tree </span></span><br><span class="line">    <span class="keyword">return</span> </span><br><span class="line"> </span><br><span class="line">   <span class="comment"># Iteratively fetch missing and/or nested unregistered submodules </span></span><br><span class="line">   <span class="keyword">while</span> <span class="literal">True</span>: </span><br><span class="line">    <span class="comment">#...... </span></span><br><span class="line">    all_projects = self.GetProjects(args, </span><br><span class="line">                    missing_ok=<span class="literal">True</span>, </span><br><span class="line">                    submodules_ok=opt.fetch_submodules) </span><br><span class="line">    missing = [] </span><br><span class="line">    <span class="keyword">for</span> project <span class="keyword">in</span> all_projects: </span><br><span class="line">     <span class="keyword">if</span> project.gitdir <span class="keyword">not</span> <span class="keyword">in</span> fetched: </span><br><span class="line">      missing.append(project) </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> missing: </span><br><span class="line">     <span class="keyword">break</span> </span><br><span class="line">    <span class="comment">#...... </span></span><br><span class="line">    fetched.update(self._Fetch(missing, opt)) </span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> self.UpdateProjectList(): </span><br><span class="line">   sys.exit(<span class="number">1</span>) </span><br><span class="line">   <span class="comment">#......  </span></span><br><span class="line">  <span class="keyword">for</span> project <span class="keyword">in</span> all_projects: </span><br><span class="line">   <span class="comment">#...... </span></span><br><span class="line">   <span class="keyword">if</span> project.worktree: </span><br><span class="line">    project.Sync_LocalHalf(syncbuf)  </span><br><span class="line">  <span class="comment">#...... </span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Syncç±»çš„æˆå‘˜å‡½æ•°Executeçš„æ ¸ä»¥æ‰§è¡Œæµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>ï¼ˆ1ï¼‰è·å¾—ç”¨æ¥æè¿°Manifestä»“åº“çš„MetaProjectå¯¹è±¡mpã€‚</p>
<p>ï¼ˆ2ï¼‰å¦‚æœåœ¨æ‰§è¡Œrepo syncå‘½ä»¤æ—¶ï¼Œæ²¡æœ‰æŒ‡å®šâ€“local-onlyé€‰é¡¹ï¼Œé‚£ä¹ˆå°±è°ƒç”¨MetaProjectå¯¹è±¡mpçš„æˆå‘˜å‡½æ•°Sync_NetworkHalfä»è¿œç¨‹ä»“åº“ä¸‹è½½æ›´æ–°æœ¬åœ°Manifestä»“åº“ã€‚</p>
<p>ï¼ˆ3ï¼‰å¦‚æœMainifestä»“åº“å‘ç”Ÿè¿‡æ›´æ–°ï¼Œé‚£ä¹ˆå°±è°ƒç”¨MetaProjectå¯¹è±¡mpçš„æˆå‘˜å‡½æ•°Sync_LocalHalfæ¥åˆå¹¶è¿™äº›æ›´æ–°åˆ°æœ¬åœ°çš„å½“å‰åˆ†æ”¯æ¥ã€‚</p>
<p>ï¼ˆ4ï¼‰è°ƒç”¨Syncçš„çˆ¶ç±»Commandçš„æˆå‘˜å‡½æ•°GetProjectsè·å¾—ç”±Manifestä»“åº“çš„default.xmlæ–‡ä»¶å®šä¹‰çš„æ‰€æœ‰AOSPå­é¡¹ç›®ä¿¡æ¯ï¼Œæˆ–è€…ç”±å‚æ•°argsæ‰€æŒ‡å®šçš„AOSPå­é¡¹ç›®çš„ä¿¡æ¯ã€‚è¿™äº›AOSPå­é¡¹ç›®ä¿¡æ¯éƒ½æ˜¯é€šè¿‡Projectå¯¹è±¡æ¥æè¿°ï¼Œå¹¶ä¸”ä¿å­˜åœ¨å˜é‡all_projectsä¸­ã€‚</p>
<p>ï¼ˆ5ï¼‰å¦‚æœåœ¨æ‰§è¡Œrepo syncå‘½ä»¤æ—¶ï¼Œæ²¡æœ‰æŒ‡å®šâ€“local-onlyé€‰é¡¹ï¼Œé‚£ä¹ˆå°±å¯¹ä¿å­˜åœ¨å˜é‡all_projectsä¸­çš„AOSPå­é¡¹ç›®è¿›è¡Œç½‘ç»œæ›´æ–°ï¼Œä¹Ÿå°±æ˜¯ä»è¿œç¨‹ä»“åº“ä¸­ä¸‹è½½æ›´æ–°åˆ°æœ¬åœ°ä»“åº“æ¥ï¼Œè¿™æ˜¯é€šè¿‡è°ƒç”¨Syncç±»çš„æˆå‘˜å‡½æ•°_Fetchæ¥å®Œæˆçš„ã€‚Syncç±»çš„æˆå‘˜å‡½æ•°_Fetchå®é™…ä¸Šåˆæ˜¯é€šè¿‡è°ƒç”¨Projectç±»çš„æˆå‘˜å‡½æ•°Sync_NetworkHalfæ¥å°†è¿œç¨‹ä»“åº“çš„æ›´æ–°ä¸‹è½½åˆ°æœ¬åœ°ä»“åº“æ¥çš„ã€‚</p>
<p>ï¼ˆ6ï¼‰ç”±äºAOSPå­é¡¹ç›®å¯èƒ½ä¼šåŒ…å«æœ‰å­æ¨¡å—ï¼Œå› æ­¤å½“å¯¹å®ƒä»¬è¿›è¡Œäº†è¿œç¨‹æ›´æ–°ä¹‹åï¼Œéœ€è¦æ£€æŸ¥å®ƒä»¬æ˜¯å¦åŒ…å«æœ‰å­æ¨¡å—ã€‚å¦‚æœåŒ…å«æœ‰å­æ¨¡å—ï¼Œå¹¶ä¸”æ‰§è¡Œrepo syncè„šæœ¬æ—¶æŒ‡å®šæœ‰â€“fetch-submodulesé€‰é¡¹ï¼Œé‚£ä¹ˆå°±éœ€è¦å¯¹AOSPå­é¡¹ç›®çš„å­æ¨¡å—è¿›è¡Œè¿œç¨‹æ›´æ–°ã€‚è°ƒç”¨Syncçš„çˆ¶ç±»Commandçš„æˆå‘˜å‡½æ•°GetProjectsçš„æ—¶å€™ï¼Œå¦‚æœå°†å‚æ•°submodules_okçš„å€¼è®¾ç½®ä¸ºtrueï¼Œé‚£ä¹ˆå¾—åˆ°çš„AOSPå­é¡¹ç›®åˆ—è¡¨å°±åŒ…å«æœ‰å­æ¨¡å—ã€‚å°†è¿™ä¸ªAOSPå­é¡¹ç›®åˆ—è¡¨ä¸ä¹‹å‰è·å¾—çš„AOSPå­é¡¹ç›®åˆ—è¡¨fetchedè¿›è¡Œä¸€ä¸ªæ¯”è¾ƒï¼Œå°±å¯ä»¥çŸ¥é“æœ‰å“ªäº›å­æ¨¡å—æ˜¯éœ€è¦æ›´æ–°çš„ã€‚éœ€è¦æ›´æ–°çš„å­æ¨¡å—éƒ½ä¿å­˜åœ¨å˜é‡missingä¸­ã€‚ç”±äºå­æ¨¡å—ä¹Ÿæ˜¯ç”¨Projectç±»æ¥æè¿°çš„ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åƒè¿œç¨‹æ›´æ–°AOSPå­é¡¹ç›®ä¸€æ ·ï¼Œè°ƒç”¨Syncç±»çš„æˆå‘˜å‡½æ•°_Fetchæ¥æ›´æ–°å®ƒä»¬çš„å­æ¨¡å—ã€‚</p>
<p>ï¼ˆ7ï¼‰è°ƒç”¨Syncç±»çš„æˆå‘˜å‡½æ•°UpdateProjectListæ›´æ–°<code>$(AOSP)/.repo</code>ç›®å½•ä¸‹çš„project.listæ–‡ä»¶ã€‚<code>$(AOSP)/.repo/project.list</code>è®°å½•çš„æ˜¯ä¸Šä¸€æ¬¡è¿œç¨‹åŒæ­¥åæ‰€æœ‰çš„AOSPå­é¡¹ç›®åç§°ã€‚ä»¥åæ¯ä¸€æ¬¡è¿œç¨‹åŒæ­¥ä¹‹åï¼ŒSyncç±»çš„æˆå‘˜å‡½æ•°UpdateProjectListå°±ä¼šé€šè¿‡è¯¥æ–‡ä»¶æ¥æ£€æŸ¥æ˜¯å¦å­˜åœ¨æŸäº›AOSPå­é¡¹ç›®è¢«åˆ æ‰äº†ã€‚å¦‚æœå­˜åœ¨è¿™æ ·çš„AOSPå­é¡¹ç›®ï¼Œå¹¶ä¸”è¿™äº›AOSPå­é¡¹ç›®æ²¡æœ‰å‘ç”Ÿä¿®æ”¹ï¼Œé‚£ä¹ˆå°±ä¼šå°†å®ƒä»¬çš„å·¥ä½œç›®å½•åˆ æ‰ã€‚</p>
<p>ï¼ˆ8ï¼‰åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒSyncç±»çš„æˆå‘˜å‡½æ•°å¯¹AOSPå­é¡¹ç›®æ‰€åšçš„æ“ä½œä»…ä»…æ˜¯ä¸‹è½½è¿œç¨‹ä»“åº“çš„æ›´æ–°åˆ°æœ¬åœ°æ¥ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰å°†è¿™äº›æ›´æ–°åˆå¹¶åˆ°æœ¬åœ°çš„å½“å‰åˆ†æ”¯æ¥ï¼Œå› æ­¤ï¼Œè¿™æ—¶å€™å°±éœ€è¦è°ƒç”¨Projectç±»çš„æˆå‘˜å‡½æ•°Sync_LocalHalfæ¥æ‰§è¡Œåˆå¹¶æ›´æ–°çš„æ“ä½œã€‚</p>
<p>ä»ä¸Šé¢çš„æ­¥éª¤å¯ä»¥çœ‹å‡ºï¼Œinit syncå‘½ä»¤çš„æ ¸å¿ƒæ“ä½œå°±æ˜¯æ”¶é›†æ¯ä¸€ä¸ªéœ€è¦åŒæ­¥çš„AOSPå­é¡¹ç›®æ‰€å¯¹åº”çš„Projectå¯¹è±¡ï¼Œç„¶åå†è°ƒç”¨è¿™äº›Projectå¯¹è±¡çš„æˆå‘˜å‡½æ•°Sync_NetwokHalftå’ŒSync_LocalHalfè¿›è¡ŒåŒæ­¥ã€‚å…³äºProjectç±»çš„æˆå‘˜å‡½æ•°Sync_NetwokHalftå’ŒSync_LocalHalfï¼Œæˆ‘ä»¬åœ¨å‰é¢åˆ†æManifestä»“åº“çš„å…‹éš†è¿‡ç¨‹æ—¶ï¼Œå·²ç»åˆ†æè¿‡äº†ï¼Œå®ƒä»¬æ— éå°±æ˜¯é€šè¿‡git fetchã€git rebaseæˆ–è€…git mergeç­‰åŸºæœ¬Gitå‘½ä»¤æ¥å®Œæˆè‡ªå·±çš„åŠŸèƒ½ã€‚</p>
<h3 id="2-5-åœ¨AOSPä¸Šåˆ›å»ºTopic"><a href="#2-5-åœ¨AOSPä¸Šåˆ›å»ºTopic" class="headerlink" title="2.5 åœ¨AOSPä¸Šåˆ›å»ºTopic"></a><font size=3>2.5 åœ¨AOSPä¸Šåˆ›å»ºTopic</font></h3><p>ä»¥ä¸Šæˆ‘ä»¬åˆ†æçš„å°±æ˜¯AOSPå­é¡¹ç›®ä»“åº“çš„å…‹éš†æˆ–è€…åŒæ­¥è¿‡ç¨‹ï¼Œä¸ºäº†æ›´è¿›ä¸€æ­¥åŠ æ·±å¯¹Repoä»“åº“çš„ç†è§£ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†å­¦ä¹ å¦å¤–ä¸€ä¸ªç”¨æ¥åœ¨AOSPä¸Šåˆ›å»ºTopicçš„å‘½ä»¤repo startã€‚</p>
<p>åœ¨Gitçš„ä¸–ç•Œé‡Œï¼Œåˆ†æ”¯ï¼ˆbranchï¼‰æ˜¯ä¸€ä¸ªå¾ˆæ ¸å¿ƒçš„æ¦‚å¿µã€‚Gité¼“åŠ±æˆ‘ä»¬åœ¨ä¿®å¤Bugæˆ–è€…å¼€å‘æ–°çš„Featureæ—¶ï¼Œéƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯ã€‚åˆ›å»ºGitåˆ†æ”¯çš„ä»£ä»·æ˜¯å¾ˆå°çš„ï¼Œè€Œä¸”é€Ÿåº¦å¾ˆå¿«ï¼Œå› æ­¤ï¼Œä¸ç”¨æ‹…å¿ƒåˆ›å»ºGitåˆ†æ”¯æ˜¯ä¸€ä»¶ä¸è®¨å¥½çš„äº‹æƒ…ï¼Œè€Œåº”è¯¥å°½å¯èƒ½å¤šåœ°ä½¿ç”¨åˆ†æ”¯ã€‚</p>
<p>åŒæ ·çš„ï¼Œæˆ‘ä»¬ä¸‹è½½å¥½AOSPä»£ç ä¹‹åï¼Œå¦‚æœéœ€è¦åœ¨ä¸Šé¢è¿›è¡Œä¿®æ”¹ï¼Œæˆ–è€…å¢åŠ æ–°çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆå°±è¦åœ¨æ–°çš„åˆ†æ”¯ä¸Šé¢è¿›è¡Œã€‚Repoä»“åº“æä¾›äº†ä¸€ä¸ªrepo startå‘½ä»¤ï¼Œç”¨æ¥åœ¨AOSPä¸Šåˆ›å»ºåˆ†æ”¯ï¼Œä¹Ÿç§°ä¸ºTopicã€‚è¿™ä¸ªå‘½ä»¤çš„ç”¨æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repo start BRANCH_NAME [PROJECT_LIST] </span><br></pre></td></tr></table></figure>

<p>å‚æ•°BRANCH_NAMEæŒ‡å®šæ–°çš„åˆ†æ”¯åç§°ï¼Œåé¢çš„PROJECT_LISTæ˜¯å¯é€‰çš„ã€‚å¦‚æœæŒ‡å®šäº†PROJECT_LISTï¼Œå°±è¡¨ç¤ºåªå¯¹ç‰¹å®šçš„AOSPå­é¡¹ç›®åˆ›å»ºåˆ†æ”¯ï¼Œå¦åˆ™çš„è¯ï¼Œå°±å¯¹æ‰€æœ‰çš„AOSPå­é¡¹ç›®åˆ›å»ºåˆ†æ”¯ã€‚</p>
<p>æ ¹æ®å‰é¢æˆ‘ä»¬å¯¹repo syncå‘½ä»¤çš„åˆ†æå¯ä»¥çŸ¥é“ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œrepo startå‘½ä»¤çš„æ—¶å€™ï¼Œæœ€ç»ˆå®šä¹‰åœ¨Repoä»“åº“çš„subcmds&#x2F;start.pyæ–‡ä»¶é‡Œé¢çš„Startç±»çš„æˆå‘˜å‡½æ•°Executeä¼šè¢«è°ƒç”¨ï¼Œå®ƒçš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Start</span>(<span class="title class_ inherited__">Command</span>): </span><br><span class="line"> <span class="comment">#...... </span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">Execute</span>(<span class="params">self, opt, args</span>): </span><br><span class="line">  <span class="comment">#...... </span></span><br><span class="line"> </span><br><span class="line">  nb = args[<span class="number">0</span>] </span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> git.check_ref_format(<span class="string">&#x27;heads/%s&#x27;</span> % nb): </span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;error: &#x27;%s&#x27; is not a valid name&quot;</span> % nb, file=sys.stderr) </span><br><span class="line">   sys.exit(<span class="number">1</span>) </span><br><span class="line"> </span><br><span class="line">  err = [] </span><br><span class="line">  projects = [] </span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> opt.<span class="built_in">all</span>: </span><br><span class="line">   projects = args[<span class="number">1</span>:] </span><br><span class="line">   <span class="keyword">if</span> <span class="built_in">len</span>(projects) &lt; <span class="number">1</span>: </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;error: at least one project must be specified&quot;</span>, file=sys.stderr) </span><br><span class="line">    sys.exit(<span class="number">1</span>) </span><br><span class="line"> </span><br><span class="line">  all_projects = self.GetProjects(projects) </span><br><span class="line"> </span><br><span class="line">  pm = Progress(<span class="string">&#x27;Starting %s&#x27;</span> % nb, <span class="built_in">len</span>(all_projects)) </span><br><span class="line">  <span class="keyword">for</span> project <span class="keyword">in</span> all_projects: </span><br><span class="line">   pm.update() </span><br><span class="line">   <span class="comment">#...... </span></span><br><span class="line">   <span class="keyword">if</span> <span class="keyword">not</span> project.StartBranch(nb): </span><br><span class="line">    err.append(project) </span><br><span class="line">  pm.end() </span><br><span class="line"> </span><br><span class="line">  <span class="comment">#...... </span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å‚æ•°args[0]ä¿å­˜çš„æ˜¯è¦åˆ›å»ºçš„åˆ†æ”¯çš„åç§°ï¼Œå‚æ•°args[1:]ä¿å­˜çš„æ˜¯è¦åˆ›å»ºåˆ†æ”¯çš„AOSPå­é¡¹ç›®åç§°åˆ—è¡¨ï¼ŒStartç±»çš„æˆå‘˜å‡½æ•°Executeåˆ†åˆ«å°†å®ƒä»¬ä¿å­˜å˜é‡nbå’Œprojectsä¸­ã€‚</p>
<p>Startç±»çš„æˆå‘˜å‡½æ•°Executeæ¥ä¸‹æ¥è°ƒç”¨çˆ¶ç±»Commandçš„æˆå‘˜å‡½æ•°GetProjectsï¼Œå¹¶ä¸”ä»¥å˜é‡projectsä¸ºå‚æ•°ï¼Œå°±å¯ä»¥è·å¾—æ‰€æœ‰éœ€è¦åˆ›å»ºæ–°åˆ†æ”¯nbçš„AOSPå­é¡¹ç›®åˆ—è¡¨all_projectsã€‚åœ¨all_projectsä¸­ï¼Œæ¯ä¸€ä¸ªAOSPå­é¡¹ç›®éƒ½ç”¨ä¸€ä¸ªProjectå¯¹è±¡æ¥æè¿°ã€‚</p>
<p>æœ€åï¼ŒStartç±»çš„æˆå‘˜å‡½æ•°Executeå°±éå†all_projectsé‡Œé¢çš„æ¯ä¸€ä¸ªProjectå¯¹è±¡ï¼Œå¹¶ä¸”è°ƒç”¨å®ƒä»¬çš„æˆå‘˜å‡½æ•°StartBranchæ¥æ‰§è¡Œåˆ›å»ºæ–°åˆ†æ”¯çš„æ“ä½œã€‚</p>
<p>Projectç±»çš„æˆå‘˜å‡½æ•°StartBranchçš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Project</span>(<span class="title class_ inherited__">object</span>): </span><br><span class="line"> ...... </span><br><span class="line"> </span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">StartBranch</span>(<span class="params">self, name</span>): </span><br><span class="line">  <span class="string">&quot;&quot;&quot;Create a new branch off the manifest&#x27;s revision. </span></span><br><span class="line"><span class="string">  &quot;&quot;&quot;</span> </span><br><span class="line">  head = self.work_git.GetHead() </span><br><span class="line">  <span class="keyword">if</span> head == (R_HEADS + name): </span><br><span class="line">   <span class="keyword">return</span> <span class="literal">True</span> </span><br><span class="line"> </span><br><span class="line">  all_refs = self.bare_ref.<span class="built_in">all</span> </span><br><span class="line">  <span class="keyword">if</span> (R_HEADS + name) <span class="keyword">in</span> all_refs: </span><br><span class="line">   <span class="keyword">return</span> GitCommand(self, </span><br><span class="line">            [<span class="string">&#x27;checkout&#x27;</span>, name, <span class="string">&#x27;--&#x27;</span>], </span><br><span class="line">            capture_stdout = <span class="literal">True</span>, </span><br><span class="line">            capture_stderr = <span class="literal">True</span>).Wait() == <span class="number">0</span> </span><br><span class="line"> </span><br><span class="line">  branch = self.GetBranch(name) </span><br><span class="line">  branch.remote = self.GetRemote(self.remote.name) </span><br><span class="line">  branch.merge = self.revisionExpr </span><br><span class="line">  revid = self.GetRevisionId(all_refs) </span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> head.startswith(R_HEADS): </span><br><span class="line">   <span class="keyword">try</span>: </span><br><span class="line">    head = all_refs[head] </span><br><span class="line">   <span class="keyword">except</span> KeyError: </span><br><span class="line">    head = <span class="literal">None</span> </span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> revid <span class="keyword">and</span> head <span class="keyword">and</span> revid == head: </span><br><span class="line">   ref = os.path.join(self.gitdir, R_HEADS + name) </span><br><span class="line">   <span class="keyword">try</span>: </span><br><span class="line">    os.makedirs(os.path.dirname(ref)) </span><br><span class="line">   <span class="keyword">except</span> OSError: </span><br><span class="line">    <span class="keyword">pass</span> </span><br><span class="line">   _lwrite(ref, <span class="string">&#x27;%s\n&#x27;</span> % revid) </span><br><span class="line">   _lwrite(os.path.join(self.worktree, <span class="string">&#x27;.git&#x27;</span>, HEAD), </span><br><span class="line">       <span class="string">&#x27;ref: %s%s\n&#x27;</span> % (R_HEADS, name)) </span><br><span class="line">   branch.Save() </span><br><span class="line">   <span class="keyword">return</span> <span class="literal">True</span> </span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> GitCommand(self, </span><br><span class="line">         [<span class="string">&#x27;checkout&#x27;</span>, <span class="string">&#x27;-b&#x27;</span>, branch.name, revid], </span><br><span class="line">         capture_stdout = <span class="literal">True</span>, </span><br><span class="line">         capture_stderr = <span class="literal">True</span>).Wait() == <span class="number">0</span>: </span><br><span class="line">   branch.Save() </span><br><span class="line">   <span class="keyword">return</span> <span class="literal">True</span> </span><br><span class="line">  <span class="keyword">return</span> <span class="literal">False</span> </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Projectç±»çš„æˆå‘˜å‡½æ•°StartBranchçš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>ï¼ˆ1ï¼‰è·å¾—é¡¹ç›®çš„å½“å‰åˆ†æ”¯headï¼Œè¿™æ˜¯é€šè¿‡è°ƒç”¨Projectç±»çš„æˆå‘˜å‡½æ•°GetHeadæ¥å®ç°çš„ã€‚</p>
<p>ï¼ˆ2ï¼‰é¡¹ç›®å½“å‰çš„æ‰€æœ‰åˆ†æ”¯ä¿å­˜åœ¨Projectç±»çš„æˆå‘˜å˜é‡bare_refæ‰€æè¿°çš„ä¸€ä¸ªGitRefså¯¹è±¡çš„æˆå‘˜å˜é‡allä¸­ã€‚å¦‚æœè¦åˆ›å»ºçš„åˆ†æ”¯nameå·²ç»é¡¹ç›®çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œé‚£ä¹ˆå°±ç›´æ¥é€šè¿‡GitCommandç±»è°ƒç”¨git checkoutå‘½ä»¤æ¥å°†è¯¥åˆ†æ”¯æ£€å‡ºå³å¯ï¼Œè€Œä¸ç”¨åˆ›å»ºæ–°çš„åˆ†æ”¯ã€‚å¦åˆ™ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚</p>
<p>ï¼ˆ3ï¼‰åˆ›å»ºä¸€ä¸ªBranchå¯¹è±¡æ¥æè¿°å³å°†è¦åˆ›å»ºçš„åˆ†æ”¯ã€‚Branchç±»çš„æˆå‘˜å˜é‡remoteæè¿°çš„åˆ†æ”¯æ‰€è¦è¿½è¸ªçš„è¿œç¨‹ä»“åº“ï¼Œå¦å¤–ä¸€ä¸ªæˆå‘˜å˜é‡mergeæè¿°çš„æ˜¯åˆ†æ”¯è¦è¿½è¸ªçš„è¿œç¨‹ä»“åº“çš„åˆ†æ”¯ã€‚è¿™ä¸ªè¦è¿½è¸ªçš„è¿œç¨‹ä»“åº“åˆ†æ”¯ç”±Manifestä»“åº“çš„default.xmlæ–‡ä»¶æè¿°ï¼Œå¹¶ä¸”ä¿å­˜åœ¨Projectç±»çš„æˆå‘˜å˜é‡revisionExprä¸­ã€‚</p>
<p>ï¼ˆ4ï¼‰è°ƒç”¨Projectç±»çš„æˆå‘˜å‡½æ•°GetRevisionIdè·å¾—é¡¹ç›®è¦è¿½è¸ªçš„è¿œç¨‹ä»“åº“åˆ†æ”¯çš„sha1å€¼ï¼Œå¹¶ä¸”ä¿å­˜åœ¨å˜é‡revidä¸­ã€‚</p>
<p>ï¼ˆ5ï¼‰ç”±äºæ–°åˆ›å»ºçš„åˆ†æ”¯nameéœ€è¦è¿½è¸ªçš„è¿œç¨‹ä»“åº“åˆ†æ”¯ä¸ºrevidï¼Œå› æ­¤å¦‚æœé¡¹ç›®çš„å½“å‰åˆ†æ”¯headåˆšå¥½å°±æ˜¯é¡¹ç›®è¦è¿½è¸ªçš„è¿œç¨‹ä»“åº“åˆ†æ”¯revidï¼Œé‚£ä¹ˆåˆ›å»ºæ–°åˆ†æ”¯nameå°±å˜å¾—å¾ˆç®€å•ï¼Œåªè¦åœ¨é¡¹ç›®çš„Gitç›®å½•ï¼ˆä½äº.repo&#x2F;projectsç›®å½•ä¸‹ï¼‰ä¸‹çš„refs&#x2F;headså­ç›®å½•ä»¥nameåç§°åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”å¾€è¿™ä¸ªæ–‡ä»¶å†™å…¥å†™å…¥revidçš„å€¼ï¼Œä»¥è¡¨æ˜æ–°åˆ†æ”¯nameæ˜¯åœ¨è¦è¿½è¸ªçš„è¿œç¨‹åˆ†æ”¯revidçš„åŸºç¡€ä¸Šåˆ›å»ºçš„ã€‚è¿™æ ·çš„ä¸€ä¸ªç®€å•çš„Gitåˆ†æ”¯å°±åˆ›å»ºå®Œæˆäº†ã€‚ä¸è¿‡æˆ‘ä»¬è¿˜è¦ä¿®æ”¹é¡¹ç›®å·¥ä½œç›®å½•ä¸‹çš„.git&#x2F;HEADæ–‡ä»¶ï¼Œå°†å®ƒçš„å†…å®¹å†™ä¸ºåˆšæ‰åˆ›å»ºçš„æ–‡ä»¶çš„è·¯å¾„åç§°ï¼Œè¿™æ ·æ‰èƒ½å°†é¡¹ç›®çš„å½“å‰åˆ†æ”¯åˆ‡æ¢ä¸ºåˆšæ‰æ–°åˆ›å»ºçš„åˆ†æ”¯ã€‚ä»è¿™ä¸ªè¿‡ç¨‹å°±å¯ä»¥çœ‹å‡ºï¼Œåˆ›å»ºçš„ä¸€ä¸ªGitåˆ†æ”¯ï¼Œä¸è¿‡å°±æ˜¯åˆ›å»ºä¸€ä¸ªåŒ…å«ä¸€ä¸ªsha1å€¼çš„æ–‡ä»¶ï¼Œå› æ­¤ä»£ä»·æ˜¯éå¸¸å°çš„ã€‚å¦‚æœé¡¹ç›®çš„å½“å‰åˆ†æ”¯headåˆšå¥½ä¸æ˜¯é¡¹ç›®è¦è¿½è¸ªçš„è¿œç¨‹ä»“åº“åˆ†æ”¯revidï¼Œé‚£ä¹ˆå°±ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚</p>
<p>ï¼ˆ6ï¼‰æ‰§è¡Œåˆ°è¿™é‡Œçš„æ—¶å€™ï¼Œå°±è¡¨æ˜æˆ‘ä»¬è¦åˆ›å»ºçš„åˆ†æ”¯ä¸å­˜åœ¨ï¼Œå¹¶ä¸”æˆ‘ä»¬éœ€è¦åœ¨ä¸€ä¸ªä¸æ˜¯å½“å‰åˆ†æ”¯çš„åˆ†æ”¯çš„åŸºç¡€ä¸Šåˆ›å»ºè¯¥æ–°åˆ†æ”¯ï¼Œè¿™æ—¶å€™å°±éœ€è¦é€šè¿‡è°ƒç”¨å¸¦-bé€‰é¡¹çš„git checkoutå‘½ä»¤æ¥å®Œæˆåˆ›å»ºæ–°åˆ†æ”¯çš„æ“ä½œäº†ã€‚é€‰é¡¹-båé¢çš„å‚æ•°å°±è¡¨æ˜è¦åœ¨å“ªä¸€ä¸ªåˆ†æ”¯çš„åŸºç¡€ä¸Šåˆ›å»ºåˆ†æ”¯ã€‚æ–°çš„åˆ†æ”¯åˆ›å»ºå‡ºæ¥ä¹‹åï¼Œè¿˜éœ€è¦å°†å®ƒçš„æ–‡ä»¶æ‹·è´åˆ°é¡¹ç›®çš„å·¥ä½œç›®å½•å»ã€‚</p>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å°±åˆ†æå®Œåœ¨AOSPä¸Šåˆ›å»ºæ–°åˆ†æ”¯çš„è¿‡ç¨‹äº†ï¼Œä¹Ÿå°±æ˜¯repo startå‘½ä»¤çš„æ‰§è¡Œè¿‡ç¨‹ã€‚æ›´å¤šçš„repoå‘½ä»¤ï¼Œä¾‹å¦‚repo upladã€repo diffå’Œrepo statusç­‰ï¼Œå¯ä»¥ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£<a target="_blank" rel="noopener" href="http://source.android.com/source/using-repo.html">http://source.android.com/source/using-repo.html</a>ï¼Œå®ƒä»¬çš„æ‰§è¡Œè¿‡ç¨‹å’Œæˆ‘ä»¬å‰é¢åˆ†ærepo syncã€repo startéƒ½æ˜¯ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯å®ƒä»¬æ‰§è¡Œå…¶å®ƒçš„Gitå‘½ä»¤ã€‚</p>
<h1 id="äºŒã€-repoç›¸å…³ç›®å½•"><a href="#äºŒã€-repoç›¸å…³ç›®å½•" class="headerlink" title="äºŒã€.repoç›¸å…³ç›®å½•"></a><font size=3>äºŒã€<code>.repo</code>ç›¸å…³ç›®å½•</font></h1><p>å‰é¢æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨åˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›®æ—¶ï¼Œå°±ä¼šä»è¿œç¨‹æŠŠmanifestså’Œrepoè¿™ä¸¤ä¸ªgitåº“æ‹·è´åˆ°æœ¬åœ°ï¼Œä¸Šé¢ä¸‹è½½å®Œæ¯•åï¼Œä¼šå‘ç°å‡ºç°äº†è¿™ä¸¤ä¸ªä»“åº“ï¼š</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/02%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/03%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/LV03-repo-02-repo%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/img/image-20240926233044031.png" alt="image-20240926233044031" style="zoom:50%;" />

<p>å¯ä»¥çœ‹åˆ°è¿™ä¸¤ä¸ªä»“åº“éƒ½æ˜¯gitç‰ˆæœ¬åº“ã€‚</p>
<h2 id="1-é¡¹ç›®æ¸…å•åº“-repo-manifests"><a href="#1-é¡¹ç›®æ¸…å•åº“-repo-manifests" class="headerlink" title="1. é¡¹ç›®æ¸…å•åº“(.repo&#x2F;manifests)"></a><font size=3>1. é¡¹ç›®æ¸…å•åº“(.repo&#x2F;manifests)</font></h2><p>AOSPé¡¹ç›®æ¸…å•gitåº“ä¸‹ï¼Œåªæœ‰ä¸€ä¸ªæ–‡ä»¶default.xmlï¼Œæ˜¯ä¸€ä¸ªæ ‡å‡†çš„XMLï¼Œæè¿°äº†å½“å‰repoç®¡ç†çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">remote</span>  <span class="attr">name</span>=<span class="string">&quot;aosp&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">fetch</span>=<span class="string">&quot;..&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">review</span>=<span class="string">&quot;https://android-review.googlesource.com/&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">default</span> <span class="attr">revision</span>=<span class="string">&quot;main&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">remote</span>=<span class="string">&quot;aosp&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">sync-j</span>=<span class="string">&quot;4&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">manifest-server</span> <span class="attr">url</span>=<span class="string">&quot;http://android-smartsync.corp.google.com/android.googlesource.com/manifestserver&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">superproject</span> <span class="attr">name</span>=<span class="string">&quot;platform/superproject/main&quot;</span> <span class="attr">remote</span>=<span class="string">&quot;aosp&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">contactinfo</span> <span class="attr">bugurl</span>=<span class="string">&quot;go/repo-bug&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">project</span> <span class="attr">path</span>=<span class="string">&quot;build/make&quot;</span> <span class="attr">name</span>=<span class="string">&quot;platform/build&quot;</span> <span class="attr">groups</span>=<span class="string">&quot;pdk&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">linkfile</span> <span class="attr">src</span>=<span class="string">&quot;CleanSpec.mk&quot;</span> <span class="attr">dest</span>=<span class="string">&quot;build/CleanSpec.mk&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">linkfile</span> <span class="attr">src</span>=<span class="string">&quot;buildspec.mk.default&quot;</span> <span class="attr">dest</span>=<span class="string">&quot;build/buildspec.mk.default&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">linkfile</span> <span class="attr">src</span>=<span class="string">&quot;core&quot;</span> <span class="attr">dest</span>=<span class="string">&quot;build/core&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">linkfile</span> <span class="attr">src</span>=<span class="string">&quot;envsetup.sh&quot;</span> <span class="attr">dest</span>=<span class="string">&quot;build/envsetup.sh&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">linkfile</span> <span class="attr">src</span>=<span class="string">&quot;target&quot;</span> <span class="attr">dest</span>=<span class="string">&quot;build/target&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">linkfile</span> <span class="attr">src</span>=<span class="string">&quot;tools&quot;</span> <span class="attr">dest</span>=<span class="string">&quot;build/tools&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">project</span> <span class="attr">path</span>=<span class="string">&quot;build/bazel&quot;</span> <span class="attr">name</span>=<span class="string">&quot;platform/build/bazel&quot;</span> <span class="attr">groups</span>=<span class="string">&quot;pdk&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">linkfile</span> <span class="attr">src</span>=<span class="string">&quot;bazel.WORKSPACE&quot;</span> <span class="attr">dest</span>=<span class="string">&quot;WORKSPACE&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">linkfile</span> <span class="attr">src</span>=<span class="string">&quot;bazel.BUILD&quot;</span> <span class="attr">dest</span>=<span class="string">&quot;BUILD&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">project</span> <span class="attr">path</span>=<span class="string">&quot;build/bazel_common_rules&quot;</span> <span class="attr">name</span>=<span class="string">&quot;platform/build/bazel_common_rules&quot;</span> <span class="attr">groups</span>=<span class="string">&quot;pdk&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">project</span> <span class="attr">path</span>=<span class="string">&quot;build/blueprint&quot;</span> <span class="attr">name</span>=<span class="string">&quot;platform/build/blueprint&quot;</span> <span class="attr">groups</span>=<span class="string">&quot;pdk,tradefed&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">project</span> <span class="attr">path</span>=<span class="string">&quot;build/pesto&quot;</span> <span class="attr">name</span>=<span class="string">&quot;platform/build/pesto&quot;</span> <span class="attr">groups</span>=<span class="string">&quot;pdk&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">project</span> <span class="attr">path</span>=<span class="string">&quot;build/release&quot;</span> <span class="attr">name</span>=<span class="string">&quot;platform/build/release&quot;</span> <span class="attr">groups</span>=<span class="string">&quot;pdk,tradefed&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">project</span> <span class="attr">path</span>=<span class="string">&quot;build/soong&quot;</span> <span class="attr">name</span>=<span class="string">&quot;platform/build/soong&quot;</span> <span class="attr">groups</span>=<span class="string">&quot;pdk,tradefed&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">linkfile</span> <span class="attr">src</span>=<span class="string">&quot;root.bp&quot;</span> <span class="attr">dest</span>=<span class="string">&quot;Android.bp&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">linkfile</span> <span class="attr">src</span>=<span class="string">&quot;bootstrap.bash&quot;</span> <span class="attr">dest</span>=<span class="string">&quot;bootstrap.bash&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">project</span> <span class="attr">path</span>=<span class="string">&quot;art&quot;</span> <span class="attr">name</span>=<span class="string">&quot;platform/art&quot;</span> <span class="attr">groups</span>=<span class="string">&quot;pdk&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">project</span> <span class="attr">path</span>=<span class="string">&quot;bionic&quot;</span> <span class="attr">name</span>=<span class="string">&quot;platform/bionic&quot;</span> <span class="attr">groups</span>=<span class="string">&quot;pdk&quot;</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- ...... --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">project</span> <span class="attr">path</span>=<span class="string">&quot;external/OpenCL-Headers&quot;</span> <span class="attr">name</span>=<span class="string">&quot;platform/external/OpenCL-Headers&quot;</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- ...... --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">project</span> <span class="attr">path</span>=<span class="string">&quot;trusty/vendor/google/aosp&quot;</span> <span class="attr">name</span>=<span class="string">&quot;trusty/vendor/google/aosp&quot;</span> <span class="attr">groups</span>=<span class="string">&quot;trusty&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">copyfile</span> <span class="attr">src</span>=<span class="string">&quot;lk_inc.mk&quot;</span> <span class="attr">dest</span>=<span class="string">&quot;lk_inc.mk&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- END open-source projects --&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">repo-hooks</span> <span class="attr">in-project</span>=<span class="string">&quot;platform/tools/repohooks&quot;</span> <span class="attr">enabled-list</span>=<span class="string">&quot;pre-upload&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    Merge marker to make it easier for git to merge AOSP-only manifest</span></span><br><span class="line"><span class="comment">    changes to a custom manifest.  Please keep this marker here and</span></span><br><span class="line"><span class="comment">    refrain from making changes on or below it.</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œé¢æœ‰ä¸Šç™¾è¡Œï¼Œè¿™é‡Œä¸­é—´æœ‰ä¸€å¤§éƒ¨åˆ†çœç•¥æ‰äº†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€éƒ¨åˆ†éƒ¨åˆ†äº†è§£ã€‚</p>
<ul>
<li>remoteæ ‡ç­¾</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">remote</span>  <span class="attr">name</span>=<span class="string">&quot;aosp&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">fetch</span>=<span class="string">&quot;..&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">review</span>=<span class="string">&quot;https://android-review.googlesource.com/&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>æè¿°äº†è¿œç¨‹ä»“åº“çš„åŸºæœ¬ä¿¡æ¯ã€‚nameæè¿°çš„æ˜¯ä¸€ä¸ªè¿œç¨‹ä»“åº“çš„åç§°ï¼Œé€šå¸¸æˆ‘ä»¬çœ‹åˆ°çš„å‘½åæ˜¯originã€‚fetchç”¨ä½œé¡¹ç›®åç§°çš„å‰ç¼˜ï¼Œåœ¨æ„é€ é¡¹ç›®ä»“åº“è¿œç¨‹åœ°å€æ—¶ä½¿ç”¨åˆ°ã€‚reviewæè¿°çš„æ˜¯ç”¨ä½œcode reviewçš„serveråœ°å€ã€‚</p>
<ul>
<li>defaultæ ‡ç­¾</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">default</span> <span class="attr">revision</span>=<span class="string">&quot;main&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">remote</span>=<span class="string">&quot;aosp&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">sync-j</span>=<span class="string">&quot;4&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>defaultæ ‡ç­¾çš„å®šä¹‰çš„å±æ€§ï¼Œå°†ä½œä¸ºæ ‡ç­¾çš„é»˜è®¤å±æ€§ï¼Œåœ¨æ ‡ç­¾ä¸­ï¼Œä¹Ÿå¯ä»¥é‡å†™è¿™äº›å±æ€§ã€‚å±æ€§revisionè¡¨ç¤ºå½“å‰çš„ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¿—ç§°çš„åˆ†æ”¯ã€‚å±æ€§remoteæè¿°çš„æ˜¯é»˜è®¤ä½¿ç”¨çš„è¿œç¨‹ä»“åº“åç§°ï¼Œå³æ ‡ç­¾ä¸­nameçš„å±æ€§å€¼ã€‚å±æ€§sync-jè¡¨ç¤ºåœ¨åŒæ­¥è¿œç¨‹ä»£ç æ—¶ï¼Œå¹¶å‘çš„ä»»åŠ¡æ•°é‡ï¼Œé…ç½®é«˜çš„æœºå™¨å¯ä»¥å°†è¿™ä¸ªå€¼è°ƒå¤§.</p>
<ul>
<li>projectæ ‡ç­¾</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">path</span>=<span class="string">&quot;build/make&quot;</span> <span class="attr">name</span>=<span class="string">&quot;platform/build&quot;</span> <span class="attr">groups</span>=<span class="string">&quot;pdk&quot;</span> &gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">linkfile</span> <span class="attr">src</span>=<span class="string">&quot;CleanSpec.mk&quot;</span> <span class="attr">dest</span>=<span class="string">&quot;build/CleanSpec.mk&quot;</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">linkfile</span> <span class="attr">src</span>=<span class="string">&quot;buildspec.mk.default&quot;</span> <span class="attr">dest</span>=<span class="string">&quot;build/buildspec.mk.default&quot;</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">linkfile</span> <span class="attr">src</span>=<span class="string">&quot;core&quot;</span> <span class="attr">dest</span>=<span class="string">&quot;build/core&quot;</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">linkfile</span> <span class="attr">src</span>=<span class="string">&quot;envsetup.sh&quot;</span> <span class="attr">dest</span>=<span class="string">&quot;build/envsetup.sh&quot;</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">linkfile</span> <span class="attr">src</span>=<span class="string">&quot;target&quot;</span> <span class="attr">dest</span>=<span class="string">&quot;build/target&quot;</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">linkfile</span> <span class="attr">src</span>=<span class="string">&quot;tools&quot;</span> <span class="attr">dest</span>=<span class="string">&quot;build/tools&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¯ä¸€ä¸ªrepoç®¡ç†çš„gitåº“ï¼Œå°±æ˜¯å¯¹åº”åˆ°ä¸€ä¸ª&lt;project&gt;æ ‡ç­¾ï¼Œpathæè¿°çš„æ˜¯é¡¹ç›®ç›¸å¯¹äºè¿œç¨‹ä»“åº“URLçš„è·¯å¾„ï¼ŒåŒæ—¶å°†ä½œä¸ºå¯¹åº”çš„gitåº“åœ¨æœ¬åœ°ä»£ç çš„è·¯å¾„; nameç”¨äºå®šä¹‰é¡¹ç›®åç§°ï¼Œå‘½åæ–¹å¼é‡‡ç”¨çš„æ˜¯æ•´ä¸ªé¡¹ç›®URLçš„ç›¸å¯¹åœ°å€ã€‚ å¦‚ï¼ŒAOSPé¡¹ç›®çš„URLä¸º<code>https://android.googlesource.com/</code>ï¼Œå‘½åä¸ºplatform&#x2F;buildçš„gitåº“ï¼Œè®¿é—®çš„URLå°±æ˜¯<code>https://android.googlesource.com/platform/build</code></p>
<p>å¦‚æœéœ€è¦æ–°å¢æˆ–æ›¿æ¢ä¸€äº›gitåº“ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹default.xmlæ¥å®ç°ï¼Œrepoä¼šæ ¹æ®é…ç½®ä¿¡æ¯ï¼Œè‡ªåŠ¨åŒ–ç®¡ç†ã€‚ä½†ç›´æ¥å¯¹default.xmlçš„å®šåˆ¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸‹ä¸€æ¬¡æ›´æ–°é¡¹ç›®æ¸…å•æ—¶ï¼Œä¸è¿œç¨‹default.xmlå‘ç”Ÿå†²çªã€‚ å› æ­¤ï¼Œrepoæä¾›äº†ä¸€ä¸ªç§æ›´ä¸ºçµæ´»çš„å®šåˆ¶æ–¹å¼â€”â€”<code>local_manifests</code> ã€‚æ‰€æœ‰çš„å®šåˆ¶æ˜¯éµå¾ªdefault.xmlè§„èŒƒçš„ï¼Œæ–‡ä»¶åå¯ä»¥è‡ªå®šä¹‰ï¼Œå¦‚local_manifest.xml, another_local_manifest.xmlç­‰ï¼Œ å°†å®šåˆ¶çš„XMLæ”¾åœ¨æ–°å»ºçš„.repo&#x2F;local_manifestså­ç›®å½•å³å¯ã€‚repoä¼šéå†.repo&#x2F;local_manifestsç›®å½•ä¸‹çš„æ‰€æœ‰*.xmlæ–‡ä»¶ï¼Œæœ€ç»ˆä¸default.xmlåˆå¹¶æˆä¸€ä¸ªæ€»çš„é¡¹ç›®æ¸…å•æ–‡ä»¶manifest.xmlã€‚</p>
<p>local_manifestsçš„ä¿®æ”¹ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ ls .repo/local_manifests</span><br><span class="line">local_manifest.xml</span><br><span class="line">another_local_manifest.xml</span><br><span class="line"></span><br><span class="line">$ cat .repo/local_manifests/local_manifest.xml</span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project</span> <span class="attr">path</span>=<span class="string">&quot;manifest&quot;</span> <span class="attr">name</span>=<span class="string">&quot;tools/manifest&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project</span> <span class="attr">path</span>=<span class="string">&quot;platform-manifest&quot;</span> <span class="attr">name</span>=<span class="string">&quot;platform/manifest&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-repoè„šæœ¬åº“-repo-repo"><a href="#2-repoè„šæœ¬åº“-repo-repo" class="headerlink" title="2. repoè„šæœ¬åº“(.repo&#x2F;repo)"></a><font size=3>2. repoè„šæœ¬åº“(.repo&#x2F;repo)</font></h2><p>repoå¯¹gitå‘½ä»¤è¿›è¡Œäº†å°è£…ï¼Œæä¾›äº†ä¸€å¥—repoçš„å‘½ä»¤é›†(åŒ…æ‹¬init, syncç­‰)ï¼Œæ‰€æœ‰repoç®¡ç†çš„è‡ªåŠ¨åŒ–å®ç°ä¹Ÿéƒ½åŒ…å«åœ¨è¿™ä¸ªgitåº“ä¸­ã€‚ åœ¨ç¬¬ä¸€æ¬¡åˆå§‹åŒ–çš„æ—¶å€™ï¼Œrepoä¼šä»è¿œç¨‹æŠŠè¿™ä¸ªgitåº“ä¸‹è½½åˆ°æœ¬åœ°ã€‚</p>
<h2 id="3-ä»“åº“ç›®å½•å’Œå·¥ä½œç›®å½•"><a href="#3-ä»“åº“ç›®å½•å’Œå·¥ä½œç›®å½•" class="headerlink" title="3.Â ä»“åº“ç›®å½•å’Œå·¥ä½œç›®å½•"></a><font size=3>3.Â ä»“åº“ç›®å½•å’Œå·¥ä½œç›®å½•</font></h2><p>ä»“åº“ç›®å½•ä¿å­˜çš„æ˜¯å†å²ä¿¡æ¯å’Œä¿®æ”¹è®°å½•ï¼Œå·¥ä½œç›®å½•ä¿å­˜çš„æ˜¯å½“å‰ç‰ˆæœ¬çš„ä¿¡æ¯ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªé¡¹ç›®çš„Gitä»“åº“ç›®å½•ï¼ˆé»˜è®¤ä¸º.gitç›®å½•ï¼‰æ˜¯ä½äºå·¥ä½œç›®å½•ä¸‹é¢çš„ï¼Œä½†æ˜¯Gitæ”¯æŒå°†ä¸€ä¸ªé¡¹ç›®çš„Gitä»“åº“ç›®å½•å’Œå·¥ä½œç›®å½•åˆ†å¼€æ¥å­˜æ”¾ã€‚ å¯¹äºrepoç®¡ç†è€Œè¨€ï¼Œæ—¢æœ‰åˆ†å¼€å­˜æ”¾ï¼Œä¹Ÿæœ‰ä½äºå·¥ä½œç›®å½•å­˜æ”¾çš„:</p>
<ul>
<li>manifestsï¼š ä»“åº“ç›®å½•æœ‰ä¸¤ä»½æ‹·è´ï¼Œä¸€ä»½ä½äºå·¥ä½œç›®å½•(.repo&#x2F;manifests)çš„.gitç›®å½•ä¸‹ï¼Œå¦ä¸€ä»½ç‹¬ç«‹å­˜æ”¾äº.repo&#x2F;manifests.git</li>
<li>repoï¼šä»“åº“ç›®å½•ä½äºå·¥ä½œç›®å½•(.repo&#x2F;repo)çš„.gitç›®å½•ä¸‹</li>
<li>projectï¼šæ‰€æœ‰è¢«ç®¡ç†gitåº“çš„ä»“åº“ç›®å½•éƒ½æ˜¯åˆ†å¼€å­˜æ”¾çš„ï¼Œä½äº.repo&#x2F;projectsç›®å½•ä¸‹ã€‚åŒæ—¶ï¼Œä¹Ÿä¼šä¿ç•™å·¥ä½œç›®å½•çš„.gitï¼Œä½†é‡Œé¢æ‰€æœ‰çš„æ–‡ä»¶éƒ½æ˜¯åˆ°.repoçš„é“¾æ¥ã€‚è¿™æ ·ï¼Œå³åšåˆ°äº†åˆ†å¼€å­˜æ”¾ï¼Œä¹Ÿå…¼å®¹äº†åœ¨å·¥ä½œç›®å½•ä¸‹çš„æ‰€æœ‰gitå‘½ä»¤ã€‚</li>
</ul>
<p><strong>æ—¢ç„¶.repoç›®å½•ä¸‹ä¿å­˜äº†é¡¹ç›®çš„æ‰€æœ‰ä¿¡æ¯ï¼Œæ‰€æœ‰è¦æ‹·è´ä¸€ä¸ªé¡¹ç›®æ—¶ï¼Œåªæ˜¯éœ€è¦æ‹·è´è¿™ä¸ªç›®å½•å°±å¯ä»¥äº†ã€‚repoæ”¯æŒä»æœ¬åœ°å·²æœ‰çš„.repoä¸­æ¢å¤åŸæœ‰çš„é¡¹ç›®ã€‚</strong></p>
<blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42107504/article/details/140709590">repo å·¥å…·å®‰è£…å’Œä½¿ç”¨æ•™ç¨‹ï¼ˆwindows+gitee)_repoå®‰è£…-CSDNåšå®¢</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_64124795/article/details/131599506">Repoå·¥ä½œåŸç†åŠå¸¸ç”¨å‘½ä»¤æ€»ç»“â€”â€”2023.07-CSDNåšå®¢</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jb51.net/article/131935.htm">Androidæºä»£ç ä»“åº“åŠå…¶ç®¡ç†å·¥å…·Repoåˆ†æè¯¦è§£_Android_è„šæœ¬ä¹‹å®¶ (jb51.net)</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jb51.net/article/232003.htm">Repoå·¥ä½œåŸç†å’Œä½¿ç”¨ä»‹ç»_Android_è„šæœ¬ä¹‹å®¶ (jb51.net)</a></p>
</blockquote>

    </div>

    
    
    

    <footer class="post-footer">




    <div>
        
            <div style="text-align:center;color: #ccc;font-size:14px;">
            ----------æœ¬æ–‡ç»“æŸ
            <i class="fas fa-fan fa-spin" style="color: #FF1493; font-size: 1rem"></i>
            æ„Ÿè°¢æ‚¨çš„é˜…è¯»----------
            </div>
        
    </div>





  
  <div class="my_post_copyright"> 
    <p><span>æ–‡ç« æ ‡é¢˜:</span><a href="/post/d94f8cde.html">LV03-repo-02-repoåŸºæœ¬åŸç†</a></p>
    <p><span>æ–‡ç« ä½œè€…:</span><a href="/" title="æ¬¢è¿è®¿é—® ã€Šè‹æœ¨ã€‹ çš„å­¦ä¹ ç¬”è®°">è‹æœ¨</a></p>
    <p><span>å‘å¸ƒæ—¶é—´:</span>2024å¹´10æœˆ26æ—¥ - 22:40</p>
    <p><span>æœ€åæ›´æ–°:</span>2025å¹´06æœˆ14æ—¥ - 00:25</p>
    <p><span>åŸå§‹é“¾æ¥:</span><a href="/post/d94f8cde.html" title="LV03-repo-02-repoåŸºæœ¬åŸç†">https://sumumm.github.io/post/d94f8cde.html</a></p>
    <p><span>è®¸å¯åè®®:</span><i class="fab fa-creative-commons"></i> <a rel="license" href= "https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç¦æ­¢æ¼”ç» 4.0 å›½é™…</a> è½¬è½½è¯·ä¿ç•™åŸæ–‡é“¾æ¥åŠä½œè€…ã€‚</p>  
  </div>
  


          <div class="post-tags">
              <a href="/tags/Git/" rel="tag"><i class="fa fa-tag"></i> Git</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/post/58627ebd.html" rel="prev" title="LV03-repo-03-ä»0æ­å»ºä¸€ä¸ªrepoç®¡ç†çš„é¡¹ç›®">
                  <i class="fa fa-angle-left"></i> LV03-repo-03-ä»0æ­å»ºä¸€ä¸ªrepoç®¡ç†çš„é¡¹ç›®
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/post/1eba3c88.html" rel="next" title="LV03-repo-01-repoç®€ä»‹ä¸å®‰è£…">
                  LV03-repo-01-repoç®€ä»‹ä¸å®‰è£… <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2017 â€“ 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">è‹æœ¨</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>ç«™ç‚¹æ€»å­—æ•°ï¼š</span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">3.7m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>ç«™ç‚¹é˜…è¯»æ—¶é•¿ &asymp;</span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">225:26</span>
  </span>
</div>




    <span id="sitetime"></span>
    <script defer language=javascript>
        function siteTime()
        {
            window.setTimeout("siteTime()", 1000);
            var seconds = 1000;
            var minutes = seconds * 60;
            var hours = minutes * 60;
            var days = hours * 24;
            var years = days * 365;
            var today = new Date();
            var todayYear = today.getFullYear();
            var todayMonth = today.getMonth()+1;
            var todayDate = today.getDate();
            var todayHour = today.getHours();
            var todayMinute = today.getMinutes();
            var todaySecond = today.getSeconds();
            /*==================================================
            Date.UTC() -- è¿”å›dateå¯¹è±¡è·ä¸–ç•Œæ ‡å‡†æ—¶é—´(UTC)1970å¹´1æœˆ1æ—¥åˆå¤œä¹‹é—´çš„æ¯«ç§’æ•°(æ—¶é—´æˆ³)
            year        - ä½œä¸ºdateå¯¹è±¡çš„å¹´ä»½ï¼Œä¸º4ä½å¹´ä»½å€¼
            month       - 0-11ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„æœˆä»½
            day         - 1-31ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„å¤©æ•°
            hours       - 0(åˆå¤œ24ç‚¹)-23ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„å°æ—¶æ•°
            minutes     - 0-59ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„åˆ†é’Ÿæ•°
            seconds     - 0-59ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„ç§’æ•°
            microseconds - 0-999ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„æ¯«ç§’æ•°
            ==================================================*/
            var t1 = Date.UTC(2017, 
                              5, 
                              19, 
                              0, 
                              0, 
                              0); //åŒ—äº¬æ—¶é—´
            var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond);
            var diff = t2-t1;
            var diffYears = Math.floor(diff/years);
            var diffDays = Math.floor((diff/days)-diffYears*365);
            var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours);
            var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes);
            var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds);
            document.getElementById("sitetime").innerHTML="å·²åœ¨è¿™é‡Œ "+diffYears+" å¹´ "+diffDays+" å¤© "+diffHours+" å°æ—¶ "+diffMinutes+" åˆ†é’Ÿ "+diffSeconds+" ç§’";
        }
        siteTime();
    </script>



    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.umd.js" integrity="sha256-ytMJGN3toR+a84u7g7NuHm91VIR06Q41kMWDr2pq7Zo=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>


  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


 
        <div id="click-show-text"
            data-mobile = false
            data-text = å¯Œå¼º,æ°‘ä¸»,æ–‡æ˜,å’Œè°,è‡ªç”±,å¹³ç­‰,å…¬æ­£,æ³•åˆ¶,çˆ±å›½,æ•¬ä¸š,è¯šä¿¡,å‹å–„
            data-fontsize = 15px
            data-random= false>
        </div>
       

      
        <script async src=https://cdn.jsdelivr.net/npm/hexo-next-mouse-effect@latest/click/showText.js></script>
      

      
    




    <script async src="/js/fancybox_param.js"></script>





<!-- APlayeræœ¬ä½“ -->



</body>
</html>
