<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha256-wiz7ZSCn/btzhjKDQBms9Hx4sSeUYsDrTLg7roPstac=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.css" integrity="sha256-6cQIC71/iBIYXFK+0RHAvwmjwWzkWd+r7v/BX3/vZDc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/green/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"sumumm.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.19.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":300},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="æœ¬æ–‡ä¸»è¦æ˜¯platformâ€”â€”å¹³å°æ€»çº¿é©±åŠ¨åŸºç¡€çŸ¥è¯†çš„ç›¸å…³ç¬”è®°ï¼Œè‹¥ç¬”è®°ä¸­æœ‰é”™è¯¯æˆ–è€…ä¸åˆé€‚çš„åœ°æ–¹ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ğŸ˜ƒã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="LV10-10-platform-01-platformé©±åŠ¨åŸºç¡€">
<meta property="og:url" content="https://sumumm.github.io/post/684dbf90.html">
<meta property="og:site_name" content="è‹æœ¨">
<meta property="og:description" content="æœ¬æ–‡ä¸»è¦æ˜¯platformâ€”â€”å¹³å°æ€»çº¿é©±åŠ¨åŸºç¡€çŸ¥è¯†çš„ç›¸å…³ç¬”è®°ï¼Œè‹¥ç¬”è®°ä¸­æœ‰é”™è¯¯æˆ–è€…ä¸åˆé€‚çš„åœ°æ–¹ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ğŸ˜ƒã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/01HQ%E8%AF%BE%E7%A8%8B%E4%BD%93%E7%B3%BB/LV10-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV10-10-platform-01-platform%E9%A9%B1%E5%8A%A8%E5%9F%BA%E7%A1%80/img/image-20220902122116722.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/01HQ%E8%AF%BE%E7%A8%8B%E4%BD%93%E7%B3%BB/LV10-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV10-10-platform-01-platform%E9%A9%B1%E5%8A%A8%E5%9F%BA%E7%A1%80/img/image-20220902122621641.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/01HQ%E8%AF%BE%E7%A8%8B%E4%BD%93%E7%B3%BB/LV10-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV10-10-platform-01-platform%E9%A9%B1%E5%8A%A8%E5%9F%BA%E7%A1%80/img/image-20220902123155397.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/01HQ%E8%AF%BE%E7%A8%8B%E4%BD%93%E7%B3%BB/LV10-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV10-10-platform-01-platform%E9%A9%B1%E5%8A%A8%E5%9F%BA%E7%A1%80/img/image-20220902123555631.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/01HQ%E8%AF%BE%E7%A8%8B%E4%BD%93%E7%B3%BB/LV10-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV10-10-platform-01-platform%E9%A9%B1%E5%8A%A8%E5%9F%BA%E7%A1%80/img/image-20220902135400211.png">
<meta property="article:published_time" content="2023-07-08T10:58:33.000Z">
<meta property="article:modified_time" content="2025-06-13T16:25:57.004Z">
<meta property="article:author" content="è‹æœ¨">
<meta property="article:tag" content="LV10-é©±åŠ¨å¼€å‘">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/01HQ%E8%AF%BE%E7%A8%8B%E4%BD%93%E7%B3%BB/LV10-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV10-10-platform-01-platform%E9%A9%B1%E5%8A%A8%E5%9F%BA%E7%A1%80/img/image-20220902122116722.png">


<link rel="canonical" href="https://sumumm.github.io/post/684dbf90.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://sumumm.github.io/post/684dbf90.html","path":"post/684dbf90.html","title":"LV10-10-platform-01-platformé©±åŠ¨åŸºç¡€"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>LV10-10-platform-01-platformé©±åŠ¨åŸºç¡€ | è‹æœ¨</title>
  








    <script src="/js/browser_tools_disable.js"></script>

  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start --><link rel="stylesheet" href="https://unpkg.com/hexo-next-tags-plus@latest/lib/tag_plus.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">è‹æœ¨</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">æˆ‘çš„å­¦ä¹ ä¹‹è·¯</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>è‹æœ¨çš„å®¶</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»é¡µ<span class="badge">42</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£é¡µ<span class="badge">673</span></a></li><li class="menu-item menu-item-flink"><a href="/flink/" rel="section"><i class="fa fa-link fa-fw"></i>å‹äººå¸</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äºæˆ‘</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E3%80%81platform%E7%AE%80%E4%BB%8B"><span class="nav-text">ä¸€ã€platformç®€ä»‹</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8C%E3%80%81platform%E6%80%BB%E7%BA%BF%E7%90%86%E8%A7%A3"><span class="nav-text">äºŒã€platformæ€»çº¿ç†è§£</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E9%A9%B1%E5%8A%A8%E7%9A%84%E5%88%86%E9%9A%94%E4%B8%8E%E5%88%86%E7%A6%BB"><span class="nav-text">1. é©±åŠ¨çš„åˆ†éš”ä¸åˆ†ç¦»</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E8%AE%BE%E5%A4%87%E3%80%81%E9%A9%B1%E5%8A%A8%E5%92%8C%E6%80%BB%E7%BA%BF"><span class="nav-text">2. è®¾å¤‡ã€é©±åŠ¨å’Œæ€»çº¿</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E9%A9%B1%E5%8A%A8%E7%9A%84%E5%88%86%E5%B1%82"><span class="nav-text">3. é©±åŠ¨çš„åˆ†å±‚</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-platform%E5%B9%B3%E5%8F%B0%E9%A9%B1%E5%8A%A8%E6%A8%A1%E5%9E%8B"><span class="nav-text">4.Â platformå¹³å°é©±åŠ¨æ¨¡å‹</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%89%E3%80%81platform%E6%80%BB%E7%BA%BF%E6%9C%BA%E5%88%B6"><span class="nav-text">ä¸‰ã€platformæ€»çº¿æœºåˆ¶</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%9C%A8%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84%E4%BD%93%E7%8E%B0"><span class="nav-text">1. åœ¨ç³»ç»Ÿä¸­çš„ä½“ç°</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E7%AE%A1%E7%90%86%E4%B8%8E%E5%8C%B9%E9%85%8D%E6%9C%BA%E5%88%B6"><span class="nav-text">2. ç®¡ç†ä¸åŒ¹é…æœºåˆ¶</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-text">å››ã€åŸºæœ¬æ•°æ®ç±»å‹</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-struct-bus-type"><span class="nav-text">1.Â struct bus_type</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-platform%E6%80%BB%E7%BA%BF%E7%9B%B8%E5%85%B3%E7%BB%93%E6%9E%84%E4%BD%93"><span class="nav-text">2.Â platformæ€»çº¿ç›¸å…³ç»“æ„ä½“</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E6%80%BB%E7%BA%BF%E5%AE%9A%E4%B9%89"><span class="nav-text">2.1 æ€»çº¿å®šä¹‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%8C%B9%E9%85%8D%E5%87%BD%E6%95%B0"><span class="nav-text">2.2 åŒ¹é…å‡½æ•°</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-platform%E9%A9%B1%E5%8A%A8%E7%9B%B8%E5%85%B3%E7%BB%93%E6%9E%84%E4%BD%93"><span class="nav-text">3.Â platformé©±åŠ¨ç›¸å…³ç»“æ„ä½“</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-struct-platform-driver"><span class="nav-text">3.1Â struct platform_driver</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-struct-device-driver"><span class="nav-text">3.2Â struct device_driver</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-struct-platform-device-id"><span class="nav-text">3.3Â struct platform_device_id</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-struct-of-device-id"><span class="nav-text">3.4Â struct of_device_id</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-platform%E8%AE%BE%E5%A4%87%E7%9B%B8%E5%85%B3%E7%BB%93%E6%9E%84%E4%BD%93"><span class="nav-text">4.Â platformè®¾å¤‡ç›¸å…³ç»“æ„ä½“</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-struct-platform-device"><span class="nav-text">4.1Â struct platform_device</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-struct-device"><span class="nav-text">4.2Â struct device</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-struct-resource"><span class="nav-text">4.3Â struct resource</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-struct-platform-device-id"><span class="nav-text">4.4Â struct platform_device_id</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E5%9F%BA%E6%9C%AC%E5%87%BD%E6%95%B0"><span class="nav-text">äº”ã€åŸºæœ¬å‡½æ•°</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-platform%E9%A9%B1%E5%8A%A8%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0"><span class="nav-text">1.Â platformé©±åŠ¨ç›¸å…³å‡½æ•°</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-platform-driver-register"><span class="nav-text">1.1Â platform_driver_register()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-platform-driver-unregister"><span class="nav-text">1.2Â platform_driver_unregister()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-platform-get-resource"><span class="nav-text">1.3Â platform_get_resource()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-of-match-ptr"><span class="nav-text">1.4Â of_match_ptr()</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-platform%E8%AE%BE%E5%A4%87%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0"><span class="nav-text">2.Â platformè®¾å¤‡ç›¸å…³å‡½æ•°</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-platform-device-register"><span class="nav-text">2.1Â platform_device_register()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-platform-device-unregister"><span class="nav-text">2.2Â platform_device_unregister()</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="è‹æœ¨"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">è‹æœ¨</p>
  <div class="site-description" itemprop="description">è«é“æ¡‘æ¦†æ™šï¼Œä¸ºéœå°šæ»¡å¤©</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">673</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">42</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">æ ‡ç­¾</span>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/sumumm" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;sumumm" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sumumm.github.io/post/684dbf90.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="è‹æœ¨">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è‹æœ¨">
      <meta itemprop="description" content="è«é“æ¡‘æ¦†æ™šï¼Œä¸ºéœå°šæ»¡å¤©">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="LV10-10-platform-01-platformé©±åŠ¨åŸºç¡€ | è‹æœ¨">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          LV10-10-platform-01-platformé©±åŠ¨åŸºç¡€
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-07-08 18:58:33" itemprop="dateCreated datePublished" datetime="2023-07-08T18:58:33+08:00">2023-07-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">åµŒå…¥å¼å¼€å‘</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/01HQ%E8%AF%BE%E7%A8%8B%E4%BD%93%E7%B3%BB/" itemprop="url" rel="index"><span itemprop="name">01HQè¯¾ç¨‹ä½“ç³»</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/01HQ%E8%AF%BE%E7%A8%8B%E4%BD%93%E7%B3%BB/LV10-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">LV10-é©±åŠ¨å¼€å‘</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>8.9k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>32 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>æœ¬æ–‡ä¸»è¦æ˜¯platformâ€”â€”å¹³å°æ€»çº¿é©±åŠ¨åŸºç¡€çŸ¥è¯†çš„ç›¸å…³ç¬”è®°ï¼Œè‹¥ç¬”è®°ä¸­æœ‰é”™è¯¯æˆ–è€…ä¸åˆé€‚çš„åœ°æ–¹ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ğŸ˜ƒã€‚</p>
<span id="more"></span>

<!-- Photo: https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/01HQ%E8%AF%BE%E7%A8%8B%E4%BD%93%E7%B3%BB/LV10-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV10-10-platform-01-platform%E9%A9%B1%E5%8A%A8%E5%9F%BA%E7%A1%80/img/ -->

<details class="folding-tag" blue><summary> ç‚¹å‡»æŸ¥çœ‹ä½¿ç”¨å·¥å…·åŠç‰ˆæœ¬ </summary>
              <div class='content'>
              <table>    <tr>        <td align="center" width=150px>Windows</td>        <td align="left">windows11</td>    </tr>    <tr>        <td align="center">Ubuntu</td>        <td align="left">Ubuntu16.04çš„64ä½ç‰ˆæœ¬</td>      </tr>    <tr>        <td align="center">VMwareÂ® Workstation 16 Pro</td>        <td align="left">16.2.3 build-19376536</td>      </tr>    <tr>        <td align="center">SecureCRT</td>        <td align="left">Version 8.7.2 (x64 build 2214)   -   æ­£å¼ç‰ˆ-2020å¹´5æœˆ14æ—¥</td>      </tr>    <tr>        <td align="center" width=150>Linuxå¼€å‘æ¿</td>        <td align="left">åæ¸…è¿œè§ åº•æ¿: FS4412_DEV_V5 æ ¸å¿ƒæ¿: FS4412 V2</td>      </tr>    <tr>        <td align="center" width=150>u-boot</td>        <td align="left">2013.01</td>      </tr></table>
              </div>
            </details>

<details class="folding-tag" blue><summary> ç‚¹å‡»æŸ¥çœ‹æœ¬æ–‡å‚è€ƒèµ„æ–™ </summary>
              <div class='content'>
              <table>    <tr><td align="center">å‚è€ƒæ–¹å‘</td><td align="center">å‚è€ƒåŸæ–‡</td></tr>    <tr><td align="left">é©±åŠ¨å¼€å‘æŒ‡å—</td><td align="left"><a href="http://47.111.11.73/docs/boards/arm-linux/zdyz-i.mx6ull.html#i-mx6ull-linux" target="_blank">i.MX6ULL Linuxé˜¿å°”æ³•å¼€å‘æ¿èµ„æ–™ <i class="fa fa-external-link-alt"></i> </a></td></tr>    <tr><td align="left">åæ¸…è¿œè§è¯¾ç¨‹</td><td align="left"><a href="http://47.111.11.73/docs/boards/arm-linux/zdyz-i.mx6ull.html#i-mx6ull-linux" target="_blank">åæ¸…è¿œè§è¯¾ç¨‹ <i class="fa fa-external-link-alt"></i> </a></td></tr>    <tr><td align="left">platformé©±åŠ¨æ¨¡å‹</td><td align="left"><a href="https://www.cnblogs.com/linfeng-learning/p/9334853.html" target="_blank">Linux platformé©±åŠ¨æ¨¡å‹ - LinFeng-Learning - åšå®¢å›­ (cnblogs.com) <i class="fa fa-external-link-alt"></i> </a></td></tr>    <tr><td align="left">platformé©±åŠ¨æ¨¡å‹è¯¦è§£</td><td align="left"><a href="https://www.cnblogs.com/biaohc/p/6667529.html" target="_blank">platformé©±åŠ¨æ¨¡å‹è¯¦è§£ï¼Œä»¥åŠåŸºäºplatformé©±åŠ¨æ¨¡å‹çš„ledé©±åŠ¨ - biaohc - åšå®¢å›­ (cnblogs.com) <i class="fa fa-external-link-alt"></i> </a></td></tr>    <tr><td align="left">Linux Platformé©±åŠ¨æ¨¡å‹(ä¸€)</td><td align="left"><a href="https://www.cnblogs.com/xiaojiang1025/p/6367061.html" target="_blank">Linux Platformé©±åŠ¨æ¨¡å‹(ä¸€) _è®¾å¤‡ä¿¡æ¯ - Abnor - åšå®¢å›­ (cnblogs.com) <i class="fa fa-external-link-alt"></i> </a></td></tr>    <tr><td align="left">Linux Platformé©±åŠ¨æ¨¡å‹(äºŒ)</td><td align="left"><a href="https://www.cnblogs.com/xiaojiang1025/p/6367910.html" target="_blank">Linux Platformé©±åŠ¨æ¨¡å‹(äºŒ) _é©±åŠ¨æ–¹æ³• - Abnor - åšå®¢å›­ (cnblogs.com) <i class="fa fa-external-link-alt"></i> </a></td></tr></table>
              </div>
            </details>

<details class="folding-tag" blue><summary> ç‚¹å‡»æŸ¥çœ‹ç›¸å…³æ–‡ä»¶ä¸‹è½½ </summary>
              <div class='content'>
              <table>    <tr><td align="center">æ–‡ä»¶</td><td align="center">ä¸‹è½½é“¾æ¥</td></tr>    <tr><td align="left">---</td><td align="left"><a href="https://wwz.lanzouy.com/iH1vO09jxavi" target="_blank">--- <i class="fa fa-external-link-alt"></i> </a></td></tr></table>
              </div>
            </details>



<h1 id="ä¸€ã€platformç®€ä»‹"><a href="#ä¸€ã€platformç®€ä»‹" class="headerlink" title="ä¸€ã€platformç®€ä»‹"></a><font size=3>ä¸€ã€<code>platform</code>ç®€ä»‹</font></h1><p>åœ¨æˆ‘ä»¬ä¹‹å‰å­¦ä¹ çš„å­—ç¬¦è®¾å¤‡é©±åŠ¨æ¨¡å‹ä¸­ï¼Œåªè¦åº”ç”¨ç¨‹åºè°ƒç”¨<code>open()</code>æ‰“å¼€äº†ç›¸åº”çš„è®¾å¤‡æ–‡ä»¶ï¼Œå°±å¯ä»¥ä½¿ç”¨<code>ioctl</code>é€šè¿‡é©±åŠ¨ç¨‹åºæ¥æ§åˆ¶æˆ‘ä»¬çš„ç¡¬ä»¶ï¼Œè¿™ç§æ¨¡å‹å¾ˆç›´è§‚ï¼Œä½†æ˜¯ä»è½¯ä»¶è®¾è®¡çš„è§’åº¦çœ‹ï¼Œå´æ˜¯ä¸€ç§ååˆ†ç³Ÿç³•çš„æ–¹å¼ï¼Œå®ƒæœ‰ä¸€ä¸ªè‡´å‘½çš„é—®é¢˜ï¼Œå°±æ˜¯<strong>è®¾å¤‡ä¿¡æ¯å’Œé©±åŠ¨ä»£ç å†—ä½™åœ¨ä¸€èµ·ï¼Œä¸€æ—¦ç¡¬ä»¶ä¿¡æ¯å‘ç”Ÿæ”¹å˜ç”šè‡³è®¾å¤‡å·²ç»ä¸åœ¨äº†ï¼Œå°±å¿…é¡»è¦ä¿®æ”¹é©±åŠ¨æºç </strong>ï¼Œéå¸¸çš„éº»çƒ¦ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ç§é©±åŠ¨ä»£ç å’Œè®¾å¤‡ä¿¡æ¯è€¦åˆçš„é—®é¢˜ï¼Œ<code>Linux</code>æå‡ºäº†<code>platform bus</code>(<strong>å¹³å°æ€»çº¿</strong>)çš„æ¦‚å¿µï¼Œå³ä½¿ç”¨è™šæ‹Ÿæ€»çº¿å°†<strong>è®¾å¤‡ä¿¡æ¯å’Œé©±åŠ¨ç¨‹åºè¿›è¡Œåˆ†ç¦»</strong>ï¼Œè®¾å¤‡æ ‘çš„æå‡ºå°±æ˜¯è¿›ä¸€æ­¥æ·±åŒ–è¿™ç§æ€æƒ³ï¼Œå°†è®¾å¤‡ä¿¡æ¯è¿›è¡Œæ›´å¥½çš„æ•´ç†ã€‚</p>
<p>åœ¨<code>Linux2.6</code>ä»¥åçš„è®¾å¤‡é©±åŠ¨æ¨¡å‹ï¼Œ<code>Linux</code>å†…æ ¸ä¸­çš„æ€»çº¿ä¸»è¦è´Ÿè´£ç®¡ç†æŒ‚æ¥åœ¨è¯¥æ€»çº¿ä¸‹çš„è®¾å¤‡ä¸é©±åŠ¨ï¼Œå¹³å°æ€»çº¿ä¼š<strong>ç»´æŠ¤ä¸¤æ¡é“¾è¡¨ï¼Œåˆ†åˆ«ç®¡ç†è®¾å¤‡å’Œé©±åŠ¨</strong>ï¼Œå°†è®¾å¤‡ä¿¡æ¯ä¸é©±åŠ¨ç¨‹åºåˆ†ç±»ç®¡ç†ï¼Œå¯ä»¥æé«˜é©±åŠ¨ç¨‹åºçš„å¯ç§»æ¤æ€§ã€‚åœ¨ç³»ç»Ÿæ¯æ³¨å†Œä¸€ä¸ªè®¾å¤‡çš„æ—¶å€™ï¼Œä¼šå¯»æ‰¾ä¸ä¹‹åŒ¹é…çš„é©±åŠ¨ï¼›ç›¸åŒåœ°ï¼Œåœ¨ç³»ç»Ÿæ¯æ³¨å†Œä¸€ä¸ªé©±åŠ¨çš„æ—¶å€™ï¼Œä¼šå¯»æ‰¾ä¸ä¹‹åŒ¹é…çš„è®¾å¤‡ï¼Œè€Œ<strong>åŒ¹é…ç”±æ€»çº¿</strong>å®Œæˆã€‚ ç›¸å¯¹äº<code>USB</code>ã€<code>PCI</code>ã€<code>I2C</code>ã€<code>SPI</code>ç­‰ç‰©ç†æ€»çº¿æ¥è¯´ï¼Œ<code>platform</code>æ€»çº¿æ˜¯ä¸€ç§è™šæ‹Ÿã€æŠ½è±¡å‡ºæ¥çš„æ€»çº¿ï¼Œå®é™…ä¸­å¹¶ä¸å­˜åœ¨è¿™æ ·çš„æ€»çº¿ã€‚ è¿™ç§<strong>è™šæ‹Ÿçš„æ€»çº¿ä»…ç”¨æ¥ç®¡ç†è®¾å¤‡å’Œé©±åŠ¨ï¼ˆæœ€æ ¸å¿ƒçš„ä½œç”¨ä¹‹ä¸€å°±æ˜¯å®Œæˆè®¾å¤‡å’Œé©±åŠ¨çš„åŒ¹é…ï¼‰</strong>ã€‚</p>
<p>è®¾å¤‡ä¸»è¦æä¾›ç¡¬ä»¶èµ„æºï¼Œé©±åŠ¨ä¸»è¦æ°”åŠŸé©±åŠ¨ä»£ç ï¼Œè€Œæ€»çº¿åˆ™æ˜¯å®Œæˆè®¾å¤‡å’Œé©±åŠ¨åŒ¹é…çš„åª’ä»‹ã€‚</p>
<h1 id="äºŒã€platformæ€»çº¿ç†è§£"><a href="#äºŒã€platformæ€»çº¿ç†è§£" class="headerlink" title="äºŒã€platformæ€»çº¿ç†è§£"></a><font size=3>äºŒã€<code>platform</code>æ€»çº¿ç†è§£</font></h1><p>ä¸Šè¾¹ä»…ä»…æ˜¯åšäº†ä¸€ä¸ªç®€ä»‹ï¼Œæˆ‘æ„Ÿè§‰å¹¶ä¸èƒ½å¾ˆå¥½çš„å¸®åŠ©æˆ‘ç†è§£<code>platform</code>å¹³å°æ€»çº¿æ¨¡å‹ã€‚è¿™ä¸€éƒ¨åˆ†ç¬”è®°æ˜¯æ¥è‡ªäºæ­£ç‚¹åŸå­çš„é©±åŠ¨å¼€å‘æ‰‹å†Œï¼Œè¯¦ç»†çš„å¯ä»¥æŸ¥çœ‹æ‰‹å†ŒåŸæ–‡ï¼Œè¿™é‡Œåšä¸€ä¸ªç¬”è®°ï¼ŒåŠ æ·±è‡ªå·±çš„ç†è§£ã€‚</p>
<h2 id="1-é©±åŠ¨çš„åˆ†éš”ä¸åˆ†ç¦»"><a href="#1-é©±åŠ¨çš„åˆ†éš”ä¸åˆ†ç¦»" class="headerlink" title="1. é©±åŠ¨çš„åˆ†éš”ä¸åˆ†ç¦»"></a><font size=3>1. é©±åŠ¨çš„åˆ†éš”ä¸åˆ†ç¦»</font></h2><p>å¯¹äº <code>Linux</code> è¿™æ ·ä¸€ä¸ªæˆç†Ÿã€åºå¤§ã€å¤æ‚çš„æ“ä½œç³»ç»Ÿï¼Œä»£ç çš„é‡ç”¨æ€§éå¸¸é‡è¦ï¼Œå¦åˆ™çš„è¯å°±ä¼šåœ¨ <code>Linux</code> å†…æ ¸ä¸­å­˜åœ¨å¤§é‡æ— æ„ä¹‰çš„é‡å¤ä»£ç ã€‚å°¤å…¶æ˜¯é©±åŠ¨ç¨‹åºï¼Œå› ä¸ºé©±åŠ¨ç¨‹åºå ç”¨äº† <code>Linux</code>å†…æ ¸ä»£ç é‡çš„å¤§å¤´ï¼Œå¦‚æœä¸å¯¹é©±åŠ¨ç¨‹åºåŠ ä»¥ç®¡ç†ï¼Œä»»ç”±é‡å¤çš„ä»£ç è‚†æ„å¢åŠ ï¼Œé‚£ä¹ˆç”¨ä¸äº†å¤šä¹…<code>Linux</code> å†…æ ¸çš„æ–‡ä»¶æ•°é‡å°±åºå¤§åˆ°æ— æ³•æ¥å—çš„åœ°æ­¥ã€‚</p>
<p>å‡å¦‚ç°åœ¨æœ‰ä¸‰ä¸ªå¹³å° <code>A</code>ã€ <code>B</code>å’Œ <code>C</code>ï¼Œè¿™ä¸‰ä¸ªå¹³å°ï¼ˆè¿™é‡Œçš„å¹³å°è¯´çš„æ˜¯ <code>SOC</code>ï¼‰ä¸Šéƒ½æœ‰<code>MPU6050</code> è¿™ä¸ª<code>I2C</code>æ¥å£çš„å…­è½´ä¼ æ„Ÿå™¨ï¼ŒæŒ‰ç…§æˆ‘ä»¬å†™è£¸æœº<code>I2C</code>é©±åŠ¨çš„æ—¶å€™çš„æ€è·¯ï¼Œæ¯ä¸ªå¹³å°éƒ½æœ‰ä¸€ä¸ª<code>MPU6050</code>çš„é©±åŠ¨ï¼Œå› æ­¤ç¼–å†™å‡ºæ¥çš„æœ€ç®€å•çš„é©±åŠ¨æ¡†æ¶å¦‚ä¸‹å›¾ï¼š</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/01HQ%E8%AF%BE%E7%A8%8B%E4%BD%93%E7%B3%BB/LV10-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV10-10-platform-01-platform%E9%A9%B1%E5%8A%A8%E5%9F%BA%E7%A1%80/img/image-20220902122116722.png" alt="image-20220902122116722" style="zoom:43%;" />

<p>å¯ä»¥çœ‹å‡ºï¼Œæ¯ç§å¹³å°ä¸‹éƒ½æœ‰ä¸€ä¸ªä¸»æœºé©±åŠ¨å’Œè®¾å¤‡é©±åŠ¨ï¼Œä¸»æœºé©±åŠ¨è‚¯å®šæ˜¯å¿…é¡»è¦çš„ï¼Œæ¯•ç«Ÿä¸åŒçš„å¹³å°å…¶ <code>I2C</code> æ§åˆ¶å™¨ä¸åŒã€‚ä½†æ˜¯å³ä¾§çš„è®¾å¤‡é©±åŠ¨å°±æ²¡å¿…è¦æ¯ä¸ªå¹³å°éƒ½å†™ä¸€ä¸ªï¼Œå› ä¸ºä¸ç®¡å¯¹äºé‚£ä¸ª <code>SOC</code> æ¥è¯´ï¼Œ <code>MPU6050</code> éƒ½æ˜¯ä¸€æ ·ï¼Œé€šè¿‡ <code>I2C</code> æ¥å£è¯»å†™æ•°æ®å°±è¡Œäº†ï¼Œåªéœ€è¦ä¸€ä¸ª<code>MPU6050</code> çš„é©±åŠ¨ç¨‹åºå³å¯ã€‚</p>
<p>å¦‚æœå†æ¥å‡ ä¸ª <code>I2C</code> è®¾å¤‡ï¼Œæ¯”å¦‚ <code>AT24C02</code>ã€ <code>FT5206</code>(ç”µå®¹è§¦æ‘¸å±)ç­‰ï¼Œè‹¥éƒ½æŒ‰ç…§ä¸Šå›¾çš„å†™æ³•ï¼Œé‚£ä¹ˆè®¾å¤‡ç«¯çš„é©±åŠ¨å°†ä¼šé‡å¤çš„ç¼–å†™å¥½å‡ æ¬¡ã€‚æ˜¾ç„¶åœ¨ <code>Linux</code>é©±åŠ¨ç¨‹åºä¸­è¿™ç§å†™æ³•æ˜¯ä¸æ¨èçš„ï¼Œæœ€å¥½çš„åšæ³•å°±æ˜¯æ¯ä¸ªå¹³å°çš„ <code>I2C</code> æ§åˆ¶å™¨éƒ½æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£(ä¹Ÿå«åšä¸»æœºé©±åŠ¨)ï¼Œæ¯ä¸ªè®¾å¤‡çš„è¯ä¹Ÿåªæä¾›ä¸€ä¸ªé©±åŠ¨ç¨‹åº(è®¾å¤‡é©±åŠ¨)ï¼Œæ¯ä¸ªè®¾å¤‡é€šè¿‡ç»Ÿä¸€çš„<code> I2C</code>æ¥å£é©±åŠ¨æ¥è®¿é—®ï¼Œè¿™æ ·å°±å¯ä»¥å¤§å¤§ç®€åŒ–é©±åŠ¨æ–‡ä»¶ï¼Œæ¯”å¦‚<code>A</code>ã€<code>B</code>å’Œ<code>C</code>ä¸‰ç§å¹³å°ä¸‹çš„ <code>MPU6050</code> é©±åŠ¨æ¡†æ¶å°±å¯ä»¥ç®€åŒ–ä¸ºä¸‹å›¾çš„å½¢å¼ï¼š</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/01HQ%E8%AF%BE%E7%A8%8B%E4%BD%93%E7%B3%BB/LV10-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV10-10-platform-01-platform%E9%A9%B1%E5%8A%A8%E5%9F%BA%E7%A1%80/img/image-20220902122621641.png" alt="image-20220902122621641" style="zoom:43%;" />

<p>å®é™…çš„ <code>I2C</code> é©±åŠ¨è®¾å¤‡è‚¯å®šæœ‰å¾ˆå¤šç§ï¼Œä¸æ­¢ <code>MPU6050</code> è¿™ä¸€ä¸ªï¼Œé‚£ä¹ˆå®é™…çš„é©±åŠ¨æ¶æ„å°±å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/01HQ%E8%AF%BE%E7%A8%8B%E4%BD%93%E7%B3%BB/LV10-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV10-10-platform-01-platform%E9%A9%B1%E5%8A%A8%E5%9F%BA%E7%A1%80/img/image-20220902123155397.png" alt="image-20220902123155397" style="zoom:43%;" />

<p>è¿™ä¸ªå°±æ˜¯<strong>é©±åŠ¨çš„åˆ†éš”</strong>ï¼Œä¹Ÿå°±æ˜¯å°†ä¸»æœºé©±åŠ¨å’Œè®¾å¤‡é©±åŠ¨åˆ†éš”å¼€æ¥ï¼Œæ¯”å¦‚<code>I2C</code>ã€<code>SPI</code> ç­‰ç­‰éƒ½ä¼šé‡‡ç”¨é©±åŠ¨åˆ†éš”çš„æ–¹å¼æ¥ç®€åŒ–é©±åŠ¨çš„å¼€å‘ã€‚åœ¨å®é™…çš„é©±åŠ¨å¼€å‘ä¸­ï¼Œä¸€èˆ¬<code>I2C</code>ä¸»æœºæ§åˆ¶å™¨é©±åŠ¨å·²ç»ç”±åŠå¯¼ä½“å‚å®¶ç¼–å†™å¥½äº†ï¼Œè€Œè®¾å¤‡é©±åŠ¨ä¸€èˆ¬ä¹Ÿç”±è®¾å¤‡å™¨ä»¶çš„å‚å®¶ç¼–å†™å¥½äº†ï¼Œæˆ‘ä»¬åªéœ€è¦æä¾›è®¾å¤‡ä¿¡æ¯å³å¯ï¼Œæ¯”å¦‚<code>I2C</code>è®¾å¤‡çš„è¯æä¾›è®¾å¤‡è¿æ¥åˆ°äº†å“ªä¸ª<code> I2C</code>æ¥å£ä¸Šï¼Œ <code>I2C</code> çš„é€Ÿåº¦æ˜¯å¤šå°‘ç­‰ç­‰ã€‚ç›¸å½“äºå°†è®¾å¤‡ä¿¡æ¯ä»è®¾å¤‡é©±åŠ¨ä¸­å‰¥ç¦»å¼€æ¥ï¼Œé©±åŠ¨ä½¿ç”¨æ ‡å‡†æ–¹æ³•å»è·å–åˆ°è®¾å¤‡ä¿¡æ¯(æ¯”å¦‚ä»è®¾å¤‡æ ‘ä¸­è·å–åˆ°è®¾å¤‡ä¿¡æ¯)ï¼Œç„¶åæ ¹æ®è·å–åˆ°çš„è®¾å¤‡ä¿¡æ¯æ¥åˆå§‹åŒ–è®¾å¤‡ã€‚ è¿™æ ·å°±ç›¸å½“äºé©±åŠ¨åªè´Ÿè´£é©±åŠ¨ï¼Œè®¾å¤‡åªè´Ÿè´£è®¾å¤‡ï¼Œæƒ³åŠæ³•å°†ä¸¤è€…è¿›è¡ŒåŒ¹é…å³å¯ã€‚</p>
<h2 id="2-è®¾å¤‡ã€é©±åŠ¨å’Œæ€»çº¿"><a href="#2-è®¾å¤‡ã€é©±åŠ¨å’Œæ€»çº¿" class="headerlink" title="2. è®¾å¤‡ã€é©±åŠ¨å’Œæ€»çº¿"></a><font size=3>2. è®¾å¤‡ã€é©±åŠ¨å’Œæ€»çº¿</font></h2><p>é©±åŠ¨è¿›è¡Œåˆ†éš”å’Œåˆ†ç¦»åï¼Œåœ¨<code>linux</code>ä¸­å°±å½¢æˆäº†æ€»çº¿ï¼ˆ<code>bus</code>ï¼‰ã€é©±åŠ¨ï¼ˆ<code>driver</code>ï¼‰å’Œè®¾å¤‡ï¼ˆ<code>device</code>ï¼‰æ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„<strong>é©±åŠ¨åˆ†ç¦»</strong>ã€‚æ€»çº¿å°±æ˜¯é©±åŠ¨å’Œè®¾å¤‡ä¿¡æ¯çš„æœˆè€ï¼Œè´Ÿè´£ç»™ä¸¤è€…ç‰µçº¿æ­æ¡¥ã€‚æ‰€ä»¥<code>linux</code>ä¸­çš„è®¾å¤‡ã€é©±åŠ¨å’Œæ€»çº¿çš„æ¨¡å¼å¦‚ä¸‹å›¾ï¼š</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/01HQ%E8%AF%BE%E7%A8%8B%E4%BD%93%E7%B3%BB/LV10-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV10-10-platform-01-platform%E9%A9%B1%E5%8A%A8%E5%9F%BA%E7%A1%80/img/image-20220902123555631.png" alt="image-20220902123555631" style="zoom:43%;" />

<p>å½“æˆ‘ä»¬å‘ç³»ç»Ÿæ³¨å†Œä¸€ä¸ªé©±åŠ¨çš„æ—¶å€™ï¼Œæ€»çº¿å°±ä¼šåœ¨å³ä¾§çš„è®¾å¤‡ä¸­æŸ¥æ‰¾ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰ä¸ä¹‹åŒ¹é…çš„è®¾å¤‡ï¼Œå¦‚æœæœ‰çš„è¯å°±å°†ä¸¤è€…è”ç³»èµ·æ¥ã€‚åŒæ ·çš„ï¼Œå½“å‘ç³»ç»Ÿä¸­æ³¨å†Œä¸€ä¸ªè®¾å¤‡çš„æ—¶å€™ï¼Œæ€»çº¿å°±ä¼šåœ¨å·¦ä¾§çš„é©±åŠ¨ä¸­æŸ¥æ‰¾çœ‹æœ‰æ²¡æœ‰ä¸ä¹‹åŒ¹é…çš„è®¾å¤‡ï¼Œæœ‰çš„è¯ä¹Ÿè”ç³»èµ·æ¥ã€‚ <code>Linux</code> å†…æ ¸ä¸­å¤§é‡çš„é©±åŠ¨ç¨‹åºéƒ½é‡‡ç”¨æ€»çº¿ã€é©±åŠ¨å’Œè®¾å¤‡æ¨¡å¼ã€‚  </p>
<h2 id="3-é©±åŠ¨çš„åˆ†å±‚"><a href="#3-é©±åŠ¨çš„åˆ†å±‚" class="headerlink" title="3. é©±åŠ¨çš„åˆ†å±‚"></a><font size=3>3. é©±åŠ¨çš„åˆ†å±‚</font></h2><p><code>Linux</code> ä¸‹çš„é©±åŠ¨å¾€å¾€ä¹Ÿæ˜¯åˆ†å±‚çš„ï¼Œåˆ†å±‚çš„ç›®çš„ä¹Ÿæ˜¯ä¸ºäº†åœ¨ä¸åŒçš„å±‚å¤„ç†ä¸åŒçš„å†…å®¹ã€‚ä»¥å¸¸å¸¸ä½¿ç”¨åˆ°çš„<code>input</code>(è¾“å…¥å­ç³»ç»Ÿï¼Œåè¾¹ä¼šå­¦ä¹ åˆ°)ä¸ºä¾‹ï¼Œç®€å•ä»‹ç»ä¸€ä¸‹é©±åŠ¨çš„åˆ†å±‚ã€‚</p>
<p><code> input</code> å­ç³»ç»Ÿè´Ÿè´£ç®¡ç†æ‰€æœ‰è·Ÿè¾“å…¥æœ‰å…³çš„é©±åŠ¨ï¼ŒåŒ…æ‹¬é”®ç›˜ã€é¼ æ ‡ã€è§¦æ‘¸ç­‰ï¼Œæœ€åº•å±‚çš„å°±æ˜¯è®¾å¤‡åŸå§‹é©±åŠ¨ï¼Œè´Ÿè´£è·å–è¾“å…¥è®¾å¤‡çš„åŸå§‹å€¼ï¼Œè·å–åˆ°çš„è¾“å…¥äº‹ä»¶ä¸ŠæŠ¥ç»™ <code>input</code> æ ¸å¿ƒå±‚ã€‚ <code>input</code> æ ¸å¿ƒå±‚ä¼šå¤„ç†å„ç§ <code>IO</code> æ¨¡å‹ï¼Œå¹¶ä¸”æä¾› <code>file_operations</code> æ“ä½œé›†åˆã€‚æˆ‘ä»¬åœ¨ç¼–å†™è¾“å…¥è®¾å¤‡é©±åŠ¨çš„æ—¶å€™åªéœ€è¦å¤„ç†å¥½è¾“å…¥äº‹ä»¶çš„ä¸ŠæŠ¥å³å¯ï¼Œè‡³äºå¦‚ä½•å¤„ç†è¿™äº›ä¸ŠæŠ¥çš„è¾“å…¥äº‹ä»¶é‚£æ˜¯ä¸Šå±‚å»è€ƒè™‘çš„ï¼Œæˆ‘ä»¬ä¸ç”¨å…³å¿ƒã€‚</p>
<p>å¯ä»¥çœ‹å‡ºå€ŸåŠ©åˆ†å±‚æ¨¡å‹å¯ä»¥æå¤§çš„ç®€åŒ–æˆ‘ä»¬çš„é©±åŠ¨ç¼–å†™ï¼Œå¯¹äºé©±åŠ¨ç¼–å†™æ¥è¯´éå¸¸çš„å‹å¥½ã€‚  </p>
<h2 id="4-platformå¹³å°é©±åŠ¨æ¨¡å‹"><a href="#4-platformå¹³å°é©±åŠ¨æ¨¡å‹" class="headerlink" title="4.Â platformå¹³å°é©±åŠ¨æ¨¡å‹"></a><font size=3>4.Â <code>platform</code>å¹³å°é©±åŠ¨æ¨¡å‹</font></h2><p>æˆ‘ä»¬ä¸Šè¾¹å­¦ä¹ äº†è®¾å¤‡é©±åŠ¨çš„åˆ†ç¦»ï¼Œå¹¶ä¸”å¼•å‡ºäº†æ€»çº¿ï¼ˆ<code>bus</code>ï¼‰ã€é©±åŠ¨ï¼ˆ<code>driver</code>ï¼‰å’Œè®¾å¤‡ï¼ˆ<code>device</code>ï¼‰æ¨¡å‹ï¼Œæ¯”å¦‚ <code>I2C</code>ã€ <code>SPI</code>ã€ <code>USB</code> ç­‰æ€»çº¿ã€‚ä½†æ˜¯åœ¨ <code>SOC</code> ä¸­æœ‰äº›å¤–è®¾æ˜¯æ²¡æœ‰æ€»çº¿è¿™ä¸ªæ¦‚å¿µçš„ï¼Œä½†æ˜¯åˆè¦ä½¿ç”¨æ€»çº¿ã€é©±åŠ¨å’Œè®¾å¤‡æ¨¡å‹è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>ä¸ºäº†è§£å†³æ­¤é—®é¢˜ï¼Œ <code>Linux</code> æå‡ºäº† <code>platform</code> è¿™ä¸ªè™šæ‹Ÿæ€»çº¿ï¼Œç›¸åº”çš„å°±æœ‰ <code>platform_driver</code> å’Œ <code>platform_device</code>ã€‚  </p>
<h1 id="ä¸‰ã€platformæ€»çº¿æœºåˆ¶"><a href="#ä¸‰ã€platformæ€»çº¿æœºåˆ¶" class="headerlink" title="ä¸‰ã€platformæ€»çº¿æœºåˆ¶"></a><font size=3>ä¸‰ã€<code>platform</code>æ€»çº¿æœºåˆ¶</font></h1><h2 id="1-åœ¨ç³»ç»Ÿä¸­çš„ä½“ç°"><a href="#1-åœ¨ç³»ç»Ÿä¸­çš„ä½“ç°" class="headerlink" title="1. åœ¨ç³»ç»Ÿä¸­çš„ä½“ç°"></a><font size=3>1. åœ¨ç³»ç»Ÿä¸­çš„ä½“ç°</font></h2><p><code>platform</code>æ€»çº¿åœ¨æ ¹æ–‡ä»¶ç³»ç»Ÿä¸‹çš„ç›®å½•ä¸º<code>/sys/bus/platform</code>ï¼Œè¯¥ç›®å½•ä¸‹æœ‰ä¸¤ä¸ªå­ç›®å½•å’Œç›¸å…³çš„<code>platform</code>å±æ€§æ–‡ä»¶ï¼š</p>
<ul>
<li><p><code>devices</code>ç›®å½•ä¸‹å­˜æ”¾çš„æ˜¯<code>platform</code>æ€»çº¿ä¸‹çš„æ‰€æœ‰è®¾å¤‡ã€‚</p>
</li>
<li><p><code>drivers</code>ç›®å½•ä¸‹å­˜æ”¾çš„æ˜¯<code>platform</code>æ€»çº¿ä¸‹çš„æ‰€æœ‰é©±åŠ¨ç¨‹åºã€‚</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">[root@farsight]#</span><span class="language-bash"><span class="built_in">ls</span> /sys/bus/platform/ -lh</span></span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x    2 0        0              0 Jan  1 04:06 devices</span><br><span class="line">drwxr-xr-x   37 0        0              0 Jan  1 04:06 drivers</span><br><span class="line">-rw-r--r--    1 0        0           4.0K Jan  1 04:06 drivers_autoprobe</span><br><span class="line">--w-------    1 0        0           4.0K Jan  1 04:06 drivers_probe</span><br><span class="line">--w-------    1 0        0           4.0K Jan  1 04:06 ueven</span><br></pre></td></tr></table></figure>

<h2 id="2-ç®¡ç†ä¸åŒ¹é…æœºåˆ¶"><a href="#2-ç®¡ç†ä¸åŒ¹é…æœºåˆ¶" class="headerlink" title="2. ç®¡ç†ä¸åŒ¹é…æœºåˆ¶"></a><font size=3>2. ç®¡ç†ä¸åŒ¹é…æœºåˆ¶</font></h2><p><code>platform</code>æ€»çº¿çš„é©±åŠ¨ä¸è®¾å¤‡çš„ç®¡ç†ä¸åŒ¹é…æœºåˆ¶å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/01HQ%E8%AF%BE%E7%A8%8B%E4%BD%93%E7%B3%BB/LV10-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV10-10-platform-01-platform%E9%A9%B1%E5%8A%A8%E5%9F%BA%E7%A1%80/img/image-20220902135400211.png" alt="image-20220902135400211" style="zoom:43%;" />

<h1 id="å››ã€åŸºæœ¬æ•°æ®ç±»å‹"><a href="#å››ã€åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="å››ã€åŸºæœ¬æ•°æ®ç±»å‹"></a><font size=3>å››ã€åŸºæœ¬æ•°æ®ç±»å‹</font></h1><p>ä¸Šè¾¹æè¿°<code>platform</code>æ€»çº¿çš„ç®¡ç†ä¸åŒ¹é…æœºåˆ¶çš„æ—¶å€™å‡ºç°äº†å‡ ç§æ•°æ®ç»“æ„ï¼Œè¿™ä¸€éƒ¨åˆ†ä¸»è¦æ˜¯ä»‹ç»ä¸€ä¸‹è¿™äº›é‡è¦çš„æ•°æ®ç»“æ„ã€‚</p>
<h2 id="1-struct-bus-type"><a href="#1-struct-bus-type" class="headerlink" title="1.Â struct bus_type"></a><font size=3>1.Â <code>struct bus_type</code></font></h2><p><code>Linux</code>ç³»ç»Ÿå†…æ ¸ä½¿ç”¨<code>bus_type</code>ç»“æ„ä½“è¡¨ç¤ºæ€»çº¿ï¼Œè¿™ä¸ªç»“æ„ä½“å®šä¹‰åœ¨<code>linux</code>å†…æ ¸æºç çš„ä¸‹è¾¹è¿™ä¸ªæ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include/linux/device.h</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œæ‰¾åˆ°<code>struct bus_type</code>ç»“æ„ä½“å¦‚ä¸‹ï¼š</p>
<details class="folding-tag" blue><summary> ç‚¹å‡»æŸ¥çœ‹æºç ä¸­å¯¹è¯¥ç»“æ„ä½“çš„æ³¨é‡Šè¯´æ˜ </summary>
              <div class='content'>
              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * struct bus_type - The bus type of the device</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @name:       The name of the bus.</span></span><br><span class="line"><span class="comment"> * @dev_name:   Used for subsystems to enumerate devices like (&quot;foo%u&quot;, dev-&gt;id).</span></span><br><span class="line"><span class="comment"> * @dev_root:   Default device to use as the parent.</span></span><br><span class="line"><span class="comment"> * @dev_attrs:  Default attributes of the devices on the bus.</span></span><br><span class="line"><span class="comment"> * @bus_groups: Default attributes of the bus.</span></span><br><span class="line"><span class="comment"> * @dev_groups: Default attributes of the devices on the bus.</span></span><br><span class="line"><span class="comment"> * @drv_groups: Default attributes of the device drivers on the bus.</span></span><br><span class="line"><span class="comment"> * @match:      Called, perhaps multiple times, whenever a new device or driver</span></span><br><span class="line"><span class="comment"> *              is added for this bus. It should return a nonzero value if the</span></span><br><span class="line"><span class="comment"> *              given device can be handled by the given driver.</span></span><br><span class="line"><span class="comment"> * @uevent:     Called when a device is added, removed, or a few other things</span></span><br><span class="line"><span class="comment"> *              that generate uevents to add the environment variables.</span></span><br><span class="line"><span class="comment"> * @probe:      Called when a new device or driver add to this bus, and callback</span></span><br><span class="line"><span class="comment"> *              the specific driver&#x27;s probe to initial the matched device.</span></span><br><span class="line"><span class="comment"> * @remove:     Called when a device removed from this bus.</span></span><br><span class="line"><span class="comment"> * @shutdown:   Called at shut-down time to quiesce the device.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @online:     Called to put the device back online (after offlining it).</span></span><br><span class="line"><span class="comment"> * @offline:    Called to put the device offline for hot-removal. May fail.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @suspend:    Called when a device on this bus wants to go to sleep mode.</span></span><br><span class="line"><span class="comment"> * @resume:     Called to bring a device on this bus out of sleep mode.</span></span><br><span class="line"><span class="comment"> * @pm:         Power management operations of this bus, callback the specific</span></span><br><span class="line"><span class="comment"> *              device driver&#x27;s pm-ops.</span></span><br><span class="line"><span class="comment"> * @iommu_ops:  IOMMU specific operations for this bus, used to attach IOMMU</span></span><br><span class="line"><span class="comment"> *              driver implementations to a bus and allow the driver to do</span></span><br><span class="line"><span class="comment"> *              bus-specific setup</span></span><br><span class="line"><span class="comment"> * @p:          The private data of the driver core, only the driver core can</span></span><br><span class="line"><span class="comment"> *              touch this.</span></span><br><span class="line"><span class="comment"> * @lock_key:   Lock class key for use by the lock validator</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * A bus is a channel between the processor and one or more devices. For the</span></span><br><span class="line"><span class="comment"> * purposes of the device model, all devices are connected via a bus, even if</span></span><br><span class="line"><span class="comment"> * it is an internal, virtual, &quot;platform&quot; bus. Buses can plug into each other.</span></span><br><span class="line"><span class="comment"> * A USB controller is usually a PCI device, for example. The device model</span></span><br><span class="line"><span class="comment"> * represents the actual connections between buses and the devices they control.</span></span><br><span class="line"><span class="comment"> * A bus is represented by the bus_type structure. It contains the name, the</span></span><br><span class="line"><span class="comment"> * default attributes, the bus&#x27; methods, PM operations, and the driver core&#x27;s</span></span><br><span class="line"><span class="comment"> * private data.</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>
              </div>
            </details>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">bus_type</span> &#123;</span></span><br><span class="line">        <span class="type">const</span> <span class="type">char</span>              *name;</span><br><span class="line">        <span class="type">const</span> <span class="type">char</span>              *dev_name;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">device</span>           *<span class="title">dev_root</span>;</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">device_attribute</span> *<span class="title">dev_attrs</span>;</span>     <span class="comment">/* use dev_groups instead */</span></span><br><span class="line">        <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">attribute_group</span> **<span class="title">bus_groups</span>;</span></span><br><span class="line">        <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">attribute_group</span> **<span class="title">dev_groups</span>;</span></span><br><span class="line">        <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">attribute_group</span> **<span class="title">drv_groups</span>;</span></span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> (*match)(<span class="keyword">struct</span> device *dev, <span class="keyword">struct</span> device_driver *drv);</span><br><span class="line">        <span class="type">int</span> (*uevent)(<span class="keyword">struct</span> device *dev, <span class="keyword">struct</span> kobj_uevent_env *env);</span><br><span class="line">        <span class="type">int</span> (*probe)(<span class="keyword">struct</span> device *dev);</span><br><span class="line">        <span class="type">int</span> (*remove)(<span class="keyword">struct</span> device *dev);</span><br><span class="line">        <span class="type">void</span> (*shutdown)(<span class="keyword">struct</span> device *dev);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> (*online)(<span class="keyword">struct</span> device *dev);</span><br><span class="line">        <span class="type">int</span> (*offline)(<span class="keyword">struct</span> device *dev);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> (*suspend)(<span class="keyword">struct</span> device *dev, <span class="type">pm_message_t</span> state);</span><br><span class="line">        <span class="type">int</span> (*resume)(<span class="keyword">struct</span> device *dev);</span><br><span class="line"></span><br><span class="line">        <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">dev_pm_ops</span> *<span class="title">pm</span>;</span> </span><br><span class="line"></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">iommu_ops</span> *<span class="title">iommu_ops</span>;</span></span><br><span class="line"></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">subsys_private</span> *<span class="title">p</span>;</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">lock_class_key</span> <span class="title">lock_key</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>æˆå‘˜ä¸­<code>match</code>æŒ‡å‘çš„å‡½æ•°å¾ˆé‡è¦ï¼Œæ­¤å‡½æ•°æŒ‡é’ˆæŒ‡å‘çš„å‡½æ•°å°±æ˜¯å®Œæˆè®¾å¤‡å’Œé©±åŠ¨ä¹‹é—´åŒ¹é…çš„ï¼Œæ€»çº¿å°±æ˜¯ä½¿ç”¨<code>match</code>å‡½æ•°æ¥æ ¹æ®æ³¨å†Œçš„è®¾å¤‡æ¥æŸ¥æ‰¾å¯¹åº”çš„é©±åŠ¨ï¼Œæˆ–è€…æ ¹æ®æ³¨å†Œçš„é©±åŠ¨æ¥æŸ¥æ‰¾ç›¸åº”çš„è®¾å¤‡ï¼Œå› æ­¤<strong>æ¯ä¸€æ¡æ€»çº¿éƒ½å¿…é¡»å®ç°æ­¤å‡½æ•°</strong>ã€‚ <code>match</code> å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼š <code>dev</code> å’Œ <code>drv</code>ï¼Œè¿™ä¸¤ä¸ªå‚æ•°åˆ†åˆ«ä¸º <code>device</code> å’Œ <code>device_driver</code>ç±»å‹ï¼Œä¹Ÿå°±æ˜¯è®¾å¤‡å’Œé©±åŠ¨ã€‚  </p>
<h2 id="2-platformæ€»çº¿ç›¸å…³ç»“æ„ä½“"><a href="#2-platformæ€»çº¿ç›¸å…³ç»“æ„ä½“" class="headerlink" title="2.Â platformæ€»çº¿ç›¸å…³ç»“æ„ä½“"></a><font size=3>2.Â <code>platform</code>æ€»çº¿ç›¸å…³ç»“æ„ä½“</font></h2><h3 id="2-1-æ€»çº¿å®šä¹‰"><a href="#2-1-æ€»çº¿å®šä¹‰" class="headerlink" title="2.1 æ€»çº¿å®šä¹‰"></a><font size=3>2.1 æ€»çº¿å®šä¹‰</font></h3><p><code>platform</code> æ€»çº¿æ˜¯ <code>bus_type</code> çš„ä¸€ä¸ªå…·ä½“å®ä¾‹ï¼Œå®šä¹‰åœ¨<code>linux</code>å†…æ ¸æºç ä¸­çš„è¿™ä¸ªæ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drivers/base/platform.c</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ° <code>platform</code> æ€»çº¿å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">bus_type</span> <span class="title">platform_bus_type</span> =</span> &#123;</span><br><span class="line">        .name           = <span class="string">&quot;platform&quot;</span>,</span><br><span class="line">        .dev_groups     = platform_dev_groups,</span><br><span class="line">        .match          = platform_match,</span><br><span class="line">        .uevent         = platform_uevent,</span><br><span class="line">        .pm             = &amp;platform_dev_pm_ops,</span><br><span class="line">&#125;;</span><br><span class="line">EXPORT_SYMBOL_GPL(platform_bus_type);</span><br></pre></td></tr></table></figure>

<p>  å…¶ä¸­ï¼Œ<code>platform_match</code>å°±æ˜¯åŒ¹é…å‡½æ•°ã€‚</p>
<h3 id="2-2-åŒ¹é…å‡½æ•°"><a href="#2-2-åŒ¹é…å‡½æ•°" class="headerlink" title="2.2 åŒ¹é…å‡½æ•°"></a><font size=3>2.2 åŒ¹é…å‡½æ•°</font></h3><p><code>platform</code>åŒ¹é…å‡½æ•°å®šä¹‰åœ¨<code>linux</code>å†…æ ¸æºç çš„ä¸‹è¾¹è¿™ä¸ªæ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drivers/base/platform.c</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ‰“å¼€è¿™æ–‡ä»¶å¯ä»¥çœ‹åˆ°è¿™ä¸ªå‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * platform_match - bind platform device to platform driver.</span></span><br><span class="line"><span class="comment"> * @dev: device.</span></span><br><span class="line"><span class="comment"> * @drv: driver.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Platform device IDs are assumed to be encoded like this:</span></span><br><span class="line"><span class="comment"> * &quot;&lt;name&gt;&lt;instance&gt;&quot;, where &lt;name&gt; is a short description of the type of</span></span><br><span class="line"><span class="comment"> * device, like &quot;pci&quot; or &quot;floppy&quot;, and &lt;instance&gt; is the enumerated</span></span><br><span class="line"><span class="comment"> * instance of the device, like &#x27;0&#x27; or &#x27;42&#x27;.  Driver IDs are simply</span></span><br><span class="line"><span class="comment"> * &quot;&lt;name&gt;&quot;.  So, extract the &lt;name&gt; from the platform_device structure,</span></span><br><span class="line"><span class="comment"> * and compare it against the name of the driver. Return whether they match</span></span><br><span class="line"><span class="comment"> * or not.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">platform_match</span><span class="params">(<span class="keyword">struct</span> device *dev, <span class="keyword">struct</span> device_driver *drv)</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">platform_device</span> *<span class="title">pdev</span> =</span> to_platform_device(dev);</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">platform_driver</span> *<span class="title">pdrv</span> =</span> to_platform_driver(drv);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Attempt an OF style match first */</span></span><br><span class="line">        <span class="keyword">if</span> (of_driver_match_device(dev, drv))</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Then try ACPI style match */</span></span><br><span class="line">        <span class="keyword">if</span> (acpi_driver_match_device(dev, drv))</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Then try to match against the id table */</span></span><br><span class="line">        <span class="keyword">if</span> (pdrv-&gt;id_table)</span><br><span class="line">                <span class="keyword">return</span> platform_match_id(pdrv-&gt;id_table, pdev) != <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* fall-back to driver name match */</span></span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">strcmp</span>(pdev-&gt;name, drv-&gt;name) == <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä»å‡½æ•°è§†å®ç°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé©±åŠ¨å’Œè®¾å¤‡çš„åŒ¹é…æœ‰å››ç§æ–¹æ³•  ï¼š</p>
<ul>
<li><code>OF</code> ç±»å‹çš„åŒ¹é…ï¼Œä¹Ÿå°±æ˜¯è®¾å¤‡æ ‘é‡‡ç”¨çš„åŒ¹é…æ–¹å¼</li>
</ul>
<p><code>of_driver_match_device</code>å‡½æ•°å®šä¹‰åœ¨<code>linux</code>å†…æ ¸æºç çš„ä¸‹è¾¹è¿™ä¸ªæ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include/linux/of_device.h</span><br></pre></td></tr></table></figure>

<p><code>device_driver</code> ç»“æ„ä½“ï¼ˆè¡¨ç¤ºè®¾å¤‡é©±åŠ¨ï¼‰ä¸­æœ‰ä¸ªåä¸º<code>of_match_table</code>çš„æˆå‘˜å˜é‡ï¼Œæ­¤æˆå‘˜å˜é‡ä¿å­˜ç€é©±åŠ¨çš„<code>compatible</code>åŒ¹é…è¡¨ï¼Œè®¾å¤‡æ ‘ä¸­çš„æ¯ä¸ªè®¾å¤‡èŠ‚ç‚¹çš„<code>compatible</code>å±æ€§ä¼šå’Œ<code>of_match_table</code>è¡¨ä¸­çš„æ‰€æœ‰æˆå‘˜æ¯”è¾ƒï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰ç›¸åŒçš„æ¡ç›®ï¼Œå¦‚æœæœ‰çš„è¯å°±è¡¨ç¤ºè®¾å¤‡å’Œæ­¤é©±åŠ¨åŒ¹é…ï¼Œè®¾å¤‡å’Œé©±åŠ¨åŒ¹é…æˆåŠŸä»¥å <code>probe</code> å‡½æ•°å°±ä¼šæ‰§è¡Œã€‚ </p>
<ul>
<li><code>ACPI</code> åŒ¹é…æ–¹å¼</li>
</ul>
<p><code>Advanced Configuration and Power Management Interface</code> é«˜çº§é…ç½®å’Œç”µæºç®¡ç†æ¥å£ï¼Œæ˜¯<code>PC</code>æœºå¹³å°é‡‡ç”¨çš„ä¸€ç§ç¡¬ä»¶é…ç½®æ¥å£æ²¡æ€ä¹ˆä½¿ç”¨è¿‡ï¼Œåç»­ä½¿ç”¨äº†å†è¡¥å……ç¬”è®°ã€‚</p>
<ul>
<li><code>id_table</code> åŒ¹é…</li>
</ul>
<p>æ¯ä¸ª <code>platform_driver</code> ç»“æ„ä½“æœ‰ä¸€ä¸ª<code>id_table</code>æˆå‘˜å˜é‡ï¼Œå®ƒé‡Œè¾¹ä¿å­˜äº†å¾ˆå¤š<code>id</code>ä¿¡æ¯ã€‚è¿™äº›<code>id</code>ä¿¡æ¯å­˜æ”¾ç€è¿™ä¸ª<code> platform</code>é©±åŠ¨æ‰€æ”¯æŒçš„é©±åŠ¨ç±»å‹ã€‚  </p>
<ul>
<li>åç§°åŒ¹é…</li>
</ul>
<p>è¿™æ˜¯ç¬¬å››ç§åŒ¹é…æ–¹å¼ï¼Œå¦‚æœç¬¬ä¸‰ç§åŒ¹é…æ–¹å¼çš„ <code>id_table</code> ä¸å­˜åœ¨çš„è¯å°±ç›´æ¥æ¯”è¾ƒé©±åŠ¨å’Œè®¾å¤‡çš„ <code>name</code> å­—æ®µï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰çš„è¯å°±åŒ¹é…æˆåŠŸã€‚  </p>
<p>å¯¹äºæ”¯æŒè®¾å¤‡æ ‘çš„<code> Linux</code> ç‰ˆæœ¬å·ï¼Œä¸€èˆ¬è®¾å¤‡é©±åŠ¨ä¸ºäº†å…¼å®¹æ€§éƒ½æ”¯æŒè®¾å¤‡æ ‘å’Œæ— è®¾å¤‡æ ‘ä¸¤ç§åŒ¹é…æ–¹å¼ã€‚ä¹Ÿå°±æ˜¯ç¬¬ä¸€ç§åŒ¹é…æ–¹å¼ä¸€èˆ¬éƒ½ä¼šå­˜åœ¨ï¼Œç¬¬ä¸‰ç§å’Œç¬¬å››ç§åªè¦å­˜åœ¨ä¸€ç§å°±å¯ä»¥ï¼Œä¸€èˆ¬ç”¨çš„æœ€å¤šçš„è¿˜æ˜¯ç¬¬å››ç§ï¼Œæ¯•ç«Ÿåç§°åŒ¹é…æ˜¯æœ€ç®€å•çš„ã€‚ </p>
<blockquote>
<p>ã€åŒ¹é…ä¼˜å…ˆçº§ã€‘</p>
<p>ä»åŒ¹é…å‡½æ•°ä¸­å¯ä»¥çœ‹å‡ºï¼Œä¸è€ƒè™‘ç¬¬äºŒç§<code>ACPI</code>åŒ¹é…æ–¹å¼çš„æƒ…å†µä¸‹ï¼ŒåŒ¹é…çš„ä¼˜å…ˆçº§ä¸ºï¼š</p>
<p>è®¾å¤‡æ ‘åŒ¹é… &gt; IDåŒ¹é… &gt; åç§°åŒ¹é…</p>
</blockquote>
<h2 id="3-platformé©±åŠ¨ç›¸å…³ç»“æ„ä½“"><a href="#3-platformé©±åŠ¨ç›¸å…³ç»“æ„ä½“" class="headerlink" title="3.Â platformé©±åŠ¨ç›¸å…³ç»“æ„ä½“"></a><font size=3>3.Â <code>platform</code>é©±åŠ¨ç›¸å…³ç»“æ„ä½“</font></h2><h3 id="3-1-struct-platform-driver"><a href="#3-1-struct-platform-driver" class="headerlink" title="3.1Â struct platform_driver"></a><font size=3>3.1Â <code>struct platform_driver</code></font></h3><p><code>platform_driver</code>ç»“æ„ä½“è¡¨ç¤º<code>platform</code>é©±åŠ¨ï¼Œè¿™ä¸ªç»“æ„ä½“å®šä¹‰åœ¨<code>linux</code>å†…æ ¸æºç çš„è¿™ä¸ªæ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include/linux/platform_device.h </span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªç»“æ„ä½“åŠå…¶æˆå‘˜å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">platform_driver</span> &#123;</span></span><br><span class="line">        <span class="type">int</span> (*probe)(<span class="keyword">struct</span> platform_device *);</span><br><span class="line">        <span class="type">int</span> (*remove)(<span class="keyword">struct</span> platform_device *);</span><br><span class="line">        <span class="type">void</span> (*shutdown)(<span class="keyword">struct</span> platform_device *);</span><br><span class="line">        <span class="type">int</span> (*suspend)(<span class="keyword">struct</span> platform_device *, <span class="type">pm_message_t</span> state);</span><br><span class="line">        <span class="type">int</span> (*resume)(<span class="keyword">struct</span> platform_device *);</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">device_driver</span> <span class="title">driver</span>;</span></span><br><span class="line">        <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">platform_device_id</span> *<span class="title">id_table</span>;</span></span><br><span class="line">        <span class="type">bool</span> prevent_deferred_probe;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>ã€æˆå‘˜è¯´æ˜ã€‘</strong></p>
<ul>
<li><code>probe</code>ï¼šå‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘ä¸€ä¸ª<code>probe</code> å‡½æ•°ï¼Œå½“é©±åŠ¨ä¸è®¾å¤‡åŒ¹é…æˆåŠŸä»¥å <code>probe</code> å‡½æ•°å°±ä¼šæ‰§è¡Œï¼Œä¸€èˆ¬é©±åŠ¨çš„æä¾›è€…ä¼šç¼–å†™ï¼Œå¦‚æœè‡ªå·±è¦ç¼–å†™ä¸€ä¸ªå…¨æ–°çš„é©±åŠ¨ï¼Œé‚£ä¹ˆ<code>probe</code> å°±éœ€è¦è‡ªè¡Œå®ç°ã€‚  </li>
<li><code>remove</code>ï¼šå‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘ä¸€ä¸ª<code>remove</code>å‡½æ•°ï¼Œè®¾å¤‡å¸è½½äº†çš„æ—¶å€™ä¼šè°ƒç”¨è¯¥å‡½æ•°ã€‚</li>
<li><code>driver</code>ï¼š<code> struct device_driver</code>ç±»å‹ï¼ˆåè¾¹ä¼šä»‹ç»è¯¥ç»“æ„ä½“ï¼‰ï¼Œ<code>Linux</code> å†…æ ¸é‡Œé¢å¤§é‡ä½¿ç”¨åˆ°äº†é¢å‘å¯¹è±¡çš„æ€ç»´ï¼Œ <code>device_driver</code> ç›¸å½“äºåŸºç±»ï¼Œæä¾›äº†æœ€åŸºç¡€çš„é©±åŠ¨æ¡†æ¶ã€‚ <code>plaform_driver</code> ç»§æ‰¿äº†è¿™ä¸ªåŸºç±»ï¼Œç„¶ååœ¨æ­¤åŸºç¡€ä¸Šåˆæ·»åŠ äº†ä¸€äº›ç‰¹æœ‰çš„æˆå‘˜å˜é‡ã€‚<strong>å†…æ ¸é‡Œæ‰€æœ‰çš„é©±åŠ¨å¿…é¡»åŒ…å«è¯¥ç»“æ„ä½“</strong>ã€‚  </li>
<li><code>id_table</code>ï¼š<code>struct platform_device_id *</code>ç±»å‹ï¼ˆåä¾¿ä¼šä»‹ç»è¯¥ç»“æ„ä½“ï¼‰ï¼ŒæŒ‡å‘<code>id_table</code> è¡¨ï¼Œ<code>platform</code> æ€»çº¿åŒ¹é…é©±åŠ¨å’Œè®¾å¤‡çš„æ—¶å€™é‡‡ç”¨çš„ç¬¬ä¸‰ç§æ–¹æ³•ï¼Œ <code>id_table</code> æ˜¯ä¸ªè¡¨(ä¹Ÿå°±æ˜¯æ•°ç»„)ï¼Œæ¯ä¸ªå…ƒç´ çš„ç±»å‹ä¸º <code>platform_device_id</code>ã€‚</li>
</ul>
<p><strong>ã€å®šä¹‰å®ä¾‹ã€‘</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** å®šä¹‰platformå¹³å°é©±åŠ¨ */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">platform_driver</span> <span class="title">hello_driver</span> =</span> &#123;</span><br><span class="line">    .driver = &#123;</span><br><span class="line">        .name = MODULE_NAME,       <span class="comment">/* å¿…é¡»åˆå§‹åŒ– name æˆå‘˜ */</span></span><br><span class="line">    &#125;,</span><br><span class="line">    .probe = hello_driver_probe,   <span class="comment">/* è®¾å¤‡å’Œé©±åŠ¨åŒ¹é…æˆåŠŸä¹‹åçš„è°ƒç”¨å‡½æ•° */</span></span><br><span class="line">    .remove = hello_driver_remove, <span class="comment">/* å¸è½½è®¾å¤‡ */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h3 id="3-2-struct-device-driver"><a href="#3-2-struct-device-driver" class="headerlink" title="3.2Â struct device_driver"></a><font size=3>3.2Â <code>struct device_driver</code></font></h3><p><code>device_driver</code>ç»“æ„ä½“å®šä¹‰åœ¨<code>linux</code>å†…æ ¸æºç çš„è¿™ä¸ªæ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include/linux/device.h</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªç»“æ„ä½“å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">device_driver</span> &#123;</span></span><br><span class="line">        <span class="type">const</span> <span class="type">char</span>              *name;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">bus_type</span>         *<span class="title">bus</span>;</span></span><br><span class="line"></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">module</span>           *<span class="title">owner</span>;</span></span><br><span class="line">        <span class="type">const</span> <span class="type">char</span>              *mod_name;      <span class="comment">/* used for built-in modules */</span></span><br><span class="line"></span><br><span class="line">        <span class="type">bool</span> suppress_bind_attrs;       <span class="comment">/* disables bind/unbind via sysfs */</span></span><br><span class="line"></span><br><span class="line">        <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">of_device_id</span>       *<span class="title">of_match_table</span>;</span></span><br><span class="line">        <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">acpi_device_id</span>     *<span class="title">acpi_match_table</span>;</span></span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> (*probe) (<span class="keyword">struct</span> device *dev);</span><br><span class="line">        <span class="type">int</span> (*remove) (<span class="keyword">struct</span> device *dev);</span><br><span class="line">        <span class="type">void</span> (*shutdown) (<span class="keyword">struct</span> device *dev);</span><br><span class="line">        <span class="type">int</span> (*suspend) (<span class="keyword">struct</span> device *dev, <span class="type">pm_message_t</span> state);</span><br><span class="line">        <span class="type">int</span> (*resume) (<span class="keyword">struct</span> device *dev);</span><br><span class="line">        <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">attribute_group</span> **<span class="title">groups</span>;</span></span><br><span class="line"></span><br><span class="line">        <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">dev_pm_ops</span> *<span class="title">pm</span>;</span> </span><br><span class="line"></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">driver_private</span> *<span class="title">p</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>ã€æˆå‘˜è¯´æ˜ã€‘</strong></p>
<ul>
<li><code>name</code>ï¼š<code>char *</code>ç±»å‹ï¼Œé©±åŠ¨åç§°ï¼Œä½¿ç”¨åç§°åŒ¹é…çš„æ—¶å€™åŒ¹é…<code>device</code>ç”¨ï¼Œæœ€åä¸€ä¸ªæˆå‘˜æ˜¯<strong>å¿…é¡»è¦åˆå§‹åŒ–</strong>çš„ã€‚</li>
<li><code>bus</code>ï¼š<code>struct bus_type *</code>ç±»å‹ï¼Œæ€»çº¿ç±»å‹ã€‚</li>
<li><code>owner</code>ï¼š<code>struct module *</code>ç±»å‹ï¼Œä¸€èˆ¬å¡«<code>THIS_MODULE</code>ã€‚</li>
<li><code>of_match_table</code>ï¼š<code>struct of_device_id *</code>ç±»å‹ï¼ˆåè¾¹ä¼šä»‹ç»ï¼‰ï¼Œç”¨äºè®¾å¤‡æ ‘åŒ¹é… <code>of_match_ptr</code>(æŸ<code>struct of_device_id</code>å¯¹è±¡åœ°å€) ã€‚<code>of_match_table</code> å°±æ˜¯é‡‡ç”¨è®¾å¤‡æ ‘çš„æ—¶å€™é©±åŠ¨ä½¿ç”¨çš„åŒ¹é…è¡¨ï¼ŒåŒæ ·æ˜¯æ•°ç»„ï¼Œæ¯ä¸ªåŒ¹é…é¡¹éƒ½ä¸º <code>of_device_id</code> ç»“æ„ä½“ç±»å‹ã€‚</li>
</ul>
<h3 id="3-3-struct-platform-device-id"><a href="#3-3-struct-platform-device-id" class="headerlink" title="3.3Â struct platform_device_id"></a><font size=3>3.3Â <code>struct platform_device_id</code></font></h3><p>åœ¨ä½¿ç”¨<code>ID</code>åŒ¹é…çš„æ—¶å€™ï¼Œè¿™ä¸ªç»“æ„ä½“ç±»å‹åœ¨è®¾å¤‡å’Œé©±åŠ¨ä¸­éƒ½ä¼šç”¨åˆ°ã€‚åœ¨é©±åŠ¨ä¸­ï¼Œéœ€è¦ç”¨è¯¥ç»“æ„ä½“å¯¹è±¡å®šä¹‰ä¸€ä¸ªç»“æ„ä½“æ•°ç»„ï¼Œè€Œåœ¨é©±åŠ¨ä¸­ï¼Œåªéœ€è¦å®šä¹‰ä¸€ä¸ªå˜é‡å³å¯ã€‚è¿™ä¸ªç»“æ„ä½“å®šä¹‰åœ¨<code>linux</code>å†…æ ¸æºç çš„ä¸‹è¾¹è¿™ä¸ªæ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include/linux/mod_devicetable.h</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œä¼šçœ‹åˆ°è¿™ä¸ªç»“æ„ä½“å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> PLATFORM_NAME_SIZE      20</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PLATFORM_MODULE_PREFIX  <span class="string">&quot;platform:&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">platform_device_id</span> &#123;</span></span><br><span class="line">        <span class="type">char</span> name[PLATFORM_NAME_SIZE];</span><br><span class="line">        <span class="type">kernel_ulong_t</span> driver_data;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>ã€æˆå‘˜è¯´æ˜ã€‘</strong></p>
<ul>
<li><code>name</code>ï¼š<code>char</code>ç±»å‹ï¼Œè¡¨ç¤ºåŒ¹é…ç”¨çš„åç§°ï¼ˆæŒ‰æˆ‘è‡ªå·±çš„ç†è§£è¿™ä¸ªåç§°å°±æ˜¯åŒ¹é…çš„æ—¶å€™ç”¨çš„<code>ID</code>ï¼‰ã€‚</li>
<li><code>driver_data</code>ï¼š<code>kernel_ulong_t</code>ç±»å‹ï¼Œéœ€è¦å‘é©±åŠ¨ä¼ è¾“çš„å…¶å®ƒæ•°æ®ã€‚</li>
</ul>
<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong>ä¸€èˆ¬æ˜¯å®šä¹‰åœ¨é©±åŠ¨ä¸­ï¼Œå®šä¹‰çš„æ˜¯ä¸€ä¸ªç»“æ„ä½“æ•°ç»„ï¼Œä¸€èˆ¬ä¸æŒ‡å®šå¤§å°ï¼Œåˆå§‹åŒ–æ—¶æœ€ååŠ <code>&#123;&#125;</code>è¡¨ç¤ºæ•°ç»„ç»“æŸï¼Œåœ¨è®¾å¤‡ç¨‹åºä¸­åªéœ€è¦å®šä¹‰ä¸€ä¸ªå˜é‡å³å¯ã€‚</p>
<p><strong>ã€å®šä¹‰å®ä¾‹ã€‘</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> *  å®šä¹‰åŒ¹é…IDæ•°ç»„ </span></span><br><span class="line"><span class="comment"> *  ä¸æ•°ç»„ä¸­å«æœ‰çš„åç§°ç›¸åŒçš„è®¾å¤‡éƒ½å¯ä»¥åŒ¹é…åˆ°è¯¥é©±åŠ¨</span></span><br><span class="line"><span class="comment"> *  ç»“æ„ä½“å˜é‡åèµ‹å€¼ç»™ struct platform_driver ç»“æ„ä½“çš„ .id_table æˆå‘˜</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">platform_device_id</span> <span class="title">hello_driver_ids</span>[] =</span> </span><br><span class="line">&#123;</span><br><span class="line">	[<span class="number">0</span>] = &#123;.name = <span class="string">&quot;hello_dev&quot;</span>&#125;,</span><br><span class="line">	[<span class="number">1</span>] = &#123;.name = <span class="string">&quot;a&quot;</span>&#125;,</span><br><span class="line">	[<span class="number">2</span>] = &#123;&#125;                   <span class="comment">/* means ending */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h3 id="3-4-struct-of-device-id"><a href="#3-4-struct-of-device-id" class="headerlink" title="3.4Â struct of_device_id"></a><font size=3>3.4Â <code>struct of_device_id</code></font></h3><p>ä¸Šè¾¹æåˆ°<code>of_match_table</code> å°±æ˜¯é‡‡ç”¨è®¾å¤‡æ ‘çš„æ—¶å€™é©±åŠ¨ä½¿ç”¨çš„åŒ¹é…è¡¨ï¼ŒåŒæ ·æ˜¯æ•°ç»„ï¼Œæ¯ä¸ªåŒ¹é…é¡¹éƒ½ä¸º<code>of_device_id</code>ç»“æ„ä½“ç±»å‹ï¼Œæ­¤ç»“æ„ä½“å®šä¹‰åœ¨<code>linux</code>å†…æ ¸æºç çš„è¿™ä¸ªæ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include/linux/mod_devicetable.h</span><br></pre></td></tr></table></figure>

<p>  æˆ‘ä»¬æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°è¿™ç»“æ„ä½“å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Struct used for matching a device</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">of_device_id</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">        <span class="type">char</span>    name[<span class="number">32</span>];</span><br><span class="line">        <span class="type">char</span>    type[<span class="number">32</span>];</span><br><span class="line">        <span class="type">char</span>    compatible[<span class="number">128</span>];</span><br><span class="line">        <span class="type">const</span> <span class="type">void</span> *data;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>ã€æˆå‘˜è¯´æ˜ã€‘</strong></p>
<ul>
<li><code>name</code>ï¼š<code>char</code>ç±»å‹æ•°ç»„ï¼Œè®¾å¤‡åã€‚</li>
<li><code>type</code>ï¼š<code>char</code>ç±»å‹æ•°ç»„ï¼Œè®¾å¤‡ç±»å‹ã€‚</li>
<li><code>compatible</code>ï¼š<code>char</code>ç±»å‹æ•°ç»„ï¼Œå¯¹äºè®¾å¤‡æ ‘è€Œè¨€ï¼Œé€šè¿‡è®¾å¤‡èŠ‚ç‚¹çš„ <code>compatible</code> å±æ€§å€¼å’Œ <code>of_match_table</code> ä¸­æ¯ä¸ªé¡¹ç›®çš„ <code>compatible</code> æˆå‘˜å˜é‡è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæœ‰ç›¸ç­‰çš„å°±è¡¨ç¤ºè®¾å¤‡å’Œæ­¤é©±åŠ¨åŒ¹é…æˆåŠŸã€‚</li>
</ul>
<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong>ä¸€èˆ¬æ˜¯å®šä¹‰åœ¨é©±åŠ¨ä¸­ï¼Œå®šä¹‰çš„æ˜¯ä¸€ä¸ªç»“æ„ä½“æ•°ç»„ï¼Œä¸€èˆ¬ä¸æŒ‡å®šå¤§å°ï¼Œåˆå§‹åŒ–æ—¶æœ€ååŠ <code>&#123;&#125;</code>è¡¨ç¤ºæ•°ç»„ç»“æŸã€‚</p>
<p><strong>ã€å®šä¹‰å®ä¾‹ã€‘</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> *  å®šä¹‰åŒ¹é…è®¾å¤‡æ ‘æ•°ç»„</span></span><br><span class="line"><span class="comment"> *  ä¸æ•°ç»„ä¸­å«æœ‰çš„åç§°ç›¸åŒçš„è®¾å¤‡éƒ½å¯ä»¥åŒ¹é…åˆ°è¯¥é©±åŠ¨</span></span><br><span class="line"><span class="comment"> *  ç»“æ„ä½“å˜é‡åèµ‹å€¼ç»™ struct platform_driver ç»“æ„ä½“çš„ .driver.of_match_table æˆå‘˜</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">of_device_id</span> <span class="title">hello_driver_dt_ids</span>[] =</span> &#123;</span><br><span class="line">    [<span class="number">0</span>] = &#123;.compatible = <span class="string">&quot;fs4412,hello-dt&quot;</span>&#125;,  <span class="comment">/* è®¾å¤‡æ ‘ä¸­ compatible çš„åç§° */</span></span><br><span class="line">    [<span class="number">1</span>] = &#123;.compatible = <span class="string">&quot;origen4412,hello-dt&quot;</span>&#125;,</span><br><span class="line">    [<span class="number">2</span>] = &#123;&#125;                               <span class="comment">/* means ending */</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** å®šä¹‰platformå¹³å°é©±åŠ¨ */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">platform_driver</span> <span class="title">hello_driver</span> =</span> &#123;</span><br><span class="line">    .driver = &#123;</span><br><span class="line">        .name = MODULE_NAME,       <span class="comment">/* å¿…é¡»åˆå§‹åŒ– name æˆå‘˜ */</span></span><br><span class="line">        .of_match_table = hello_driver_dt_ids,</span><br><span class="line">    &#125;,</span><br><span class="line">    .probe = hello_driver_probe,   <span class="comment">/* è®¾å¤‡å’Œé©±åŠ¨åŒ¹é…æˆåŠŸä¹‹åçš„è°ƒç”¨å‡½æ•° */</span></span><br><span class="line">    .remove = hello_driver_remove, <span class="comment">/* å¸è½½è®¾å¤‡ */</span></span><br><span class="line">    <span class="comment">// .id_table = hello_driver_ids,  /* å¯åŒ¹é…çš„è®¾å¤‡IDæ•°ç»„ */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="4-platformè®¾å¤‡ç›¸å…³ç»“æ„ä½“"><a href="#4-platformè®¾å¤‡ç›¸å…³ç»“æ„ä½“" class="headerlink" title="4.Â platformè®¾å¤‡ç›¸å…³ç»“æ„ä½“"></a><font size=3>4.Â <code>platform</code>è®¾å¤‡ç›¸å…³ç»“æ„ä½“</font></h2><h3 id="4-1-struct-platform-device"><a href="#4-1-struct-platform-device" class="headerlink" title="4.1Â struct platform_device"></a><font size=3>4.1Â <code>struct platform_device</code></font></h3><p><code>platform_device</code> è¿™ä¸ªç»“æ„ä½“è¡¨ç¤º <code>platform</code> è®¾å¤‡ï¼Œè¦æ³¨æ„ï¼Œå¦‚æœå†…æ ¸æ”¯æŒè®¾å¤‡æ ‘çš„è¯å°±ä¸è¦å†ä½¿ç”¨<code>platform_device</code>æ¥æè¿°è®¾å¤‡äº†ï¼Œå› ä¸ºæ”¹ç”¨è®¾å¤‡æ ‘å»æè¿°äº†ã€‚å½“ç„¶äº†ï¼Œå¦‚æœä¸€å®šè¦ç”¨<code>platform_device</code>æ¥æè¿°è®¾å¤‡ä¿¡æ¯çš„è¯ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚è¿™ä¸ªç»“æ„ä½“å®šä¹‰åœ¨<code>linux</code>å†…æ ¸æºç çš„è¿™ä¸ªæ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include/linux/platform_device.h</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°ç»“æ„ä½“å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">platform_device</span> &#123;</span></span><br><span class="line">        <span class="type">const</span> <span class="type">char</span>      *name;</span><br><span class="line">        <span class="type">int</span>             id;</span><br><span class="line">        <span class="type">bool</span>            id_auto;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">device</span>   <span class="title">dev</span>;</span></span><br><span class="line">        u32             num_resources;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">resource</span> *<span class="title">resource</span>;</span></span><br><span class="line"></span><br><span class="line">        <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">platform_device_id</span> *<span class="title">id_entry</span>;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/* MFD cell pointer */</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">mfd_cell</span> *<span class="title">mfd_cell</span>;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/* arch specific additions */</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">pdev_archdata</span>    <span class="title">archdata</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>ã€æˆå‘˜è¯´æ˜ã€‘</strong></p>
<ul>
<li><p><code>name</code>ï¼š<code>char *</code>ç±»å‹ï¼Œ è¡¨ç¤ºè®¾å¤‡åå­—ï¼Œè¦å’Œæ‰€ä½¿ç”¨çš„ <code>platform</code> é©±åŠ¨çš„ <code>name</code> å­—æ®µç›¸åŒï¼Œå¦åˆ™çš„è¯è®¾å¤‡å°±æ— æ³•åŒ¹é…åˆ°å¯¹åº”çš„é©±åŠ¨ã€‚æ¯”å¦‚å¯¹åº”çš„ <code>platform</code> é©±åŠ¨çš„ <code>name</code> å­—æ®µä¸º<code>xxx-gpio</code>ï¼Œé‚£ä¹ˆæ­¤ <code>name</code>å­—æ®µä¹Ÿè¦è®¾ç½®ä¸º<code>xxx-gpio</code>ã€‚  <strong>å¿…é¡»è¦è¿›è¡Œåˆå§‹åŒ–</strong>ã€‚</p>
</li>
<li><p><code>id</code>ï¼š<code>int</code>ç±»å‹ï¼Œè®¾å¤‡<code>id</code>ï¼Œç”¨äºåœ¨è¯¥æ€»çº¿ä¸ŠåŒåçš„è®¾å¤‡è¿›è¡Œç¼–å·ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªè®¾å¤‡ï¼Œåˆ™ä¸º<code>-1</code>ã€‚</p>
</li>
<li><p><code>dev</code>ï¼š<code>struct device</code>ç±»å‹ï¼ˆåè¾¹ä¼šè¯´æ˜ï¼‰ï¼Œè®¾å¤‡æ¨¡å—å¿…é¡»åŒ…å«è¯¥ç»“æ„ä½“ã€‚</p>
</li>
<li><p><code>num_resources</code>ï¼š<code>u32</code>ç±»å‹ï¼Œè¡¨ç¤ºèµ„æºæ•°é‡ï¼Œä¸€èˆ¬ä¸º<code>resource</code>æˆå‘˜ï¼ˆä¸€èˆ¬æ˜¯ä¸€ä¸ªæ•°ç»„ï¼‰èµ„æºçš„ä¸ªæ•° ã€‚</p>
</li>
<li><p><code>resource</code>ï¼š<code>struct resource *</code>ç±»å‹ï¼ˆåè¾¹ä¼šè¯´æ˜ï¼‰ï¼ŒæŒ‡å‘èµ„æºæ•°ç»„ï¼Œè¡¨ç¤ºèµ„æºï¼Œä¹Ÿå°±æ˜¯è®¾å¤‡ä¿¡æ¯ï¼Œæ¯”å¦‚å¤–è®¾å¯„å­˜å™¨ç­‰ã€‚</p>
</li>
</ul>
<p><strong>ã€å®šä¹‰å®ä¾‹ã€‘</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** å®šä¹‰platformå¹³å°è®¾å¤‡ */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">platform_device</span> <span class="title">hello_device</span> =</span> &#123;</span><br><span class="line">    .name = MODULE_NAME,                 <span class="comment">/* å¿…é¡»åˆå§‹åŒ– name æˆå‘˜ */</span></span><br><span class="line">    .dev.release = hello_device_release, <span class="comment">/* åˆ é™¤è®¾å¤‡ */</span></span><br><span class="line">    .resource = hello_device_res,        <span class="comment">/* èµ„æºæ•°ç»„ */</span></span><br><span class="line">    .num_resources = ARRAY_SIZE(hello_device_res), <span class="comment">/* èµ„æºæ•°ç»„å…ƒç´ ä¸ªæ•° */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h3 id="4-2-struct-device"><a href="#4-2-struct-device" class="headerlink" title="4.2Â struct device"></a><font size=3>4.2Â <code>struct device</code></font></h3><p><code>device</code>ç»“æ„ä½“å®šä¹‰åœ¨<code>linux</code>å†…æ ¸æºç çš„è¿™ä¸ªæ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include/linux/device.h</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªç»“æ„ä½“å®šä¹‰å¦‚ä¸‹ï¼ˆæˆå‘˜å¾ˆå¤šï¼Œè¿™é‡Œåªå†™äº†å‡ ä¸ªå¯èƒ½ç”¨åˆ°çš„ï¼‰ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">device</span> &#123;</span></span><br><span class="line">    <span class="comment">//... ...</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">bus_type</span>	*<span class="title">bus</span>;</span>		  <span class="comment">/* type of bus device is on */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">device_driver</span> *<span class="title">driver</span>;</span> <span class="comment">/* which driver has allocated this device */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">device_node</span>	*<span class="title">of_node</span>;</span> <span class="comment">/* associated device tree node */</span></span><br><span class="line">    <span class="type">dev_t</span>			devt;	      <span class="comment">/* dev_t, creates the sysfs &quot;dev&quot; */</span></span><br><span class="line">	<span class="type">void</span>	(*release)(<span class="keyword">struct</span> device *dev);</span><br><span class="line">    <span class="comment">// ... ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>ã€æˆå‘˜è¯´æ˜ã€‘</strong></p>
<ul>
<li><code>bus</code>ï¼š<code>struct bus_type *</code>ç±»å‹ï¼Œæ€»çº¿ç±»å‹ã€‚</li>
<li><code>devt</code>ï¼š<code>dev_t</code>ç±»å‹ï¼Œè¡¨ç¤ºè®¾å¤‡å·ã€‚</li>
<li><code>driver</code>ï¼š<code>struct device_driver *</code>ç±»å‹ï¼Œè®¾å¤‡é©±åŠ¨ã€‚</li>
<li><code>of_node</code>ï¼š<code>struct device_node *</code>ç±»å‹ï¼Œé©±åŠ¨å’Œè®¾å¤‡åŒ¹é…æˆåŠŸåï¼Œè¿™é‡Œå°†æŒ‡å‘åŒ¹é…æˆåŠŸçš„è®¾å¤‡åœ¨è®¾å¤‡æ ‘ä¸­çš„èŠ‚ç‚¹çœå»è·å–èŠ‚ç‚¹çš„è¿‡ç¨‹ã€‚</li>
<li><code>release</code>ï¼šå‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘ä¸€ä¸ªåˆ é™¤è®¾å¤‡å‡½æ•°ã€‚</li>
</ul>
<p><strong>ã€ä½¿ç”¨å®ä¾‹ã€‘</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">hello_driver_probe</span><span class="params">(<span class="keyword">struct</span> platform_device *p_pltdev)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* 0.ç›¸å…³å˜é‡å®šä¹‰ */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">device_node</span> *<span class="title">pnode</span> =</span> <span class="literal">NULL</span>; <span class="comment">/* å­˜å‚¨è®¾å¤‡æ ‘èŠ‚ç‚¹ */</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *str = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="comment">/* 1.è·å–è®¾å¤‡æ ‘èŠ‚ç‚¹ */</span></span><br><span class="line">    pnode = p_pltdev-&gt;dev.of_node;</span><br><span class="line">    <span class="comment">/* 2.è·å–è®¾å¤‡æ ‘regæ•°æ® */</span></span><br><span class="line">    printk(<span class="string">&quot;=====================================================\n&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(of_property_read_string(pnode, <span class="string">&quot;my-name&quot;</span>, &amp;str) &lt; <span class="number">0</span>)</span><br><span class="line">        printk(<span class="string">&quot;of_property_read_string failed!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        printk(<span class="string">&quot;name=%s\n&quot;</span>, str);</span><br><span class="line">    printk(<span class="string">&quot;=====================================================\n&quot;</span>);</span><br><span class="line">    <span class="comment">/* æ‰“å°æç¤ºä¿¡æ¯ */</span></span><br><span class="line">    printk(<span class="string">&quot;[INFO]hello_driver_probe is called!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-3-struct-resource"><a href="#4-3-struct-resource" class="headerlink" title="4.3Â struct resource"></a><font size=3>4.3Â <code>struct resource</code></font></h3><p><code>Linux</code> å†…æ ¸ä½¿ç”¨ <code>resource</code>ç»“æ„ä½“è¡¨ç¤ºèµ„æº ï¼Œè¯¥ç»“æ„ä½“å®šä¹‰åœ¨<code>linux</code>å†…æ ¸æºç çš„è¿™ä¸ªæ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include/linux/ioport.h</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°ç»“æ„ä½“å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Resources are tree-like, allowing</span></span><br><span class="line"><span class="comment"> * nesting etc..</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">resource</span> &#123;</span></span><br><span class="line">        <span class="type">resource_size_t</span> start;</span><br><span class="line">        <span class="type">resource_size_t</span> end;</span><br><span class="line">        <span class="type">const</span> <span class="type">char</span> *name;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">long</span> flags;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">resource</span> *<span class="title">parent</span>, *<span class="title">sibling</span>, *<span class="title">child</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>ã€æˆå‘˜è¯´æ˜ã€‘</strong></p>
<ul>
<li><code>start</code>ï¼š<code>resource_size_t</code>ç±»å‹ï¼Œ è¡¨ç¤ºèµ„æºçš„èµ·å§‹ä¿¡æ¯ï¼Œå¯¹äºå†…å­˜ç±»çš„èµ„æºï¼Œå°±è¡¨ç¤ºå†…å­˜èµ·å§‹åœ°å€ã€‚</li>
<li><code>end</code> ï¼š<code>resource_size_t</code>ç±»å‹ï¼Œè¡¨ç¤ºèµ„æºçš„ç»ˆæ­¢ä¿¡æ¯ï¼Œå¯¹äºå†…å­˜ç±»çš„èµ„æºï¼Œå°±è¡¨ç¤ºå†…å­˜ç»ˆæ­¢åœ°å€ã€‚</li>
<li><code>name</code> <code>char *</code>ç±»å‹ï¼Œè¡¨ç¤ºèµ„æºåå­—ã€‚</li>
<li><code>flags</code> ï¼š<code>unsigned long</code>ç±»å‹ï¼Œè¡¨ç¤ºèµ„æºç±»å‹ï¼Œå¯é€‰çš„èµ„æºç±»å‹éƒ½å®šä¹‰åœ¨äº†æ–‡ä»¶<code>include/linux/ioport.h</code> é‡Œé¢ã€‚æˆ‘ä»¬å¸¸ç”¨çš„æ˜¯ <code>IORESOURCE_MEM</code>ã€<code>IORESOURCE_IRQ</code>  è¿™ä¸¤ç§ã€‚start å’Œ end çš„å«ä¹‰ä¼šéšç€ flagsè€Œå˜æ›´ã€‚</li>
</ul>
<p><code>flags</code>ä¸º<code>IORESOURCE_MEM</code>æ—¶ï¼Œ<code>start</code> ã€<code>end </code>åˆ†åˆ«è¡¨ç¤ºè¯¥<code>platform_device</code>å æ®çš„å†…å­˜çš„å¼€å§‹åœ°å€å’Œç»“æŸå€¼ï¼›æ³¨æ„ä¸åŒ<code>MEM</code>çš„åœ°å€å€¼<strong>ä¸èƒ½é‡å </strong>ï¼Œé‡å çš„è¯å¯èƒ½ä¼šæŠ¥ä¸‹è¾¹çš„é”™è¯¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">failed to claim resource 2/3/4/5</span><br></pre></td></tr></table></figure>

<p><code>flags</code>ä¸º <code>IORESOURCE_IRQ</code>   æ—¶ï¼Œ<code>start</code> ã€<code>end</code>åˆ†åˆ«è¡¨ç¤ºè¯¥<code>platform_device</code>ä½¿ç”¨çš„ä¸­æ–­å·çš„å¼€å§‹åœ°å€å’Œç»“æŸå€¼ã€‚</p>
<p><strong>ã€å®šä¹‰å®ä¾‹ã€‘</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> *  å®šä¹‰èµ„æºæ•°ç»„(æ³¨æ„ä¸èƒ½æœ‰é‡å åŒºåŸŸï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼šfailed to claim resource 2/3/4/5)</span></span><br><span class="line"><span class="comment"> *  ç»“æ„ä½“å˜é‡åèµ‹å€¼ç»™ struct platform_device ç»“æ„ä½“çš„ .resource æˆå‘˜</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">resource</span> <span class="title">hello_device_res</span>[] =</span> &#123;</span><br><span class="line">    [<span class="number">0</span>] = &#123;.start = <span class="number">0x1000</span>, .end = <span class="number">0x1003</span>, .name = <span class="string">&quot;reg1&quot;</span>, .flags = IORESOURCE_MEM&#125;,</span><br><span class="line">    [<span class="number">1</span>] = &#123;.start = <span class="number">0x2000</span>, .end = <span class="number">0x2003</span>, .name = <span class="string">&quot;reg2&quot;</span>, .flags = IORESOURCE_MEM&#125;,</span><br><span class="line">    [<span class="number">2</span>] = &#123;.start =     <span class="number">10</span>, .end =     <span class="number">10</span>, .name = <span class="string">&quot;irq1&quot;</span>, .flags = IORESOURCE_IRQ&#125;,</span><br><span class="line">    [<span class="number">3</span>] = &#123;.start = <span class="number">0x3000</span>, .end = <span class="number">0x3003</span>, .name = <span class="string">&quot;reg3&quot;</span>, .flags = IORESOURCE_MEM&#125;,</span><br><span class="line">    [<span class="number">4</span>] = &#123;.start =    <span class="number">100</span>, .end =    <span class="number">100</span>, .name = <span class="string">&quot;irq2&quot;</span>, .flags = IORESOURCE_IRQ&#125;,</span><br><span class="line">    [<span class="number">5</span>] = &#123;.start =     <span class="number">62</span>, .end =     <span class="number">62</span>, .name = <span class="string">&quot;irq3&quot;</span>, .flags = IORESOURCE_IRQ&#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h3 id="4-4-struct-platform-device-id"><a href="#4-4-struct-platform-device-id" class="headerlink" title="4.4Â struct platform_device_id"></a><font size=3>4.4Â <code>struct platform_device_id</code></font></h3><p>åœ¨ä½¿ç”¨<code>ID</code>åŒ¹é…çš„æ—¶å€™ï¼Œè¿™ä¸ªç»“æ„ä½“ç±»å‹åœ¨è®¾å¤‡å’Œé©±åŠ¨ä¸­éƒ½ä¼šç”¨åˆ°ã€‚åœ¨é©±åŠ¨ä¸­ï¼Œéœ€è¦ç”¨è¯¥ç»“æ„ä½“å¯¹è±¡å®šä¹‰ä¸€ä¸ªç»“æ„ä½“æ•°ç»„ï¼Œè€Œåœ¨é©±åŠ¨ä¸­ï¼Œåªéœ€è¦å®šä¹‰ä¸€ä¸ªå˜é‡å³å¯ã€‚è¿™ä¸ªç»“æ„ä½“å®šä¹‰åœ¨<code>linux</code>å†…æ ¸æºç çš„ä¸‹è¾¹è¿™ä¸ªæ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include/linux/mod_devicetable.h</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œä¼šçœ‹åˆ°è¿™ä¸ªç»“æ„ä½“å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> PLATFORM_NAME_SIZE      20</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PLATFORM_MODULE_PREFIX  <span class="string">&quot;platform:&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">platform_device_id</span> &#123;</span></span><br><span class="line">        <span class="type">char</span> name[PLATFORM_NAME_SIZE];</span><br><span class="line">        <span class="type">kernel_ulong_t</span> driver_data;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>ã€æˆå‘˜è¯´æ˜ã€‘</strong></p>
<ul>
<li><code>name</code>ï¼š<code>char</code>ç±»å‹ï¼Œè¡¨ç¤ºåŒ¹é…ç”¨çš„åç§°ï¼ˆæŒ‰æˆ‘è‡ªå·±çš„ç†è§£è¿™ä¸ªåç§°å°±æ˜¯åŒ¹é…çš„æ—¶å€™ç”¨çš„<code>ID</code>ï¼‰ã€‚</li>
<li><code>driver_data</code>ï¼š<code>kernel_ulong_t</code>ç±»å‹ï¼Œéœ€è¦å‘é©±åŠ¨ä¼ è¾“çš„å…¶å®ƒæ•°æ®ã€‚</li>
</ul>
<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong>ä¸€èˆ¬æ˜¯å®šä¹‰åœ¨é©±åŠ¨ä¸­ï¼Œå®šä¹‰çš„æ˜¯ä¸€ä¸ªç»“æ„ä½“æ•°ç»„ï¼Œä¸€èˆ¬ä¸æŒ‡å®šå¤§å°ï¼Œåˆå§‹åŒ–æ—¶æœ€ååŠ <code>&#123;&#125;</code>è¡¨ç¤ºæ•°ç»„ç»“æŸï¼Œåœ¨è®¾å¤‡ç¨‹åºä¸­åªéœ€è¦å®šä¹‰ä¸€ä¸ªå˜é‡å³å¯ã€‚</p>
<p><strong>ã€å®šä¹‰å®ä¾‹ã€‘</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> *  å®šä¹‰IDåŒ¹é…æ•°ç»„ </span></span><br><span class="line"><span class="comment"> *  ç»“æ„ä½“å˜é‡åèµ‹å€¼ç»™ struct platform_device ç»“æ„ä½“çš„ .id_entry æˆå‘˜</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">platform_device_id</span> <span class="title">hello_id</span> =</span> &#123;</span><br><span class="line">	.name = MODULE_NAME,                 <span class="comment">/* è¿™é‡Œè¦ä¸ struct platform_device ç»“æ„ä½“ä¸­ name æˆå‘˜ç›¸åŒ */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="äº”ã€åŸºæœ¬å‡½æ•°"><a href="#äº”ã€åŸºæœ¬å‡½æ•°" class="headerlink" title="äº”ã€åŸºæœ¬å‡½æ•°"></a><font size=3>äº”ã€åŸºæœ¬å‡½æ•°</font></h1><h2 id="1-platformé©±åŠ¨ç›¸å…³å‡½æ•°"><a href="#1-platformé©±åŠ¨ç›¸å…³å‡½æ•°" class="headerlink" title="1.Â platformé©±åŠ¨ç›¸å…³å‡½æ•°"></a><font size=3>1.Â <code>platform</code>é©±åŠ¨ç›¸å…³å‡½æ•°</font></h2><h3 id="1-1-platform-driver-register"><a href="#1-1-platform-driver-register" class="headerlink" title="1.1Â platform_driver_register()"></a><font size=3>1.1Â <code>platform_driver_register()</code></font></h3><p>æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢ä¸€ä¸‹å‡½æ•°æ‰€åœ¨å¤´æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep platform_driver_register -r -n ~/5linux/linux-3.14/include</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* éœ€åŒ…å«çš„å¤´æ–‡ä»¶ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/platform_device.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å‡½æ•°å£°æ˜ */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">platform_driver_register</span><span class="params">(<span class="keyword">struct</span> platform_driver *driver)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ã€å‡½æ•°è¯´æ˜ã€‘</strong>è¯¥å‡½æ•°å‘ <code>Linux</code> å†…æ ¸æ³¨å†Œä¸€ä¸ª <code>platform</code> é©±åŠ¨ã€‚</p>
<p><strong>ã€å‡½æ•°å‚æ•°ã€‘</strong></p>
<ul>
<li><code>driver</code>ï¼š<code>struct platform_driver *</code>ç±»å‹ï¼Œè¦æ³¨å†Œçš„ <code>platform</code> é©±åŠ¨ã€‚</li>
</ul>
<p><strong>ã€è¿”å›å€¼ã€‘</strong><code>int</code>ç±»å‹ï¼ŒæˆåŠŸè¿”å›<code>0</code>ï¼Œå¤±è´¥è¿”å› ä¸€ä¸ªè´Ÿæ•°ï¼Œè´Ÿæ•°çš„ç»å¯¹å€¼è¡¨ç¤ºé”™è¯¯ç ã€‚</p>
<p><strong>ã€ä½¿ç”¨æ ¼å¼ã€‘</strong><code>none</code></p>
<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong><code>none</code></p>
<h3 id="1-2-platform-driver-unregister"><a href="#1-2-platform-driver-unregister" class="headerlink" title="1.2Â platform_driver_unregister()"></a><font size=3>1.2Â <code>platform_driver_unregister()</code></font></h3><p>æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢ä¸€ä¸‹å‡½æ•°æ‰€åœ¨å¤´æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep platform_driver_unregister -r -n ~/5linux/linux-3.14/include</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* éœ€åŒ…å«çš„å¤´æ–‡ä»¶ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/platform_device.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å‡½æ•°å£°æ˜ */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">platform_driver_unregister</span><span class="params">(<span class="keyword">struct</span> platform_driver *drv)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ã€å‡½æ•°è¯´æ˜ã€‘</strong>è¯¥å‡½æ•°ä» <code>Linux</code> å†…æ ¸å¸è½½ä¸€ä¸ª <code>platform</code> é©±åŠ¨ã€‚</p>
<p><strong>ã€å‡½æ•°å‚æ•°ã€‘</strong></p>
<ul>
<li><code>drv</code>ï¼š<code>struct platform_driver *</code>ç±»å‹ï¼Œè¦å¸è½½çš„ <code>platform</code> é©±åŠ¨ã€‚</li>
</ul>
<p><strong>ã€è¿”å›å€¼ã€‘</strong><code>none</code></p>
<p><strong>ã€ä½¿ç”¨æ ¼å¼ã€‘</strong><code>none</code></p>
<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong><code>none</code></p>
<h3 id="1-3-platform-get-resource"><a href="#1-3-platform-get-resource" class="headerlink" title="1.3Â platform_get_resource()"></a><font size=3>1.3Â <code>platform_get_resource()</code></font></h3><p>æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢ä¸€ä¸‹å‡½æ•°æ‰€åœ¨å¤´æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep platform_get_resource -r -n ~/5linux/linux-3.14/include</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* éœ€åŒ…å«çš„å¤´æ–‡ä»¶ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/platform_device.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å‡½æ•°å£°æ˜ */</span></span><br><span class="line"><span class="keyword">struct</span> resource *<span class="title function_">platform_get_resource</span><span class="params">(<span class="keyword">struct</span> platform_device *dev, <span class="type">unsigned</span> <span class="type">int</span> type, <span class="type">unsigned</span> <span class="type">int</span> num)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ã€å‡½æ•°è¯´æ˜ã€‘</strong>è¯¥å‡½æ•°ç”¨äºè·å–è®¾å¤‡èµ„æºï¼Œç”¨åœ¨<code>platform</code>é©±åŠ¨ä¸­ã€‚</p>
<p><strong>ã€å‡½æ•°å‚æ•°ã€‘</strong></p>
<ul>
<li><code>dev</code>ï¼š<code>struct platform_device *</code>ç±»å‹ï¼Œèµ„æºæ‰€åœ¨çš„è®¾å¤‡ã€‚</li>
<li><code>type</code>ï¼š<code>unsigned int</code>ç±»å‹ï¼Œè·å–çš„èµ„æºç±»å‹ã€‚</li>
<li><code>num</code>ï¼š<code>unsigned int</code>ç±»å‹ï¼Œå¯¹åº”ç±»å‹èµ„æºçš„åºå·ï¼ˆå¦‚ç¬¬<code>0</code>ä¸ª<code>MEM</code>ã€ç¬¬<code>2</code>ä¸ª<code>IRQ</code>ç­‰ï¼Œä¸æ˜¯æ•°ç»„ä¸‹æ ‡ï¼Œè€Œæ˜¯åŒç±»èµ„æºçš„åºå·ï¼‰ã€‚</li>
</ul>
<p><strong>ã€è¿”å›å€¼ã€‘</strong><code>struct resource *</code>ç±»å‹ï¼ŒæˆåŠŸåˆ™è¿”å›èµ„æºç»“æ„ä½“é¦–åœ°å€ï¼Œå¤±è´¥åˆ™è¿”å›<code>NULL</code>ã€‚</p>
<p><strong>ã€ä½¿ç”¨æ ¼å¼ã€‘</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* è®¾å¤‡æ ‘èŠ‚ç‚¹éƒ¨åˆ† */</span></span><br><span class="line">fs4412-adc&#123;  </span><br><span class="line">    compatible = <span class="string">&quot;fs4412,adc&quot;</span>;  </span><br><span class="line">    reg = &lt;<span class="number">0x126C0000</span> <span class="number">0x20</span>&gt;;  </span><br><span class="line">    interrupt-parent = &lt;&amp;combiner&gt;;  </span><br><span class="line">    interrupts = &lt;<span class="number">10</span> <span class="number">3</span>&gt;;  </span><br><span class="line">&#125;; </span><br><span class="line"><span class="comment">/* è·å–èµ„æº */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">resource</span> *<span class="title">res1</span>;</span>   <span class="comment">/* ä¿å­˜ä¸­æ–­ä¿¡æ¯åœ°å€ */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">resource</span> *<span class="title">res2</span>;</span>   <span class="comment">/* ä¿å­˜å¯„å­˜å™¨åŸºåœ°å€ä¿¡æ¯åœ°å€ */</span></span><br><span class="line"></span><br><span class="line">res1 = platform_get_resource(p_pltdev, IORESOURCE_IRQ, <span class="number">0</span>); <span class="comment">/* ä¸­æ–­ä¿¡æ¯ */</span></span><br><span class="line">res2 = platform_get_resource(p_pltdev, IORESOURCE_MEM, <span class="number">0</span>); <span class="comment">/* å¯„å­˜å™¨åŸºåœ°å€ */</span></span><br><span class="line">printk(<span class="string">&quot;[INFO ]res1-&gt;start :%d.\n&quot;</span>, res1-&gt;start);</span><br><span class="line">printk(<span class="string">&quot;[INFO ]res2-&gt;start=%#x,res2-&gt;end - res2-&gt;start :%#x.\n&quot;</span>,res2-&gt;start, res2-&gt;end - res2-&gt;start);</span><br></pre></td></tr></table></figure>

<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong><code>none</code></p>
<h3 id="1-4-of-match-ptr"><a href="#1-4-of-match-ptr" class="headerlink" title="1.4Â of_match_ptr()"></a><font size=3>1.4Â <code>of_match_ptr()</code></font></h3><p>æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢ä¸€ä¸‹å‡½æ•°æ‰€åœ¨å¤´æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep of_match_ptr -r -n ~/5linux/linux-3.14/include</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* éœ€åŒ…å«çš„å¤´æ–‡ä»¶ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* æ–‡ä»¶ç»“æ„å¦‚ä¸‹ */</span></span><br><span class="line"><span class="comment">// ... ...</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> CONFIG_OF</span></span><br><span class="line"><span class="comment">// ... ...</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> of_match_ptr(_ptr)      (_ptr)</span></span><br><span class="line"><span class="comment">// ... ...</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span> <span class="comment">/* CONFIG_OF */</span></span></span><br><span class="line"><span class="comment">// ... ...</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> of_match_ptr(_ptr)	NULL</span></span><br><span class="line"><span class="comment">// ... ...</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">/* CONFIG_OF */</span></span></span><br></pre></td></tr></table></figure>

<p><strong>ã€å‡½æ•°è¯´æ˜ã€‘</strong>è¯¥å‡½æ•°æ˜¯ä¸€ä¸ªå®ï¼Œè¡¨ç¤ºå½“ä½¿ç”¨è®¾å¤‡æ ‘æ—¶ï¼Œä½¿ç”¨<code>_ptr</code>è¿›è¡ŒåŒ¹é…ï¼Œå¦åˆ™å…¶ä¸ºç©ºã€‚</p>
<details class="folding-tag" blue><summary> ç‚¹å‡»æŸ¥çœ‹è¯´æ˜ </summary>
              <div class='content'>
              <p>åœ¨å†…æ ¸è¿˜æ²¡æœ‰å¼•è¿›è®¾å¤‡æ ‘çš„æ—¶å€™ï¼Œè®¾å¤‡å’Œé©±åŠ¨çš„åŒ¹é…å·¥ä½œæ˜¯ç”±<code>driver.name</code>æˆ–è€…<code>id_table</code>æ¥å®Œæˆçš„ï¼Œè‡ªä»å¼•è¿›è®¾å¤‡æ ‘ä¹‹åï¼ˆå°±æœ‰äº†<code>CONFIG_OF</code>ï¼‰è¿™ä¸ªå®ï¼ŒåŒ¹é…è§„åˆ™ä¸­å°±å¤šäº†<code>of_match_table</code>è¿™ç§é€šè¿‡<code>compatible</code>æ–¹å¼æ¥åŒ¹é…çš„æ–¹å¼ã€‚åŒæ—¶ä¸ºäº†å…¼å®¹è€çš„åŒ¹é…æ–¹å¼ï¼Œå®šä¹‰äº†å®<code>of_match_ptr</code>ã€‚</p><ul><li>å½“æœ‰è®¾å¤‡æ ‘çš„æ—¶å€™ï¼ˆå®šä¹‰äº†<code>CONFIG_OF</code>ï¼‰ï¼Œé‚£ä¹ˆ<code>of_match_table</code>å°±æœ‰å€¼ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.of_match_table = of_match_ptr(adc_driver_dt_ids)</span><br></pre></td></tr></table></figure><p>å®æ›¿æ¢ä¹‹åå°±æ˜¯ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.of_match_table = (adc_driver_dt_ids)</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±ä¼šä½¿ç”¨è®¾å¤‡æ ‘çš„æ–¹å¼è¿›è¡ŒåŒ¹é…ã€‚</p><ul><li>å½“æ²¡æœ‰è®¾å¤‡æ ‘çš„æ—¶å€™ï¼ˆæ²¡æœ‰å®šä¹‰<code>CONFIG_OF</code>ï¼‰ï¼Œé‚£ä¹ˆ<code>of_match_table</code>å°±æ²¡å€¼ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.of_match_table = of_match_ptr(adc_driver_dt_ids)</span><br></pre></td></tr></table></figure><p>å®æ›¿æ¢ä¹‹åå°±æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.of_match_table = NULL</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å°±ä¼šä½¿ç”¨ä¼ ç»Ÿæ–¹å¼åŒ¹é…ã€‚</p>
              </div>
            </details>

<p><strong>ã€å‡½æ•°å‚æ•°ã€‘</strong></p>
<ul>
<li><code>_ptr</code>ï¼š<code>struct of_device_id</code>ç±»å‹çš„ä¸€ä¸ªæ•°ç»„ï¼Œè¡¨ç¤ºè®¾å¤‡æ ‘åŒ¹é…çš„<code>compatible</code>è¡¨ã€‚</li>
</ul>
<p><strong>ã€è¿”å›å€¼ã€‘</strong><code>none</code></p>
<p><strong>ã€ä½¿ç”¨æ ¼å¼ã€‘</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** å®šä¹‰åŒ¹é…è®¾å¤‡æ ‘æ•°ç»„</span></span><br><span class="line"><span class="comment"> *  ä¸æ•°ç»„ä¸­å«æœ‰çš„åç§°ç›¸åŒçš„è®¾å¤‡éƒ½å¯ä»¥åŒ¹é…åˆ°è¯¥é©±åŠ¨</span></span><br><span class="line"><span class="comment"> *  ç»“æ„ä½“å˜é‡åèµ‹å€¼ç»™ struct platform_driver ç»“æ„ä½“çš„ ..driver.of_match_table æˆå‘˜</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">of_device_id</span> <span class="title">adc_driver_dt_ids</span>[] =</span> &#123;</span><br><span class="line">    [<span class="number">0</span>] = &#123;.compatible = <span class="string">&quot;fs4412,adc&quot;</span> &#125;,</span><br><span class="line">    [<span class="number">1</span>] = &#123;&#125;, <span class="comment">/* means ending */</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** å®šä¹‰platformå¹³å°é©±åŠ¨ */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">platform_driver</span> <span class="title">adc_driver</span> =</span> &#123;</span><br><span class="line">    .driver = &#123;</span><br><span class="line">        .name = MODULE_NAME, <span class="comment">/* å¿…é¡»åˆå§‹åŒ– name æˆå‘˜ */</span></span><br><span class="line">        <span class="comment">// .of_match_table = adc_driver_dt_ids,</span></span><br><span class="line">        .of_match_table = of_match_ptr(adc_driver_dt_ids), <span class="comment">/* ç›´æ¥ä½¿ç”¨çš„è¯ï¼ŒåŠ è½½é©±åŠ¨æŠ¥é”™ï¼Œæš‚æœªç ”ç©¶ */</span></span><br><span class="line">    &#125;,</span><br><span class="line">    .probe = adc_driver_probe,   <span class="comment">/* è®¾å¤‡å’Œé©±åŠ¨åŒ¹é…æˆåŠŸä¹‹åçš„è°ƒç”¨å‡½æ•° */</span></span><br><span class="line">    .remove = adc_driver_remove, <span class="comment">/* å¸è½½è®¾å¤‡ */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong>å…¶å®åŸæœ¬æ²¡ç”¨è¿‡è¿™ä¸ªå®ï¼Œç›´æ¥ä½¿ç”¨æ•°ç»„åå°±ä¹Ÿå®Œæˆäº†åŒ¹é…ï¼Œä½†æ˜¯åä¾¿åœ¨ç¼–å†™ä¸€ä¸ªé©±åŠ¨çš„æ—¶å€™ï¼Œä½¿ç”¨<code>platform_get_resource</code>è·ä»è®¾å¤‡æ ‘è·å–èµ„æºçš„è¯ï¼Œè¿™é‡Œä¸ç”¨è¿™ä¸ªå®çš„è¯ï¼Œåœ¨åŠ è½½æ¨¡å—çš„æ—¶å€™å°±ä¼šæŠ¥é”™ï¼Œç›®å‰è¿˜æ²¡æœ‰ä»”ç»†ç ”ç©¶ï¼Œæ‰€ä»¥è¿™é‡Œå…ˆæ³¨æ„ä¸€ä¸‹ï¼Œåè¾¹ææ‡‚äº†å†è¡¥å……ã€‚</p>
<h2 id="2-platformè®¾å¤‡ç›¸å…³å‡½æ•°"><a href="#2-platformè®¾å¤‡ç›¸å…³å‡½æ•°" class="headerlink" title="2.Â platformè®¾å¤‡ç›¸å…³å‡½æ•°"></a><font size=3>2.Â <code>platform</code>è®¾å¤‡ç›¸å…³å‡½æ•°</font></h2><h3 id="2-1-platform-device-register"><a href="#2-1-platform-device-register" class="headerlink" title="2.1Â platform_device_register()"></a><font size=3>2.1Â <code>platform_device_register()</code></font></h3><p>æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢ä¸€ä¸‹å‡½æ•°æ‰€åœ¨å¤´æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep platform_device_register -r -n ~/5linux/linux-3.14/include</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* éœ€åŒ…å«çš„å¤´æ–‡ä»¶ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/platform_device.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å‡½æ•°å£°æ˜ */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">platform_device_register</span><span class="params">(<span class="keyword">struct</span> platform_device *pdev)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ã€å‡½æ•°è¯´æ˜ã€‘</strong>è¯¥å‡½æ•°è®¾å¤‡ä¿¡æ¯æ³¨å†Œåˆ° <code>Linux</code> å†…æ ¸ä¸­ï¼ŒæŠŠæŒ‡å®šè®¾å¤‡æ·»åŠ åˆ°å†…æ ¸ä¸­å¹³å°æ€»çº¿çš„è®¾å¤‡åˆ—è¡¨ï¼Œç­‰å¾…åŒ¹é…ï¼ŒåŒ¹é…æˆåŠŸåˆ™å›è°ƒé©±åŠ¨ä¸­<code>probe</code>æŒ‡å‘çš„å‡½æ•°ã€‚</p>
<p><strong>ã€å‡½æ•°å‚æ•°ã€‘</strong></p>
<ul>
<li><code>pdev</code>ï¼š<code>struct platform_device *</code>ç±»å‹ï¼Œè¦æ³¨å†Œçš„ <code>platform</code> è®¾å¤‡ã€‚</li>
</ul>
<p><strong>ã€è¿”å›å€¼ã€‘</strong><code>int</code>ç±»å‹ï¼ŒæˆåŠŸè¿”å›<code>0</code>ï¼Œå¤±è´¥è¿”å› ä¸€ä¸ªè´Ÿæ•°ï¼Œè´Ÿæ•°çš„ç»å¯¹å€¼è¡¨ç¤ºé”™è¯¯ç ã€‚</p>
<p><strong>ã€ä½¿ç”¨æ ¼å¼ã€‘</strong><code>none</code></p>
<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong><code>none</code></p>
<h3 id="2-2-platform-device-unregister"><a href="#2-2-platform-device-unregister" class="headerlink" title="2.2Â platform_device_unregister()"></a><font size=3>2.2Â <code>platform_device_unregister()</code></font></h3><p>æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢ä¸€ä¸‹å‡½æ•°æ‰€åœ¨å¤´æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep platform_device_unregister -r -n ~/5linux/linux-3.14/include</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* éœ€åŒ…å«çš„å¤´æ–‡ä»¶ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/platform_device.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å‡½æ•°å£°æ˜ */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">platform_device_unregister</span><span class="params">(<span class="keyword">struct</span> platform_device *pdev)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ã€å‡½æ•°è¯´æ˜ã€‘</strong>è¯¥å‡½æ•°ä» <code>Linux</code> å†…æ ¸æ³¨é”€ä¸€ä¸ª <code>platform</code> è®¾å¤‡ï¼Œå¦‚æœé©±åŠ¨å·²åŒ¹é…åˆ™å›è°ƒé©±åŠ¨æ–¹æ³•å’Œè®¾å¤‡ä¿¡æ¯ä¸­çš„<code>release</code>æŒ‡å‘çš„å‡½æ•° ã€‚</p>
<p><strong>ã€å‡½æ•°å‚æ•°ã€‘</strong></p>
<ul>
<li><code>pdev</code>ï¼š<code>struct platform_device *</code>ç±»å‹ï¼Œè¦æ³¨é”€çš„ <code>platform</code> è®¾å¤‡ã€‚</li>
</ul>
<p><strong>ã€è¿”å›å€¼ã€‘</strong><code>none</code></p>
<p><strong>ã€ä½¿ç”¨æ ¼å¼ã€‘</strong><code>none</code></p>
<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong><code>none</code></p>

    </div>

    
    
    

    <footer class="post-footer">




    <div>
        
            <div style="text-align:center;color: #ccc;font-size:14px;">
            ----------æœ¬æ–‡ç»“æŸ
            <i class="fas fa-fan fa-spin" style="color: #FF1493; font-size: 1rem"></i>
            æ„Ÿè°¢æ‚¨çš„é˜…è¯»----------
            </div>
        
    </div>





  
  <div class="my_post_copyright"> 
    <p><span>æ–‡ç« æ ‡é¢˜:</span><a href="/post/684dbf90.html">LV10-10-platform-01-platformé©±åŠ¨åŸºç¡€</a></p>
    <p><span>æ–‡ç« ä½œè€…:</span><a href="/" title="æ¬¢è¿è®¿é—® ã€Šè‹æœ¨ã€‹ çš„å­¦ä¹ ç¬”è®°">è‹æœ¨</a></p>
    <p><span>å‘å¸ƒæ—¶é—´:</span>2023å¹´07æœˆ08æ—¥ - 18:58</p>
    <p><span>æœ€åæ›´æ–°:</span>2025å¹´06æœˆ14æ—¥ - 00:25</p>
    <p><span>åŸå§‹é“¾æ¥:</span><a href="/post/684dbf90.html" title="LV10-10-platform-01-platformé©±åŠ¨åŸºç¡€">https://sumumm.github.io/post/684dbf90.html</a></p>
    <p><span>è®¸å¯åè®®:</span><i class="fab fa-creative-commons"></i> <a rel="license" href= "https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç¦æ­¢æ¼”ç» 4.0 å›½é™…</a> è½¬è½½è¯·ä¿ç•™åŸæ–‡é“¾æ¥åŠä½œè€…ã€‚</p>  
  </div>
  


          <div class="post-tags">
              <a href="/tags/LV10-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/" rel="tag"><i class="fa fa-tag"></i> LV10-é©±åŠ¨å¼€å‘</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/post/61f6cfe4.html" rel="prev" title="LV10-10-platform-02-ä¸‰ç§åŒ¹é…æ–¹å¼">
                  <i class="fa fa-angle-left"></i> LV10-10-platform-02-ä¸‰ç§åŒ¹é…æ–¹å¼
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/post/2a3d5ad0.html" rel="next" title="LV10-09-sysfs-01-sysfsç®€ä»‹">
                  LV10-09-sysfs-01-sysfsç®€ä»‹ <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2017 â€“ 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">è‹æœ¨</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>ç«™ç‚¹æ€»å­—æ•°ï¼š</span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">3.7m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>ç«™ç‚¹é˜…è¯»æ—¶é•¿ &asymp;</span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">225:26</span>
  </span>
</div>




    <span id="sitetime"></span>
    <script defer language=javascript>
        function siteTime()
        {
            window.setTimeout("siteTime()", 1000);
            var seconds = 1000;
            var minutes = seconds * 60;
            var hours = minutes * 60;
            var days = hours * 24;
            var years = days * 365;
            var today = new Date();
            var todayYear = today.getFullYear();
            var todayMonth = today.getMonth()+1;
            var todayDate = today.getDate();
            var todayHour = today.getHours();
            var todayMinute = today.getMinutes();
            var todaySecond = today.getSeconds();
            /*==================================================
            Date.UTC() -- è¿”å›dateå¯¹è±¡è·ä¸–ç•Œæ ‡å‡†æ—¶é—´(UTC)1970å¹´1æœˆ1æ—¥åˆå¤œä¹‹é—´çš„æ¯«ç§’æ•°(æ—¶é—´æˆ³)
            year        - ä½œä¸ºdateå¯¹è±¡çš„å¹´ä»½ï¼Œä¸º4ä½å¹´ä»½å€¼
            month       - 0-11ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„æœˆä»½
            day         - 1-31ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„å¤©æ•°
            hours       - 0(åˆå¤œ24ç‚¹)-23ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„å°æ—¶æ•°
            minutes     - 0-59ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„åˆ†é’Ÿæ•°
            seconds     - 0-59ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„ç§’æ•°
            microseconds - 0-999ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„æ¯«ç§’æ•°
            ==================================================*/
            var t1 = Date.UTC(2017, 
                              5, 
                              19, 
                              0, 
                              0, 
                              0); //åŒ—äº¬æ—¶é—´
            var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond);
            var diff = t2-t1;
            var diffYears = Math.floor(diff/years);
            var diffDays = Math.floor((diff/days)-diffYears*365);
            var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours);
            var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes);
            var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds);
            document.getElementById("sitetime").innerHTML="å·²åœ¨è¿™é‡Œ "+diffYears+" å¹´ "+diffDays+" å¤© "+diffHours+" å°æ—¶ "+diffMinutes+" åˆ†é’Ÿ "+diffSeconds+" ç§’";
        }
        siteTime();
    </script>



    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.umd.js" integrity="sha256-ytMJGN3toR+a84u7g7NuHm91VIR06Q41kMWDr2pq7Zo=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>


  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


 
        <div id="click-show-text"
            data-mobile = false
            data-text = å¯Œå¼º,æ°‘ä¸»,æ–‡æ˜,å’Œè°,è‡ªç”±,å¹³ç­‰,å…¬æ­£,æ³•åˆ¶,çˆ±å›½,æ•¬ä¸š,è¯šä¿¡,å‹å–„
            data-fontsize = 15px
            data-random= false>
        </div>
       

      
        <script async src=https://cdn.jsdelivr.net/npm/hexo-next-mouse-effect@latest/click/showText.js></script>
      

      
    




    <script async src="/js/fancybox_param.js"></script>





<!-- APlayeræœ¬ä½“ -->



</body>
</html>
