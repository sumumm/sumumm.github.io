<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha256-wiz7ZSCn/btzhjKDQBms9Hx4sSeUYsDrTLg7roPstac=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.css" integrity="sha256-6cQIC71/iBIYXFK+0RHAvwmjwWzkWd+r7v/BX3/vZDc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/green/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"sumumm.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.19.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":300},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="æœ¬æ–‡ä¸»è¦æ˜¯ubootâ€”â€”ubootæºç é¡¶å±‚MakefileåŸºç¡€è§£æçš„ç›¸å…³ç¬”è®°ï¼Œè‹¥ç¬”è®°ä¸­æœ‰é”™è¯¯æˆ–è€…ä¸åˆé€‚çš„åœ°æ–¹ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ğŸ˜ƒã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="LV05-02-U-Boot-06-01-é¡¶å±‚MakefileåŸºç¡€è§£æ">
<meta property="og:url" content="https://sumumm.github.io/post/ca32061f.html">
<meta property="og:site_name" content="è‹æœ¨">
<meta property="og:description" content="æœ¬æ–‡ä¸»è¦æ˜¯ubootâ€”â€”ubootæºç é¡¶å±‚MakefileåŸºç¡€è§£æçš„ç›¸å…³ç¬”è®°ï¼Œè‹¥ç¬”è®°ä¸­æœ‰é”™è¯¯æˆ–è€…ä¸åˆé€‚çš„åœ°æ–¹ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ğŸ˜ƒã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV05-%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F/LV05-02-U-Boot-06-01-%E9%A1%B6%E5%B1%82Makefile%E5%9F%BA%E7%A1%80%E8%A7%A3%E6%9E%90/img/image-20241119220727685.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV05-%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F/LV05-02-U-Boot-06-01-%E9%A1%B6%E5%B1%82Makefile%E5%9F%BA%E7%A1%80%E8%A7%A3%E6%9E%90/img/image-20241119221119307.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV05-%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F/LV05-02-U-Boot-06-01-%E9%A1%B6%E5%B1%82Makefile%E5%9F%BA%E7%A1%80%E8%A7%A3%E6%9E%90/img/image-20241119231818010.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV05-%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F/LV05-02-U-Boot-06-01-%E9%A1%B6%E5%B1%82Makefile%E5%9F%BA%E7%A1%80%E8%A7%A3%E6%9E%90/img/image-20241119232614054.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV05-%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F/LV05-02-U-Boot-06-01-%E9%A1%B6%E5%B1%82Makefile%E5%9F%BA%E7%A1%80%E8%A7%A3%E6%9E%90/img/image-20230730143850408.png">
<meta property="article:published_time" content="2024-11-19T15:38:31.000Z">
<meta property="article:modified_time" content="2025-06-13T16:25:57.043Z">
<meta property="article:author" content="è‹æœ¨">
<meta property="article:tag" content="LV05-ç³»ç»Ÿé•œåƒ">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV05-%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F/LV05-02-U-Boot-06-01-%E9%A1%B6%E5%B1%82Makefile%E5%9F%BA%E7%A1%80%E8%A7%A3%E6%9E%90/img/image-20241119220727685.png">


<link rel="canonical" href="https://sumumm.github.io/post/ca32061f.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":"","permalink":"https://sumumm.github.io/post/ca32061f.html","path":"post/ca32061f.html","title":"LV05-02-U-Boot-06-01-é¡¶å±‚MakefileåŸºç¡€è§£æ"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>LV05-02-U-Boot-06-01-é¡¶å±‚MakefileåŸºç¡€è§£æ | è‹æœ¨</title>
  








    <script src="/js/browser_tools_disable.js"></script>

  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start --><link rel="stylesheet" href="https://unpkg.com/hexo-next-tags-plus@latest/lib/tag_plus.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">è‹æœ¨</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">æˆ‘çš„å­¦ä¹ ä¹‹è·¯</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>è‹æœ¨çš„å®¶</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»é¡µ<span class="badge">42</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£é¡µ<span class="badge">673</span></a></li><li class="menu-item menu-item-flink"><a href="/flink/" rel="section"><i class="fa fa-link fa-fw"></i>å‹äººå¸</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äºæˆ‘</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E3%80%81U-Boot%E9%A1%B6%E5%B1%82Makefile%E5%9F%BA%E7%A1%80"><span class="nav-text">ä¸€ã€U-Booté¡¶å±‚MakefileåŸºç¡€</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E7%89%88%E6%9C%AC%E5%8F%B7"><span class="nav-text">1. ç‰ˆæœ¬å·</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-MAKEFLAGS-%E5%8F%98%E9%87%8F"><span class="nav-text">2.Â MAKEFLAGS å˜é‡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%91%BD%E4%BB%A4%E8%BE%93%E5%87%BA"><span class="nav-text">3. å‘½ä»¤è¾“å‡º</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E9%BB%98%E8%AE%A4%E7%9A%84%E8%BE%93%E5%87%BA%E6%83%85%E5%86%B5"><span class="nav-text">3.1 é»˜è®¤çš„è¾“å‡ºæƒ…å†µ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E5%AE%8C%E6%95%B4%E5%91%BD%E4%BB%A4%E8%BE%93%E5%87%BA"><span class="nav-text">3.2 å®Œæ•´å‘½ä»¤è¾“å‡º</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E5%91%BD%E4%BB%A4%E8%BE%93%E5%87%BA%E6%8E%A7%E5%88%B6"><span class="nav-text">3.3 å‘½ä»¤è¾“å‡ºæ§åˆ¶</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-1-%E5%91%BD%E4%BB%A4%E8%BE%93%E5%87%BA%E6%8E%A7%E5%88%B6%E5%91%BD%E4%BB%A4"><span class="nav-text">3.3.1 å‘½ä»¤è¾“å‡ºæ§åˆ¶å‘½ä»¤</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-3-2-V%E7%9A%84%E6%9D%A5%E6%BA%90"><span class="nav-text">3.3.2 Vçš„æ¥æº</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-2-Q%E4%B8%8Equiet"><span class="nav-text">3.3.2 Qä¸quiet</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-%E6%80%8E%E4%B9%88%E6%8E%A7%E5%88%B6%E8%BE%93%E5%87%BA%E4%BF%A1%E6%81%AF%EF%BC%9F"><span class="nav-text">3.4 æ€ä¹ˆæ§åˆ¶è¾“å‡ºä¿¡æ¯ï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-%E9%9D%99%E9%BB%98%E8%BE%93%E5%87%BA"><span class="nav-text">3.5Â é™é»˜è¾“å‡º</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-1-%E9%9D%99%E9%BB%98%E8%BE%93%E5%87%BA%E5%91%BD%E4%BB%A4"><span class="nav-text">3.5.1 é™é»˜è¾“å‡ºå‘½ä»¤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-2-make%E7%89%88%E6%9C%AC%E5%8F%B7%E5%88%A4%E6%96%AD"><span class="nav-text">3.5.2 makeç‰ˆæœ¬å·åˆ¤æ–­</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-3-%E7%A1%AE%E5%AE%9Aquiet%E7%9A%84%E5%80%BC"><span class="nav-text">3.5.3 ç¡®å®šquietçš„å€¼</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-6-%E5%AF%BC%E5%87%BA%E5%8F%98%E9%87%8F"><span class="nav-text">3.6 å¯¼å‡ºå˜é‡</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E8%AE%BE%E7%BD%AE%E7%BC%96%E8%AF%91%E7%BB%93%E6%9E%9C%E8%BE%93%E5%87%BA%E7%9B%AE%E5%BD%95"><span class="nav-text">4.Â è®¾ç½®ç¼–è¯‘ç»“æœè¾“å‡ºç›®å½•</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E8%BE%93%E5%87%BA%E7%9B%AE%E5%BD%95%E6%8E%A7%E5%88%B6%E5%91%BD%E4%BB%A4"><span class="nav-text">4.1 è¾“å‡ºç›®å½•æ§åˆ¶å‘½ä»¤Â </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-O%E5%8F%82%E6%95%B0%E6%9D%A5%E6%BA%90%E5%88%A4%E6%96%AD"><span class="nav-text">4.2 Oå‚æ•°æ¥æºåˆ¤æ–­</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-%E5%88%9B%E5%BB%BAKBUILD-OUTPUT%E7%9B%AE%E5%BD%95"><span class="nav-text">4.3 åˆ›å»ºKBUILD_OUTPUTç›®å½•</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E4%BB%A3%E7%A0%81%E6%A3%80%E6%9F%A5"><span class="nav-text">5. ä»£ç æ£€æŸ¥</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-%E4%BB%A3%E7%A0%81%E6%A3%80%E6%9F%A5%E6%8E%A7%E5%88%B6%E5%91%BD%E4%BB%A4"><span class="nav-text">5.1 ä»£ç æ£€æŸ¥æ§åˆ¶å‘½ä»¤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-KBUILD-CHECKSRC"><span class="nav-text">5.2Â KBUILD_CHECKSRC</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E6%A8%A1%E5%9D%97%E7%BC%96%E8%AF%91"><span class="nav-text">6. æ¨¡å—ç¼–è¯‘</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-%E6%A8%A1%E5%9D%97%E7%BC%96%E8%AF%91%E5%91%BD%E4%BB%A4"><span class="nav-text">6.1 æ¨¡å—ç¼–è¯‘å‘½ä»¤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-KBUILD-EXTMOD"><span class="nav-text">6.2Â KBUILD_EXTMOD</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-%E7%BC%96%E8%AF%91%E7%9B%AE%E6%A0%87"><span class="nav-text">6.3 ç¼–è¯‘ç›®æ ‡</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-VPATH%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="nav-text">7. VPATHçš„é…ç½®</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-%E7%BC%96%E8%AF%91%E5%B9%B3%E5%8F%B0"><span class="nav-text">8. ç¼–è¯‘å¹³å°</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-1-%E4%B8%BB%E6%9C%BA%E6%9E%B6%E6%9E%84-HOSTARCH"><span class="nav-text">8.1 ä¸»æœºæ¶æ„ HOSTARCH</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-2-%E4%B8%BB%E6%9C%BA%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-HOSTOS"><span class="nav-text">8.2 ä¸»æœºæ“ä½œç³»ç»Ÿ HOSTOS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-3-%E5%AF%BC%E5%87%BAHOSTARCH%E5%92%8CHOSTOS"><span class="nav-text">8.3 å¯¼å‡ºHOSTARCHå’ŒHOSTOS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-4-%E7%9B%AE%E6%A0%87%E6%9E%B6%E6%9E%84%E5%92%8C%E7%BC%96%E8%AF%91%E5%99%A8"><span class="nav-text">8.4 ç›®æ ‡æ¶æ„å’Œç¼–è¯‘å™¨</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#8-4-1-%E8%AE%BE%E7%BD%AE%E5%91%BD%E4%BB%A4"><span class="nav-text">8.4.1 è®¾ç½®å‘½ä»¤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-4-2-ARCH%E4%B8%8ECROSS-COMPILE"><span class="nav-text">8.4.2Â ARCHä¸CROSS_COMPILE</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">9. é…ç½®æ–‡ä»¶</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-%E9%80%9A%E7%94%A8%E5%AE%9A%E4%B9%89"><span class="nav-text">10. é€šç”¨å®šä¹‰</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#10-1-Kbuild-include"><span class="nav-text">10.1Â Kbuild.include</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-2-%E6%80%8E%E4%B9%88%E8%A2%AB%E5%8C%85%E5%90%AB%E5%88%B0Makefile%E4%B8%AD%EF%BC%9F"><span class="nav-text">10.2 æ€ä¹ˆè¢«åŒ…å«åˆ°Makefileä¸­ï¼Ÿ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-%E7%9B%B8%E5%85%B3%E5%8F%98%E9%87%8F"><span class="nav-text">11. ç›¸å…³å˜é‡</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#11-1-%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E5%B7%A5%E5%85%B7%E5%8F%98%E9%87%8F"><span class="nav-text">11.1Â äº¤å‰ç¼–è¯‘å·¥å…·å˜é‡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-2-%E7%BC%96%E8%AF%91%E9%80%89%E9%A1%B9"><span class="nav-text">11.2 ç¼–è¯‘é€‰é¡¹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-3-%E5%8F%98%E9%87%8F%E5%AF%BC%E5%87%BA"><span class="nav-text">11.3 å˜é‡å¯¼å‡º</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8C%E3%80%81Makefile%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90"><span class="nav-text">äºŒã€Makefileè¿‡ç¨‹åˆ†æ</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-make-xxx-defconfig"><span class="nav-text">1.Â  make xxx_defconfig</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E7%89%88%E6%9C%AC%E4%B8%8E%E6%97%B6%E9%97%B4"><span class="nav-text">1.1 ç‰ˆæœ¬ä¸æ—¶é—´</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-1-version-h"><span class="nav-text">1.1.1 version_h</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-2-timestamp-h"><span class="nav-text">1.1.2Â timestamp_h</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E4%B8%89%E4%B8%AA%E5%8F%98%E9%87%8F"><span class="nav-text">1.2 ä¸‰ä¸ªå˜é‡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-%E4%B8%89%E4%B8%AA%E5%8F%98%E9%87%8F%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-text">1.3 ä¸‰ä¸ªå˜é‡çš„ä½¿ç”¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-config"><span class="nav-text">1.4 %config</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-1-FORCE"><span class="nav-text">1.4.1 FORCE</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-2-scripts-basic"><span class="nav-text">1.4.2Â scripts_basic</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-3-config%E5%B1%95%E5%BC%80"><span class="nav-text">1.4.3 %configå±•å¼€</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-5-%E7%BC%96%E8%AF%91%E4%BF%A1%E6%81%AF"><span class="nav-text">1.5 ç¼–è¯‘ä¿¡æ¯</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-6-Makefile-build-%E8%84%9A%E6%9C%AC"><span class="nav-text">1.6Â Makefile.build è„šæœ¬</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-6-1-scripts-basic-%E7%9B%AE%E6%A0%87%E5%AF%B9%E5%BA%94%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="nav-text">1.6.1Â scripts_basic ç›®æ ‡å¯¹åº”çš„å‘½ä»¤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-6-2-config-%E7%9B%AE%E6%A0%87%E5%AF%B9%E5%BA%94%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="nav-text">1.6.2 %config ç›®æ ‡å¯¹åº”çš„å‘½ä»¤</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-7-%E6%80%BB%E7%BB%93%E4%B8%80%E4%B8%8B"><span class="nav-text">1.7 æ€»ç»“ä¸€ä¸‹</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-u-boot-bin%E7%9A%84%E7%94%9F%E6%88%90%E8%BF%87%E7%A8%8B"><span class="nav-text">2. u-boot.binçš„ç”Ÿæˆè¿‡ç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E7%9B%AE%E6%A0%87%E6%96%87%E4%BB%B6"><span class="nav-text">2.1 ç›®æ ‡æ–‡ä»¶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-all%E7%9B%AE%E6%A0%87%E8%A7%84%E5%88%99"><span class="nav-text">2.2 allç›®æ ‡è§„åˆ™</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-ALL-y"><span class="nav-text">2.3Â ALL-y</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-u-boot-bin"><span class="nav-text">2.4 u-boot.bin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-u-boot-dtb-bin"><span class="nav-text">2.5 u-boot-dtb.bin</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-5-1-%E4%BE%9D%E8%B5%96%E7%9B%AE%E6%A0%87"><span class="nav-text">2.5.1 ä¾èµ–ç›®æ ‡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-5-2-u-boot"><span class="nav-text">2.5.2 u-boot</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-5-2-1-u-boot%E7%9A%84%E4%BE%9D%E8%B5%96"><span class="nav-text">2.5.2.1 u-bootçš„ä¾èµ–</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-5-2-2-head-y"><span class="nav-text">2.5.2.2 head-y</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-5-2-3-libs-y"><span class="nav-text">2.5.2.3 libs-y</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-5-2-4-u-boot-lds%E8%A7%84%E5%88%99"><span class="nav-text">2.5.2.4Â u-boot.ldsè§„åˆ™</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-5-2-5-built-in-o%E6%80%8E%E4%B9%88%E7%94%9F%E6%88%90%EF%BC%9F"><span class="nav-text">2.5.2.5Â  built-in.oæ€ä¹ˆç”Ÿæˆï¼Ÿ</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-5-2-6-u-boot%E7%9A%84%E7%94%9F%E6%88%90"><span class="nav-text">2.5.2.6 u-bootçš„ç”Ÿæˆ</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-%E6%80%BB%E7%BB%93%E4%B8%80%E4%B8%8B"><span class="nav-text">2.6 æ€»ç»“ä¸€ä¸‹</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="è‹æœ¨"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">è‹æœ¨</p>
  <div class="site-description" itemprop="description">è«é“æ¡‘æ¦†æ™šï¼Œä¸ºéœå°šæ»¡å¤©</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">673</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">42</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">æ ‡ç­¾</span>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/sumumm" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;sumumm" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sumumm.github.io/post/ca32061f.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="è‹æœ¨">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è‹æœ¨">
      <meta itemprop="description" content="è«é“æ¡‘æ¦†æ™šï¼Œä¸ºéœå°šæ»¡å¤©">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="LV05-02-U-Boot-06-01-é¡¶å±‚MakefileåŸºç¡€è§£æ | è‹æœ¨">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          LV05-02-U-Boot-06-01-é¡¶å±‚MakefileåŸºç¡€è§£æ
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2024-11-19 23:38:31" itemprop="dateCreated datePublished" datetime="2024-11-19T23:38:31+08:00">2024-11-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">åµŒå…¥å¼å¼€å‘</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/" itemprop="url" rel="index"><span itemprop="name">02IMX6ULLå¹³å°</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV05-%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F/" itemprop="url" rel="index"><span itemprop="name">LV05-ç³»ç»Ÿé•œåƒ</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>12k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>44 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>æœ¬æ–‡ä¸»è¦æ˜¯ubootâ€”â€”ubootæºç é¡¶å±‚MakefileåŸºç¡€è§£æçš„ç›¸å…³ç¬”è®°ï¼Œè‹¥ç¬”è®°ä¸­æœ‰é”™è¯¯æˆ–è€…ä¸åˆé€‚çš„åœ°æ–¹ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ğŸ˜ƒã€‚</p>
<span id="more"></span>

<!-- Photo: https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV05-%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F/LV05-02-U-Boot-06-01-%E9%A1%B6%E5%B1%82Makefile%E5%9F%BA%E7%A1%80%E8%A7%A3%E6%9E%90/img/ -->

<details class="folding-tag" blue><summary> ç‚¹å‡»æŸ¥çœ‹ä½¿ç”¨å·¥å…·åŠç‰ˆæœ¬ </summary>
              <div class='content'>
              <table>    <tr>        <td align="center" rowspan="5">PCç«¯å¼€å‘ç¯å¢ƒ</td>        <td align="center" width=150px>Windows</td>        <td align="left">Windows11</td>    </tr>    <tr>        <td align="center">Ubuntu</td>        <td align="left">Ubuntu20.04.2çš„64ä½ç‰ˆæœ¬</td>      </tr>    <tr>        <td align="center">VMwareÂ® Workstation 17 Pro</td>        <td align="left">17.6.0 build-24238078</td>      </tr>    <tr>        <td align="center">ç»ˆç«¯è½¯ä»¶</td>        <td align="left">MobaXterm(Professional Edition v23.0 Build 5042 (license))</td>    </tr>    <tr>        <td align="center">Win32DiskImager</td>        <td align="left">Win32DiskImager v1.0</td>      </tr>    <tr>        <td align="center" rowspan="3">Linuxå¼€å‘æ¿ç¯å¢ƒ</td>        <td align="center">Linuxå¼€å‘æ¿</td>        <td align="left">æ­£ç‚¹åŸå­ i.MX6ULL Linux é˜¿å°”æ³•å¼€å‘æ¿</td>      </tr>    <tr>        <td align="center">uboot</td>        <td align="left">NXPå®˜æ–¹æä¾›çš„ubootï¼Œä½¿ç”¨çš„ubootç‰ˆæœ¬ä¸ºU-Boot 2019.04</td>      </tr>    <tr>        <td align="center">linuxå†…æ ¸</td>        <td align="left">linux-4.19.71(NXPå®˜æ–¹æä¾›)</td>      </tr></table>
              </div>
            </details>

<details class="folding-tag" blue><summary> ç‚¹å‡»æŸ¥çœ‹æœ¬æ–‡å‚è€ƒèµ„æ–™ </summary>
              <div class='content'>
              <table>    <tr>        <td align="center">åˆ†ç±»</td>        <td align="center">ç½‘å€</td>        <td align="center">è¯´æ˜</td>    </tr>    <tr>        <td align="center" rowspan="5">å®˜æ–¹ç½‘ç«™</td>        <td align="left"><a href="https://www.arm.com/" target="_blank">https://www.arm.com/</a></td>        <td align="left">ARMå®˜æ–¹ç½‘ç«™ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°Cotex-Mxä»¥åŠARMVxçš„ä¸€äº›æ–‡æ¡£</td>    </tr>    <tr>        <td align="left"><a href="https://www.nxp.com.cn/" target="_blank">https://www.nxp.com.cn/ </a></td>        <td align="left">NXPå®˜æ–¹ç½‘ç«™</td>    </tr>    <tr>        <td align="left"><a href="https://www.nxpic.org.cn/" target="_blank">https://www.nxpic.org.cn/</a></td><td align="left">NXP å®˜æ–¹ç¤¾åŒº</td>    </tr>    <tr>        <td align="left"><a href="https://u-boot.readthedocs.io/en/latest/" target="_blank">https://u-boot.readthedocs.io/en/latest/</a></td><td align="left">u-bootå®˜ç½‘</td>    </tr>    <tr>        <td align="left"><a href="https://www.kernel.org/" target="_blank">https://www.kernel.org/</a></td><td align="left">linuxå†…æ ¸å®˜ç½‘</td>    </tr>    <tr>        <td align="center" rowspan="5">å…¶ä»–ç½‘ç«™</td>        <td align="left"><a href="https://elixir.bootlin.com/linux/v4.15/source/kernel" target="_blank">kernel - Linux source code (v4.15) - Bootlin</a></td>        <td align="left">linuxå†…æ ¸æºç åœ¨çº¿æŸ¥çœ‹</td>    </tr></table>
              </div>
            </details>

<details class="folding-tag" blue><summary> ç‚¹å‡»æŸ¥çœ‹ç›¸å…³æ–‡ä»¶ä¸‹è½½ </summary>
              <div class='content'>
              <table>    <tr>        <td align="center">åˆ†ç±»</td>        <td align="center">ç½‘å€</td>        <td align="center">è¯´æ˜</td>    </tr>    <tr>        <td align="center" rowspan="3">NXP</td>        <td align="left"><a href="https://github.com/nxp-imx" target="_blank">https://github.com/nxp-imx</a></td>        <td align="left">NXP imxå¼€å‘èµ„æºGitHubç»„ç»‡ï¼Œé‡Œè¾¹ä¼šæœ‰u-bootå’Œlinuxå†…æ ¸çš„ä»“åº“</td>    </tr>    <tr>        <td align="left"><a href="https://github.com/nxp-imx/linux-imx/releases/tag/v4.19.71" target="_blank">nxp-imx/linux-imx/releases/tag/v4.19.71</a></td>        <td align="left">NXP linuxå†…æ ¸ä»“åº“tagsä¸­çš„v4.19.71</td>    </tr>    <tr>        <td align="left"><a href="https://github.com/nxp-imx/uboot-imx/releases/tag/rel_imx_4.19.35_1.1.0" target="_blank">nxp-imx/uboot-imx/releases/tag/rel_imx_4.19.35_1.1.0</a></td>        <td align="left">NXP u-bootä»“åº“tagsä¸­çš„rel_imx_4.19.35_1.1.0</td>    </tr>    <tr>        <td align="center" rowspan="2">I.MX6ULL</td>        <td align="left"><a href="https://www.nxp.com.cn/docs/en/data-sheet/IMX6ULLIEC.pdf" target="_blank">i.MX 6ULL Applications Processors for Industrial Products</a></td>        <td align="left">I.MX6ULL èŠ¯ç‰‡æ‰‹å†Œï¼ˆdatasheetï¼Œå¯ä»¥åœ¨çº¿æŸ¥çœ‹ï¼‰</td>    </tr>    <tr>        <td align="left"><a href="https://www.nxp.com.cn/webapp/Download?colCode=IMX6ULLRM&lang_cd=zh" target="_blank">i.MX 6ULL Applications ProcessorReference Manual</a></td>        <td align="left">I.MX6ULL å‚è€ƒæ‰‹å†Œï¼ˆä¸‹è½½åæ‰èƒ½æŸ¥çœ‹ï¼Œéœ€è¦ç™»å½•NXPå®˜ç½‘ï¼‰</td>    </tr>    <tr>        <td align="center" rowspan="2">Source Code</td>        <td align="left"><a href="https://elixir.bootlin.com/linux/latest/source" target="_blank">https://elixir.bootlin.com/linux/latest/source</a></td>        <td align="left">linux kernelæºç </td>    </tr>    <tr>        <td align="left"><a href="https://elixir.bootlin.com/u-boot/latest/source" target="_blank">https://elixir.bootlin.com/u-boot/latest/source</a></td>        <td align="left">ubootæºç </td>    </tr></table>
              </div>
            </details>

<h1 id="ä¸€ã€U-Booté¡¶å±‚MakefileåŸºç¡€"><a href="#ä¸€ã€U-Booté¡¶å±‚MakefileåŸºç¡€" class="headerlink" title="ä¸€ã€U-Booté¡¶å±‚MakefileåŸºç¡€"></a><font size=3>ä¸€ã€U-Booté¡¶å±‚MakefileåŸºç¡€</font></h1><h2 id="1-ç‰ˆæœ¬å·"><a href="#1-ç‰ˆæœ¬å·" class="headerlink" title="1. ç‰ˆæœ¬å·"></a><font size=3>1. ç‰ˆæœ¬å·</font></h2><p>ç‰ˆæœ¬å·å®šä¹‰åœ¨è¿™é‡Œï¼š<a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L3">Makefile</a></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">VERSION = 2019</span><br><span class="line">PATCHLEVEL = 04</span><br><span class="line">SUBLEVEL =</span><br><span class="line">EXTRAVERSION =</span><br><span class="line">NAME =</span><br></pre></td></tr></table></figure>

<p>VERSION æ˜¯ä¸»ç‰ˆæœ¬å·ï¼ŒPATCHLEVEL æ˜¯è¡¥ä¸ç‰ˆæœ¬å·ï¼ŒSUBLEVEL æ˜¯æ¬¡ç‰ˆæœ¬å·ï¼Œè¿™ä¸‰ä¸ªä¸€ èµ·æ„æˆäº† uboot çš„ç‰ˆæœ¬å·ï¼Œæ¯”å¦‚å½“å‰çš„ uboot ç‰ˆæœ¬å·å°±æ˜¯â€œ2019.04â€ã€‚EXTRAVERSION æ˜¯é™„åŠ  ç‰ˆæœ¬ä¿¡æ¯ï¼ŒNAME æ˜¯å’Œåå­—æœ‰å…³çš„ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨è¿™ä¸¤ä¸ªã€‚</p>
<h2 id="2-MAKEFLAGS-å˜é‡"><a href="#2-MAKEFLAGS-å˜é‡" class="headerlink" title="2.Â MAKEFLAGS å˜é‡"></a><font size=3>2.Â MAKEFLAGS å˜é‡</font></h2><p>make æ˜¯æ”¯æŒé€’å½’è°ƒç”¨çš„ï¼Œä¹Ÿå°±æ˜¯åœ¨ Makefile ä¸­ä½¿ç”¨â€œmakeâ€å‘½ä»¤æ¥æ‰§è¡Œå…¶ä»–çš„ Makefile æ–‡ä»¶ï¼Œä¸€èˆ¬éƒ½æ˜¯å­ç›®å½•ä¸­çš„ Makefile æ–‡ä»¶ã€‚å‡å¦‚åœ¨å½“å‰ç›®å½•ä¸‹å­˜åœ¨ä¸€ä¸ªâ€œsubdirâ€å­ç›®å½•ï¼Œè¿™ä¸ª å­ç›®å½•ä¸­åˆæœ‰å…¶å¯¹åº”çš„ Makefile æ–‡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªå·¥ç¨‹åœ¨ç¼–è¯‘çš„æ—¶å€™å…¶ä¸»ç›®å½•ä¸­çš„ Makefile å°±å¯ ä»¥è°ƒç”¨å­ç›®å½•ä¸­çš„ Makefileï¼Œä»¥æ­¤æ¥å®Œæˆæ‰€æœ‰å­ç›®å½•çš„ç¼–è¯‘ã€‚ä¸»ç›®å½•çš„ Makefile å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç æ¥ç¼–è¯‘è¿™ä¸ªå­ç›®å½•ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(MAKE)</span> -C subdir</span><br></pre></td></tr></table></figure>

<p>$(MAKE)å°±æ˜¯è°ƒç”¨â€œmakeâ€å‘½ä»¤ï¼Œ-C æŒ‡å®šå­ç›®å½•ã€‚æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦å‘å­ make ä¼ é€’å˜é‡ï¼Œ è¿™ä¸ªæ—¶å€™ä½¿ç”¨â€œexportâ€æ¥å¯¼å‡ºè¦ä¼ é€’ç»™å­ make çš„å˜é‡å³å¯ï¼Œå¦‚æœä¸å¸Œæœ›å“ªä¸ªå˜é‡ä¼ é€’ç»™å­ make çš„è¯å°±ä½¿ç”¨â€œunexportâ€æ¥å£°æ˜ä¸å¯¼å‡ºï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> VARIABLE   <span class="comment"># å¯¼å‡ºå˜é‡ç»™å­ make </span></span><br><span class="line"><span class="keyword">unexport</span> VARIABLE <span class="comment"># ä¸å¯¼å‡ºå˜é‡ç»™å­ make</span></span><br></pre></td></tr></table></figure>

<p>æœ‰ä¸¤ä¸ªç‰¹æ®Šçš„å˜é‡ï¼šâ€œSHELLâ€å’Œâ€œMAKEFLAGSâ€ï¼Œè¿™ä¸¤ä¸ªå˜é‡é™¤éä½¿ç”¨â€œunexportâ€å£°æ˜ï¼Œ å¦åˆ™çš„è¯åœ¨æ•´ä¸ªmakeçš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå®ƒä»¬çš„å€¼å§‹ç»ˆè‡ªåŠ¨çš„ä¼ é€’ç»™å­makeã€‚åœ¨ubootçš„ä¸» <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L18">Makefile</a> ä¸­æœ‰å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MAKEFLAGS += -rR --include-dir=<span class="variable">$(CURDIR)</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä»£ç ä½¿ç”¨â€œ+&#x3D;â€æ¥ç»™å˜é‡ MAKEFLAGS è¿½åŠ äº†ä¸€äº›å€¼ï¼Œâ€œ-rRâ€è¡¨ç¤ºç¦æ­¢ä½¿ç”¨å†…ç½®çš„éš å«è§„åˆ™å’Œå˜é‡å®šä¹‰ï¼Œâ€œâ€“include-dirâ€æŒ‡æ˜æœç´¢è·¯å¾„ï¼Œâ€$(CURDIR)â€è¡¨ç¤ºå½“å‰ç›®å½•ã€‚</p>
<h2 id="3-å‘½ä»¤è¾“å‡º"><a href="#3-å‘½ä»¤è¾“å‡º" class="headerlink" title="3. å‘½ä»¤è¾“å‡º"></a><font size=3>3. å‘½ä»¤è¾“å‡º</font></h2><h3 id="3-1-é»˜è®¤çš„è¾“å‡ºæƒ…å†µ"><a href="#3-1-é»˜è®¤çš„è¾“å‡ºæƒ…å†µ" class="headerlink" title="3.1 é»˜è®¤çš„è¾“å‡ºæƒ…å†µ"></a><font size=3>3.1 é»˜è®¤çš„è¾“å‡ºæƒ…å†µ</font></h3><p>uboot é»˜è®¤ç¼–è¯‘æ˜¯ä¸ä¼šåœ¨ç»ˆç«¯ä¸­æ˜¾ç¤ºå®Œæ•´çš„å‘½ä»¤ï¼Œéƒ½æ˜¯çŸ­å‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">sumu@sumu-virtual-machine:~/7Linux/imx6ull-uboot$  make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- -j16</span><br><span class="line">scripts/kconfig/conf  --syncconfig Kconfig</span><br><span class="line">  CHK     include/config.h</span><br><span class="line">  UPD     include/config.h</span><br><span class="line">  GEN     include/autoconf.mk.dep</span><br><span class="line">  CFG     u-boot.cfg</span><br><span class="line">  GEN     include/autoconf.mk</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">......</span></span><br><span class="line">*** Your GCC is older than 6.0 and will not be supported</span><br><span class="line">  HOSTCC  scripts/dtc/dtc.o</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">......</span></span><br><span class="line">  HOSTCC  tools/zynqimage.o</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">......</span></span><br><span class="line">  LD      fs/fat/built-in.o</span><br><span class="line">  CC      lib/efi_loader/efi_unicode_collation.o</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">......</span></span><br><span class="line">  OBJCOPY u-boot.srec</span><br><span class="line">  SYM     u-boot.sym</span><br><span class="line">  DTC     arch/arm/dts/imx6ull-14x14-ddr3-arm2.dtb</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">......</span></span><br><span class="line">  COPY    u-boot.dtb</span><br><span class="line">  COPY    u-boot.bin</span><br><span class="line">  CFGS    u-boot-dtb.cfgout</span><br><span class="line">  MKIMAGE u-boot-dtb.imx</span><br><span class="line">  CFGCHK  u-boot.cfg</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åœ¨ç»ˆç«¯ä¸­è¾“å‡ºçŸ­å‘½ä»¤è™½ç„¶çœ‹èµ·æ¥å¾ˆæ¸…çˆ½ï¼Œä½†æ˜¯ä¸åˆ©äºåˆ†æ uboot çš„ç¼–è¯‘è¿‡ç¨‹ã€‚</p>
<h3 id="3-2-å®Œæ•´å‘½ä»¤è¾“å‡º"><a href="#3-2-å®Œæ•´å‘½ä»¤è¾“å‡º" class="headerlink" title="3.2 å®Œæ•´å‘½ä»¤è¾“å‡º"></a><font size=3>3.2 å®Œæ•´å‘½ä»¤è¾“å‡º</font></h3><p>å¯ä»¥é€šè¿‡è®¾ ç½®å˜é‡â€œV&#x3D;1â€œæ¥å®ç°å®Œæ•´çš„å‘½ä»¤è¾“å‡ºï¼Œè¿™ä¸ªåœ¨è°ƒè¯• uboot çš„æ—¶å€™å¾ˆæœ‰ç”¨ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">sumu@sumu-virtual-machine:~/7Linux/imx6ull-uboot$  make V=1 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- -j16</span><br><span class="line">make -f ./Makefile syncconfig</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">......</span></span><br><span class="line">make -f ./scripts/Makefile.build obj=scripts/kconfig syncconfig</span><br><span class="line">mkdir -p include/config include/generated</span><br><span class="line">scripts/kconfig/conf  --syncconfig Kconfig</span><br><span class="line">make -f ./scripts/Makefile.autoconf || \</span><br><span class="line">	&#123; rm -f include/config/auto.conf; false; &#125;</span><br><span class="line">if [ -d arch/arm/mach-mx6/include/mach ]; then	\</span><br><span class="line">	dest=../../mach-mx6/include/mach;			\</span><br><span class="line">else								\</span><br><span class="line">	dest=arch-mx6;			\</span><br><span class="line">fi;								\</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">......</span></span><br><span class="line">*** Your GCC is older than 6.0 and will not be supported</span><br><span class="line">make -f ./scripts/Makefile.build obj=scripts</span><br><span class="line">make -f ./scripts/Makefile.build obj=scripts/dtc</span><br><span class="line">  cc -Wp,-MD,scripts/dtc/.dtc.o.d -Wall -Wstrict-prototypes -O2 -fomit-frame-pointer  -std=gnu11    -Iscripts/dtc -Iscripts/dtc/libfdt -c -o scripts/dtc/dtc.o scripts/dtc/dtc.c</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">......</span></span><br><span class="line">make -f ./scripts/Makefile.build obj=arch/arm/mach-imx u-boot-dtb.imx</span><br><span class="line">  cp u-boot-dtb.bin u-boot.bin</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">......</span></span><br><span class="line">  ./tools/mkimage -n u-boot-dtb.cfgout -T imximage -e 0x87800000 -d u-boot-dtb.bin u-boot-dtb.imx &gt;u-boot-dtb.imx.log  &amp;&amp; cat u-boot-dtb.imx.log</span><br><span class="line">Image Type:   Freescale IMX Boot Image</span><br><span class="line">Image Ver:    2 (i.MX53/6/7 compatible)</span><br><span class="line">Mode:         DCD</span><br><span class="line">Data Size:    675840 Bytes = 660.00 KiB = 0.64 MiB</span><br><span class="line">Load Address: 877ff420</span><br><span class="line">Entry Point:  87800000</span><br><span class="line">  ./scripts/check-config.sh u-boot.cfg ./scripts/config_whitelist.txt .</span><br></pre></td></tr></table></figure>

<h3 id="3-3-å‘½ä»¤è¾“å‡ºæ§åˆ¶"><a href="#3-3-å‘½ä»¤è¾“å‡ºæ§åˆ¶" class="headerlink" title="3.3 å‘½ä»¤è¾“å‡ºæ§åˆ¶"></a><font size=3>3.3 å‘½ä»¤è¾“å‡ºæ§åˆ¶</font></h3><h4 id="3-3-1-å‘½ä»¤è¾“å‡ºæ§åˆ¶å‘½ä»¤"><a href="#3-3-1-å‘½ä»¤è¾“å‡ºæ§åˆ¶å‘½ä»¤" class="headerlink" title="3.3.1 å‘½ä»¤è¾“å‡ºæ§åˆ¶å‘½ä»¤"></a><font size=3>3.3.1 å‘½ä»¤è¾“å‡ºæ§åˆ¶å‘½ä»¤</font></h4><p>é¡¶å±‚ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L71">Makefile</a> ä¸­æ§åˆ¶å‘½ä»¤è¾“å‡ºçš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ifeq</span> (<span class="string">&quot;$(origin V)&quot;</span>, <span class="string">&quot;command line&quot;</span>)</span><br><span class="line">  KBUILD_VERBOSE = <span class="variable">$(V)</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"><span class="keyword">ifndef</span> KBUILD_VERBOSE</span><br><span class="line">  KBUILD_VERBOSE = 0</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(KBUILD_VERBOSE)</span>,1)</span><br><span class="line">  quiet =</span><br><span class="line">  Q =</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  quiet=quiet_</span><br><span class="line">  Q = @</span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<h5 id="3-3-2-Vçš„æ¥æº"><a href="#3-3-2-Vçš„æ¥æº" class="headerlink" title="3.3.2 Vçš„æ¥æº"></a><font size=3>3.3.2 Vçš„æ¥æº</font></h5><p>Vçš„æ¥æºåœ¨<a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L71">Makefile</a>ä¸­æ˜¯è¿™ä¸€éƒ¨åˆ†ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ifeq</span> (<span class="string">&quot;$(origin V)&quot;</span>, <span class="string">&quot;command line&quot;</span>)</span><br><span class="line">  KBUILD_VERBOSE = <span class="variable">$(V)</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"><span class="keyword">ifndef</span> KBUILD_VERBOSE</span><br><span class="line">  KBUILD_VERBOSE = 0</span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä»£ç ä¸­å…ˆä½¿ç”¨ ifeq æ¥åˆ¤æ–­<code>&quot;$(origin V)&quot;</code>å’Œ<code>&quot;command line&quot;</code>æ˜¯å¦ç›¸ç­‰ã€‚è¿™é‡Œç”¨åˆ°äº† Makefile ä¸­çš„å‡½æ•° originï¼Œorigin å’Œå…¶ä»–çš„å‡½æ•°ä¸ä¸€æ ·ï¼Œå®ƒä¸æ“ä½œå˜é‡çš„å€¼ï¼Œorigin ç”¨äºå‘Šè¯‰ä½ å˜é‡æ˜¯å“ªæ¥çš„ï¼Œè¯­æ³•ä¸ºï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">origin</span> &lt;variable&gt;)</span></span><br></pre></td></tr></table></figure>

<p>variable æ˜¯å˜é‡åï¼Œorigin å‡½æ•°çš„è¿”å›å€¼å°±æ˜¯å˜é‡æ¥æºï¼Œå› æ­¤<code>$(origin V)</code>å°±æ˜¯å˜é‡ V çš„æ¥æºã€‚ å¦‚æœå˜é‡ V æ˜¯åœ¨å‘½ä»¤è¡Œå®šä¹‰çš„é‚£ä¹ˆå®ƒçš„æ¥æºå°±æ˜¯<code>&quot;command line&quot;</code>ï¼Œè¿™æ ·<code>&quot;$(origin V)&quot;</code>å’Œ<code>&quot;command line&quot;</code>å°±ç›¸ç­‰äº†ã€‚å½“è¿™ä¸¤ä¸ªç›¸ç­‰çš„æ—¶å€™å˜é‡ KBUILD_VERBOSE å°±ç­‰äº V çš„å€¼ï¼Œæ¯”å¦‚åœ¨å‘½ä»¤è¡Œä¸­ è¾“å…¥â€œ V&#x3D;1 â€œ çš„ è¯ é‚£ ä¹ˆ KBUILD_VERBOSE&#x3D;1 ã€‚å¦‚æœæ²¡æœ‰åœ¨å‘½ä»¤è¡Œè¾“å…¥ V çš„è¯ KBUILD_VERBOSE&#x3D;0ã€‚</p>
<h4 id="3-3-2-Qä¸quiet"><a href="#3-3-2-Qä¸quiet" class="headerlink" title="3.3.2 Qä¸quiet"></a><font size=3>3.3.2 Qä¸quiet</font></h4><p>è¿™ä¸¤ä¸ªå˜é‡çš„æ§åˆ¶åœ¨<a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L78">Makefile</a>ä¸­æ˜¯è¿™ä¸€éƒ¨åˆ†ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(KBUILD_VERBOSE)</span>,1)</span><br><span class="line">  quiet =</span><br><span class="line">  Q =</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  quiet=quiet_</span><br><span class="line">  Q = @</span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p>åˆ¤æ–­ KBUILD_VERBOSE æ˜¯å¦ä¸º 1ï¼Œå¦‚æœ KBUILD_VERBOSE ä¸º 1 çš„è¯å˜é‡ quietå’Œ Q éƒ½ä¸ºç©ºï¼Œå¦‚æœ KBUILD_VERBOSE&#x3D;0 çš„è¯å˜é‡ quiet ä¸ºâ€œquiet_â€œï¼Œå˜é‡ Q ä¸ºâ€œ@â€ï¼Œæ‰€ä»¥Vçš„ä½œç”¨æ˜¯ï¼š</p>
<ul>
<li>V &#x3D; 1</li>
</ul>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">KBUILD_VERBOSE=1</span><br><span class="line">quiet=ç©º</span><br><span class="line">Q=ç©º</span><br></pre></td></tr></table></figure>

<ul>
<li>V &#x3D; 0 æˆ–è€…å‘½ä»¤è¡Œä¸å®šä¹‰ V</li>
</ul>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">KBUILD_VERBOSE=0</span><br><span class="line">quiet= quiet_</span><br><span class="line">Q=@</span><br></pre></td></tr></table></figure>

<h3 id="3-4-æ€ä¹ˆæ§åˆ¶è¾“å‡ºä¿¡æ¯ï¼Ÿ"><a href="#3-4-æ€ä¹ˆæ§åˆ¶è¾“å‡ºä¿¡æ¯ï¼Ÿ" class="headerlink" title="3.4 æ€ä¹ˆæ§åˆ¶è¾“å‡ºä¿¡æ¯ï¼Ÿ"></a><font size=3>3.4 æ€ä¹ˆæ§åˆ¶è¾“å‡ºä¿¡æ¯ï¼Ÿ</font></h3><p>Makefile ä¸­ä¼šç”¨åˆ°å˜é‡ quiet å’Œ Q æ¥æ§åˆ¶ç¼–è¯‘çš„æ—¶å€™æ˜¯å¦åœ¨ç»ˆç«¯è¾“å‡ºå®Œæ•´çš„å‘½ä»¤ï¼Œåœ¨é¡¶å±‚ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L1722">Makefile</a> ä¸­æœ‰å¾ˆå¤šå¦‚ä¸‹æ‰€ç¤ºçš„å‘½ä»¤ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">tools-only: scripts_basic <span class="variable">$(version_h)</span> <span class="variable">$(timestamp_h)</span></span></span><br><span class="line">	<span class="variable">$(Q)</span><span class="variable">$(MAKE)</span> <span class="variable">$(build)</span>=tools</span><br></pre></td></tr></table></figure>

<p>å¦‚æœ V&#x3D;0 çš„è¯ä¸Šè¿°å‘½ä»¤å±•å¼€å°±æ˜¯ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@ make <span class="variable">$(build)</span>=tools</span><br></pre></td></tr></table></figure>

<p>make åœ¨æ‰§è¡Œçš„æ—¶å€™é»˜è®¤ä¼šåœ¨ç»ˆ ç«¯è¾“å‡ºå‘½ä»¤ï¼Œä½†æ˜¯åœ¨å‘½ä»¤å‰é¢åŠ ä¸Šâ€œ@â€å°±ä¸ä¼šåœ¨ç»ˆç«¯è¾“å‡ºå‘½ä»¤äº†ã€‚</p>
<p>å½“ V&#x3D;1 çš„æ—¶å€™ Q å°±ä¸ºç©ºï¼Œ ä¸Šè¿°å‘½ä»¤å°±æ˜¯ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make <span class="variable">$(build)</span>=tools</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶åœ¨ make æ‰§è¡Œçš„è¿‡ç¨‹ï¼Œå‘½ä»¤ä¼šè¢«å®Œæ•´çš„è¾“å‡ºåœ¨ç»ˆç«¯ä¸Šã€‚</p>
<p>æœ‰äº›å‘½ä»¤ä¼šæœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œæ¯”å¦‚ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L1515">Makefile</a> ä¸­çš„ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">quiet_cmd_sym ?= SYM     <span class="variable">$@</span></span><br><span class="line">      cmd_sym ?= <span class="variable">$(OBJDUMP)</span> -t <span class="variable">$&lt;</span> &gt; <span class="variable">$@</span></span><br></pre></td></tr></table></figure>

<p>sym å‘½ä»¤åˆ†ä¸ºâ€œquiet_cmd_symâ€å’Œâ€œcmd_symâ€ä¸¤ä¸ªç‰ˆæœ¬ï¼Œè¿™ä¸¤ä¸ªå‘½ä»¤çš„åŠŸèƒ½éƒ½æ˜¯ä¸€æ ·çš„ï¼Œ åŒºåˆ«åœ¨äº make æ‰§è¡Œçš„æ—¶å€™è¾“å‡ºçš„å‘½ä»¤ä¸åŒã€‚quiet_cmd_xxx å‘½ä»¤è¾“å‡ºä¿¡æ¯å°‘ï¼Œä¹Ÿå°±æ˜¯çŸ­å‘½ä»¤ï¼Œ è€Œ cmd_xxx å‘½ä»¤è¾“å‡ºä¿¡æ¯å¤šï¼Œä¹Ÿå°±æ˜¯å®Œæ•´çš„å‘½ä»¤ã€‚ å¦‚æœå˜é‡ quiet ä¸ºç©ºçš„è¯ï¼Œæ•´ä¸ªå‘½ä»¤éƒ½ä¼šè¾“å‡ºã€‚ å¦‚æœå˜é‡ quiet ä¸ºâ€œquiet_â€çš„è¯ï¼Œä»…è¾“å‡ºçŸ­ç‰ˆæœ¬ã€‚ å¦‚æœå˜é‡ quiet ä¸ºâ€œsilent_â€çš„è¯ï¼Œæ•´ä¸ªå‘½ä»¤éƒ½ä¸ä¼šè¾“å‡ºã€‚è¿™éƒ¨åˆ†åœ¨<a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L45">Makefile - <em>Beautify output</em></a> ä¸­æœ‰è¯´æ˜ã€‚</p>
<h3 id="3-5-é™é»˜è¾“å‡º"><a href="#3-5-é™é»˜è¾“å‡º" class="headerlink" title="3.5Â é™é»˜è¾“å‡º"></a><font size=3>3.5Â é™é»˜è¾“å‡º</font></h3><h4 id="3-5-1-é™é»˜è¾“å‡ºå‘½ä»¤"><a href="#3-5-1-é™é»˜è¾“å‡ºå‘½ä»¤" class="headerlink" title="3.5.1 é™é»˜è¾“å‡ºå‘½ä»¤"></a><font size=3>3.5.1 é™é»˜è¾“å‡ºå‘½ä»¤</font></h4><p>è®¾ç½® V&#x3D;0 æˆ–è€…åœ¨å‘½ä»¤è¡Œä¸­ä¸å®šä¹‰ V çš„è¯ï¼Œç¼–è¯‘ uboot çš„æ—¶å€™ç»ˆç«¯ä¸­æ˜¾ç¤ºçš„çŸ­å‘½ä»¤ï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šæœ‰å‘½ä»¤è¾“å‡ºï¼Œæœ‰æ—¶å€™æˆ‘ä»¬åœ¨ç¼–è¯‘ uboot çš„æ—¶å€™ä¸éœ€è¦è¾“å‡ºå‘½ä»¤ï¼Œè¿™ä¸ªæ—¶å€™ å°±å¯ä»¥ä½¿ç”¨ uboot çš„é™é»˜è¾“å‡ºåŠŸèƒ½ã€‚ç¼–è¯‘çš„æ—¶å€™ä½¿ç”¨è¿™ä¸ªå‘½ä»¤å°±å¯ä»¥å®ç°ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make -s</span><br></pre></td></tr></table></figure>

<p>å³å¯å®ç°é™é»˜è¾“å‡ºï¼Œé¡¶å±‚ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L86">Makefile</a> ä¸­ç›¸åº”çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># If the user is running make -s (silent mode), suppress echoing of</span></span><br><span class="line"><span class="comment"># commands</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ifneq</span> (<span class="variable">$(<span class="built_in">filter</span> 4.%,<span class="variable">$(MAKE_VERSION)</span>)</span>,)	<span class="comment"># make-4</span></span><br><span class="line"><span class="keyword">ifneq</span> (<span class="variable">$(<span class="built_in">filter</span> %s ,$(<span class="built_in">firstword</span> x<span class="variable">$(MAKEFLAGS)</span>)</span>),)</span><br><span class="line">  quiet=silent_</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"><span class="keyword">else</span>					<span class="comment"># make-3.8x</span></span><br><span class="line"><span class="keyword">ifneq</span> (<span class="variable">$(<span class="built_in">filter</span> s% -s%,<span class="variable">$(MAKEFLAGS)</span>)</span>,)</span><br><span class="line">  quiet=silent_</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<h4 id="3-5-2-makeç‰ˆæœ¬å·åˆ¤æ–­"><a href="#3-5-2-makeç‰ˆæœ¬å·åˆ¤æ–­" class="headerlink" title="3.5.2 makeç‰ˆæœ¬å·åˆ¤æ–­"></a><font size=3>3.5.2 makeç‰ˆæœ¬å·åˆ¤æ–­</font></h4><p>å…ˆçœ‹<a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L89">Makefile</a> è¿™ä¸€éƒ¨åˆ†ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ifneq</span> (<span class="variable">$(<span class="built_in">filter</span> 4.%,<span class="variable">$(MAKE_VERSION)</span>)</span>,)	<span class="comment"># make-4</span></span><br><span class="line"><span class="comment"># (1)......</span></span><br><span class="line"><span class="keyword">else</span>					<span class="comment"># make-3.8x</span></span><br><span class="line"><span class="comment"># (2)......</span></span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œåœ¨åˆ¤æ–­å½“å‰æ­£åœ¨ä½¿ç”¨çš„makeå‘½ä»¤ç‰ˆæœ¬å·æ˜¯å¦ä¸º 4.xï¼Œé¦–å…ˆè¿›è¡Œå¦‚ä¸‹åˆ¤æ–­ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åˆ¤æ–­ <span class="variable">$(<span class="built_in">filter</span> 4.%,<span class="variable">$(MAKE_VERSION)</span>)</span> å’Œ <span class="string">&quot; &quot;</span>(ç©º)æ˜¯å¦ç›¸ç­‰ï¼Ÿ</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸ç›¸ç­‰çš„è¯å°±æˆç«‹ï¼Œæ‰§è¡Œé‡Œé¢çš„(1)è¯­å¥ã€‚è¿™é‡Œç”¨åˆ°äº† Makefile ä¸­çš„ filter å‡½æ•°ï¼Œè¿™æ˜¯ ä¸ªè¿‡æ»¤å‡½æ•°ï¼Œå‡½æ•°æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">filter</span> &lt;pattern...&gt;,&lt;text&gt;)</span></span><br></pre></td></tr></table></figure>

<p>filter å‡½æ•°è¡¨ç¤ºä»¥ pattern æ¨¡å¼è¿‡æ»¤ text å­—ç¬¦ä¸²ä¸­çš„å•è¯ï¼Œä»…ä¿ç•™ç¬¦åˆæ¨¡å¼ pattern çš„å•è¯ï¼Œ å¯ä»¥æœ‰å¤šä¸ªæ¨¡å¼ã€‚å‡½æ•°è¿”å›å€¼å°±æ˜¯ç¬¦åˆ pattern çš„å­—ç¬¦ä¸²ã€‚</p>
<p>å› æ­¤<code>$(filter 4.%,$(MAKE_VERSION)) </code>çš„å«ä¹‰å°±æ˜¯åœ¨å­—ç¬¦ä¸² â€œMAKE_VERSIONâ€ ä¸­æ‰¾å‡ºç¬¦åˆâ€œ4.%â€çš„å­—ç¬¦(%ä¸ºé€šé…ç¬¦)ï¼Œ MAKE_VERSION æ˜¯makeå·¥å…·çš„ç‰ˆæœ¬å·ï¼Œubuntu16.04é‡Œé¢é»˜è®¤è‡ªå¸¦çš„makeå·¥å…·ç‰ˆæœ¬å·ä¸º4.1ï¼Œä¹‹åçš„ç‰ˆæœ¬åº”è¯¥éƒ½æ˜¯4.1åŠä»¥ä¸Šäº†ï¼Œ æˆ‘ä»¬å¯ä»¥åœ¨ubuntuä¸­è¾“å…¥â€œmake -vâ€æŸ¥çœ‹ã€‚æ‰€ä»¥ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">filter</span> 4.%,<span class="variable">$(MAKE_VERSION)</span>)</span> != <span class="string">&quot; &quot;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ¡ä»¶æˆç«‹ã€‚åç»­èµ°ï¼ˆ1ï¼‰å¤„çš„è¯­å¥ã€‚</p>
<h4 id="3-5-3-ç¡®å®šquietçš„å€¼"><a href="#3-5-3-ç¡®å®šquietçš„å€¼" class="headerlink" title="3.5.3 ç¡®å®šquietçš„å€¼"></a><font size=3>3.5.3 ç¡®å®šquietçš„å€¼</font></h4><p>ä¸Šé¢æˆ‘ä»¬å·²ç»ç¡®è®¤æ¡ä»¶æˆç«‹ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥èµ°çš„æ˜¯ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L90">Makefile</a> è¿™ä¸€éƒ¨åˆ†çš„å‘½ä»¤ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ifneq</span> (<span class="variable">$(<span class="built_in">filter</span> 4.%,<span class="variable">$(MAKE_VERSION)</span>)</span>,)	<span class="comment"># make-4</span></span><br><span class="line"><span class="keyword">ifneq</span> (<span class="variable">$(<span class="built_in">filter</span> %s ,$(<span class="built_in">firstword</span> x<span class="variable">$(MAKEFLAGS)</span>)</span>),)</span><br><span class="line">  quiet=silent_</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"><span class="keyword">else</span>					<span class="comment"># make-3.8x</span></span><br><span class="line"><span class="comment"># ......</span></span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¹Ÿæ˜¯ä¸€ä¸ªåˆ¤æ–­è¯­å¥</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">filter</span> %s ,$(<span class="built_in">firstword</span> x<span class="variable">$(MAKEFLAGS)</span>)</span>) != <span class="string">&quot; &quot;</span> (ç©º)</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸Šé¢çš„æ¡ä»¶æˆç«‹ï¼Œå˜é‡ quiet ç­‰äºâ€œsilent_â€ã€‚è¿™é‡Œä¹Ÿç”¨åˆ°äº†å‡½æ•° filterï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">firstword</span> x<span class="variable">$(MAKEFLAGS)</span>)</span>)</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šé¢è¿™ä¸ªå‡½æ•°ä¸­è¿‡æ»¤å‡ºç¬¦åˆâ€œ%sâ€çš„å•è¯ã€‚åˆ°äº†å‡½æ•° firstwordï¼Œå‡½æ•° firstword æ˜¯è·å–é¦–å•è¯ï¼Œå‡½æ•°æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">firstword</span> &lt;text&gt;)</span></span><br></pre></td></tr></table></figure>

<p>firstword å‡½æ•°ç”¨äºå–å‡º text å­—ç¬¦ä¸²ä¸­çš„ç¬¬ä¸€ä¸ªå•è¯ï¼Œå‡½æ•°çš„è¿”å›å€¼å°±æ˜¯è·å–åˆ°çš„å•è¯ã€‚å½“ ä½¿ç”¨â€œmake -sâ€ç¼–è¯‘çš„æ—¶å€™ï¼Œâ€œ-sâ€ä¼šä½œä¸º MAKEFLAGS å˜é‡çš„ä¸€éƒ¨åˆ†ä¼ é€’ç»™ Makefileã€‚åœ¨é¡¶å±‚ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L98">Makefile</a> çš„è¿™æ®µå‘½ä»¤ä¹‹åæ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ifneq</span> (<span class="variable">$(<span class="built_in">filter</span> 4.%,<span class="variable">$(MAKE_VERSION)</span>)</span>,)	<span class="comment"># make-4</span></span><br><span class="line"><span class="comment">#......</span></span><br><span class="line"><span class="keyword">else</span>					<span class="comment"># make-3.8x</span></span><br><span class="line"><span class="comment"># ......</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"><span class="section">my_test:</span></span><br><span class="line">	@echo <span class="string">&quot;first word=&quot;</span><span class="variable">$(<span class="built_in">firstword</span> x<span class="variable">$(MAKEFLAGS)</span>)</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬åœ¨æºç ç›®å½•æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œçœ‹ä¸€ä¸‹è¿™ä¸ªåˆ°åº•è¾“å‡ºçš„æ˜¯å•¥ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sumu@sumu-virtual-machine:~/7Linux/imx6ull-uboot$  make -s ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- my_test -j16</span><br><span class="line">first word=xrRs</span><br></pre></td></tr></table></figure>

<p>ä»è¾“å‡ºå¯ä»¥çœ‹å‡ºç¬¬ä¸€ä¸ªå•è¯æ˜¯â€œxrRsâ€ï¼ŒæŠŠä¸‹é¢çš„å‘½ä»¤å±•å¼€</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">filter</span> %s ,$(<span class="built_in">firstword</span> x<span class="variable">$(MAKEFLAGS)</span>)</span>) </span><br><span class="line"><span class="comment"># å±•å¼€å°±æ˜¯</span></span><br><span class="line"><span class="variable">$(<span class="built_in">filter</span> %s, xrRs)</span></span><br></pre></td></tr></table></figure>

<p>è€Œ$(filter %s, xrRs)çš„è¿”å›å€¼è‚¯å®šä¸ä¸ºç©ºï¼Œæ¡ä»¶æˆç«‹ï¼Œæ‰€ä»¥quiet&#x3D;silent_ã€‚ </p>
<h3 id="3-6-å¯¼å‡ºå˜é‡"><a href="#3-6-å¯¼å‡ºå˜é‡" class="headerlink" title="3.6 å¯¼å‡ºå˜é‡"></a><font size=3>3.6 å¯¼å‡ºå˜é‡</font></h3><p>ä¸Šé¢å…³äºå‘½ä»¤è¾“å‡ºçš„å˜é‡çš„å€¼éƒ½å·²ç»ç¡®å®šå®Œæ¯•äº†ï¼Œæœ€åä½¿ç”¨exportå‘½ä»¤å¯¼å‡ºï¼Œå¯¼å‡ºå‘½ä»¤åœ¨è¿™é‡Œï¼š<a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L99">Makefile</a></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> quiet Q KBUILD_VERBOSE</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ export å¯¼å‡ºå˜é‡ quietã€Q å’Œ KBUILD_VERBOSEã€‚</p>
<h2 id="4-è®¾ç½®ç¼–è¯‘ç»“æœè¾“å‡ºç›®å½•"><a href="#4-è®¾ç½®ç¼–è¯‘ç»“æœè¾“å‡ºç›®å½•" class="headerlink" title="4.Â è®¾ç½®ç¼–è¯‘ç»“æœè¾“å‡ºç›®å½•"></a><font size=3>4.Â è®¾ç½®ç¼–è¯‘ç»“æœè¾“å‡ºç›®å½•</font></h2><h3 id="4-1-è¾“å‡ºç›®å½•æ§åˆ¶å‘½ä»¤"><a href="#4-1-è¾“å‡ºç›®å½•æ§åˆ¶å‘½ä»¤" class="headerlink" title="4.1 è¾“å‡ºç›®å½•æ§åˆ¶å‘½ä»¤Â "></a><font size=3>4.1 è¾“å‡ºç›®å½•æ§åˆ¶å‘½ä»¤Â </font></h3><p>uboot å¯ä»¥å°†ç¼–è¯‘å‡ºæ¥çš„ç›®æ ‡æ–‡ä»¶è¾“å‡ºåˆ°å•ç‹¬çš„ç›®å½•ä¸­ï¼Œåœ¨ make çš„æ—¶å€™ä½¿ç”¨â€œOâ€æ¥æŒ‡å®š è¾“å‡ºç›®å½•ã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make O=out</span><br></pre></td></tr></table></figure>

<p>å°±æ˜¯è®¾ç½®ç›®æ ‡æ–‡ä»¶è¾“å‡ºåˆ° out ç›®å½•ä¸­ã€‚è¿™ä¹ˆåšæ˜¯ä¸ºäº†å°†æºæ–‡ä»¶å’Œç¼–è¯‘äº§ç”Ÿçš„æ–‡ä»¶åˆ†å¼€ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä¸æŒ‡å®š O å‚æ•°ï¼Œä¸æŒ‡å®šçš„è¯æºæ–‡ä»¶å’Œç¼–è¯‘äº§ç”Ÿçš„æ–‡ä»¶éƒ½åœ¨ åŒä¸€ä¸ªç›®å½•å†…ï¼Œä¸€èˆ¬åœ¨è¿›è¡Œubootç¼–è¯‘çš„æ—¶å€™æˆ‘ä»¬ä¸æŒ‡å®š O å‚æ•°ã€‚åœ¨ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L101">Makefile</a> ä¸­å®ç°è®¾ç½®è¾“å‡ºç›®å½•çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ......</span></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(KBUILD_SRC)</span>,)</span><br><span class="line"></span><br><span class="line"><span class="comment"># OK, Make called in directory where kernel src resides</span></span><br><span class="line"><span class="comment"># Do we want to locate output files in a separate directory?</span></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="string">&quot;$(origin O)&quot;</span>, <span class="string">&quot;command line&quot;</span>)</span><br><span class="line">  KBUILD_OUTPUT := <span class="variable">$(O)</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># That&#x27;s our default target when none is given on the command line</span></span><br><span class="line">PHONY := _all</span><br><span class="line"><span class="section">_all:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Cancel implicit rules on top Makefile</span></span><br><span class="line"><span class="variable">$(CURDIR)</span>/Makefile Makefile: ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ifneq</span> (<span class="variable">$(KBUILD_OUTPUT)</span>,)</span><br><span class="line"><span class="comment"># Invoke a second make in the output directory, passing relevant variables</span></span><br><span class="line"><span class="comment"># check that the output directory actually exists</span></span><br><span class="line">saved-output := <span class="variable">$(KBUILD_OUTPUT)</span></span><br><span class="line">KBUILD_OUTPUT := <span class="variable">$(<span class="built_in">shell</span> mkdir -p <span class="variable">$(KBUILD_OUTPUT)</span> &amp;&amp; cd <span class="variable">$(KBUILD_OUTPUT)</span> \</span></span><br><span class="line"><span class="variable">								&amp;&amp; /bin/pwd)</span></span><br><span class="line"><span class="variable">$(<span class="built_in">if</span> <span class="variable">$(KBUILD_OUTPUT)</span>,, \</span></span><br><span class="line"><span class="variable">     $(<span class="built_in">error</span> failed to create output directory &quot;$(saved-output)</span><span class="string">&quot;))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">PHONY += <span class="variable">$(MAKECMDGOALS)</span> sub-make</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$(filter-out _all sub-make <span class="variable">$(CURDIR)</span>/Makefile, <span class="variable">$(MAKECMDGOALS)</span>) _all: sub-make</span></span><br><span class="line"><span class="string">	@:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">sub-make: FORCE</span></span><br><span class="line"><span class="string">	<span class="variable">$(Q)</span><span class="variable">$(MAKE)</span> -C <span class="variable">$(KBUILD_OUTPUT)</span> KBUILD_SRC=<span class="variable">$(CURDIR)</span> \</span></span><br><span class="line"><span class="string">	-f <span class="variable">$(CURDIR)</span>/Makefile $(filter-out _all sub-make,<span class="variable">$(MAKECMDGOALS)</span>)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Leave processing to above invocation of make</span></span><br><span class="line"><span class="string">skip-makefile := 1</span></span><br><span class="line"><span class="string">endif # ifneq (<span class="variable">$(KBUILD_OUTPUT)</span>,)</span></span><br><span class="line"><span class="string">endif # ifeq (<span class="variable">$(KBUILD_SRC)</span>,)</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-Oå‚æ•°æ¥æºåˆ¤æ–­"><a href="#4-2-Oå‚æ•°æ¥æºåˆ¤æ–­" class="headerlink" title="4.2 Oå‚æ•°æ¥æºåˆ¤æ–­"></a><font size=3>4.2 Oå‚æ•°æ¥æºåˆ¤æ–­</font></h3><p><a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L122">Makefile</a>æ–‡ä»¶åˆ¤æ–­Oå‚æ•°æ¥æºçš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ifeq</span> (<span class="string">&quot;$(origin O)&quot;</span>, <span class="string">&quot;command line&quot;</span>)</span><br><span class="line">  KBUILD_OUTPUT := <span class="variable">$(O)</span></span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p>è¡Œåˆ¤æ–­â€œOâ€æ˜¯å¦æ¥è‡ªäºå‘½ä»¤è¡Œï¼Œå¦‚æœæ¥è‡ªå‘½ä»¤è¡Œçš„è¯æ¡ä»¶æˆç«‹ï¼ŒKBUILD_OUTPUT å°±ä¸º$(O)ï¼Œå› æ­¤å˜é‡ KBUILD_OUTPUT å°±æ˜¯è¾“å‡ºç›®å½•ã€‚</p>
<h3 id="4-3-åˆ›å»ºKBUILD-OUTPUTç›®å½•"><a href="#4-3-åˆ›å»ºKBUILD-OUTPUTç›®å½•" class="headerlink" title="4.3 åˆ›å»ºKBUILD_OUTPUTç›®å½•"></a><font size=3>4.3 åˆ›å»ºKBUILD_OUTPUTç›®å½•</font></h3><p>è¿˜éœ€è¦åˆ¤æ–­ä¸€ä¸‹è¿™ä¸ªKBUILD_OUTPUTç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨çš„è¯ï¼Œä¼šè¿›è¡Œåˆ›å»ºï¼Œ<a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L136">Makefile </a>ä¸­å¯¹åº”çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">saved-output := <span class="variable">$(KBUILD_OUTPUT)</span></span><br><span class="line">KBUILD_OUTPUT := <span class="variable">$(<span class="built_in">shell</span> mkdir -p <span class="variable">$(KBUILD_OUTPUT)</span> &amp;&amp; cd <span class="variable">$(KBUILD_OUTPUT)</span> \</span></span><br><span class="line"><span class="variable">								&amp;&amp; /bin/pwd)</span></span><br><span class="line"><span class="variable">$(<span class="built_in">if</span> <span class="variable">$(KBUILD_OUTPUT)</span>,, \</span></span><br><span class="line"><span class="variable">     $(<span class="built_in">error</span> failed to create output directory &quot;$(saved-output)</span><span class="string">&quot;))</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œç›¸å½“äºå°†KBUILD_OUTPUTé‡æ–°èµ‹å€¼äº†ä¸€ä¸‹ï¼Œä»ç›¸å¯¹è·¯å¾„å˜ä¸ºç»å¯¹è·¯å¾„ã€‚ç»è¿‡è¿™é‡Œä¹‹åï¼Œä¸€ä¸ªä¸å­˜åœ¨çš„è¾“å‡ºç›®å½•å°±è¢«åˆ›å»ºå¥½äº†ã€‚</p>
<h2 id="5-ä»£ç æ£€æŸ¥"><a href="#5-ä»£ç æ£€æŸ¥" class="headerlink" title="5. ä»£ç æ£€æŸ¥"></a><font size=3>5. ä»£ç æ£€æŸ¥</font></h2><h3 id="5-1-ä»£ç æ£€æŸ¥æ§åˆ¶å‘½ä»¤"><a href="#5-1-ä»£ç æ£€æŸ¥æ§åˆ¶å‘½ä»¤" class="headerlink" title="5.1 ä»£ç æ£€æŸ¥æ§åˆ¶å‘½ä»¤"></a><font size=3>5.1 ä»£ç æ£€æŸ¥æ§åˆ¶å‘½ä»¤</font></h3><p>uboot æ”¯æŒä»£ç æ£€æŸ¥ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make C=1 # ä½¿èƒ½ä»£ç æ£€æŸ¥ï¼Œæ£€æŸ¥é‚£äº›éœ€è¦é‡æ–°ç¼–è¯‘çš„æ–‡ä»¶ã€‚</span><br><span class="line">make C=2 # ç”¨äºæ£€æŸ¥æ‰€æœ‰çš„æºç æ–‡ä»¶</span><br></pre></td></tr></table></figure>

<h3 id="5-2-KBUILD-CHECKSRC"><a href="#5-2-KBUILD-CHECKSRC" class="headerlink" title="5.2Â KBUILD_CHECKSRC"></a><font size=3>5.2Â KBUILD_CHECKSRC</font></h3><p>é¡¶å±‚ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L167">Makefile</a> ä¸­çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Call a source code checker (by default, &quot;sparse&quot;) as part of the</span></span><br><span class="line"><span class="comment"># C compilation.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Use &#x27;make C=1&#x27; to enable checking of only re-compiled files.</span></span><br><span class="line"><span class="comment"># Use &#x27;make C=2&#x27; to enable checking of *all* source files, regardless</span></span><br><span class="line"><span class="comment"># of whether they are re-compiled or not.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># See the file &quot;doc/sparse.txt&quot; for more details, including</span></span><br><span class="line"><span class="comment"># where to get the &quot;sparse&quot; utility.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="string">&quot;$(origin C)&quot;</span>, <span class="string">&quot;command line&quot;</span>)</span><br><span class="line">  KBUILD_CHECKSRC = <span class="variable">$(C)</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"><span class="keyword">ifndef</span> KBUILD_CHECKSRC</span><br><span class="line">  KBUILD_CHECKSRC = 0</span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p>å’Œå‰é¢ä¸€æ ·ï¼Œåˆ¤æ–­ä¸€ä¸‹ C æ˜¯å¦æ¥æºäºå‘½ä»¤è¡Œï¼Œå¦‚æœ C æ¥æºäºå‘½ä»¤è¡Œï¼Œé‚£å°±å°† C èµ‹å€¼ç»™å˜é‡ KBUILD_CHECKSRCï¼Œå¦‚æœå‘½ä»¤è¡Œæ²¡æœ‰ C çš„è¯ KBUILD_CHECKSRC å°±ä¸º 0ã€‚</p>
<h2 id="6-æ¨¡å—ç¼–è¯‘"><a href="#6-æ¨¡å—ç¼–è¯‘" class="headerlink" title="6. æ¨¡å—ç¼–è¯‘"></a><font size=3>6. æ¨¡å—ç¼–è¯‘</font></h2><h3 id="6-1-æ¨¡å—ç¼–è¯‘å‘½ä»¤"><a href="#6-1-æ¨¡å—ç¼–è¯‘å‘½ä»¤" class="headerlink" title="6.1 æ¨¡å—ç¼–è¯‘å‘½ä»¤"></a><font size=3>6.1 æ¨¡å—ç¼–è¯‘å‘½ä»¤</font></h3><p>åœ¨ uboot ä¸­å…è®¸å•ç‹¬ç¼–è¯‘æŸä¸ªæ¨¡å—ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make M=dir</span><br><span class="line">make SUBDIRS=dir # æ—§è¯­æ³•æ˜¯è¿™æ ·çš„ï¼Œä¹Ÿæ˜¯æ”¯æŒçš„ã€‚</span><br></pre></td></tr></table></figure>

<h3 id="6-2-KBUILD-EXTMOD"><a href="#6-2-KBUILD-EXTMOD" class="headerlink" title="6.2Â KBUILD_EXTMOD"></a><font size=3>6.2Â KBUILD_EXTMOD</font></h3><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L181">Makefile</a> ä¸­å¯¹è¿™ä¸ªå‚æ•°çš„å®šä¹‰ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Use make M=dir to specify directory of external module to build</span></span><br><span class="line"><span class="comment"># Old syntax make ... SUBDIRS=$PWD is still supported</span></span><br><span class="line"><span class="comment"># Setting the environment variable KBUILD_EXTMOD take precedence</span></span><br><span class="line"><span class="keyword">ifdef</span> SUBDIRS</span><br><span class="line">  KBUILD_EXTMOD ?= <span class="variable">$(SUBDIRS)</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="string">&quot;$(origin M)&quot;</span>, <span class="string">&quot;command line&quot;</span>)</span><br><span class="line">  KBUILD_EXTMOD := <span class="variable">$(M)</span></span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆåˆ¤æ–­æ˜¯å¦å®šä¹‰äº† SUBDIRS ï¼Œ å¦‚æœå®šä¹‰äº† SUBDIRS ï¼Œ å˜é‡ KBUILD_EXTMOD&#x3D;SUBDIRSï¼Œè¿™é‡Œæ˜¯ä¸ºäº†æ”¯æŒè€è¯­æ³•â€œmake SUBIDRS&#x3D;dirâ€ ã€‚</p>
<p>æ¥ç€åé¢æ˜¯åˆ¤æ–­æ˜¯å¦åœ¨å‘½ä»¤è¡Œå®šä¹‰äº† Mï¼Œå¦‚æœå®šä¹‰äº†çš„è¯ KBUILD_EXTMOD&#x3D;$(M)ã€‚</p>
<h3 id="6-3-ç¼–è¯‘ç›®æ ‡"><a href="#6-3-ç¼–è¯‘ç›®æ ‡" class="headerlink" title="6.3 ç¼–è¯‘ç›®æ ‡"></a><font size=3>6.3 ç¼–è¯‘ç›®æ ‡</font></h3><p>æ¥ç€æ˜¯æ ¹æ®ä¸Šé¢çš„KBUILD_EXTMODæ˜¯å¦ä¸ºç©ºæ¥ç¡®å®šç¼–è¯‘ç›®æ ‡ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L192">Makefile</a> æ–‡ä»¶ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># If building an external module we do not care about the all: rule</span></span><br><span class="line"><span class="comment"># but instead _all depend on modules</span></span><br><span class="line">PHONY += all</span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(KBUILD_EXTMOD)</span>,)</span><br><span class="line"><span class="section">_all: all</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="section">_all: modules</span></span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p>åˆ¤æ–­ KBUILD_EXTMOD æ—¶ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºçš„è¯ç›®æ ‡_all ä¾èµ– allï¼Œå› æ­¤è¦å…ˆç¼–è¯‘å‡º allã€‚å¦åˆ™çš„è¯é»˜è®¤ç›®æ ‡_all ä¾èµ– modulesï¼Œè¦å…ˆç¼–è¯‘å‡º modulesï¼Œä¹Ÿå°±æ˜¯ç¼–è¯‘æ¨¡å—ã€‚ä¸€èˆ¬æƒ…å†µ ä¸‹æˆ‘ä»¬ä¸ä¼šåœ¨ uboot ä¸­ç¼–è¯‘æ¨¡å—ï¼Œæ‰€ä»¥æ­¤å¤„ä¼šç¼–è¯‘ all è¿™ä¸ªç›®æ ‡ã€‚</p>
<h2 id="7-VPATHçš„é…ç½®"><a href="#7-VPATHçš„é…ç½®" class="headerlink" title="7. VPATHçš„é…ç½®"></a><font size=3>7. VPATHçš„é…ç½®</font></h2><p>çœ‹ä¸€ä¸‹ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L201">Makefile</a> è¿™ä¸€éƒ¨åˆ†ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(KBUILD_SRC)</span>,)</span><br><span class="line">        <span class="comment"># building in the source tree</span></span><br><span class="line">        srctree := .</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        <span class="keyword">ifeq</span> (<span class="variable">$(KBUILD_SRC)</span>/,<span class="variable">$(<span class="built_in">dir</span> <span class="variable">$(CURDIR)</span>)</span>)</span><br><span class="line">                <span class="comment"># building in a subdirectory of the source tree</span></span><br><span class="line">                srctree := ..</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">                srctree := <span class="variable">$(KBUILD_SRC)</span></span><br><span class="line">        <span class="keyword">endif</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line">objtree		:= .</span><br><span class="line">src		:= <span class="variable">$(srctree)</span></span><br><span class="line">obj		:= <span class="variable">$(objtree)</span></span><br><span class="line"></span><br><span class="line">VPATH		:= <span class="variable">$(srctree)</span><span class="variable">$(<span class="built_in">if</span> <span class="variable">$(KBUILD_EXTMOD)</span>,:<span class="variable">$(KBUILD_EXTMOD)</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> srctree objtree VPATH</span><br></pre></td></tr></table></figure>

<p>ç¬¬ 1~11 è¡Œåˆ¤æ–­ KBUILD_SRC æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºçš„è¯å°±è®¾ç½®å˜é‡ srctree ä¸ºå½“å‰ç›®å½•ï¼Œå³ srctree ä¸ºâ€œ.â€ï¼Œä¸€èˆ¬ä¸è®¾ç½® KBUILD_SRCã€‚ </p>
<p>ç¬¬ 12 è¡Œè®¾ç½®å˜é‡ objtree ä¸ºå½“å‰ç›®å½•ã€‚ </p>
<p>ç¬¬ 13~14 è¡Œåˆ†åˆ«è®¾ç½®å˜é‡ src å’Œ objï¼Œæ ¹æ®å‰é¢çš„å˜é‡çš„å€¼ï¼Œè¿™é‡Œéƒ½ä¸ºå½“å‰ç›®å½•ã€‚</p>
<p>ç¬¬ 16 è¡Œè®¾ç½® VPATHã€‚ è¿™é‡Œä¼šKBUILD_EXTMODæ˜¯å¦ä¸ºç©ºï¼Œè¦æ˜¯éç©ºï¼Œè¿™é‡Œå°±ä¼šåŠ å…¥KBUILD_EXTMODè·¯å¾„ã€‚ä¹Ÿå°±æ˜¯è¦ç¼–è¯‘çš„æ¨¡å—çš„è·¯å¾„ã€‚</p>
<p>ç¬¬ 18 è¡Œå¯¼å‡ºå˜é‡ scrtreeã€objtree å’Œ VPATHã€‚</p>
<h2 id="8-ç¼–è¯‘å¹³å°"><a href="#8-ç¼–è¯‘å¹³å°" class="headerlink" title="8. ç¼–è¯‘å¹³å°"></a><font size=3>8. ç¼–è¯‘å¹³å°</font></h2><h3 id="8-1-ä¸»æœºæ¶æ„-HOSTARCH"><a href="#8-1-ä¸»æœºæ¶æ„-HOSTARCH" class="headerlink" title="8.1 ä¸»æœºæ¶æ„ HOSTARCH"></a><font size=3>8.1 ä¸»æœºæ¶æ„ HOSTARCH</font></h3><p>HOSTARCHåœ¨<a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L225">Makefile</a>ä¸­å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HOSTARCH := $(shell uname -m | \</span><br><span class="line">	sed -e s/i.<span class="number">86</span>/x86/ \</span><br><span class="line">	    -e s/sun4u/sparc64/ \</span><br><span class="line">	    -e s/arm.*/arm/ \</span><br><span class="line">	    -e s/sa110/arm/ \</span><br><span class="line">	    -e s/ppc64/powerpc/ \</span><br><span class="line">	    -e s/ppc/powerpc/ \</span><br><span class="line">	    -e s/macppc/powerpc/\</span><br><span class="line">	    -e s/sh.*/sh/)</span><br></pre></td></tr></table></figure>

<p>å˜é‡ HOSTARCHï¼Œç”¨äºä¿å­˜ä¸»æœºæ¶æ„ï¼Œè¿™é‡Œè°ƒç”¨ shell å‘½ä»¤â€œuname -mâ€è·å–æ¶æ„åç§°ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sumu@sumu-virtual-machine:~/7Linux/imx6ull-uboot$  uname -m</span><br><span class="line">x86_64</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºå½“å‰ubuntuä¸»æœºæ¶æ„ä¸ºâ€œx86_64â€ï¼Œshell ä¸­çš„â€œ|â€è¡¨ç¤ºç®¡é“ï¼Œæ„æ€æ˜¯å°† å·¦è¾¹çš„è¾“å‡ºä½œä¸ºå³è¾¹çš„è¾“å…¥ï¼Œsed -e æ˜¯æ›¿æ¢å‘½ä»¤ï¼Œâ€œsed -e s&#x2F;i.86&#x2F;x86&#x2F;â€è¡¨ç¤ºå°†ç®¡é“è¾“å…¥çš„å­—ç¬¦ä¸² ä¸­çš„â€œi.86â€æ›¿æ¢ä¸ºâ€œx86â€ï¼Œå…¶ä»–çš„â€œsed -e sâ€å‘½ä»¤åŒç†ã€‚å¯¹äºæˆ‘ç°åœ¨è¿è¡Œçš„ubuntuç³»ç»Ÿè€Œè¨€ï¼ŒHOSTARCH&#x3D;x86_64ã€‚</p>
<h3 id="8-2-ä¸»æœºæ“ä½œç³»ç»Ÿ-HOSTOS"><a href="#8-2-ä¸»æœºæ“ä½œç³»ç»Ÿ-HOSTOS" class="headerlink" title="8.2 ä¸»æœºæ“ä½œç³»ç»Ÿ HOSTOS"></a><font size=3>8.2 ä¸»æœºæ“ä½œç³»ç»Ÿ HOSTOS</font></h3><p> HOSTOSåœ¨ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L235">Makefile</a> ä¸­å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HOSTOS := <span class="variable">$(<span class="built_in">shell</span> uname -s | tr &#x27;[:upper:]&#x27; &#x27;[:lower:]&#x27; | \</span></span><br><span class="line"><span class="variable">	    sed -e &#x27;s/\(cygwin\)</span>.*/cygwin/&#x27;)</span><br></pre></td></tr></table></figure>

<p>å˜é‡ HOSTOSï¼Œæ­¤å˜é‡ç”¨äºä¿å­˜ä¸»æœº OS çš„å€¼ï¼Œå…ˆä½¿ç”¨ shell å‘½ä»¤â€œuname -sâ€æ¥è·å–ä¸»æœº OSï¼Œç»“æœä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sumu@sumu-virtual-machine:~/7Linux/imx6ull-uboot$  uname -s</span><br><span class="line">Linux</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºæ­¤æ—¶çš„ä¸»æœº OS ä¸ºâ€œLinuxâ€ï¼Œä½¿ç”¨ç®¡é“å°†â€œLinuxâ€ä½œä¸ºåé¢â€œ tr â€˜[:upper:]â€˜  â€˜[:lower:]â€˜ â€çš„è¾“å…¥ï¼Œâ€œ tr â€˜[:upper:]â€˜ â€˜[:lower:]â€˜ â€è¡¨ç¤ºå°†æ‰€æœ‰çš„å¤§å†™å­—æ¯æ›¿æ¢ä¸ºå°å†™å­—æ¯ï¼Œå› æ­¤å¾—åˆ° â€œ linux â€ã€‚æœ€ååŒæ ·ä½¿ç”¨ç®¡é“ï¼Œå°†â€œ linux â€ä½œä¸ºâ€œ sed -e â€˜s&#x2F;(cygwin).*&#x2F;cygwin&#x2F;â€˜ â€çš„è¾“å…¥ï¼Œç”¨äºå°† cygwin.*æ›¿æ¢ä¸º cygwinã€‚å› æ­¤ï¼Œç°åœ¨åœ¨è¿™é‡ŒHOSTOS&#x3D;linuxã€‚</p>
<h3 id="8-3-å¯¼å‡ºHOSTARCHå’ŒHOSTOS"><a href="#8-3-å¯¼å‡ºHOSTARCHå’ŒHOSTOS" class="headerlink" title="8.3 å¯¼å‡ºHOSTARCHå’ŒHOSTOS"></a><font size=3>8.3 å¯¼å‡ºHOSTARCHå’ŒHOSTOS</font></h3><p>æ¥ç€å¯¼å‡ºè¿™ä¸¤ä¸ªå˜é‡ï¼Œåœ¨<a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L238">Makefile</a>ä¸­å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span>	HOSTARCH HOSTOS</span><br></pre></td></tr></table></figure>

<h3 id="8-4-ç›®æ ‡æ¶æ„å’Œç¼–è¯‘å™¨"><a href="#8-4-ç›®æ ‡æ¶æ„å’Œç¼–è¯‘å™¨" class="headerlink" title="8.4 ç›®æ ‡æ¶æ„å’Œç¼–è¯‘å™¨"></a><font size=3>8.4 ç›®æ ‡æ¶æ„å’Œç¼–è¯‘å™¨</font></h3><h4 id="8-4-1-è®¾ç½®å‘½ä»¤"><a href="#8-4-1-è®¾ç½®å‘½ä»¤" class="headerlink" title="8.4.1 è®¾ç½®å‘½ä»¤"></a><font size=3>8.4.1 è®¾ç½®å‘½ä»¤</font></h4><p>ç¼–è¯‘ uboot çš„æ—¶å€™éœ€è¦è®¾ç½®ç›®æ ‡æ¿æ¶æ„å’Œäº¤å‰ç¼–è¯‘å™¨ï¼Œæˆ‘ä»¬ä¸€èˆ¬åœ¨ä½¿ç”¨makeå‘½ä»¤çš„æ—¶å€™ä¼ å…¥ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf-</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‘½ä»¤å°±æ˜¯ç”¨äºè®¾ç½® ARCH å’ŒCROSS_COMPILEã€‚</p>
<h4 id="8-4-2-ARCHä¸CROSS-COMPILE"><a href="#8-4-2-ARCHä¸CROSS-COMPILE" class="headerlink" title="8.4.2Â ARCHä¸CROSS_COMPILE"></a><font size=3>8.4.2Â ARCHä¸CROSS_COMPILE</font></h4><p>åœ¨é¡¶å±‚ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L243">Makefile</a> ä¸­ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(HOSTARCH)</span>,<span class="variable">$(ARCH)</span>)</span><br><span class="line">CROSS_COMPILE ?=</span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œåˆ¤æ–­ HOSTARCH å’Œ ARCH è¿™ä¸¤ä¸ªå˜é‡æ˜¯å¦ç›¸ç­‰ï¼Œå‰é¢æˆ‘ä»¬çŸ¥é“ä¸»æœºæ¶æ„(å˜é‡ HOSTARCH)æ˜¯ x86_64ï¼ŒARCHå°±æ˜¯é€šè¿‡makeå‘½ä»¤ä¼ å…¥ï¼Œè¦æ˜¯æ²¡æœ‰ä¼ å…¥ï¼Œé‚£ARCHå°±ä¸ºç©ºï¼Œæˆ‘ä»¬ç¼–è¯‘çš„æ˜¯ ARM ç‰ˆæœ¬ ubootï¼Œè‚¯å®šä¸ç›¸ç­‰ï¼Œæ‰€ä»¥ CROSS_COMPILE&#x3D; arm-linux-gnueabihf-ã€‚å½“ç„¶ï¼Œè¦æ˜¯æˆ‘ä»¬åœ¨ARMå¼€å‘æ¿è£…äº†GCCï¼Œè¿™é‡Œå°±ä¸éœ€è¦å‰ç¼€äº†ï¼Œå› ä¸ºå¼€å‘æ¿ä¸Šè£…çš„GCCä¸€å®šå°±æ˜¯ARMç‰ˆæœ¬çš„ï¼Œå¯ä»¥ç›´æ¥æœ¬åœ°ç¼–è¯‘ï¼Œä¸éœ€è¦äº¤å‰ç¼–è¯‘ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæ¯æ¬¡ç¼–è¯‘ uboot çš„æ—¶å€™éƒ½è¦åœ¨ make å‘½ä»¤åé¢è®¾ç½® ARCH å’Œ CROSS_COMPILEï¼Œä½¿ç”¨èµ·æ¥å¾ˆéº»çƒ¦ï¼ˆå½“ç„¶ï¼Œå†™shellè„šæœ¬è°ƒç”¨Makefileçš„é™¤å¤–ï¼‰ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥ç›´æ¥ä¿®æ”¹é¡¶å±‚ Makefileï¼Œåœ¨é‡Œé¢åŠ å…¥ ARCH å’Œ CROSS_COMPILE çš„å®šä¹‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ARCH          ?= arm</span><br><span class="line">CROSS_COMPILE ?= arm-linux-gnueabihf-</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ç›´æ¥åœ¨é¡¶å±‚ Makefile é‡Œé¢å®šä¹‰ ARCH å’Œ CROSS_COMPILEï¼Œè¿™æ ·å°±ä¸ç”¨æ¯æ¬¡ç¼–è¯‘çš„æ—¶å€™éƒ½è¦åœ¨ make å‘½ä»¤åé¢å®šä¹‰ ARCH å’Œ CROSS_COMPILEï¼Œç›´æ¥ä¸€ä¸ªmakeå°±å¯ä»¥äº†ã€‚</p>
<h2 id="9-é…ç½®æ–‡ä»¶"><a href="#9-é…ç½®æ–‡ä»¶" class="headerlink" title="9. é…ç½®æ–‡ä»¶"></a><font size=3>9. é…ç½®æ–‡ä»¶</font></h2><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">KCONFIG_CONFIG	?= .config</span><br><span class="line"><span class="keyword">export</span> KCONFIG_CONFIG</span><br></pre></td></tr></table></figure>

<p>uboot æ˜¯å¯ä»¥é…ç½®çš„ï¼Œè¿™é‡Œè®¾ç½®é…ç½®æ–‡ä»¶ä¸º .configã€‚.config æ–‡ä»¶é»˜è®¤æ˜¯æ²¡æœ‰çš„ï¼Œéœ€è¦ä½¿ç”¨å‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make xxx_defconfig</span><br></pre></td></tr></table></figure>

<p>å¯¹ uboot è¿›è¡Œé…ç½®ï¼Œé…ç½®å®Œæˆä»¥åå°±ä¼šåœ¨ uboot æ ¹ç›®å½•ä¸‹ç”Ÿæˆ .configã€‚é»˜è®¤æƒ…å†µä¸‹.config å’Œ xxx_defconfig å†…å®¹æ˜¯ä¸€æ ·çš„ï¼Œå› ä¸º .config å°±æ˜¯ä» xxx_defconfig å¤åˆ¶è¿‡æ¥çš„ã€‚å¦‚æœåç»­è‡ªè¡Œè°ƒæ•´ äº† uboot çš„ä¸€äº›é…ç½®å‚æ•°ï¼Œé‚£ä¹ˆè¿™äº›æ–°çš„é…ç½®å‚æ•°å°±æ·»åŠ åˆ°äº†.config ä¸­ï¼Œè€Œä¸æ˜¯ xxx_defconfigã€‚ ç›¸å½“äº xxx_defconfig åªæ˜¯ä¸€äº›åˆå§‹é…ç½®ï¼Œè€Œ .config é‡Œé¢çš„æ‰æ˜¯å®æ—¶æœ‰æ•ˆçš„é…ç½®ã€‚æˆ‘ä»¬åœ¨å›¾å½¢é…ç½®ç•Œé¢è¿›è¡Œçš„å„ç§é…ç½®ä¹Ÿä¼šè¢«å†™å…¥åˆ°è¿™ä¸ª .config æ–‡ä»¶ä¸­ã€‚</p>
<h2 id="10-é€šç”¨å®šä¹‰"><a href="#10-é€šç”¨å®šä¹‰" class="headerlink" title="10. é€šç”¨å®šä¹‰"></a><font size=3>10. é€šç”¨å®šä¹‰</font></h2><h3 id="10-1-Kbuild-include"><a href="#10-1-Kbuild-include" class="headerlink" title="10.1Â Kbuild.include"></a><font size=3>10.1Â Kbuild.include</font></h3><p>è¿™é‡Œè¿˜ä¼šæœ‰ä¸€äº›é€šç”¨çš„å®šä¹‰åœ¨ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/scripts/Kbuild.include">scripts&#x2F;Kbuild.include</a> æ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">####</span><br><span class="line"># kbuild: Generic definitions</span><br><span class="line"></span><br><span class="line"># Convenient variables</span><br><span class="line">comma   := ,</span><br><span class="line">quote   := &quot;</span><br><span class="line">squote  := &#x27;</span><br><span class="line">empty   :=</span><br><span class="line">space   := $(empty) $(empty)</span><br><span class="line">pound := \#</span><br><span class="line"></span><br><span class="line">###</span><br><span class="line"># Name of target with a &#x27;.&#x27; as filename prefix. foo/bar.o =&gt; foo/.bar.o</span><br><span class="line">dot-target = $(dir $@).$(notdir $@)</span><br><span class="line"></span><br><span class="line">###</span><br><span class="line"># The temporary file to save gcc -MD generated dependencies must not</span><br><span class="line"># contain a comma</span><br><span class="line">depfile = $(subst $(comma),_,$(dot-target).d)</span><br></pre></td></tr></table></figure>

<h3 id="10-2-æ€ä¹ˆè¢«åŒ…å«åˆ°Makefileä¸­ï¼Ÿ"><a href="#10-2-æ€ä¹ˆè¢«åŒ…å«åˆ°Makefileä¸­ï¼Ÿ" class="headerlink" title="10.2 æ€ä¹ˆè¢«åŒ…å«åˆ°Makefileä¸­ï¼Ÿ"></a><font size=3>10.2 æ€ä¹ˆè¢«åŒ…å«åˆ°Makefileä¸­ï¼Ÿ</font></h3><p>åœ¨ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L345">Makefile</a>ä¸­è°ƒç”¨çš„ä»£ç ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># We need some generic definitions (do not try to remake the file).</span></span><br><span class="line"><span class="section">scripts/Kbuild.include: ;</span></span><br><span class="line"><span class="keyword">include</span> scripts/Kbuild.<span class="keyword">include</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ uboot çš„ç¼–è¯‘è¿‡ç¨‹ä¸­ä¼šç”¨åˆ° scripts&#x2F;Kbuild.include ä¸­çš„è¿™äº›å˜é‡ï¼Œåé¢ç”¨åˆ°çš„æ—¶å€™å†åˆ†æã€‚</p>
<h2 id="11-ç›¸å…³å˜é‡"><a href="#11-ç›¸å…³å˜é‡" class="headerlink" title="11. ç›¸å…³å˜é‡"></a><font size=3>11. ç›¸å…³å˜é‡</font></h2><h3 id="11-1-äº¤å‰ç¼–è¯‘å·¥å…·å˜é‡"><a href="#11-1-äº¤å‰ç¼–è¯‘å·¥å…·å˜é‡" class="headerlink" title="11.1Â äº¤å‰ç¼–è¯‘å·¥å…·å˜é‡"></a><font size=3>11.1Â äº¤å‰ç¼–è¯‘å·¥å…·å˜é‡</font></h3><p>ä¸Šé¢æˆ‘ä»¬åªæ˜¯è®¾ç½®äº† CROSS_COMPILE çš„åå­—ï¼Œä½†æ˜¯äº¤å‰ç¼–è¯‘å™¨å…¶ä»–çš„å·¥å…·è¿˜æ²¡æœ‰è®¾ç½®ï¼Œé¡¶å±‚ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L347">Makefile</a> ä¸­ç›¸å…³ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">AS		= <span class="variable">$(CROSS_COMPILE)</span>as</span><br><span class="line"><span class="comment"># Always use GNU ld</span></span><br><span class="line"><span class="keyword">ifneq</span> (<span class="variable">$(<span class="built_in">shell</span> <span class="variable">$(CROSS_COMPILE)</span>ld.bfd -v 2&gt; /dev/null)</span>,)</span><br><span class="line">LD		= <span class="variable">$(CROSS_COMPILE)</span>ld.bfd</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">LD		= <span class="variable">$(CROSS_COMPILE)</span>ld</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line">CC		= <span class="variable">$(CROSS_COMPILE)</span>gcc</span><br><span class="line">CPP		= <span class="variable">$(CC)</span> -E</span><br><span class="line">AR		= <span class="variable">$(CROSS_COMPILE)</span>ar</span><br><span class="line">NM		= <span class="variable">$(CROSS_COMPILE)</span>nm</span><br><span class="line">LDR		= <span class="variable">$(CROSS_COMPILE)</span>ldr</span><br><span class="line">STRIP		= <span class="variable">$(CROSS_COMPILE)</span>strip</span><br><span class="line">OBJCOPY		= <span class="variable">$(CROSS_COMPILE)</span>objcopy</span><br><span class="line">OBJDUMP		= <span class="variable">$(CROSS_COMPILE)</span>objdump</span><br><span class="line">LEX		= flex</span><br><span class="line">YACC		= bison</span><br><span class="line">AWK		= awk</span><br><span class="line">PERL		= perl</span><br><span class="line">PYTHON		?= python</span><br><span class="line">PYTHON2		= python2</span><br><span class="line">PYTHON3		= python3</span><br><span class="line">DTC		?= <span class="variable">$(objtree)</span>/scripts/dtc/dtc</span><br></pre></td></tr></table></figure>

<h3 id="11-2-ç¼–è¯‘é€‰é¡¹"><a href="#11-2-ç¼–è¯‘é€‰é¡¹" class="headerlink" title="11.2 ç¼–è¯‘é€‰é¡¹"></a><font size=3>11.2 ç¼–è¯‘é€‰é¡¹</font></h3><p>æˆ‘ä»¬ç¼–è¯‘çš„æ—¶å€™è¿˜æœ‰ä¸€äº›é€‰é¡¹çš„å®šä¹‰ï¼Œè¿™äº›åœ¨é¡¶å±‚çš„ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L374">Makefile</a>ä¸­ä¹Ÿæœ‰å®šä¹‰ï¼Œä¾‹å¦‚è¿™é‡Œå°±æœ‰ä¸€äº›å®å’Œæ ‡å¿—ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CHECKFLAGS     := -D__linux__ -Dlinux -D__STDC__ -Dunix -D__unix__ \</span><br><span class="line">		  -Wbitwise -Wno-return-void -D__CHECK_ENDIAN__ <span class="variable">$(CF)</span></span><br><span class="line"></span><br><span class="line">KBUILD_CPPFLAGS := -D__KERNEL__ -D__UBOOT__</span><br><span class="line"></span><br><span class="line">KBUILD_CFLAGS   := -Wall -Wstrict-prototypes \</span><br><span class="line">		   -Wno-format-security \</span><br><span class="line">		   -fno-builtin -ffreestanding <span class="variable">$(CSTD_FLAG)</span></span><br><span class="line">KBUILD_CFLAGS	+= -fshort-wchar -fno-strict-aliasing</span><br><span class="line">KBUILD_AFLAGS   := -D__ASSEMBLY__</span><br></pre></td></tr></table></figure>

<h3 id="11-3-å˜é‡å¯¼å‡º"><a href="#11-3-å˜é‡å¯¼å‡º" class="headerlink" title="11.3 å˜é‡å¯¼å‡º"></a><font size=3>11.3 å˜é‡å¯¼å‡º</font></h3><p>æ¥ä¸‹æ¥åœ¨é¡¶å±‚ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L393">Makefile</a> ä¼šå¯¼å‡ºå¾ˆå¤šå˜é‡ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> VERSION PATCHLEVEL SUBLEVEL UBOOTRELEASE UBOOTVERSION</span><br><span class="line"><span class="keyword">export</span> ARCH CPU BOARD VENDOR SOC CPUDIR BOARDDIR</span><br><span class="line"><span class="keyword">export</span> CONFIG_SHELL HOSTCC HOSTCFLAGS HOSTLDFLAGS CROSS_COMPILE AS LD CC</span><br><span class="line"><span class="keyword">export</span> CPP AR NM LDR STRIP OBJCOPY OBJDUMP</span><br><span class="line"><span class="keyword">export</span> MAKE LEX YACC AWK PERL PYTHON PYTHON2 PYTHON3</span><br><span class="line"><span class="keyword">export</span> HOSTCXX HOSTCXXFLAGS CHECK CHECKFLAGS DTC DTC_FLAGS</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> KBUILD_CPPFLAGS NOSTDINC_FLAGS UBOOTINCLUDE OBJCOPYFLAGS LDFLAGS</span><br><span class="line"><span class="keyword">export</span> KBUILD_CFLAGS KBUILD_AFLAGS</span><br><span class="line"></span><br><span class="line"><span class="comment"># When compiling out-of-tree modules, put MODVERDIR in the module</span></span><br><span class="line"><span class="comment"># tree rather than in the kernel tree. The kernel tree might</span></span><br><span class="line"><span class="comment"># even be read-only.</span></span><br><span class="line"><span class="keyword">export</span> MODVERDIR := <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(KBUILD_EXTMOD)</span>,$(<span class="built_in">firstword</span> <span class="variable">$(KBUILD_EXTMOD)</span>)</span>/).tmp_versions</span><br><span class="line"></span><br><span class="line"><span class="comment"># Files to ignore in find ... statements</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> RCS_FIND_IGNORE := \( -name SCCS -o -name BitKeeper -o -name .svn -o    \</span><br><span class="line">			  -name CVS -o -name .pc -o -name .hg -o -name .git \) \</span><br><span class="line">			  -prune -o</span><br><span class="line"><span class="keyword">export</span> RCS_TAR_IGNORE := --exclude SCCS --exclude BitKeeper --exclude .svn \</span><br><span class="line">			 --exclude CVS --exclude .pc --exclude .hg --exclude .git</span><br></pre></td></tr></table></figure>

<p>è¿™äº›å˜é‡ä¸­å¤§éƒ¨åˆ†éƒ½å·²ç»åœ¨å‰é¢å®šä¹‰äº†ï¼Œæˆ‘ä»¬é‡ç‚¹æ¥çœ‹ä¸€ä¸‹ä¸‹é¢è¿™å‡ ä¸ªå˜é‡ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ARCH CPU BOARD VENDOR SOC CPUDIR BOARDDIR</span><br></pre></td></tr></table></figure>

<p>è¿™ 7 ä¸ªå˜é‡åœ¨é¡¶å±‚ Makefile æ˜¯æ‰¾ä¸åˆ°çš„ï¼Œè¯´æ˜è¿™ 7 ä¸ªå˜é‡æ˜¯åœ¨å…¶ä»–æ–‡ä»¶é‡Œé¢å®šä¹‰çš„ã€‚å…ˆæ¥çœ‹ä¸€ä¸‹è¿™ 7 ä¸ªå˜é‡éƒ½æ˜¯ä»€ä¹ˆå†…å®¹ï¼Œåœ¨é¡¶å±‚ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L415">Makefile</a> ä¸­å¯¼å‡ºå˜é‡ç»“æŸçš„ä½ç½®è¾“å…¥å¦‚å›¾æ‰€ç¤ºçš„å†…å®¹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ......</span></span><br><span class="line"><span class="keyword">export</span> RCS_TAR_IGNORE := --exclude SCCS --exclude BitKeeper --exclude .svn \</span><br><span class="line">			 --exclude CVS --exclude .pc --exclude .hg --exclude .git</span><br><span class="line"></span><br><span class="line"><span class="section">my_test:</span></span><br><span class="line">	@echo <span class="string">&quot;ARCH&quot;</span>=<span class="variable">$(ARCH)</span> </span><br><span class="line">	@echo <span class="string">&quot;CPU&quot;</span>=<span class="variable">$(CPU)</span> </span><br><span class="line">	@echo <span class="string">&quot;BOARD&quot;</span>=<span class="variable">$(BOARD)</span> </span><br><span class="line">	@echo <span class="string">&quot;VENDOR&quot;</span>=<span class="variable">$(VENDOR)</span> </span><br><span class="line">	@echo <span class="string">&quot;SOC&quot;</span>=<span class="variable">$(SOC)</span> </span><br><span class="line">	@echo <span class="string">&quot;CPUDIR&quot;</span>=<span class="variable">$(CPUDIR)</span> </span><br><span class="line">	@echo <span class="string">&quot;BOARDDIR&quot;</span>=<span class="variable">$(BOARDDIR)</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤çœ‹ä¸€ä¸‹æ‰“å°ä¿¡æ¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sumu@sumu-virtual-machine:~/7Linux/imx6ull-uboot$  make -s ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- my_test -j16</span><br><span class="line">ARCH=arm</span><br><span class="line">CPU=armv7</span><br><span class="line">BOARD=mx6ullevk</span><br><span class="line">VENDOR=freescale</span><br><span class="line">SOC=mx6</span><br><span class="line">CPUDIR=arch/arm/cpu/armv7</span><br><span class="line">BOARDDIR=freescale/mx6ullevk</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°è¿™ 7 ä¸ªå˜é‡çš„å€¼ï¼Œè¿™ 7 ä¸ªå˜é‡æ˜¯ä»å“ªé‡Œæ¥çš„å‘¢ï¼Ÿåœ¨ uboot æ ¹ç›®å½•ä¸‹æœ‰ä¸ªæ–‡ä»¶å«åš <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/config.mk">config.mk</a>ï¼Œè¿™ 7 ä¸ªå˜é‡å°±æ˜¯åœ¨  <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/config.mk">config.mk</a> é‡Œé¢å®šä¹‰çš„ï¼Œæ‰“å¼€  <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/config.mk">config.mk</a> å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ......</span></span><br><span class="line"><span class="comment"># clear VENDOR for tcsh</span></span><br><span class="line">VENDOR :=</span><br><span class="line"><span class="comment">#########################################################################</span></span><br><span class="line"></span><br><span class="line">ARCH := $(CONFIG_SYS_ARCH:<span class="string">&quot;%&quot;</span>=%)</span><br><span class="line">CPU := $(CONFIG_SYS_CPU:<span class="string">&quot;%&quot;</span>=%)</span><br><span class="line"><span class="keyword">ifdef</span> CONFIG_SPL_BUILD</span><br><span class="line"><span class="keyword">ifdef</span> CONFIG_TEGRA</span><br><span class="line">CPU := arm720t</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line">BOARD := $(CONFIG_SYS_BOARD:<span class="string">&quot;%&quot;</span>=%)</span><br><span class="line"><span class="keyword">ifneq</span> (<span class="variable">$(CONFIG_SYS_VENDOR)</span>,)</span><br><span class="line">VENDOR := $(CONFIG_SYS_VENDOR:<span class="string">&quot;%&quot;</span>=%)</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"><span class="keyword">ifneq</span> (<span class="variable">$(CONFIG_SYS_SOC)</span>,)</span><br><span class="line">SOC := $(CONFIG_SYS_SOC:<span class="string">&quot;%&quot;</span>=%)</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"><span class="comment"># ......</span></span><br><span class="line">CPUDIR=arch/<span class="variable">$(ARCH)</span>/cpu<span class="variable">$(<span class="built_in">if</span> <span class="variable">$(CPU)</span>,/<span class="variable">$(CPU)</span>,)</span></span><br><span class="line"><span class="comment"># ......</span></span><br><span class="line"><span class="keyword">ifneq</span> (<span class="variable">$(BOARD)</span>,)</span><br><span class="line"><span class="keyword">ifdef</span>	VENDOR</span><br><span class="line">BOARDDIR = <span class="variable">$(VENDOR)</span>/<span class="variable">$(BOARD)</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">BOARDDIR = <span class="variable">$(BOARD)</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"><span class="comment"># ......</span></span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥éœ€è¦æ‰¾åˆ° CONFIG_SYS_ARCHã€ CONFIG_SYS_CPUã€ CONFIG_SYS_BOARDã€CONFIG_SYS_VENDOR å’Œ CONFIG_SYS_SOC è¿™ 5 ä¸ªå˜é‡çš„å€¼ã€‚è¿™ 5 ä¸ªå˜é‡åœ¨ uboot æ ¹ç›®å½•ä¸‹çš„  <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/.config">.config</a> æ–‡ä»¶ï¼ˆè¿™ä¸ªæ–‡ä»¶éœ€è¦æ‰§è¡Œé…ç½®å‘½ä»¤åæ‰ä¼šç”Ÿæˆï¼‰ä¸­æœ‰å®šä¹‰ï¼Œï¼Œå¯ä»¥æ‰“å¼€çœ‹ä¸€ä¸‹ï¼Œæœç´¢ä¸€ä¸‹è¿™ä¸ªå‡ ä¸ªå˜é‡ï¼Œä¼šå‘ç°ä»–ä»¬åœ¨ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/.config#L19">.config </a> æ–‡ä»¶ä¸­å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CONFIG_SYS_ARCH=&quot;arm&quot;</span><br><span class="line">CONFIG_SYS_CPU=&quot;armv7&quot;</span><br><span class="line">CONFIG_SYS_SOC=&quot;mx6&quot;</span><br><span class="line">CONFIG_SYS_VENDOR=&quot;freescale&quot;</span><br><span class="line">CONFIG_SYS_BOARD=&quot;mx6ull_alpha_emmc&quot;</span><br><span class="line">CONFIG_SYS_CONFIG_NAME=&quot;mx6ull_alpha_emmc&quot;</span><br></pre></td></tr></table></figure>

<p>ä¸»è¦æ˜¯è¿™é‡Œæˆ‘æ˜¯ç”¨çš„è‡ªå·±ç§»æ¤çš„æ¿å­ï¼Œæ‰€ä»¥è¿™äº›åå­—ä»€ä¹ˆéƒ½ä¸å¤ªä¸€æ ·ï¼Œä¸è¿‡ç”¨nxp evkè¯„ä¼°æ¿çš„é»˜è®¤é…ç½®æ–‡ä»¶çš„è¯ä¼šæ˜¯å¯¹åº”çš„ã€‚æ‰€ä»¥å°±æœ‰ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ARCH = arm</span><br><span class="line">CPU = armv7</span><br><span class="line">BOARD = mx6ullevk</span><br><span class="line">VENDOR = freescale</span><br><span class="line">SOC = mx6</span><br><span class="line">CPUDIR = arch/arm/cpu/armv7</span><br><span class="line">BOARDDIR = freescale/mx6ullevk</span><br></pre></td></tr></table></figure>

<p>ä¼šå‘ç°å’Œä¸Šé¢çš„æ‰“å°ä¿¡æ¯æ˜¯ä¸€æ ·çš„ã€‚å†æ¥åˆ†æ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/config.mk">config.mk</a> ï¼Œå°±ä¼šå‘ç°åœ¨ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/config.mk">config.mk</a> ä¸­è¯»å–çš„æ–‡ä»¶æœ‰ :</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">arch/arm/config.mk</span><br><span class="line">arch/arm/cpu/armv7/config.mk</span><br><span class="line">arch/arm/cpu/armv7/mx6/config.mk (æ­¤æ–‡ä»¶ä¸å­˜åœ¨)</span><br><span class="line">board/ freescale/mx6ullevk/config.mk (æ­¤æ–‡ä»¶ä¸å­˜åœ¨)</span><br></pre></td></tr></table></figure>

<h1 id="äºŒã€Makefileè¿‡ç¨‹åˆ†æ"><a href="#äºŒã€Makefileè¿‡ç¨‹åˆ†æ" class="headerlink" title="äºŒã€Makefileè¿‡ç¨‹åˆ†æ"></a><font size=3>äºŒã€Makefileè¿‡ç¨‹åˆ†æ</font></h1><h2 id="1-make-xxx-defconfig"><a href="#1-make-xxx-defconfig" class="headerlink" title="1.Â  make xxx_defconfig"></a><font size=3>1.Â  make xxx_defconfig</font></h2><p>åœ¨ç¼–è¯‘ uboot ä¹‹å‰è¦ä½¿ç”¨â€œmake xxx_defconfigâ€å‘½ä»¤æ¥é…ç½® ubootï¼Œé‚£ä¹ˆè¿™ä¸ªé…ç½®è¿‡ç¨‹æ˜¯å¦‚ä½•è¿è¡Œçš„å‘¢ï¼Ÿæ¥ä¸‹æ¥å°±æ¥äº†è§£ä¸€ä¸‹å§ã€‚è¿™ä¸ªæˆ‘ä»¬ä»è¿™é‡Œå¼€å§‹ï¼š<a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L439">Makefile Â· è‹æœ¨&#x2F;u-boot - ç äº‘ - å¼€æºä¸­å›½</a></p>
<h3 id="1-1-ç‰ˆæœ¬ä¸æ—¶é—´"><a href="#1-1-ç‰ˆæœ¬ä¸æ—¶é—´" class="headerlink" title="1.1 ç‰ˆæœ¬ä¸æ—¶é—´"></a><font size=3>1.1 ç‰ˆæœ¬ä¸æ—¶é—´</font></h3><h4 id="1-1-1-version-h"><a href="#1-1-1-version-h" class="headerlink" title="1.1.1 version_h"></a><font size=3>1.1.1 version_h</font></h4><p>å…ˆæ¥çœ‹ä¸€äº›è¿™ä¸ªå˜é‡ï¼Œå®ƒåœ¨<a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L447">Makefile</a>ä¸­å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">version_h := <span class="keyword">include</span>/generated/version_autogenerated.h</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå˜é‡ä¿å­˜ç‰ˆæœ¬å·æ–‡ä»¶ï¼Œæ­¤æ–‡ä»¶æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ã€‚æ–‡ä»¶ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/include/generated/version_autogenerated.h">include&#x2F;generated&#x2F;version_autogenerated.h</a> ï¼ˆç¼–è¯‘åæ‰ä¼šç”Ÿæˆï¼‰å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> PLAIN_VERSION <span class="string">&quot;2019.04-gf32bcf5b&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> U_BOOT_VERSION <span class="string">&quot;U-Boot &quot;</span> PLAIN_VERSION</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CC_VERSION_STRING <span class="string">&quot;arm-linux-gnueabihf-gcc (GNU Toolchain for the A-profile Architecture 8.3-2019.03 (arm-rel-8.36)) 8.3.0&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LD_VERSION_STRING <span class="string">&quot;GNU ld (GNU Toolchain for the A-profile Architecture 8.3-2019.03 (arm-rel-8.36)) 2.32.0.20190321&quot;</span></span></span><br></pre></td></tr></table></figure>

<h4 id="1-1-2-timestamp-h"><a href="#1-1-2-timestamp-h" class="headerlink" title="1.1.2Â timestamp_h"></a><font size=3>1.1.2Â timestamp_h</font></h4><p>å˜é‡ timestamp_håœ¨ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L448">Makefile</a> ä¸­å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timestamp_h := <span class="keyword">include</span>/generated/timestamp_autogenerated.h</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå˜é‡ä¿å­˜æ—¶é—´æˆ³æ–‡ä»¶ï¼Œæ­¤æ–‡ä»¶ä¹Ÿæ˜¯ç¼–è¯‘è‡ªåŠ¨ç”Ÿæˆçš„ã€‚æ–‡ä»¶ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/include/generated/timestamp_autogenerated.h">include&#x2F;generated&#x2F;timestamp_autogenerated.h</a> å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> U_BOOT_DATE <span class="string">&quot;Nov 19 2024&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> U_BOOT_TIME <span class="string">&quot;21:45:10&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> U_BOOT_TZ <span class="string">&quot;+0800&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> U_BOOT_DMI_DATE <span class="string">&quot;11/19/2024&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> U_BOOT_BUILD_DATE 0x20241119</span></span><br></pre></td></tr></table></figure>

<h3 id="1-2-ä¸‰ä¸ªå˜é‡"><a href="#1-2-ä¸‰ä¸ªå˜é‡" class="headerlink" title="1.2 ä¸‰ä¸ªå˜é‡"></a><font size=3>1.2 ä¸‰ä¸ªå˜é‡</font></h3><p>æ¥ä¸‹æ¥çœ‹å‡ ä¸ªå˜é‡ï¼Œå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L451">Makefile</a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">no-dot-config-targets := clean clobber mrproper distclean \</span><br><span class="line">			 help %docs check% coccicheck \</span><br><span class="line">			 ubootversion backup tests check qcheck</span><br><span class="line"></span><br><span class="line">config-targets := 0</span><br><span class="line">mixed-targets  := 0</span><br><span class="line">dot-config     := 1</span><br><span class="line"></span><br><span class="line"><span class="keyword">ifneq</span> (<span class="variable">$(<span class="built_in">filter</span> $(no-dot-config-targets)</span>, <span class="variable">$(MAKECMDGOALS)</span>),)</span><br><span class="line">	<span class="keyword">ifeq</span> (<span class="variable">$(<span class="built_in">filter</span>-out $(no-dot-config-targets)</span>, <span class="variable">$(MAKECMDGOALS)</span>),)</span><br><span class="line">		dot-config := 0</span><br><span class="line">	<span class="keyword">endif</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(KBUILD_EXTMOD)</span>,)</span><br><span class="line">        <span class="keyword">ifneq</span> (<span class="variable">$(<span class="built_in">filter</span> config %config,<span class="variable">$(MAKECMDGOALS)</span>)</span>,)</span><br><span class="line">                config-targets := 1</span><br><span class="line">                <span class="keyword">ifneq</span> (<span class="variable">$(words <span class="variable">$(MAKECMDGOALS)</span>)</span>,1)</span><br><span class="line">                        mixed-targets := 1</span><br><span class="line">                <span class="keyword">endif</span></span><br><span class="line">        <span class="keyword">endif</span></span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p>ç¬¬ 1 è¡Œå®šä¹‰äº†å˜é‡ no-dot-config-targetsã€‚</p>
<p>ç¬¬ 5 è¡Œå®šä¹‰äº†å˜é‡ config-targetsï¼Œåˆå§‹å€¼ä¸º 0ã€‚ </p>
<p>ç¬¬ 6 è¡Œå®šä¹‰äº†å˜é‡ mixed-targetsï¼Œåˆå§‹å€¼ä¸º 0ã€‚</p>
<p>ç¬¬ 7 è¡Œå®šä¹‰äº†å˜é‡ dot-configï¼Œåˆå§‹å€¼ä¸º 1ã€‚</p>
<p>ç¬¬ 9 è¡Œå°† MAKECMDGOALS ä¸­ä¸ç¬¦åˆ no-dot-config-targets çš„éƒ¨åˆ†è¿‡æ»¤æ‰ï¼Œå‰©ä¸‹çš„å¦‚æœä¸ä¸ºç©ºçš„è¯æ¡ä»¶å°±æˆç«‹ã€‚MAKECMDGOALS æ˜¯ make çš„ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œè¿™ä¸ªå˜é‡ä¼šä¿å­˜æˆ‘ä»¬æ‰€æŒ‡ å®šçš„ç»ˆæç›®æ ‡åˆ—è¡¨ï¼Œæ¯”å¦‚æ‰§è¡Œâ€œmake mx6ull_14x14_evk_defconfigâ€ï¼Œé‚£ä¹ˆ MAKECMDGOALS å°±ä¸º mx6ull_14x14_evk_defconfigã€‚å¾ˆæ˜æ˜¾è¿‡æ»¤åä¸ºç©ºï¼Œæ‰€ä»¥æ¡ä»¶ä¸æˆç«‹ï¼Œå˜é‡ dot-config ä¾ æ—§ä¸º 1ã€‚</p>
<p>ç¬¬ 15 è¡Œåˆ¤æ–­KBUILD_EXTMODæ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœKBUILD_EXTMODä¸ºç©ºçš„è¯æ¡ä»¶æˆç«‹ï¼Œ ç»è¿‡å‰é¢çš„åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“ KBUILD_EXTMOD ä¸ºç©ºï¼Œæ‰€ä»¥æ¡ä»¶æˆç«‹ã€‚</p>
<p>ç¬¬ 16 è¡Œå°† MAKECMDGOALS ä¸­ä¸ç¬¦åˆâ€œconfigâ€å’Œâ€œ%configâ€çš„éƒ¨åˆ†è¿‡æ»¤æ‰ï¼Œå¦‚æœå‰© ä¸‹çš„éƒ¨åˆ†ä¸ä¸ºç©ºæ¡ä»¶å°±æˆç«‹ï¼ŒMAKECMDGOALS &#x3D; mx6ull_14x14_evk_defconfigï¼Œæ‰€ä»¥æ­¤å¤„æ¡ä»¶æˆç«‹ï¼Œå˜é‡ config-targets&#x3D;1ã€‚</p>
<p>ç¬¬ 18 è¡Œç»Ÿè®¡ MAKECMDGOALS ä¸­çš„å•è¯ä¸ªæ•°ï¼Œå¦‚æœä¸ä¸º 1 çš„è¯æ¡ä»¶æˆç«‹ã€‚æ­¤å¤„è°ƒç”¨ Makefile ä¸­çš„ words å‡½æ•°æ¥ç»Ÿè®¡å•è¯ä¸ªæ•°ï¼Œwords å‡½æ•°æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(words &lt;text&gt;)</span></span><br></pre></td></tr></table></figure>

<p>MAKECMDGOALS çš„å•è¯ä¸ªæ•°æ˜¯ 1 ä¸ªï¼Œæ‰€ä»¥æ¡ä»¶ä¸æˆç«‹ï¼Œmixed-targets ç»§ç»­ä¸º 0ã€‚</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œè¿™äº›å˜é‡å€¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">config-targets = 1</span><br><span class="line">mixed-targets = 0</span><br><span class="line">dot-config = 1</span><br></pre></td></tr></table></figure>

<h3 id="1-3-ä¸‰ä¸ªå˜é‡çš„ä½¿ç”¨"><a href="#1-3-ä¸‰ä¸ªå˜é‡çš„ä½¿ç”¨" class="headerlink" title="1.3 ä¸‰ä¸ªå˜é‡çš„ä½¿ç”¨"></a><font size=3>1.3 ä¸‰ä¸ªå˜é‡çš„ä½¿ç”¨</font></h3><p>ä¸Šé¢ç¡®å®šäº†é‚£ä¸‰ä¸ªå˜é‡çš„å€¼ï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L474">Makefile</a> ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ifeq</span> ($(mixed-targets),1)</span><br><span class="line"><span class="comment"># (1)......</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="comment"># (2)......</span></span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœå˜é‡ mixed-targets ä¸º 1 çš„è¯æ¡ä»¶æˆç«‹,è¿™é‡Œæ˜¾ç„¶ä¸æˆç«‹äº†ï¼Œæ‰€ä»¥ä¼šèµ°2)è¿™é‡Œï¼Œ(2)è¿™é‡Œåœ¨ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L490">Makefile</a> ä¸­æ˜¯ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ifeq</span> ($(config-targets),1)</span><br><span class="line"><span class="comment"># (2.1)......</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="comment"># (2.2)......</span></span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœå˜é‡ config-targets ä¸º 1 çš„è¯æ¡ä»¶æˆç«‹ï¼Œå¾ˆæ˜æ˜¾ï¼Œæ¡ä»¶æˆç«‹ï¼Œæ‰§è¡Œè¿™ä¸ªï¼ˆ2.1ï¼‰åˆ†æ”¯ã€‚è¿™ä¸ªï¼ˆ2.1ï¼‰åœ¨ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L492">Makefile</a> ä¸­çš„ä»£ç ï¼Œæˆ‘ä»¬ä¸‹é¢æ¥ç€åˆ†æã€‚</p>
<h3 id="1-4-config"><a href="#1-4-config" class="headerlink" title="1.4 %config"></a><font size=3>1.4 %config</font></h3><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸Šé¢ï¼ˆ2.1ï¼‰åœ¨<a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L492">Makefile</a> ä¸­çš„ä»£ç ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># *config targets only - make sure prerequisites are updated, and descend</span></span><br><span class="line"><span class="comment"># in scripts/kconfig to make the *config target</span></span><br><span class="line"></span><br><span class="line">KBUILD_DEFCONFIG := sandbox_defconfig</span><br><span class="line"><span class="keyword">export</span> KBUILD_DEFCONFIG KBUILD_KCONFIG</span><br><span class="line"></span><br><span class="line"><span class="section">config: scripts_basic outputmakefile FORCE</span></span><br><span class="line">	<span class="variable">$(Q)</span><span class="variable">$(MAKE)</span> <span class="variable">$(build)</span>=scripts/kconfig <span class="variable">$@</span></span><br><span class="line"></span><br><span class="line"><span class="section">%config: scripts_basic outputmakefile FORCE</span></span><br><span class="line">	<span class="variable">$(Q)</span><span class="variable">$(MAKE)</span> <span class="variable">$(build)</span>=scripts/kconfig <span class="variable">$@</span></span><br></pre></td></tr></table></figure>

<p>ç¬¬ 7 è¡Œï¼Œæ²¡æœ‰ç›®æ ‡ä¸ä¹‹åŒ¹é…ï¼Œæ‰€ä»¥ä¸æ‰§è¡Œã€‚</p>
<p>ç¬¬ 10 è¡Œï¼Œæœ‰ç›®æ ‡ä¸ä¹‹åŒ¹é…ï¼Œå½“è¾“å…¥â€œmake xxx_defconfigâ€çš„æ—¶å€™å°±ä¼šåŒ¹é…åˆ°%config ç›®æ ‡ï¼Œç›®æ ‡â€œ%configâ€ä¾èµ–äº scripts_basicã€ outputmakefile å’Œ FORCEã€‚</p>
<h4 id="1-4-1-FORCE"><a href="#1-4-1-FORCE" class="headerlink" title="1.4.1 FORCE"></a><font size=3>1.4.1 FORCE</font></h4><p> FORCE åœ¨é¡¶å±‚ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L1978">Makefile</a>ä¸­å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PHONY += FORCE</span><br><span class="line"><span class="section">FORCE:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Declare the contents of the .PHONY variable as phony.  We keep that</span></span><br><span class="line"><span class="comment"># information in a variable so we can use it in if_changed and friends.</span></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: $(PHONY)</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡º FORCE æ˜¯æ²¡æœ‰è§„åˆ™å’Œä¾èµ–çš„ï¼Œæ‰€ä»¥æ¯æ¬¡éƒ½ä¼šé‡æ–°ç”Ÿæˆ FORCEã€‚å½“ FORCE ä½œä¸º å…¶ä»–ç›®æ ‡çš„ä¾èµ–æ—¶ï¼Œç”±äº FORCE æ€»æ˜¯è¢«æ›´æ–°è¿‡çš„ï¼Œå› æ­¤ä¾èµ–æ‰€åœ¨çš„è§„åˆ™æ€»æ˜¯ä¼šæ‰§è¡Œçš„ã€‚</p>
<h4 id="1-4-2-scripts-basic"><a href="#1-4-2-scripts-basic" class="headerlink" title="1.4.2Â scripts_basic"></a><font size=3>1.4.2Â scripts_basic</font></h4><p>ä¾èµ– scripts_basicåœ¨<a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L419">Makefile</a>ä¸­å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Basic helpers built in scripts/</span></span><br><span class="line">PHONY += scripts_basic</span><br><span class="line"><span class="section">scripts_basic:</span></span><br><span class="line">	<span class="variable">$(Q)</span><span class="variable">$(MAKE)</span> <span class="variable">$(build)</span>=scripts/basic</span><br><span class="line">	<span class="variable">$(Q)</span>rm -f .tmp_quiet_recordmcount</span><br><span class="line"></span><br><span class="line"><span class="comment"># To avoid any implicit rule to kick in, define an empty command.</span></span><br><span class="line"><span class="section">scripts/basic/%: scripts_basic ;</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯scripts_basic çš„è§„åˆ™ï¼Œå…¶å¯¹åº”çš„å‘½ä»¤ç”¨åˆ°äº†å˜é‡ Qã€MAKE å’Œ buildï¼Œå…¶ä¸­ï¼š</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Q=@æˆ–ä¸ºç©º</span><br><span class="line">MAKE=make</span><br></pre></td></tr></table></figure>

<p>å˜é‡ build æ˜¯åœ¨ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/scripts/Kbuild.include#L182">scripts&#x2F;Kbuild.include</a>æ–‡ä»¶ä¸­æœ‰å®šä¹‰ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">###</span><br><span class="line"># Shorthand for $(Q)$(MAKE) -f scripts/Makefile.build obj=</span><br><span class="line"># Usage:</span><br><span class="line"># $(Q)$(MAKE) $(build)=dir</span><br><span class="line">build := -f $(srctree)/scripts/Makefile.build obj</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡å‰é¢çš„åˆ†æ å¯çŸ¥ï¼Œå˜é‡ srctreeï¼ˆ<a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L201">Makefile Â· <em>srctree</em></a>ï¼‰ ä¸ºâ€.â€ï¼Œæ‰€ä»¥æœ‰ï¼š</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">build=-f ./scripts/Makefile.build obj</span><br></pre></td></tr></table></figure>

<p>scripts_basic å±•å¼€ä»¥åå¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">scripts_basic:</span></span><br><span class="line">    @make -f ./scripts/Makefile.build obj=scripts/basic <span class="comment"># ä¹Ÿå¯ä»¥æ²¡æœ‰@ï¼Œè§†é…ç½®è€Œå®š</span></span><br><span class="line">    @rm -f . tmp_quiet_recordmcount <span class="comment"># ä¹Ÿå¯ä»¥æ²¡æœ‰@</span></span><br></pre></td></tr></table></figure>

<p>scripts_basic ä¼šè°ƒç”¨æ–‡ä»¶.&#x2F;scripts&#x2F;Makefile.buildï¼Œè¿™ä¸ªæˆ‘ä»¬åé¢åœ¨åˆ†æã€‚</p>
<h4 id="1-4-3-configå±•å¼€"><a href="#1-4-3-configå±•å¼€" class="headerlink" title="1.4.3 %configå±•å¼€"></a><font size=3>1.4.3 %configå±•å¼€</font></h4><p>ä¸Šé¢çš„å‡ ä¸ªä¾èµ–æˆ‘ä»¬éƒ½æ‰¾åˆ°äº†ï¼Œæ¥ä¸‹æ¥å§%configå±•å¼€ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">%config: scripts_basic outputmakefile FORCE</span></span><br><span class="line">	<span class="variable">$(Q)</span><span class="variable">$(MAKE)</span> <span class="variable">$(build)</span>=scripts/kconfig <span class="variable">$@</span></span><br></pre></td></tr></table></figure>

<p>æŠŠbuildçš„å€¼æ›¿æ¢å±•å¼€åæ˜¯ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@make -f ./scripts/Makefile.build obj=scripts/kconfig xxx_defconfig</span><br></pre></td></tr></table></figure>

<p>å‘ç°åŒæ ·ä¹Ÿè·Ÿæ–‡ä»¶.&#x2F;scripts&#x2F;Makefile.build æœ‰å…³ï¼Œæˆ‘ä»¬åé¢å†åˆ†ææ­¤æ–‡ä»¶ã€‚</p>
<h3 id="1-5-ç¼–è¯‘ä¿¡æ¯"><a href="#1-5-ç¼–è¯‘ä¿¡æ¯" class="headerlink" title="1.5 ç¼–è¯‘ä¿¡æ¯"></a><font size=3>1.5 ç¼–è¯‘ä¿¡æ¯</font></h3><p>æˆ‘ä»¬åœ¨ubootæºç ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- distclean</span><br><span class="line">make V=1 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- mx6ull_14x14_evk_defconfig </span><br></pre></td></tr></table></figure>

<p>ä¸»è¦æ˜¯çœ‹ç¬¬äºŒæ¡å‘½ä»¤çš„æ‰“å°ä¿¡æ¯ï¼š</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV05-%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F/LV05-02-U-Boot-06-01-%E9%A1%B6%E5%B1%82Makefile%E5%9F%BA%E7%A1%80%E8%A7%A3%E6%9E%90/img/image-20241119220727685.png" alt="image-20241119220727685" />

<p>å¯ä»¥çœ‹åˆ°é‡Œé¢æœ‰ä¸¤æ¡ make -f å¼€å¤´çš„å‘½ä»¤ï¼š</p>
<ul>
<li>scripts_basic ç›®æ ‡å¯¹åº”çš„å‘½ä»¤</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make -f ./scripts/Makefile.build obj=scripts/basic</span><br></pre></td></tr></table></figure>

<ul>
<li>%config ç›®æ ‡å¯¹åº”çš„å‘½ä»¤</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make -f ./scripts/Makefile.build obj=scripts/kconfig mx6ull_14x14_evk_defconfig</span><br></pre></td></tr></table></figure>

<h3 id="1-6-Makefile-build-è„šæœ¬"><a href="#1-6-Makefile-build-è„šæœ¬" class="headerlink" title="1.6Â Makefile.build è„šæœ¬"></a><font size=3>1.6Â Makefile.build è„šæœ¬</font></h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥çœ‹ä¸€ä¸‹Makefile.build è„šæœ¬é‡Œé¢éƒ½æœ‰ä»€ä¹ˆã€‚ä»å‰è¾¹çŸ¥é“â€œ make xxx_defconfigâ€œé…ç½® uboot çš„æ—¶å€™å¦‚ä¸‹ä¸¤è¡Œå‘½ä»¤ä¼šæ‰§è¡Œè„šæœ¬scripts&#x2F;Makefile.buildï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@make -f ./scripts/Makefile.build obj=scripts/basic</span><br><span class="line">@make -f ./scripts/Makefile.build obj=scripts/kconfig xxx_defconfig  </span><br></pre></td></tr></table></figure>

<h4 id="1-6-1-scripts-basic-ç›®æ ‡å¯¹åº”çš„å‘½ä»¤"><a href="#1-6-1-scripts-basic-ç›®æ ‡å¯¹åº”çš„å‘½ä»¤" class="headerlink" title="1.6.1Â scripts_basic ç›®æ ‡å¯¹åº”çš„å‘½ä»¤"></a><font size=3>1.6.1Â scripts_basic ç›®æ ‡å¯¹åº”çš„å‘½ä»¤</font></h4><p>scripts_basic ç›®æ ‡å¯¹åº”çš„å‘½ä»¤ä¸ºï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@make -f ./scripts/Makefile.build obj=scripts/basic</span><br></pre></td></tr></table></figure>

<ul>
<li>srcä¸prefixå˜é‡</li>
</ul>
<p>å…ˆçœ‹ä¸€ä¸‹<a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/scripts/Makefile.build#L6">scripts&#x2F;Makefile.build</a>æœ€å¼€å§‹çš„ä¸¤ä¸ªå˜é‡ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Modified for U-Boot</span></span><br><span class="line">prefix := tpl</span><br><span class="line">src := <span class="variable">$(<span class="built_in">patsubst</span> <span class="variable">$(prefix)</span>/%,%,<span class="variable">$(obj)</span>)</span></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(obj)</span>,<span class="variable">$(src)</span>)</span><br><span class="line">prefix := spl</span><br><span class="line">src := <span class="variable">$(<span class="built_in">patsubst</span> <span class="variable">$(prefix)</span>/%,%,<span class="variable">$(obj)</span>)</span></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(obj)</span>,<span class="variable">$(src)</span>)</span><br><span class="line">prefix := .</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p>ç¬¬ 2 è¡Œï¼Œå˜é‡ prefix å€¼ä¸º tplã€‚</p>
<p>ç¬¬ 3 è¡Œå®šä¹‰äº†å˜é‡ srcï¼Œè¿™é‡Œç”¨åˆ°äº†å‡½æ•° patsubstï¼Œæ­¤è¡Œä»£ç å±•å¼€åä¸ºï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">patsubst</span> tpl/%,%, scripts/basic)</span></span><br></pre></td></tr></table></figure>

<p>patsubst æ˜¯æ›¿æ¢å‡½æ•°ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">patsubst</span> &lt;pattern&gt;,&lt;replacement&gt;,&lt;text&gt;)</span></span><br></pre></td></tr></table></figure>

<p>æ­¤å‡½æ•°ç”¨äºåœ¨ text ä¸­æŸ¥æ‰¾ç¬¦åˆ pattern çš„éƒ¨åˆ†ï¼Œå¦‚æœåŒ¹é…çš„è¯å°±ç”¨ replacement æ›¿æ¢æ‰ã€‚ pattern æ˜¯å¯ä»¥åŒ…å«é€šé…ç¬¦â€œ%â€ï¼Œå¦‚æœ replacement ä¸­ä¹ŸåŒ…å«é€šé…ç¬¦â€œ%â€ï¼Œé‚£ä¹ˆ replacement ä¸­çš„ è¿™ä¸ªâ€œ%â€å°†æ˜¯ pattern ä¸­çš„é‚£ä¸ªâ€œ%â€æ‰€ä»£è¡¨çš„å­—ç¬¦ä¸²ã€‚å‡½æ•°çš„è¿”å›å€¼ä¸ºæ›¿æ¢åçš„å­—ç¬¦ä¸²ã€‚å›  æ­¤ï¼Œç¬¬ 3 è¡Œå°±æ˜¯åœ¨â€œscripts&#x2F;basicâ€ä¸­æŸ¥æ‰¾ç¬¦åˆâ€œtpl&#x2F;%â€çš„éƒ¨åˆ†ï¼Œç„¶åå°†â€œtpl&#x2F;â€å–æ¶ˆæ‰ï¼Œä½†æ˜¯ â€œscripts&#x2F;basicâ€æ²¡æœ‰â€œtpl&#x2F;â€ï¼Œæ‰€ä»¥ src&#x3D; scripts&#x2F;basicã€‚</p>
<p>ç¬¬ 4 è¡Œåˆ¤æ–­å˜é‡ obj å’Œ src æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰çš„è¯æ¡ä»¶æˆç«‹ï¼Œå¾ˆæ˜æ˜¾ï¼Œæ­¤å¤„æ¡ä»¶æˆç«‹ã€‚</p>
<p>ç¬¬ 6 è¡Œå’Œç¬¬ 3 è¡Œä¸€æ ·ï¼Œåªæ˜¯è¿™é‡Œå¤„ç†çš„æ˜¯â€œsplâ€ï¼Œâ€œscripts&#x2F;basicâ€é‡Œé¢ä¹Ÿæ²¡æœ‰â€œspl&#x2F;â€ï¼Œæ‰€ä»¥ src ç»§ç»­ä¸º scripts&#x2F;basicã€‚</p>
<p>ç¬¬ 8 è¡Œå› ä¸ºå˜é‡ obj å’Œ src ç›¸ç­‰ï¼Œæ‰€ä»¥ prefix&#x3D;. ã€‚</p>
<ul>
<li>kbuild-dirä¸kbuild-file</li>
</ul>
<p>æˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹<a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/scripts/Makefile.build#L54">scripts&#x2F;Makefile.build</a>ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªå˜é‡ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The filename Kbuild has precedence over Makefile</span></span><br><span class="line">kbuild-dir := <span class="variable">$(<span class="built_in">if</span> $(<span class="built_in">filter</span> /%,<span class="variable">$(src)</span>)</span>,<span class="variable">$(src)</span>,<span class="variable">$(srctree)</span>/<span class="variable">$(src)</span>)</span><br><span class="line">kbuild-file := <span class="variable">$(<span class="built_in">if</span> $(<span class="built_in">wildcard</span> $(kbuild-<span class="built_in">dir</span>)</span>/Kbuild),$(kbuild-dir)/Kbuild,$(kbuild-dir)/Makefile)</span><br><span class="line"><span class="keyword">include</span> $(kbuild-file)</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å‰é¢åˆ†æè¿‡srctree&#x3D;.ï¼Œsrc&#x3D;scripts&#x2F;basicï¼Œ å°† kbuild-dir å±•å¼€åä¸ºï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kbuild-dir := <span class="variable">$(<span class="built_in">if</span> $(<span class="built_in">filter</span> /%, scripts/basic)</span>, scripts/basic, ./scripts/basic)</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºæ²¡æœ‰ä»¥â€œ&#x2F;â€ä¸ºå¼€å¤´çš„å•è¯ï¼Œæ‰€ä»¥$(filter &#x2F;%, scripts&#x2F;basic)çš„ç»“æœä¸ºç©ºï¼Œkbuild-dir&#x3D;.&#x2F;scripts&#x2F;basicã€‚å¾—åˆ°è¿™ä¸ªå˜é‡åï¼Œæˆ‘ä»¬å°† kbuild-file å±•å¼€åä¸ºï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kbuild-file := <span class="variable">$(<span class="built_in">if</span> $(<span class="built_in">wildcard</span> ./scripts/basic/Kbuild)</span>, ./scripts/basic/Kbuild, ./scripts/basic/Makefile)</span><br></pre></td></tr></table></figure>

<p>å› ä¸º scrpts&#x2F;basic ç›®å½•ä¸­æ²¡æœ‰ Kbuild è¿™ä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥ kbuild-file &#x3D; .&#x2F;scripts&#x2F;basic&#x2F;Makefileã€‚æœ€åå°†ç¬¬ 4 è¡Œå±•å¼€ï¼Œå³ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span> ./scripts/basic/Makefile</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå°±æ˜¯è¯»å– scripts&#x2F;basic ä¸‹é¢çš„ Makefile æ–‡ä»¶ã€‚</p>
<ul>
<li>__build</li>
</ul>
<p>æˆ‘ä»¬ç»§ç»­å‘ä¸‹çœ‹<a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/scripts/Makefile.build#L114">scripts&#x2F;Makefile.build</a>ï¼Œä¼šçœ‹åˆ°è¿™ä¸ª__buildï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># We keep a list of all modules in $(MODVERDIR)</span></span><br><span class="line"></span><br><span class="line"><span class="section">__build: $(if <span class="variable">$(KBUILD_BUILTIN)</span>,$(builtin-target) $(lib-target) $(extra-y)) \</span></span><br><span class="line">	 <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(KBUILD_MODULES)</span>,$(obj-m)</span> $(modorder-target)) \</span><br><span class="line">	 $(subdir-ym) <span class="variable">$(always)</span></span><br><span class="line">	@:</span><br></pre></td></tr></table></figure>

<p>__build æ˜¯é»˜è®¤ç›®æ ‡ï¼Œå› ä¸ºä¸‹é¢è¿™æ¡å‘½ä»¤</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@make -f ./scripts/Makefile.build obj=scripts/basic</span><br></pre></td></tr></table></figure>

<p>æ²¡æœ‰æŒ‡å®šç›®æ ‡ï¼Œæ‰€ä»¥ä¼šä½¿ç”¨åˆ°é»˜è®¤ç›®æ ‡ï¼š__buildã€‚åœ¨é¡¶å±‚ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L315">Makefile</a> ä¸­ï¼ŒKBUILD_BUILTIN ä¸º 1ï¼ŒKBUILD_MODULES ä¸º 0ï¼Œå› æ­¤å±•å¼€åç›®æ ‡__build ä¸ºï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">__build:$(builtin-target) $(lib-target) $(extra-y) $(subdir-ym) <span class="variable">$(always)</span></span></span><br><span class="line">	@:</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºç›®æ ‡__build æœ‰ 5 ä¸ªä¾èµ–ï¼šbuiltin-targetã€lib-targetã€extra-yã€subdir-ym å’Œ alwaysã€‚ è¿™ 5 ä¸ªä¾èµ–çš„å…·ä½“å†…å®¹æˆ‘ä»¬å°±ä¸é€šè¿‡æºç æ¥åˆ†æäº†ï¼Œç›´æ¥åœ¨ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/scripts/Makefile.build#L117">scripts&#x2F;Makefile.build</a> ä¸­è¾“å…¥ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># We keep a list of all modules in $(MODVERDIR)</span></span><br><span class="line"></span><br><span class="line"><span class="section">__build: $(if <span class="variable">$(KBUILD_BUILTIN)</span>,$(builtin-target) $(lib-target) $(extra-y)) \</span></span><br><span class="line">	 <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(KBUILD_MODULES)</span>,$(obj-m)</span> $(modorder-target)) \</span><br><span class="line">	 $(subdir-ym) <span class="variable">$(always)</span></span><br><span class="line">	@:</span><br><span class="line">	@echo <span class="string">&quot;builtin-target=&quot;</span>$(builtin-target) </span><br><span class="line">	@echo <span class="string">&quot;lib-target=&quot;</span>$(lib-target) </span><br><span class="line">	@echo <span class="string">&quot;extra-y=&quot;</span>$(extra-y)</span><br><span class="line">	@echo <span class="string">&quot;subdir-ym=&quot;</span>$(subdir-ym) </span><br><span class="line">	@echo <span class="string">&quot;always=&quot;</span><span class="variable">$(always)</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘é‡æ–°æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- distclean</span><br><span class="line">make V=1 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- mx6ull_14x14_evk_defconfig </span><br></pre></td></tr></table></figure>

<p>ä¼šçœ‹åˆ°æœ‰å¦‚ä¸‹æ‰“å°ä¿¡æ¯å‡ºç°ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">builtin-target=</span><br><span class="line">lib-target=</span><br><span class="line">extra-y=</span><br><span class="line">subdir-ym=</span><br><span class="line">always=scripts/basic/fixdep</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºï¼Œåªæœ‰ always æœ‰æ•ˆï¼Œå› æ­¤__build æœ€ç»ˆä¸ºï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">__build:scripts/basic/fixdep</span></span><br><span class="line">	@:</span><br></pre></td></tr></table></figure>

<p>__build ä¾èµ–äº scripts&#x2F;basic&#x2F;fixdepï¼Œæ‰€ä»¥è¦å…ˆç¼–è¯‘ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/scripts/basic/fixdep.c">scripts&#x2F;basic&#x2F;fixdep.c</a>ï¼Œç”Ÿæˆ fixdepï¼Œå‰é¢å·²ç»è¯»å–äº† <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/scripts/basic/Makefile">scripts&#x2F;basic&#x2F;Makefile</a> æ–‡ä»¶ã€‚</p>
<p>æ€»çš„æ¥è¯´scripts_basic ç›®æ ‡çš„ä½œç”¨å°±æ˜¯ç¼–è¯‘å‡º scripts&#x2F;basic&#x2F;fixdep è¿™ä¸ªè½¯ä»¶ã€‚</p>
<h4 id="1-6-2-config-ç›®æ ‡å¯¹åº”çš„å‘½ä»¤"><a href="#1-6-2-config-ç›®æ ‡å¯¹åº”çš„å‘½ä»¤" class="headerlink" title="1.6.2 %config ç›®æ ‡å¯¹åº”çš„å‘½ä»¤"></a><font size=3>1.6.2 %config ç›®æ ‡å¯¹åº”çš„å‘½ä»¤</font></h4><p>%config ç›®æ ‡å¯¹åº”çš„å‘½ä»¤ä¸ºï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@make -f ./scripts/Makefile.build obj=scripts/kconfig xxx_defconfig  </span><br></pre></td></tr></table></figure>

<p>æŒ‰ç…§å‰é¢çš„åˆ†æï¼Œç›¸å…³çš„å˜é‡å€¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">src= scripts/kconfig</span><br><span class="line">kbuild-dir = ./scripts/kconfig</span><br><span class="line">kbuild-file = ./scripts/kconfig/Makefile</span><br><span class="line">include ./scripts/kconfig/Makefile</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºï¼ŒMakefilke.build ä¼šè¯»å– <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/scripts/kconfig/Makefile">scripts&#x2F;kconfig&#x2F;Makefile</a> ä¸­çš„å†…å®¹ï¼Œæ­¤æ–‡ä»¶ä¸­æœ‰å¦‚ä¸‹æ‰€ç¤ºå†…å®¹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">%_defconfig: <span class="variable">$(obj)</span>/conf</span></span><br><span class="line">	<span class="variable">$(Q)</span><span class="variable">$&lt;</span> <span class="variable">$(silent)</span> --defconfig=arch/<span class="variable">$(SRCARCH)</span>/configs/<span class="variable">$@</span> <span class="variable">$(Kconfig)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Added for U-Boot (backward compatibility)</span></span><br><span class="line"><span class="section">%_config: %_defconfig</span></span><br><span class="line">	@:</span><br></pre></td></tr></table></figure>

<p>è¿™å‡ è¡Œåœ¨ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/scripts/kconfig/Makefile#L127">scripts&#x2F;kconfig&#x2F;Makefile Â· <em>%_defconfig</em></a> é™„è¿‘ã€‚ç›®æ ‡%_defconfig åˆšå¥½å’Œæˆ‘ä»¬è¾“å…¥çš„ xxx_defconfig åŒ¹é…ï¼Œæ‰€ä»¥ä¼šæ‰§è¡Œè¿™æ¡è§„åˆ™ã€‚ä¾èµ–ä¸º $(obj)&#x2F;confï¼Œå±•å¼€åå°±æ˜¯ scripts&#x2F;kconfig&#x2F;confã€‚</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯æ£€æŸ¥å¹¶ç”Ÿæˆä¾èµ– scripts&#x2F;kconfig&#x2F;confã€‚ conf æ˜¯ä¸»æœºè½¯ä»¶ï¼Œåˆ°è¿™é‡Œæˆ‘ä»¬å°±åœä¸‹æ¥ï¼Œä¸è¦çº ç»“ conf æ˜¯æ€ä¹ˆç¼–è¯‘å‡ºæ¥çš„ï¼Œå¦åˆ™å°±è¶Šé™·è¶Šæ·±ï¼Œå¤ªç»•äº†ï¼Œåƒ conf è¿™ç§ä¸»æœºæ‰€ä½¿ç”¨çš„å·¥å…·ç±»è½¯ä»¶æˆ‘ä»¬ä¸€èˆ¬ä¸å…³å¿ƒå®ƒæ˜¯å¦‚ä½•ç¼–è¯‘äº§ç”Ÿçš„ã€‚å¦‚æœä¸€å®šè¦çœ‹æ˜¯ conf æ˜¯æ€ä¹ˆç”Ÿæˆçš„ï¼Œå¯ä»¥è¾“å…¥å¦‚ä¸‹å‘½ä»¤é‡æ–°é…ç½® ubootï¼Œåœ¨é‡æ–°é…ç½® uboot çš„è¿‡ç¨‹ä¸­å°±ä¼š è¾“å‡º conf ç¼–è¯‘ä¿¡æ¯ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- distclean</span><br><span class="line">make V=1 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- mx6ull_14x14_evk_defconfig </span><br></pre></td></tr></table></figure>

<p>ä¼šæœ‰ä¸‹é¢çš„æ‰“å°ä¿¡æ¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">......</span></span><br><span class="line">  cc -Wp,-MD,scripts/kconfig/.zconf.tab.o.d -Wall -Wstrict-prototypes -O2 -fomit-frame-pointer  -std=gnu11   -D_GNU_SOURCE -D_DEFAULT_SOURCE -I/usr/include/ncursesw -DCURSES_LOC=&quot;&lt;ncurses.h&gt;&quot; -DNCURSES_WIDECHAR=1 -DLOCALE  -Iscripts/kconfig -c -o scripts/kconfig/zconf.tab.o scripts/kconfig/zconf.tab.c</span><br><span class="line">  cc  -o scripts/kconfig/conf scripts/kconfig/conf.o scripts/kconfig/zconf.tab.o</span><br><span class="line">scripts/kconfig/conf  --defconfig=arch/../configs/mx6ull_14x14_evk_defconfig Kconfig</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># configuration written to .config</span></span></span><br><span class="line"><span class="meta prompt_">#</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„cc  -o scripts&#x2F;kconfig&#x2F;confè¿™è¡Œå°±æ˜¯åœ¨ç¼–è¯‘ç”Ÿæˆconfè½¯ä»¶ã€‚å¾—åˆ° scripts&#x2F;kconfig&#x2F;conf ä»¥åå°±è¦æ‰§è¡Œç›®æ ‡%_defconfig çš„å‘½ä»¤ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(Q)</span><span class="variable">$&lt;</span> <span class="variable">$(silent)</span> --defconfig=arch/<span class="variable">$(SRCARCH)</span>/configs/<span class="variable">$@</span> <span class="variable">$(Kconfig)</span></span><br></pre></td></tr></table></figure>

<p>ç›¸å…³çš„å˜é‡å€¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">silent=-s æˆ–ä¸ºç©º</span><br><span class="line">SRCARCH=..</span><br><span class="line">Kconfig=Kconfig</span><br></pre></td></tr></table></figure>

<p>å°†å…¶å±•å¼€å°±æ˜¯ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@ scripts/kconfig/conf --defconfig=arch/../configs/xxx_defconfig Kconfig</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°å‘½ä»¤ç”¨åˆ°äº† xxx_defconfig æ–‡ä»¶ï¼Œæ¯”å¦‚ mx6ull_14x14_evk_defconfig ã€‚è¿™é‡Œä¼šå°†mx6ull_14x14_evk_defconfig ä¸­çš„é…ç½®è¾“å‡ºåˆ°.config æ–‡ä»¶ä¸­ï¼Œæœ€ç»ˆç”Ÿæˆ uboot æ ¹ç›®å½•ä¸‹çš„.config æ–‡ä»¶ã€‚</p>
<h3 id="1-7-æ€»ç»“ä¸€ä¸‹"><a href="#1-7-æ€»ç»“ä¸€ä¸‹" class="headerlink" title="1.7 æ€»ç»“ä¸€ä¸‹"></a><font size=3>1.7 æ€»ç»“ä¸€ä¸‹</font></h3><img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV05-%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F/LV05-02-U-Boot-06-01-%E9%A1%B6%E5%B1%82Makefile%E5%9F%BA%E7%A1%80%E8%A7%A3%E6%9E%90/img/image-20241119221119307.png" alt="image-20241119221119307" />

<h2 id="2-u-boot-binçš„ç”Ÿæˆè¿‡ç¨‹"><a href="#2-u-boot-binçš„ç”Ÿæˆè¿‡ç¨‹" class="headerlink" title="2. u-boot.binçš„ç”Ÿæˆè¿‡ç¨‹"></a><font size=3>2. u-boot.binçš„ç”Ÿæˆè¿‡ç¨‹</font></h2><h3 id="2-1-ç›®æ ‡æ–‡ä»¶"><a href="#2-1-ç›®æ ‡æ–‡ä»¶" class="headerlink" title="2.1 ç›®æ ‡æ–‡ä»¶"></a><font size=3>2.1 ç›®æ ‡æ–‡ä»¶</font></h3><p>é…ç½®å¥½ uboot ä»¥åå°±å¯ä»¥ç›´æ¥ make ç¼–è¯‘äº†ï¼Œå› ä¸ºæ²¡æœ‰æŒ‡æ˜ç›®æ ‡ï¼Œæ‰€ä»¥ä¼šä½¿ç”¨é»˜è®¤ç›®æ ‡ï¼Œä¸» <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L126">Makefile</a> ä¸­çš„é»˜è®¤ç›®æ ‡å¦‚ä¸‹ï¼š  </p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># That&#x27;s our default target when none is given on the command line</span></span><br><span class="line">PHONY := _all</span><br><span class="line"><span class="section">_all:</span></span><br></pre></td></tr></table></figure>

<p>ç›®æ ‡_all åˆä¾èµ–äº allï¼Œåœ¨ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L192">Makefile</a> ä¸­å¦‚ä¸‹æ‰€ç¤º ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># If building an external module we do not care about the all: rule</span></span><br><span class="line"><span class="comment"># but instead _all depend on modules</span></span><br><span class="line">PHONY += all</span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(KBUILD_EXTMOD)</span>,)</span><br><span class="line"><span class="section">_all: all</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="section">_all: modules</span></span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœ KBUILD_EXTMOD ä¸ºç©ºçš„è¯ _all ä¾èµ–äº all ã€‚è¿™é‡Œä¸æ˜¯å•ç‹¬ç¼–è¯‘æ¨¡å—ï¼Œæ‰€ä»¥KBUILD_EXTMOD ä¸ºç©ºï¼Œ _all çš„ä¾èµ–å°±æ˜¯ allã€‚</p>
<h3 id="2-2-allç›®æ ‡è§„åˆ™"><a href="#2-2-allç›®æ ‡è§„åˆ™" class="headerlink" title="2.2 allç›®æ ‡è§„åˆ™"></a><font size=3>2.2 allç›®æ ‡è§„åˆ™</font></h3><p>åœ¨ä¸» <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L921">Makefile</a> ä¸­ all ç›®æ ‡è§„åˆ™å¦‚ä¸‹ï¼š  </p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">all:		$(ALL-y)</span></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(CONFIG_DM_I2C_COMPAT)</span><span class="variable">$(CONFIG_SANDBOX)</span>,y)</span><br><span class="line">	@echo &gt;&amp;2 <span class="string">&quot;===================== WARNING ======================&quot;</span></span><br><span class="line">	@echo &gt;&amp;2 <span class="string">&quot;This board uses CONFIG_DM_I2C_COMPAT. Please remove&quot;</span></span><br><span class="line">	@echo &gt;&amp;2 <span class="string">&quot;(possibly in a subsequent patch in your series)&quot;</span></span><br><span class="line">	@echo &gt;&amp;2 <span class="string">&quot;before sending patches to the mailing list.&quot;</span></span><br><span class="line">	@echo &gt;&amp;2 <span class="string">&quot;====================================================&quot;</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"><span class="comment">#......</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line">	@<span class="comment"># Check that this build does not use CONFIG options that we do not</span></span><br><span class="line">	@<span class="comment"># know about unless they are in Kconfig. All the existing CONFIG</span></span><br><span class="line">	@<span class="comment"># options are whitelisted, so new ones should not be added.</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> cmd,cfgcheck,u-boot.cfg)</span></span><br></pre></td></tr></table></figure>

<p>allé‡Œé¢å…¶å®æ˜¯å¤§é‡çš„æ‰“å°ä¿¡æ¯ï¼Œä¸»è¦è¿˜æ˜¯è¦çœ‹å®ƒçš„ä¾èµ–$(ALL-y)ã€‚</p>
<h3 id="2-3-ALL-y"><a href="#2-3-ALL-y" class="headerlink" title="2.3Â ALL-y"></a><font size=3>2.3Â ALL-y</font></h3><p>åœ¨é¡¶å±‚ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L810">Makefile</a> ä¸­ï¼Œ ALL-y å¦‚ä¸‹  :</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Always append ALL so that arch config.mk&#x27;s can add custom ones</span></span><br><span class="line">ALL-y += u-boot.srec u-boot.bin u-boot.sym System.map binary_size_check</span><br><span class="line"></span><br><span class="line">ALL-<span class="variable">$(CONFIG_ONENAND_U_BOOT)</span> += u-boot-onenand.bin</span><br><span class="line"><span class="comment">#......</span></span><br><span class="line">ALL-<span class="variable">$(CONFIG_OF_HOSTFILE)</span> += u-boot.dtb</span><br><span class="line"><span class="keyword">ifneq</span> (<span class="variable">$(CONFIG_SPL_TARGET)</span>,)</span><br><span class="line">ALL-<span class="variable">$(CONFIG_SPL)</span> += $(CONFIG_SPL_TARGET:<span class="string">&quot;%&quot;</span>=%)</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"><span class="comment">#......</span></span><br><span class="line"><span class="comment"># Add optional build target if defined in board/cpu/soc headers</span></span><br><span class="line"><span class="keyword">ifneq</span> (<span class="variable">$(CONFIG_BUILD_TARGET)</span>,)</span><br><span class="line">ALL-y += $(CONFIG_BUILD_TARGET:<span class="string">&quot;%&quot;</span>=%)</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"><span class="comment">#......</span></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(CONFIG_MPC85xx)</span><span class="variable">$(CONFIG_OF_SEPARATE)</span>,yy)</span><br><span class="line">ALL-y += u-boot-with-dtb.bin</span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºï¼Œ ALL-yä¸€å®šåŒ…å« u-boot.srecã€ u-boot.binã€ u-boot.symã€System.mapã€ u-boot.cfg å’Œ binary_size_check è¿™å‡ ä¸ªæ–‡ä»¶ã€‚æ ¹æ® uboot çš„é…ç½®æƒ…å†µä¹Ÿå¯èƒ½åŒ…å«å…¶ä»–çš„æ–‡ä»¶ï¼Œæ¯”å¦‚ï¼š  </p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALL-<span class="variable">$(CONFIG_ONENAND_U_BOOT)</span> += u-boot-onenand.bin</span><br></pre></td></tr></table></figure>

<p>CONFIG_ONENAND_U_BOOT å°±æ˜¯ uboot ä¸­è·Ÿ ONENAND é…ç½®æœ‰å…³çš„ï¼Œå¦‚æœæˆ‘ä»¬ä½¿èƒ½äº†ONENANDï¼Œé‚£ä¹ˆåœ¨.config é…ç½®æ–‡ä»¶ä¸­å°±ä¼šæœ‰â€œCONFIG_ONENAND_U_BOOT&#x3D;yâ€è¿™ä¸€å¥ã€‚ç›¸å½“äº CONFIG_ONENAND_U_BOOT æ˜¯ä¸ªå˜é‡ï¼Œè¿™ä¸ªå˜é‡çš„å€¼ä¸ºâ€œyâ€ï¼Œæ‰€ä»¥å±•å¼€ä»¥åå°±æ˜¯ï¼š  </p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALL-y += u-boot-onenand.bin</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå°±æ˜¯.config é‡Œé¢çš„é…ç½®å‚æ•°çš„å«ä¹‰ï¼Œè¿™äº›å‚æ•°å…¶å®éƒ½æ˜¯å˜é‡ï¼Œåé¢è·Ÿç€å˜é‡å€¼ï¼Œä¼šåœ¨é¡¶å±‚ Makefile æˆ–è€…å…¶ä»– Makefile ä¸­è°ƒç”¨è¿™äº›å˜é‡ã€‚</p>
<h3 id="2-4-u-boot-bin"><a href="#2-4-u-boot-bin" class="headerlink" title="2.4 u-boot.bin"></a><font size=3>2.4 u-boot.bin</font></h3><p>ALL-y é‡Œé¢æœ‰ä¸ª u-boot.binï¼Œè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬æœ€ç»ˆéœ€è¦çš„ uboot äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ‰€ä½œçš„æ‰€æœ‰å·¥ä½œå°±æ˜¯ä¸ºäº†å®ƒã€‚åœ¨é¡¶å±‚ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L1034">Makefile</a> ä¸­æ‰¾åˆ° u-boot.bin ç›®æ ‡å¯¹åº”çš„è§„åˆ™ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š  </p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(CONFIG_MULTI_DTB_FIT)</span>,y)</span><br><span class="line"></span><br><span class="line"><span class="section">fit-dtb.blob: dts/dt.dtb FORCE</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> if_changed,mkimage)</span></span><br><span class="line"></span><br><span class="line">MKIMAGEFLAGS_fit-dtb.blob = -f auto -A <span class="variable">$(ARCH)</span> -T firmware -C none -O u-boot \</span><br><span class="line">	-a 0 -e 0 -E \</span><br><span class="line">	<span class="variable">$(<span class="built_in">patsubst</span> %,-b arch/<span class="variable">$(ARCH)</span>/dts/%.dtb,$(<span class="built_in">subst</span> &quot;,,<span class="variable">$(CONFIG_OF_LIST)</span>)</span>) -d /dev/null</span><br><span class="line"></span><br><span class="line"><span class="section">u-boot-fit-dtb.bin: u-boot-nodtb.bin fit-dtb.blob</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> if_changed,cat)</span></span><br><span class="line"></span><br><span class="line"><span class="section">u-boot.bin: u-boot-fit-dtb.bin FORCE</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> if_changed,copy)</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">ifeq</span> (<span class="variable">$(CONFIG_OF_SEPARATE)</span>,y)</span><br><span class="line"><span class="section">u-boot-dtb.bin: u-boot-nodtb.bin dts/dt.dtb FORCE</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> if_changed,cat)</span></span><br><span class="line"></span><br><span class="line"><span class="section">u-boot.bin: u-boot-dtb.bin FORCE</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> if_changed,copy)</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="section">u-boot.bin: u-boot-nodtb.bin FORCE</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> if_changed,copy)</span></span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥æœç´¢ä¸€ä¸‹è¿™ä¸ªCONFIG_MULTI_DTB_FITï¼Œä¼šå‘ç°æ˜¯æ²¡æœ‰è¿™ä¸ªé…ç½®é¡¹çš„ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sumu@sumu-virtual-machine:~/7Linux/imx6ull-uboot$ grep -nRw &quot;CONFIG_MULTI_DTB_FIT&quot; ./</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">......</span></span><br><span class="line">./.config:654:# CONFIG_MULTI_DTB_FIT is not set</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥èµ°çš„æ˜¯elseè¿™éƒ¨åˆ†ï¼Œæˆ‘ä»¬å†æœä¸€ä¸‹CONFIG_OF_SEPARATEï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sumu@sumu-virtual-machine:~/7Linux/imx6ull-uboot$ grep -nRw &quot;CONFIG_OF_SEPARATE&quot; ./</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">......</span></span><br><span class="line">./.config:649:CONFIG_OF_SEPARATE=y</span><br></pre></td></tr></table></figure>

<p>åˆ¤æ–­ CONFIG_OF_SEPARATE æ˜¯å¦ç­‰äº yï¼Œå¦‚æœç›¸ç­‰ï¼Œé‚£æ¡ä»¶å°±æˆç«‹ã€‚æ‰€ä»¥åœ¨è¿™é‡Œæ˜¯æˆç«‹çš„ã€‚æ‰€ä»¥è¿™ä¸€å¤§æ®µæœ€åå°±æ˜¯ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">u-boot-dtb.bin: u-boot-nodtb.bin dts/dt.dtb FORCE</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> if_changed,cat)</span></span><br><span class="line"></span><br><span class="line"><span class="section">u-boot.bin: u-boot-dtb.bin FORCE</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> if_changed,copy)</span></span><br></pre></td></tr></table></figure>

<p>è¿™éƒ¨åˆ†å°±æ˜¯åˆ¶ä½œu-boot-dtb.binå’Œu-boot.binçš„è§„åˆ™ï¼Œç›®æ ‡u-boot.binä¾èµ–äºu-boot-dtb.binï¼Œå‘½ä»¤ä¸º$(call if_changed,copy) ï¼Œ è¿™é‡Œè°ƒç”¨äº† if_changed ï¼Œif_changed æ˜¯ä¸€ä¸ªå‡½æ•° ï¼Œè¿™ä¸ªå‡½æ•°åœ¨ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/scripts/Kbuild.include#L258">scripts&#x2F;Kbuild.include</a> ä¸­æœ‰å®šä¹‰ã€‚è€Œé¡¶å±‚ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L345">Makefile</a> ä¸­ä¼šåŒ…å« <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/scripts/Kbuild.include">scripts&#x2F;Kbuild.include</a> æ–‡ä»¶ï¼Œè¿™ä¸ªå‰é¢å·²ç»è¯´è¿‡äº†ã€‚  if_changed åœ¨ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/scripts/Kbuild.include#L258">scripts&#x2F;Kbuild.include</a>  ä¸­çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if_changed = <span class="variable">$(<span class="built_in">if</span> $(<span class="built_in">strip</span> $(any-prereq)</span> $(arg-check)),                       \</span><br><span class="line">	@set -e;                                                             \</span><br><span class="line">	$(echo-cmd) $(cmd_$(1));                                             \</span><br><span class="line">	printf &#x27;%s\n&#x27; &#x27;cmd_<span class="variable">$@</span> := $(make-cmd)&#x27; &gt; $(dot-target).cmd)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰ä¸€äº›å…³äºif_changedçš„æè¿°åœ¨<a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/scripts/Kbuild.include#L228">scripts&#x2F;Kbuild.include</a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###</span></span><br><span class="line"><span class="comment"># if_changed      - execute command if any prerequisite is newer than</span></span><br><span class="line"><span class="comment">#                   target, or command line has changed</span></span><br><span class="line"><span class="comment"># if_changed_dep  - as if_changed, but uses fixdep to reveal dependencies</span></span><br><span class="line"><span class="comment">#                   including used config symbols</span></span><br><span class="line"><span class="comment"># if_changed_rule - as if_changed but execute rule instead</span></span><br><span class="line"><span class="comment"># See Documentation/kbuild/makefiles.txt for more info</span></span><br></pre></td></tr></table></figure>

<p>æ ¹æ®æè¿°ï¼Œåœ¨ä¸€äº›å…ˆå†³æ¡ä»¶æ¯”ç›®æ ‡æ–°çš„æ—¶å€™ï¼Œæˆ–è€…å‘½ä»¤è¡Œæœ‰æ”¹å˜çš„æ—¶å€™ï¼Œ if_changed å°±ä¼šæ‰§è¡Œä¸€äº›å‘½ä»¤ã€‚ç»§ç»­å¾€åçœ‹å°±å¯ä»¥æ‰¾åˆ°åˆšæ‰çš„å®šä¹‰ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if_changed = <span class="variable">$(<span class="built_in">if</span> $(<span class="built_in">strip</span> $(any-prereq)</span> $(arg-check)),                       \</span><br><span class="line">	@set -e;                                                             \</span><br><span class="line">	$(echo-cmd) $(cmd_$(1));                                             \</span><br><span class="line">	printf &#x27;%s\n&#x27; &#x27;cmd_<span class="variable">$@</span> := $(make-cmd)&#x27; &gt; $(dot-target).cmd)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ˜¯å‡½æ•° if_changedï¼Œ if_changed å‡½æ•°å¼•ç”¨çš„å˜é‡æ¯”è¾ƒå¤šï¼Œä¹Ÿæ¯”è¾ƒç»•ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“å®ƒå¯ä»¥ä» u-boot-dtb.bin ç”Ÿæˆ u-boot.bin å°±è¡Œäº†ã€‚  </p>
<h3 id="2-5-u-boot-dtb-bin"><a href="#2-5-u-boot-dtb-bin" class="headerlink" title="2.5 u-boot-dtb.bin"></a><font size=3>2.5 u-boot-dtb.bin</font></h3><h4 id="2-5-1-ä¾èµ–ç›®æ ‡"><a href="#2-5-1-ä¾èµ–ç›®æ ‡" class="headerlink" title="2.5.1 ä¾èµ–ç›®æ ‡"></a><font size=3>2.5.1 ä¾èµ–ç›®æ ‡</font></h4><p>æ—¢ç„¶ u-boot.bin ä¾èµ–äº u-boot-dtb.binï¼Œé‚£ä¹ˆè‚¯å®šè¦å…ˆç”Ÿæˆ u-boot-dtb.bin æ–‡ä»¶ï¼Œé¡¶å±‚ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L1037">Makefile</a> ä¸­ç›¸å…³ä»£ç å¦‚ä¸‹ï¼š    </p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">u-boot-dtb.bin: u-boot-nodtb.bin dts/dt.dtb FORCE</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> if_changed,cat)</span></span><br></pre></td></tr></table></figure>

<p>ç›®æ ‡ u-boot-dtb.bin åˆä¾èµ–äº u-boot-nodtb.binï¼Œ u-boot-nodtb.binçš„è§„åˆ™åœ¨ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L1126">Makefile</a>ä¸­å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">u-boot-nodtb.bin: u-boot FORCE</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> if_changed,objcopy)</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> DO_STATIC_RELA,<span class="variable">$&lt;</span>,<span class="variable">$@</span>,<span class="variable">$(CONFIG_SYS_TEXT_BASE)</span>)</span></span><br><span class="line">	<span class="variable">$(BOARD_SIZE_CHECK)</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°u-boot-nodtb.binåˆä¾èµ–äºu-bootã€‚</p>
<h4 id="2-5-2-u-boot"><a href="#2-5-2-u-boot" class="headerlink" title="2.5.2 u-boot"></a><font size=3>2.5.2 u-boot</font></h4><h5 id="2-5-2-1-u-bootçš„ä¾èµ–"><a href="#2-5-2-1-u-bootçš„ä¾èµ–" class="headerlink" title="2.5.2.1 u-bootçš„ä¾èµ–"></a><font size=3>2.5.2.1 u-bootçš„ä¾èµ–</font></h5><p>u-bootçš„è§„åˆ™åœ¨é¡¶å±‚ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L1504">Makefile</a> ä¸­ç›¸å…³è§„åˆ™å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">u-boot:	$(u-boot-init) $(u-boot-main) u-boot.lds FORCE</span></span><br><span class="line">	+<span class="variable">$(<span class="built_in">call</span> if_changed,u-boot__)</span></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(CONFIG_KALLSYMS)</span>,y)</span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> cmd,smap)</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> cmd,u-boot__)</span> common/system_map.o</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(CONFIG_RISCV)</span>,y)</span><br><span class="line">	@tools/prelink-riscv <span class="variable">$@</span> 0</span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ç›®æ ‡ u-boot ä¾èµ–äº u-boot-initã€ u-boot-main å’Œ u-boot.ldsï¼Œ u-boot-init å’Œ u-boot-main æ˜¯ä¸¤ä¸ªå˜é‡ï¼Œåœ¨é¡¶å±‚ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L749">Makefile</a> ä¸­æœ‰å®šä¹‰ï¼Œå€¼å¦‚ä¸‹ï¼š  </p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">u-boot-init := $(head-y)</span><br><span class="line">u-boot-main := $(libs-y)</span><br></pre></td></tr></table></figure>

<h5 id="2-5-2-2-head-y"><a href="#2-5-2-2-head-y" class="headerlink" title="2.5.2.2 head-y"></a><font size=3>2.5.2.2 head-y</font></h5><p>$(head-y)è·Ÿ CPU æ¶æ„æœ‰å…³ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ ARM èŠ¯ç‰‡ï¼Œæ‰€ä»¥ head-y åœ¨ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/arch/arm/Makefile#L94">arch&#x2F;arm&#x2F;Makefile</a> ä¸­è¢«æŒ‡å®šä¸ºï¼š  </p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">head-y := arch/arm/cpu/<span class="variable">$(CPU)</span>/start.o</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®æœ¬ç¯‡ç¬”è®° â€œç¬¬ä¸€éƒ¨åˆ† ç¬¬11.3 å˜é‡å¯¼å‡ºâ€ å°èŠ‚ï¼Œæˆ‘ä»¬çŸ¥é“ CPU&#x3D;armv7ï¼Œå› æ­¤ head-y å±•å¼€ä»¥åå°±æ˜¯ï¼š  </p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">head-y := arch/arm/cpu/armv7/start.o</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥å°±æœ‰ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">u-boot-init= arch/arm/cpu/armv7/start.o</span><br></pre></td></tr></table></figure>

<h5 id="2-5-2-3-libs-y"><a href="#2-5-2-3-libs-y" class="headerlink" title="2.5.2.3 libs-y"></a><font size=3>2.5.2.3 libs-y</font></h5><p>$(libs-y)åœ¨é¡¶å±‚ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L688">Makefile</a> ä¸­è¢«å®šä¹‰ä¸º uboot æ‰€æœ‰å­ç›®å½•ä¸‹ build-in.o çš„é›†åˆï¼Œä»£ç å¦‚ä¸‹ï¼š  </p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">libs-y += lib/</span><br><span class="line">libs-<span class="variable">$(HAVE_VENDOR_COMMON_LIB)</span> += board/<span class="variable">$(VENDOR)</span>/common/</span><br><span class="line">libs-<span class="variable">$(CONFIG_OF_EMBED)</span> += dts/</span><br><span class="line">libs-y += fs/</span><br><span class="line">libs-y += net/</span><br><span class="line"><span class="comment"># ......</span></span><br><span class="line">u-boot-dirs	:= <span class="variable">$(<span class="built_in">patsubst</span> %/,%,$(<span class="built_in">filter</span> %/, $(libs-y)</span>)) tools examples</span><br><span class="line"></span><br><span class="line">u-boot-alldirs	:= <span class="variable">$(<span class="built_in">sort</span> $(u-boot-dirs)</span> <span class="variable">$(<span class="built_in">patsubst</span> %/,%,$(<span class="built_in">filter</span> %/, $(libs-)</span>)))</span><br><span class="line"></span><br><span class="line">libs-y		:= <span class="variable">$(<span class="built_in">patsubst</span> %/, %/built-in.o, $(libs-y)</span>)</span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œ libs-y éƒ½æ˜¯ uboot å„å­ç›®å½•çš„é›†åˆï¼Œæœ€åï¼š  </p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">libs-y := <span class="variable">$(<span class="built_in">patsubst</span> %/, %/built-in.o, $(libs-y)</span>)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè°ƒç”¨äº†å‡½æ•° patsubstï¼Œå°† libs-y ä¸­çš„â€œ&#x2F;â€æ›¿æ¢ä¸ºâ€&#x2F;built-in.oâ€ï¼Œæ¯”å¦‚â€œdrivers&#x2F;dma&#x2F;â€å°±å˜ä¸ºäº†â€œdrivers&#x2F;dma&#x2F;built-in.oâ€ï¼Œç›¸å½“äºå°† libs-y æ”¹ä¸ºæ‰€æœ‰å­ç›®å½•ä¸­ built-in.o æ–‡ä»¶çš„é›†åˆã€‚é‚£ä¹ˆ uboot-main å°±ç­‰äºæ‰€æœ‰å­ç›®å½•ä¸­ built-in.o çš„é›†åˆã€‚  </p>
<h5 id="2-5-2-4-u-boot-ldsè§„åˆ™"><a href="#2-5-2-4-u-boot-ldsè§„åˆ™" class="headerlink" title="2.5.2.4Â u-boot.ldsè§„åˆ™"></a><font size=3>2.5.2.4Â u-boot.ldsè§„åˆ™</font></h5><p>ä¸Šé¢çš„è¿™ä¸ª u-boot è§„åˆ™å°±ç›¸å½“äºå°†ä»¥ u-boot.lds ä¸ºé“¾æ¥è„šæœ¬ï¼Œå°† arch&#x2F;arm&#x2F;cpu&#x2F;armv7&#x2F;start.o å’Œå„ä¸ªå­ç›®å½•ä¸‹çš„ built-in.o é“¾æ¥åœ¨ä¸€èµ·ç”Ÿæˆ u-bootã€‚u-boot.lds çš„è§„åˆ™åœ¨ <a target="_blank" rel="noopener" href="https://gitee.com/sumumm/u-boot/blob/master/Makefile#L1655">Makefile</a> ä¸­æ˜¯è¿™æ ·çš„ï¼š</p>
 <figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">u-boot.lds: <span class="variable">$(LDSCRIPT)</span> prepare FORCE</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> if_changed_dep,cpp_lds)</span></span><br></pre></td></tr></table></figure>

<h5 id="2-5-2-5-built-in-oæ€ä¹ˆç”Ÿæˆï¼Ÿ"><a href="#2-5-2-5-built-in-oæ€ä¹ˆç”Ÿæˆï¼Ÿ" class="headerlink" title="2.5.2.5Â  built-in.oæ€ä¹ˆç”Ÿæˆï¼Ÿ"></a><font size=3>2.5.2.5Â  built-in.oæ€ä¹ˆç”Ÿæˆï¼Ÿ</font></h5><p>æ¥ä¸‹æ¥çš„é‡ç‚¹å°±æ˜¯å„å­ç›®å½•ä¸‹çš„ built-in.o æ˜¯æ€ä¹ˆç”Ÿæˆçš„ï¼Œä»¥ drivers&#x2F;gpio&#x2F;built-in.o ä¸ºä¾‹ï¼Œåœ¨drivers&#x2F;gpio&#x2F;ç›®å½•ä¸‹ä¼šæœ‰ä¸ªåä¸º.built-in.o.cmd çš„æ–‡ä»¶ï¼š </p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV05-%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F/LV05-02-U-Boot-06-01-%E9%A1%B6%E5%B1%82Makefile%E5%9F%BA%E7%A1%80%E8%A7%A3%E6%9E%90/img/image-20241119231818010.png" alt="image-20241119231818010" />

<p>æ­¤æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š </p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd_drivers/gpio/built-in.o :=  arm-linux-gnueabihf-ld.bfd     -r -o drivers/gpio/built-in.o drivers/gpio/gpio-uclass.o drivers/gpio/74x164_gpio.o drivers/gpio/mxc_gpio.o </span><br></pre></td></tr></table></figure>

<p>ä»å‘½ä»¤â€œcmd_drivers&#x2F;gpio&#x2F;built-in.oâ€å¯ä»¥çœ‹å‡ºï¼Œ drivers&#x2F;gpio&#x2F;built-in.o è¿™ä¸ªæ–‡ä»¶æ˜¯ä½¿ç”¨ ld å‘½ä»¤ç”±æ–‡ä»¶ drivers&#x2F;gpio&#x2F;mxc_gpio.o è¿˜æœ‰å¦å¤–ä¸¤ä¸ª.oç”Ÿæˆè€Œæ¥çš„ï¼Œå…¶ä¸­ mxc_gpio.o æ˜¯ mxc_gpio.c ç¼–è¯‘ç”Ÿæˆçš„.o æ–‡ä»¶ï¼Œå…¶ä»–ä¸¤ä¸ªä¹Ÿç±»ä¼¼ï¼Œè¿™ä¸ªæ˜¯ NXP çš„ I.MX ç³»åˆ—çš„ GPIO é©±åŠ¨æ–‡ä»¶ã€‚è¿™é‡Œç”¨åˆ°äº† ld çš„â€œ-râ€å‚æ•°ï¼Œå‚æ•°å«ä¹‰å¦‚ä¸‹ï¼š-r â€“relocateable: äº§ç”Ÿå¯é‡å®šå‘çš„è¾“å‡ºï¼Œæ¯”å¦‚ï¼Œäº§ç”Ÿä¸€ä¸ªè¾“å‡ºæ–‡ä»¶å®ƒå¯å†æ¬¡ä½œä¸ºâ€˜ldâ€™ çš„è¾“å…¥ï¼Œè¿™ç»å¸¸è¢«å«åšâ€œéƒ¨åˆ†é“¾æ¥â€ï¼Œå½“æˆ‘ä»¬éœ€è¦å°†å‡ ä¸ªå°çš„.o æ–‡ä»¶é“¾æ¥æˆä¸ºä¸€ä¸ª.o æ–‡ä»¶çš„æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨æ­¤é€‰é¡¹ã€‚  </p>
<h5 id="2-5-2-6-u-bootçš„ç”Ÿæˆ"><a href="#2-5-2-6-u-bootçš„ç”Ÿæˆ" class="headerlink" title="2.5.2.6 u-bootçš„ç”Ÿæˆ"></a><font size=3>2.5.2.6 u-bootçš„ç”Ÿæˆ</font></h5><p>æœ€ç»ˆå°†å„ä¸ªå­ç›®å½•ä¸­çš„ built-in.o æ–‡ä»¶é“¾æ¥åœ¨ä¸€èµ·å°±å½¢æˆäº† u-bootï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ç¼–è¯‘ ubootå°±å¯ä»¥çœ‹åˆ°é“¾æ¥çš„è¿‡ç¨‹ï¼š  </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- distclean</span><br><span class="line">make V=1 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- mx6ull_14x14_evk_defconfig </span><br><span class="line">make V=1 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- -j16</span><br></pre></td></tr></table></figure>

<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV05-%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F/LV05-02-U-Boot-06-01-%E9%A1%B6%E5%B1%82Makefile%E5%9F%BA%E7%A1%80%E8%A7%A3%E6%9E%90/img/image-20241119232614054.png" alt="image-20241119232614054" />

<p>å°†å…¶æ•´ç†ä¸€ä¸‹ï¼Œå†…å®¹å¦‚ä¸‹ï¼š  </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">arm-linux-gnueabihf-ld.bfd   -pie  --gc-sections -Bstatic  --no-dynamic-linker -Ttext 0x87800000 \</span><br><span class="line">-o u-boot -T u-boot.lds \</span><br><span class="line">arch/arm/cpu/armv7/start.o --start-group  \</span><br><span class="line">arch/arm/cpu/built-in.o  \</span><br><span class="line">arch/arm/cpu/armv7/built-in.o  \</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">......</span></span><br><span class="line">lib/built-in.o  \</span><br><span class="line">net/built-in.o --end-group \</span><br><span class="line">arch/arm/lib/eabi_compat.o  \</span><br><span class="line">arch/arm/lib/lib.a \</span><br><span class="line">-Map u-boot.map;  \</span><br><span class="line">true</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºæœ€ç»ˆæ˜¯ç”¨ arm-linux-gnueabihf-ld.bfd å‘½ä»¤å°† arch&#x2F;arm&#x2F;cpu&#x2F;armv7&#x2F;start.o å’Œå…¶ä»–ä¼—å¤šçš„ built_in.o é“¾æ¥åœ¨ä¸€èµ·ï¼Œå½¢æˆ u-bootã€‚ç›®æ ‡ all é™¤äº† u-boot.bin ä»¥å¤–è¿˜æœ‰å…¶ä»–çš„ä¾èµ–ï¼Œæ¯”å¦‚ u-boot.srec ã€ u-boot.sym ã€ System.mapã€u-boot.cfg å’Œ binary_size_check ç­‰ç­‰ï¼Œè¿™äº›ä¾èµ–çš„ç”Ÿæˆæ–¹æ³•å’Œ u-boot.bin å¾ˆç±»ä¼¼ï¼Œè¿™é‡Œå°±ä¸å†è¯¦ç»†è¯´æ˜äº†ã€‚  </p>
<h3 id="2-6-æ€»ç»“ä¸€ä¸‹"><a href="#2-6-æ€»ç»“ä¸€ä¸‹" class="headerlink" title="2.6 æ€»ç»“ä¸€ä¸‹"></a><font size=3>2.6 æ€»ç»“ä¸€ä¸‹</font></h3><p>è¿™ä¸ªå›¾æ˜¯æŒ‰ç…§uboot 2016.03ç”»çš„ï¼Œ2019.04æœ‰æ‰€ä¸åŒï¼Œ2019.04ä½¿ç”¨è®¾å¤‡æ ‘äº†ï¼Œä½†æ˜¯æµç¨‹å¤§æ¦‚éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV05-%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F/LV05-02-U-Boot-06-01-%E9%A1%B6%E5%B1%82Makefile%E5%9F%BA%E7%A1%80%E8%A7%A3%E6%9E%90/img/image-20230730143850408.png" alt="image-20230730143850408" style="zoom:50%;" />

<p>make xxx_defconfigï¼š ç”¨äºé…ç½® ubootï¼Œè¿™ä¸ªå‘½ä»¤æœ€ä¸»è¦çš„ç›®çš„å°±æ˜¯ç”Ÿæˆ.config æ–‡ä»¶ã€‚<br>makeï¼šç”¨äºç¼–è¯‘ ubootï¼Œè¿™ä¸ªå‘½ä»¤çš„ä¸»è¦å·¥ä½œå°±æ˜¯ç”ŸæˆäºŒè¿›åˆ¶çš„ u-boot.bin æ–‡ä»¶å’Œå…¶ä»–çš„ä¸€äº›ä¸ uboot æœ‰å…³çš„æ–‡ä»¶ï¼Œæ¯”å¦‚ u-boot.imx ç­‰ç­‰ã€‚  </p>

    </div>

    
    
    

    <footer class="post-footer">




    <div>
        
            <div style="text-align:center;color: #ccc;font-size:14px;">
            ----------æœ¬æ–‡ç»“æŸ
            <i class="fas fa-fan fa-spin" style="color: #FF1493; font-size: 1rem"></i>
            æ„Ÿè°¢æ‚¨çš„é˜…è¯»----------
            </div>
        
    </div>





  
  <div class="my_post_copyright"> 
    <p><span>æ–‡ç« æ ‡é¢˜:</span><a href="/post/ca32061f.html">LV05-02-U-Boot-06-01-é¡¶å±‚MakefileåŸºç¡€è§£æ</a></p>
    <p><span>æ–‡ç« ä½œè€…:</span><a href="/" title="æ¬¢è¿è®¿é—® ã€Šè‹æœ¨ã€‹ çš„å­¦ä¹ ç¬”è®°">è‹æœ¨</a></p>
    <p><span>å‘å¸ƒæ—¶é—´:</span>2024å¹´11æœˆ19æ—¥ - 23:38</p>
    <p><span>æœ€åæ›´æ–°:</span>2025å¹´06æœˆ14æ—¥ - 00:25</p>
    <p><span>åŸå§‹é“¾æ¥:</span><a href="/post/ca32061f.html" title="LV05-02-U-Boot-06-01-é¡¶å±‚MakefileåŸºç¡€è§£æ">https://sumumm.github.io/post/ca32061f.html</a></p>
    <p><span>è®¸å¯åè®®:</span><i class="fab fa-creative-commons"></i> <a rel="license" href= "https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç¦æ­¢æ¼”ç» 4.0 å›½é™…</a> è½¬è½½è¯·ä¿ç•™åŸæ–‡é“¾æ¥åŠä½œè€…ã€‚</p>  
  </div>
  


          <div class="post-tags">
              <a href="/tags/LV05-%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F/" rel="tag"><i class="fa fa-tag"></i> LV05-ç³»ç»Ÿé•œåƒ</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/post/d00e99b.html" rel="prev" title="LV05-03-Kernel-01-NXP-linux">
                  <i class="fa fa-angle-left"></i> LV05-03-Kernel-01-NXP-linux
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/post/67dde56a.html" rel="next" title="LV05-02-U-Boot-05-ubootä¸‹è‡ªå®šä¹‰ä¸€ä¸ªå‘½ä»¤">
                  LV05-02-U-Boot-05-ubootä¸‹è‡ªå®šä¹‰ä¸€ä¸ªå‘½ä»¤ <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2017 â€“ 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">è‹æœ¨</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>ç«™ç‚¹æ€»å­—æ•°ï¼š</span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">3.7m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>ç«™ç‚¹é˜…è¯»æ—¶é•¿ &asymp;</span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">225:26</span>
  </span>
</div>




    <span id="sitetime"></span>
    <script defer language=javascript>
        function siteTime()
        {
            window.setTimeout("siteTime()", 1000);
            var seconds = 1000;
            var minutes = seconds * 60;
            var hours = minutes * 60;
            var days = hours * 24;
            var years = days * 365;
            var today = new Date();
            var todayYear = today.getFullYear();
            var todayMonth = today.getMonth()+1;
            var todayDate = today.getDate();
            var todayHour = today.getHours();
            var todayMinute = today.getMinutes();
            var todaySecond = today.getSeconds();
            /*==================================================
            Date.UTC() -- è¿”å›dateå¯¹è±¡è·ä¸–ç•Œæ ‡å‡†æ—¶é—´(UTC)1970å¹´1æœˆ1æ—¥åˆå¤œä¹‹é—´çš„æ¯«ç§’æ•°(æ—¶é—´æˆ³)
            year        - ä½œä¸ºdateå¯¹è±¡çš„å¹´ä»½ï¼Œä¸º4ä½å¹´ä»½å€¼
            month       - 0-11ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„æœˆä»½
            day         - 1-31ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„å¤©æ•°
            hours       - 0(åˆå¤œ24ç‚¹)-23ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„å°æ—¶æ•°
            minutes     - 0-59ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„åˆ†é’Ÿæ•°
            seconds     - 0-59ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„ç§’æ•°
            microseconds - 0-999ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„æ¯«ç§’æ•°
            ==================================================*/
            var t1 = Date.UTC(2017, 
                              5, 
                              19, 
                              0, 
                              0, 
                              0); //åŒ—äº¬æ—¶é—´
            var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond);
            var diff = t2-t1;
            var diffYears = Math.floor(diff/years);
            var diffDays = Math.floor((diff/days)-diffYears*365);
            var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours);
            var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes);
            var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds);
            document.getElementById("sitetime").innerHTML="å·²åœ¨è¿™é‡Œ "+diffYears+" å¹´ "+diffDays+" å¤© "+diffHours+" å°æ—¶ "+diffMinutes+" åˆ†é’Ÿ "+diffSeconds+" ç§’";
        }
        siteTime();
    </script>



    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.umd.js" integrity="sha256-ytMJGN3toR+a84u7g7NuHm91VIR06Q41kMWDr2pq7Zo=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>


  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


 
        <div id="click-show-text"
            data-mobile = false
            data-text = å¯Œå¼º,æ°‘ä¸»,æ–‡æ˜,å’Œè°,è‡ªç”±,å¹³ç­‰,å…¬æ­£,æ³•åˆ¶,çˆ±å›½,æ•¬ä¸š,è¯šä¿¡,å‹å–„
            data-fontsize = 15px
            data-random= false>
        </div>
       

      
        <script async src=https://cdn.jsdelivr.net/npm/hexo-next-mouse-effect@latest/click/showText.js></script>
      

      
    




    <script async src="/js/fancybox_param.js"></script>





<!-- APlayeræœ¬ä½“ -->



</body>
</html>
