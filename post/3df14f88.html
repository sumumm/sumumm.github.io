<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha256-wiz7ZSCn/btzhjKDQBms9Hx4sSeUYsDrTLg7roPstac=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.css" integrity="sha256-6cQIC71/iBIYXFK+0RHAvwmjwWzkWd+r7v/BX3/vZDc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/green/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"sumumm.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.19.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":300},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="æ€ä¹ˆä½¿ç”¨è®¾å¤‡æ ‘ï¼Ÿè‹¥ç¬”è®°ä¸­æœ‰é”™è¯¯æˆ–è€…ä¸åˆé€‚çš„åœ°æ–¹ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ğŸ˜ƒã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="LV06-10-è®¾å¤‡æ ‘-04-è®¾å¤‡æ ‘çš„åº”ç”¨">
<meta property="og:url" content="https://sumumm.github.io/post/3df14f88.html">
<meta property="og:site_name" content="è‹æœ¨">
<meta property="og:description" content="æ€ä¹ˆä½¿ç”¨è®¾å¤‡æ ‘ï¼Ÿè‹¥ç¬”è®°ä¸­æœ‰é”™è¯¯æˆ–è€…ä¸åˆé€‚çš„åœ°æ–¹ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ğŸ˜ƒã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-04-%E8%AE%BE%E5%A4%87%E6%A0%91%E7%9A%84%E5%BA%94%E7%94%A8/img/image-20250225164508489.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-04-%E8%AE%BE%E5%A4%87%E6%A0%91%E7%9A%84%E5%BA%94%E7%94%A8/img/image-20250309161117557.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-04-%E8%AE%BE%E5%A4%87%E6%A0%91%E7%9A%84%E5%BA%94%E7%94%A8/img/image-20250309161625812.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-04-%E8%AE%BE%E5%A4%87%E6%A0%91%E7%9A%84%E5%BA%94%E7%94%A8/img/image-20250309162949432.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-04-%E8%AE%BE%E5%A4%87%E6%A0%91%E7%9A%84%E5%BA%94%E7%94%A8/img/image-20250309164449464.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-04-%E8%AE%BE%E5%A4%87%E6%A0%91%E7%9A%84%E5%BA%94%E7%94%A8/img/image-20250119115206386.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-04-%E8%AE%BE%E5%A4%87%E6%A0%91%E7%9A%84%E5%BA%94%E7%94%A8/img/image-20250309193144637.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-04-%E8%AE%BE%E5%A4%87%E6%A0%91%E7%9A%84%E5%BA%94%E7%94%A8/img/image-20250309193337157.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-04-%E8%AE%BE%E5%A4%87%E6%A0%91%E7%9A%84%E5%BA%94%E7%94%A8/img/image-20250309195107101.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-04-%E8%AE%BE%E5%A4%87%E6%A0%91%E7%9A%84%E5%BA%94%E7%94%A8/img/image-20250309195026404.png">
<meta property="article:published_time" content="2025-03-16T23:45:54.000Z">
<meta property="article:modified_time" content="2025-06-13T16:25:57.055Z">
<meta property="article:author" content="è‹æœ¨">
<meta property="article:tag" content="LV06-é©±åŠ¨å¼€å‘">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-04-%E8%AE%BE%E5%A4%87%E6%A0%91%E7%9A%84%E5%BA%94%E7%94%A8/img/image-20250225164508489.png">


<link rel="canonical" href="https://sumumm.github.io/post/3df14f88.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":"","permalink":"https://sumumm.github.io/post/3df14f88.html","path":"post/3df14f88.html","title":"LV06-10-è®¾å¤‡æ ‘-04-è®¾å¤‡æ ‘çš„åº”ç”¨"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>LV06-10-è®¾å¤‡æ ‘-04-è®¾å¤‡æ ‘çš„åº”ç”¨ | è‹æœ¨</title>
  








    <script src="/js/browser_tools_disable.js"></script>

  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start --><link rel="stylesheet" href="https://unpkg.com/hexo-next-tags-plus@latest/lib/tag_plus.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">è‹æœ¨</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">æˆ‘çš„å­¦ä¹ ä¹‹è·¯</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>è‹æœ¨çš„å®¶</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»é¡µ<span class="badge">42</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£é¡µ<span class="badge">673</span></a></li><li class="menu-item menu-item-flink"><a href="/flink/" rel="section"><i class="fa fa-link fa-fw"></i>å‹äººå¸</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äºæˆ‘</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E5%86%85%E6%A0%B8%E6%93%8D%E4%BD%9C%E8%AE%BE%E5%A4%87%E6%A0%91%E7%9A%84%E5%87%BD%E6%95%B0"><span class="nav-text">ä¸€ã€å†…æ ¸æ“ä½œè®¾å¤‡æ ‘çš„å‡½æ•°</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%86%85%E6%A0%B8%E4%B8%AD%E8%AE%BE%E5%A4%87%E6%A0%91%E7%9B%B8%E5%85%B3%E7%9A%84%E5%A4%B4%E6%96%87%E4%BB%B6%E4%BB%8B%E7%BB%8D"><span class="nav-text">1.Â å†…æ ¸ä¸­è®¾å¤‡æ ‘ç›¸å…³çš„å¤´æ–‡ä»¶ä»‹ç»  </span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E5%A4%84%E7%90%86-DTB"><span class="nav-text">1.1Â å¤„ç† DTB  </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E5%A4%84%E7%90%86-device-node"><span class="nav-text">1.2Â å¤„ç† device_node  </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-%E5%A4%84%E7%90%86-platform-device"><span class="nav-text">1.3Â å¤„ç† platform_device  </span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-OF%E5%87%BD%E6%95%B0"><span class="nav-text">2. OFå‡½æ•°</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E8%8E%B7%E5%8F%96%E8%AE%BE%E5%A4%87%E6%A0%91%E8%8A%82%E7%82%B9"><span class="nav-text">2.1 è·å–è®¾å¤‡æ ‘èŠ‚ç‚¹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-1-of-find-node-by-name"><span class="nav-text">2.1.1Â of_find_node_by_name()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-2-of-find-node-by-path"><span class="nav-text">2.1.2Â of_find_node_by_path()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-3-of-find-node-by-type"><span class="nav-text">2.1.3Â of_find_node_by_type()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-4-of-find-compatible-node"><span class="nav-text">2.1.4Â of_find_compatible_node()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-5-of-find-node-by-phandle"><span class="nav-text">2.1.5Â of_find_node_by_phandle()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-6-of-find-matching-node-and-match"><span class="nav-text">2.1.6Â of_find_matching_node_and_match()</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E6%9F%A5%E6%89%BE%E7%88%B6%E5%AD%90%E8%8A%82%E7%82%B9"><span class="nav-text">2.2 æŸ¥æ‰¾çˆ¶å­èŠ‚ç‚¹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1-of-get-parent"><span class="nav-text">2.2.1Â of_get_parent() </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-of-get-next-parent"><span class="nav-text">2.2.2Â of_get_next_parent()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-3-of-get-next-child"><span class="nav-text">2.2.3Â of_get_next_child()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-4-of-get-next-available-child"><span class="nav-text">2.2.4Â of_get_next_available_child()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-5-of-get-child-by-name"><span class="nav-text">2.2.5Â of_get_child_by_name()</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E8%8E%B7%E5%8F%96%E5%B1%9E%E6%80%A7"><span class="nav-text">2.3 è·å–å±æ€§</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-1-of-find-property"><span class="nav-text">2.3.1 of_find_property()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-2-of-property-count-elems-of-size"><span class="nav-text">2.3.2 of_property_count_elems_of_size()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-3-%E8%AF%BB%E6%95%B0%E7%BB%84-u8-u16-u32-u64"><span class="nav-text">2.3.3 è¯»æ•°ç»„ u8&#x2F;u16&#x2F;u32&#x2F;u64</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-4-%E8%AF%BB%E6%95%B4%E6%95%B0-u8-u16-u32-u64"><span class="nav-text">2.3.4 è¯»æ•´æ•° u8&#x2F;u16&#x2F;u32&#x2F;u64</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-5-%E8%AF%BB%E6%9F%90%E4%B8%AA%E6%95%B4%E6%95%B0-u32"><span class="nav-text">2.3.5 è¯»æŸä¸ªæ•´æ•° u32</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-6-%E8%AF%BB%E6%9F%90%E4%B8%AA%E6%95%B4%E6%95%B0-u64"><span class="nav-text">2.3.6 è¯»æŸä¸ªæ•´æ•° u64</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-7-%E8%AF%BB%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-text">2.3.7 è¯»å­—ç¬¦ä¸²</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-8-%E8%AF%BB%E8%8E%B7%E5%8F%96-address-cells"><span class="nav-text">2.3.8 è¯»è·å–#address-cells  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-9-%E8%AF%BB%E5%8F%96-size-cells"><span class="nav-text">2.3.9 è¯»å–#size-cells  </span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-%E5%85%B6%E4%BB%96%E5%87%BD%E6%95%B0"><span class="nav-text">2.4 å…¶ä»–å‡½æ•°</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-1-of-device-is-compatible"><span class="nav-text">2.4.1 of_device_is_compatible()  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-2-of-get-address"><span class="nav-text">2.4.2 of_get_address() </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-3-of-translate-address"><span class="nav-text">2.4.3 of_translate_address()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-4-of-address-to-resource"><span class="nav-text">2.4.4 of_address_to_resource()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-5-of-iomap"><span class="nav-text">2.4.5 of_iomap()</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-platform-device-%E7%9B%B8%E5%85%B3%E7%9A%84%E5%87%BD%E6%95%B0"><span class="nav-text">3.Â platform_device ç›¸å…³çš„å‡½æ•°  </span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-of-find-device-by-node"><span class="nav-text">3.1Â of_find_device_by_node()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-platform-get-resource"><span class="nav-text">3.2Â platform_get_resource()</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8C%E3%80%81of%E5%87%BD%E6%95%B0%E4%BD%BF%E7%94%A8%E5%AE%9E%E4%BE%8B"><span class="nav-text">äºŒã€ofå‡½æ•°ä½¿ç”¨å®ä¾‹</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E8%AE%BE%E5%A4%87%E6%A0%91%E8%8A%82%E7%82%B9%E5%87%86%E5%A4%87"><span class="nav-text">1. è®¾å¤‡æ ‘èŠ‚ç‚¹å‡†å¤‡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-of%E8%8E%B7%E5%8F%96%E8%AE%BE%E5%A4%87%E8%8A%82%E7%82%B9%E5%AE%9E%E4%BE%8B"><span class="nav-text">2. ofè·å–è®¾å¤‡èŠ‚ç‚¹å®ä¾‹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-demo%E6%BA%90%E7%A0%81"><span class="nav-text">2.1 demoæºç </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%BC%80%E5%8F%91%E6%9D%BF%E6%B5%8B%E8%AF%95"><span class="nav-text">2.2 å¼€å‘æ¿æµ‹è¯•</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-of%E8%8E%B7%E5%8F%96%E8%AE%BE%E5%A4%87%E8%8A%82%E7%82%B9%E5%B1%9E%E6%80%A7%E5%AE%9E%E4%BE%8B"><span class="nav-text">3. ofè·å–è®¾å¤‡èŠ‚ç‚¹å±æ€§å®ä¾‹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-demo%E6%BA%90%E7%A0%81"><span class="nav-text">3.1 demoæºç </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E5%BC%80%E5%8F%91%E6%9D%BF%E6%B5%8B%E8%AF%95"><span class="nav-text">3.2 å¼€å‘æ¿æµ‹è¯•</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-led%E5%AE%9E%E4%BE%8B"><span class="nav-text">4. ledå®ä¾‹</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E8%AE%BE%E5%A4%87%E6%A0%91%E4%B8%8B%E7%9A%84%E5%B9%B3%E5%8F%B0%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8"><span class="nav-text">ä¸‰ã€è®¾å¤‡æ ‘ä¸‹çš„å¹³å°è®¾å¤‡é©±åŠ¨</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-platform-device-%E5%A6%82%E4%BD%95%E4%B8%8E-platform-driver-%E9%85%8D%E5%AF%B9"><span class="nav-text">1.Â platform_device å¦‚ä½•ä¸ platform_driver é…å¯¹  </span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E5%BC%BA%E5%88%B6%E9%80%89%E6%8B%A9%E9%A9%B1%E5%8A%A8"><span class="nav-text">1.1 å¼ºåˆ¶é€‰æ‹©é©±åŠ¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E8%AE%BE%E5%A4%87%E6%A0%91%E5%8C%B9%E9%85%8D"><span class="nav-text">1.2 è®¾å¤‡æ ‘åŒ¹é…</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-id%E5%8C%B9%E9%85%8D"><span class="nav-text">1.3 idåŒ¹é…</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-name%E5%8C%B9%E9%85%8D"><span class="nav-text">1.4 nameåŒ¹é…</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-5-%E6%80%BB%E7%BB%93"><span class="nav-text">1.5 æ€»ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E8%AE%BE%E5%A4%87%E6%A0%91%E5%8C%B9%E9%85%8D%E5%AE%9E%E4%BE%8B"><span class="nav-text">2. è®¾å¤‡æ ‘åŒ¹é…å®ä¾‹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E9%9C%80%E8%A6%81%E5%93%AA%E4%BA%9B%E6%9D%A1%E4%BB%B6%EF%BC%9F"><span class="nav-text">2.1 éœ€è¦å“ªäº›æ¡ä»¶ï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%9F%BA%E6%9C%AC%E6%A1%86%E6%9E%B6"><span class="nav-text">2.2 åŸºæœ¬æ¡†æ¶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-demo%E6%BA%90%E7%A0%81"><span class="nav-text">2.3 demoæºç </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7"><span class="nav-text">2.4 è°ƒè¯•æŠ€å·§</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E4%BB%8Eplatform-device%E8%8E%B7%E5%8F%96%E8%8A%82%E7%82%B9%E4%BF%A1%E6%81%AF"><span class="nav-text">3. ä»platform_deviceè·å–èŠ‚ç‚¹ä¿¡æ¯</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E6%80%8E%E4%B9%88%E6%8B%BF%E5%88%B0%E8%8A%82%E7%82%B9%EF%BC%9F"><span class="nav-text">3.1 æ€ä¹ˆæ‹¿åˆ°èŠ‚ç‚¹ï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-demo%E6%BA%90%E7%A0%81"><span class="nav-text">3.2 demoæºç </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E5%BC%80%E5%8F%91%E6%9D%BF%E6%B5%8B%E8%AF%95"><span class="nav-text">3.3 å¼€å‘æ¿æµ‹è¯•</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="è‹æœ¨"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">è‹æœ¨</p>
  <div class="site-description" itemprop="description">è«é“æ¡‘æ¦†æ™šï¼Œä¸ºéœå°šæ»¡å¤©</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">673</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">42</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">æ ‡ç­¾</span>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/sumumm" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;sumumm" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sumumm.github.io/post/3df14f88.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="è‹æœ¨">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è‹æœ¨">
      <meta itemprop="description" content="è«é“æ¡‘æ¦†æ™šï¼Œä¸ºéœå°šæ»¡å¤©">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="LV06-10-è®¾å¤‡æ ‘-04-è®¾å¤‡æ ‘çš„åº”ç”¨ | è‹æœ¨">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          LV06-10-è®¾å¤‡æ ‘-04-è®¾å¤‡æ ‘çš„åº”ç”¨
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-03-17 07:45:54" itemprop="dateCreated datePublished" datetime="2025-03-17T07:45:54+08:00">2025-03-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">åµŒå…¥å¼å¼€å‘</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/" itemprop="url" rel="index"><span itemprop="name">02IMX6ULLå¹³å°</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">LV06-é©±åŠ¨å¼€å‘</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>11k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>39 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>æ€ä¹ˆä½¿ç”¨è®¾å¤‡æ ‘ï¼Ÿè‹¥ç¬”è®°ä¸­æœ‰é”™è¯¯æˆ–è€…ä¸åˆé€‚çš„åœ°æ–¹ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ğŸ˜ƒã€‚</p>
<span id="more"></span>

<!-- Photo: https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-04-%E8%AE%BE%E5%A4%87%E6%A0%91%E7%9A%84%E5%BA%94%E7%94%A8/img/ -->

<details class="folding-tag" blue><summary> ç‚¹å‡»æŸ¥çœ‹ä½¿ç”¨å·¥å…·åŠç‰ˆæœ¬ </summary>
              <div class='content'>
              <table>    <tr>        <td align="center" rowspan="5">PCç«¯å¼€å‘ç¯å¢ƒ</td>        <td align="center" width=150px>Windows</td>        <td align="left">Windows11</td>    </tr>    <tr>        <td align="center">Ubuntu</td>        <td align="left">Ubuntu20.04.2çš„64ä½ç‰ˆæœ¬</td>      </tr>    <tr>        <td align="center">VMwareÂ® Workstation 17 Pro</td>        <td align="left">17.6.0 build-24238078</td>      </tr>    <tr>        <td align="center">ç»ˆç«¯è½¯ä»¶</td>        <td align="left">MobaXterm(Professional Edition v23.0 Build 5042 (license))</td>    </tr>    <tr>        <td align="center">Win32DiskImager</td>        <td align="left">Win32DiskImager v1.0</td>      </tr>    <tr>        <td align="center" rowspan="3">Linuxå¼€å‘æ¿ç¯å¢ƒ</td>        <td align="center">Linuxå¼€å‘æ¿</td>        <td align="left">æ­£ç‚¹åŸå­ i.MX6ULL Linux é˜¿å°”æ³•å¼€å‘æ¿</td>      </tr>    <tr>        <td align="center">uboot</td>        <td align="left">NXPå®˜æ–¹æä¾›çš„ubootï¼Œä½¿ç”¨çš„ubootç‰ˆæœ¬ä¸ºU-Boot 2019.04</td>      </tr>    <tr>        <td align="center">linuxå†…æ ¸</td>        <td align="left">linux-4.19.71(NXPå®˜æ–¹æä¾›)</td>      </tr></table>
              </div>
            </details>

<details class="folding-tag" blue><summary> ç‚¹å‡»æŸ¥çœ‹æœ¬æ–‡å‚è€ƒèµ„æ–™ </summary>
              <div class='content'>
              <table>    <tr>        <td align="center">åˆ†ç±»</td>        <td align="center">ç½‘å€</td>        <td align="center">è¯´æ˜</td>    </tr>    <tr>        <td align="center" rowspan="5">å®˜æ–¹ç½‘ç«™</td>        <td align="left"><a href="https://www.arm.com/" target="_blank">https://www.arm.com/</a></td>        <td align="left">ARMå®˜æ–¹ç½‘ç«™ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°Cotex-Mxä»¥åŠARMVxçš„ä¸€äº›æ–‡æ¡£</td>    </tr>    <tr>        <td align="left"><a href="https://www.nxp.com.cn/" target="_blank">https://www.nxp.com.cn/ </a></td>        <td align="left">NXPå®˜æ–¹ç½‘ç«™</td>    </tr>    <tr>        <td align="left"><a href="https://www.nxpic.org.cn/" target="_blank">https://www.nxpic.org.cn/</a></td><td align="left">NXP å®˜æ–¹ç¤¾åŒº</td>    </tr>    <tr>        <td align="left"><a href="https://u-boot.readthedocs.io/en/latest/" target="_blank">https://u-boot.readthedocs.io/en/latest/</a></td><td align="left">u-bootå®˜ç½‘</td>    </tr>    <tr>        <td align="left"><a href="https://www.kernel.org/" target="_blank">https://www.kernel.org/</a></td><td align="left">linuxå†…æ ¸å®˜ç½‘</td>    </tr></table>
              </div>
            </details>

<details class="folding-tag" blue><summary> ç‚¹å‡»æŸ¥çœ‹ç›¸å…³æ–‡ä»¶ä¸‹è½½ </summary>
              <div class='content'>
              <table>    <tr>        <td align="center">åˆ†ç±»</td>        <td align="center">ç½‘å€</td>        <td align="center">è¯´æ˜</td>    </tr>    <tr>        <td align="center" rowspan="3">NXP</td>        <td align="left"><a href="https://github.com/nxp-imx" target="_blank">https://github.com/nxp-imx</a></td>        <td align="left">NXP imxå¼€å‘èµ„æºGitHubç»„ç»‡ï¼Œé‡Œè¾¹ä¼šæœ‰u-bootå’Œlinuxå†…æ ¸çš„ä»“åº“</td>    </tr>    <tr>        <td align="left"><a href="https://github.com/nxp-imx/linux-imx/releases/tag/v4.19.71" target="_blank">nxp-imx/linux-imx/releases/tag/v4.19.71</a></td>        <td align="left">NXP linuxå†…æ ¸ä»“åº“tagsä¸­çš„v4.19.71</td>    </tr>    <tr>        <td align="left"><a href="https://github.com/nxp-imx/uboot-imx/releases/tag/rel_imx_4.19.35_1.1.0" target="_blank">nxp-imx/uboot-imx/releases/tag/rel_imx_4.19.35_1.1.0</a></td>        <td align="left">NXP u-bootä»“åº“tagsä¸­çš„rel_imx_4.19.35_1.1.0</td>    </tr>    <tr>        <td align="center" rowspan="2">I.MX6ULL</td>        <td align="left"><a href="https://www.nxp.com.cn/docs/en/data-sheet/IMX6ULLIEC.pdf" target="_blank">i.MX 6ULL Applications Processors for Industrial Products</a></td>        <td align="left">I.MX6ULL èŠ¯ç‰‡æ‰‹å†Œï¼ˆdatasheetï¼Œå¯ä»¥åœ¨çº¿æŸ¥çœ‹ï¼‰</td>    </tr>    <tr>        <td align="left"><a href="https://www.nxp.com.cn/webapp/Download?colCode=IMX6ULLRM&lang_cd=zh" target="_blank">i.MX 6ULL Applications ProcessorReference Manual</a></td>        <td align="left">I.MX6ULL å‚è€ƒæ‰‹å†Œï¼ˆä¸‹è½½åæ‰èƒ½æŸ¥çœ‹ï¼Œéœ€è¦ç™»å½•NXPå®˜ç½‘ï¼‰</td>    </tr>    <tr>        <td align="center" rowspan="3">Source Code</td>        <td align="left"><a href="https://elixir.bootlin.com/linux/latest/source" target="_blank">https://elixir.bootlin.com/linux/latest/source</a></td>        <td align="left">linux kernelæºç </td>    </tr>    <tr>        <td align="left"><a href="https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/tree/?h=v4.19.71&id=e7d2672c66e4d3675570369bf20856296da312c4" target="_blank">kernel/git/stable/linux.git - Linux kernel stable tree</a></td>        <td align="left">linux kernelæºç (å®˜ç½‘,tag 4.19.71)</td>    </tr>    <tr>        <td align="left"><a href="https://elixir.bootlin.com/u-boot/latest/source" target="_blank">https://elixir.bootlin.com/u-boot/latest/source</a></td>        <td align="left">ubootæºç </td>    </tr></table>
              </div>
            </details>

<h1 id="ä¸€ã€å†…æ ¸æ“ä½œè®¾å¤‡æ ‘çš„å‡½æ•°"><a href="#ä¸€ã€å†…æ ¸æ“ä½œè®¾å¤‡æ ‘çš„å‡½æ•°" class="headerlink" title="ä¸€ã€å†…æ ¸æ“ä½œè®¾å¤‡æ ‘çš„å‡½æ•°"></a><font size=3>ä¸€ã€å†…æ ¸æ“ä½œè®¾å¤‡æ ‘çš„å‡½æ•°</font></h1><p>å†…æ ¸æºç ä¸­ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux">linux - include&#x2F;linux</a> ç›®å½•ä¸‹æœ‰å¾ˆå¤š of å¼€å¤´çš„å¤´æ–‡ä»¶ï¼Œ of è¡¨ç¤ºâ€œopen firmwareâ€å³å¼€æ”¾å›ºä»¶ã€‚  </p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-04-%E8%AE%BE%E5%A4%87%E6%A0%91%E7%9A%84%E5%BA%94%E7%94%A8/img/image-20250225164508489.png" alt="image-20250225164508489"  />

<h2 id="1-å†…æ ¸ä¸­è®¾å¤‡æ ‘ç›¸å…³çš„å¤´æ–‡ä»¶ä»‹ç»"><a href="#1-å†…æ ¸ä¸­è®¾å¤‡æ ‘ç›¸å…³çš„å¤´æ–‡ä»¶ä»‹ç»" class="headerlink" title="1.Â å†…æ ¸ä¸­è®¾å¤‡æ ‘ç›¸å…³çš„å¤´æ–‡ä»¶ä»‹ç»  "></a><font size=3>1.Â å†…æ ¸ä¸­è®¾å¤‡æ ‘ç›¸å…³çš„å¤´æ–‡ä»¶ä»‹ç»  </font></h2><p>å‰é¢æˆ‘ä»¬å·²ç»äº†è§£è¿‡äº†ï¼Œè®¾å¤‡æ ‘çš„å¤„ç†è¿‡ç¨‹æ˜¯ï¼š dtb -&gt; device_node -&gt; platform_deviceã€‚  </p>
<h3 id="1-1-å¤„ç†-DTB"><a href="#1-1-å¤„ç†-DTB" class="headerlink" title="1.1Â å¤„ç† DTB  "></a><font size=3>1.1Â å¤„ç† DTB  </font></h3><ul>
<li><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of_fdt.h">of_fdt.h - include&#x2F;linux&#x2F;of_fdt.h</a>ï¼šdtb æ–‡ä»¶çš„ç›¸å…³æ“ä½œå‡½æ•°, æˆ‘ä»¬ä¸€èˆ¬ç”¨ä¸åˆ°,  å› ä¸º dtb æ–‡ä»¶åœ¨å†…æ ¸ä¸­å·²ç»è¢«è½¬æ¢ä¸º device_node æ ‘(å®ƒæ›´æ˜“äºä½¿ç”¨)</li>
</ul>
<h3 id="1-2-å¤„ç†-device-node"><a href="#1-2-å¤„ç†-device-node" class="headerlink" title="1.2Â å¤„ç† device_node  "></a><font size=3>1.2Â å¤„ç† device_node  </font></h3><ul>
<li><p><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of.h">of.h - include&#x2F;linux&#x2F;of.h</a> ï¼šæä¾›è®¾å¤‡æ ‘çš„ä¸€èˆ¬å¤„ç†å‡½æ•°ï¼Œæ¯”å¦‚ of_property_read_u32(è¯»å–æŸä¸ªå±æ€§çš„ u32 å€¼)ï¼Œof_get_child_count(è·å–æŸä¸ª device_node çš„å­èŠ‚ç‚¹æ•°)</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of_address.h">of_address.h - include&#x2F;linux&#x2F;of_address.h</a>ï¼šåœ°å€ç›¸å…³çš„å‡½æ•°ï¼Œæ¯”å¦‚ of_get_address(è·å¾— reg å±æ€§ä¸­çš„ addr, size å€¼) ï¼Œ of_match_device (ä» matches æ•°ç»„ä¸­å–å‡ºä¸å½“å‰è®¾å¤‡æœ€åŒ¹é…çš„ä¸€é¡¹)</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of_dma.h">of_dma.h - include&#x2F;linux&#x2F;of_dma.h</a>ï¼šè®¾å¤‡æ ‘ä¸­ DMA ç›¸å…³å±æ€§çš„å‡½æ•°</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of_gpio.h">of_gpio.h - include&#x2F;linux&#x2F;of_gpio.h</a>ï¼šGPIO ç›¸å…³çš„å‡½æ•°</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of_graph.h">of_graph.h - include&#x2F;linux&#x2F;of_graph.h</a>ï¼šGPU ç›¸å…³é©±åŠ¨ä¸­ç”¨åˆ°çš„å‡½æ•°, ä»è®¾å¤‡æ ‘ä¸­è·å¾— GPU ä¿¡æ¯</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of_iommu.h">of_iommu.h - include&#x2F;linux&#x2F;of_iommu.h</a>ï¼šå¾ˆå°‘ç”¨åˆ°</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of_irq.h">of_irq.h - include&#x2F;linux&#x2F;of_irq.h</a>ï¼šä¸­æ–­ç›¸å…³çš„å‡½æ•°</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of_mdio.h">of_mdio.h - include&#x2F;linux&#x2F;of_mdio.h</a>ï¼šMDIO (Ethernet PHY) API</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of_net.h">of_net.h - include&#x2F;linux&#x2F;of_net.h</a>ï¼šOF helpers for network devices.</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of_pci.h">of_pci.h - include&#x2F;linux&#x2F;of_pci.h</a>ï¼šPCI ç›¸å…³å‡½æ•°</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of_pdt.h">of_pdt.h - include&#x2F;linux&#x2F;of_pdt.h</a>ï¼šå¾ˆå°‘ç”¨åˆ°</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of_reserved_mem.h">of_reserved_mem.h - include&#x2F;linux&#x2F;of_reserved_mem.h</a>ï¼šreserved_mem çš„ç›¸å…³å‡½æ•°</p>
</li>
</ul>
<h3 id="1-3-å¤„ç†-platform-device"><a href="#1-3-å¤„ç†-platform-device" class="headerlink" title="1.3Â å¤„ç† platform_device  "></a><font size=3>1.3Â å¤„ç† platform_device  </font></h3><ul>
<li><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of_platform.h">of_platform.h - include&#x2F;linux&#x2F;of_platform.h</a>ï¼šæŠŠ device_node è½¬æ¢ä¸º platform_device æ—¶ç”¨åˆ°çš„å‡½æ•°ã€‚</li>
</ul>
<p>æ¯”å¦‚ of_device_alloc(æ ¹æ® device_node åˆ†é…è®¾ç½® platform_device)ï¼Œof_find_device_by_node (æ ¹æ® device_node æŸ¥æ‰¾åˆ° platform_device)ï¼Œof_platform_bus_probe (å¤„ç† device_node åŠå®ƒçš„å­èŠ‚ç‚¹)</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of_device.h">of_device.h - include&#x2F;linux&#x2F;of_device.h</a>ï¼šè®¾å¤‡ç›¸å…³çš„å‡½æ•°, æ¯”å¦‚ of_match_device</li>
</ul>
<h2 id="2-OFå‡½æ•°"><a href="#2-OFå‡½æ•°" class="headerlink" title="2. OFå‡½æ•°"></a><font size=3>2. OFå‡½æ•°</font></h2><p>è®¾å¤‡æ ‘æè¿°äº†è®¾å¤‡çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯åŒ…æ‹¬æ•°å­—ç±»å‹çš„ã€å­—ç¬¦ä¸²ç±»å‹çš„ã€æ•°ç»„ç±»å‹çš„ï¼Œæˆ‘ä»¬åœ¨ç¼–å†™é©±åŠ¨çš„æ—¶å€™éœ€è¦è·å–åˆ°è¿™äº›ä¿¡æ¯ã€‚æ¯”å¦‚è®¾å¤‡æ ‘ä½¿ç”¨ reg å±æ€§æè¿°äº†æŸä¸ªå¤–è®¾çš„å¯„å­˜å™¨åœ°å€ä¸º 0X02005482ï¼Œé•¿åº¦ä¸º 0X400ï¼Œæˆ‘ä»¬åœ¨ç¼–å†™é©±åŠ¨çš„æ—¶å€™éœ€è¦è·å–åˆ° reg å±æ€§çš„0X02005482 å’Œ 0X400 è¿™ä¸¤ä¸ªå€¼ï¼Œç„¶ååˆå§‹åŒ–å¤–è®¾ã€‚ </p>
<p>Linux å†…æ ¸ç»™æˆ‘ä»¬æä¾›äº†ä¸€ç³»åˆ—çš„å‡½æ•°æ¥è·å–è®¾å¤‡æ ‘ä¸­çš„èŠ‚ç‚¹æˆ–è€…å±æ€§ä¿¡æ¯ï¼Œè¿™ä¸€ç³»åˆ—çš„å‡½æ•°éƒ½æœ‰ä¸€ä¸ªç»Ÿä¸€çš„å‰ç¼€â€œof_â€ï¼Œæ‰€ä»¥åœ¨å¾ˆå¤šèµ„æ–™é‡Œé¢ä¹Ÿè¢«å«åš <strong>OF å‡½æ•°</strong>ã€‚è¿™äº› OF å‡½æ•°åŸå‹ä¸€èˆ¬éƒ½å®šä¹‰åœ¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of.h">of.h - include&#x2F;linux&#x2F;of.h</a>  æ–‡ä»¶ä¸­ã€‚åœ¨ä½¿ç”¨çš„æ—¶å€™è¦åŒ…å«<code>#include &lt;linux/of.h&gt;</code>æ–‡ä»¶ã€‚</p>
<p>åœ¨å†…æ ¸ä¸­ä»¥ device_node ç»“æ„ä½“æ¥å¯¹è®¾å¤‡æ ‘è¿›è¡Œæè¿°ï¼Œ æ‰€ä»¥ of æ“ä½œå‡½æ•°å®é™…ä¸Šå°±æ˜¯è·å–device_node ç»“æ„ä½“ ã€‚</p>
<h3 id="2-1-è·å–è®¾å¤‡æ ‘èŠ‚ç‚¹"><a href="#2-1-è·å–è®¾å¤‡æ ‘èŠ‚ç‚¹" class="headerlink" title="2.1 è·å–è®¾å¤‡æ ‘èŠ‚ç‚¹"></a><font size=3>2.1 è·å–è®¾å¤‡æ ‘èŠ‚ç‚¹</font></h3><h4 id="2-1-1-of-find-node-by-name"><a href="#2-1-1-of-find-node-by-name" class="headerlink" title="2.1.1Â of_find_node_by_name()"></a><font size=3>2.1.1Â <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/base.c#L939">of_find_node_by_name()</a></font></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> device_node *<span class="title function_">of_find_node_by_name</span><span class="params">(<span class="keyword">struct</span> device_node *from,</span></span><br><span class="line"><span class="params">	<span class="type">const</span> <span class="type">char</span> *name)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">device_node</span> *<span class="title">np</span>;</span></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> flags;</span><br><span class="line"></span><br><span class="line">	raw_spin_lock_irqsave(&amp;devtree_lock, flags);</span><br><span class="line">	for_each_of_allnodes_from(from, np)</span><br><span class="line">		<span class="keyword">if</span> (np-&gt;name &amp;&amp; (of_node_cmp(np-&gt;name, name) == <span class="number">0</span>)</span><br><span class="line">		    &amp;&amp; of_node_get(np))</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	of_node_put(from);</span><br><span class="line">	raw_spin_unlock_irqrestore(&amp;devtree_lock, flags);</span><br><span class="line">	<span class="keyword">return</span> np;</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL(of_find_node_by_name);</span><br></pre></td></tr></table></figure>

<p>è¯¥å‡½æ•°é€šè¿‡æŒ‡å®šçš„èŠ‚ç‚¹åç§°åœ¨è®¾å¤‡æ ‘ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼Œ è¿”å›åŒ¹é…çš„èŠ‚ç‚¹çš„ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of.h#L51">struct device_node</a> æŒ‡é’ˆã€‚ä½†æ˜¯åœ¨è®¾å¤‡æ ‘çš„å®˜æ–¹è§„èŒƒä¸­ä¸å»ºè®®ä½¿ç”¨â€œ nameâ€å±æ€§ï¼Œæ‰€ä»¥è¿™å‡½æ•°ä¹Ÿä¸å»ºè®®ä½¿ç”¨ã€‚    </p>
<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>
<ul>
<li>fromï¼š æŒ‡å®šèµ·å§‹èŠ‚ç‚¹ï¼Œ è¡¨ç¤ºä»å“ªä¸ªèŠ‚ç‚¹å¼€å§‹æŸ¥æ‰¾ã€‚ å¦‚æœ from å‚æ•°ä¸º NULLï¼Œ åˆ™ä»è®¾å¤‡æ ‘çš„æ ¹èŠ‚ç‚¹å¼€å§‹æŸ¥æ‰¾ã€‚</li>
<li>nameï¼š è¦æŸ¥æ‰¾çš„èŠ‚ç‚¹åç§°ã€‚</li>
</ul>
<p><strong>è¿”å›å€¼ï¼š</strong>å¦‚æœæ‰¾åˆ°åŒ¹é…çš„èŠ‚ç‚¹ï¼Œ åˆ™è¿”å›å¯¹åº”çš„ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of.h#L51">struct device_node</a> æŒ‡é’ˆã€‚å¦‚æœæœªæ‰¾åˆ°åŒ¹é…çš„èŠ‚ç‚¹ï¼Œ åˆ™è¿”å› NULLã€‚  </p>
<h4 id="2-1-2-of-find-node-by-path"><a href="#2-1-2-of-find-node-by-path" class="headerlink" title="2.1.2Â of_find_node_by_path()"></a><font size=3>2.1.2Â <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of.h#L288">of_find_node_by_path()</a></font></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="keyword">inline</span> <span class="keyword">struct</span> device_node *<span class="title function_">of_find_node_by_path</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *path)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> of_find_node_opts_by_path(path, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯¥å‡½æ•°é€šè¿‡èŠ‚ç‚¹è·¯å¾„åœ¨è®¾å¤‡æ ‘ä¸­è¿›è¡ŒæŸ¥æ‰¾ã€‚ è·¯å¾„æ˜¯è®¾å¤‡æ ‘èŠ‚ç‚¹ä»æ ¹èŠ‚ç‚¹åˆ°ç›®æ ‡èŠ‚ç‚¹çš„å®Œæ•´è·¯å¾„ã€‚ å¯ä»¥é€šè¿‡æŒ‡å®šæ­£ç¡®çš„è·¯å¾„æ¥å‡†ç¡®åœ°è®¿é—®è®¾å¤‡æ ‘ä¸­çš„ç‰¹å®šèŠ‚ç‚¹ã€‚ä½¿ç”¨è¯¥å‡½æ•°æ—¶ï¼Œ å¯ä»¥ç›´æ¥ä¼ é€’èŠ‚ç‚¹çš„å®Œæ•´è·¯å¾„ä½œä¸º path å‚æ•°ï¼Œ å‡½æ•°ä¼šåœ¨è®¾å¤‡æ ‘ä¸­æŸ¥æ‰¾åŒ¹é…çš„èŠ‚ç‚¹ã€‚ è¿™å¯¹äºå·²çŸ¥èŠ‚ç‚¹è·¯å¾„çš„æƒ…å†µéå¸¸æœ‰ç”¨ã€‚    </p>
<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>
<ul>
<li>pathï¼š èŠ‚ç‚¹çš„è·¯å¾„ï¼Œ ä»¥æ–œæ åˆ†éš”çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚ è·¯å¾„æ ¼å¼ä¸ºè®¾å¤‡æ ‘èŠ‚ç‚¹çš„ç»å¯¹è·¯å¾„ï¼Œ ä¾‹å¦‚ &#x2F; topeet&#x2F;myLedã€‚</li>
</ul>
<p><strong>è¿”å›å€¼ï¼š</strong>å¦‚æœæ‰¾åˆ°åŒ¹é…çš„èŠ‚ç‚¹ï¼Œ åˆ™è¿”å›å¯¹åº”çš„ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of.h#L51">struct device_node</a> æŒ‡é’ˆã€‚å¦‚æœæœªæ‰¾åˆ°åŒ¹é…çš„èŠ‚ç‚¹ï¼Œ åˆ™è¿”å› NULLã€‚  </p>
<h4 id="2-1-3-of-find-node-by-type"><a href="#2-1-3-of-find-node-by-type" class="headerlink" title="2.1.3Â of_find_node_by_type()"></a><font size=3>2.1.3Â <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/base.c#L967">of_find_node_by_type()</a></font></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> device_node *<span class="title function_">of_find_node_by_type</span><span class="params">(<span class="keyword">struct</span> device_node *from,</span></span><br><span class="line"><span class="params">	<span class="type">const</span> <span class="type">char</span> *type)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">device_node</span> *<span class="title">np</span>;</span></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> flags;</span><br><span class="line"></span><br><span class="line">	raw_spin_lock_irqsave(&amp;devtree_lock, flags);</span><br><span class="line">	for_each_of_allnodes_from(from, np)</span><br><span class="line">		<span class="keyword">if</span> (np-&gt;type &amp;&amp; (of_node_cmp(np-&gt;type, type) == <span class="number">0</span>)</span><br><span class="line">		    &amp;&amp; of_node_get(np))</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	of_node_put(from);</span><br><span class="line">	raw_spin_unlock_irqrestore(&amp;devtree_lock, flags);</span><br><span class="line">	<span class="keyword">return</span> np;</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL(of_find_node_by_type);</span><br></pre></td></tr></table></figure>

<p>è¯¥å‡½æ•°æ ¹æ®ç±»å‹æ‰¾åˆ°èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹å¦‚æœå®šä¹‰äº† device_type å±æ€§ï¼Œé‚£æˆ‘ä»¬å¯ä»¥æ ¹æ®ç±»å‹æ‰¾åˆ°å®ƒã€‚ä½†æ˜¯åœ¨è®¾å¤‡æ ‘çš„å®˜æ–¹è§„èŒƒä¸­ä¸å»ºè®®ä½¿ç”¨â€œ device_typeâ€å±æ€§ï¼Œæ‰€ä»¥è¿™å‡½æ•°ä¹Ÿä¸å»ºè®®ä½¿ç”¨ã€‚        </p>
<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>
<ul>
<li>fromï¼š æŒ‡å®šèµ·å§‹èŠ‚ç‚¹ï¼Œ è¡¨ç¤ºä»å“ªä¸ªèŠ‚ç‚¹å¼€å§‹æŸ¥æ‰¾ã€‚ å¦‚æœ from å‚æ•°ä¸º NULLï¼Œ åˆ™ä»è®¾å¤‡æ ‘çš„æ ¹èŠ‚ç‚¹å¼€å§‹æŸ¥æ‰¾ã€‚</li>
<li>typeï¼š è¦æŸ¥æ‰¾çš„èŠ‚ç‚¹çš„ device_type å±æ€§ã€‚</li>
</ul>
<p><strong>è¿”å›å€¼ï¼š</strong>å¦‚æœæ‰¾åˆ°åŒ¹é…çš„èŠ‚ç‚¹ï¼Œ åˆ™è¿”å›å¯¹åº”çš„ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of.h#L51">struct device_node</a> æŒ‡é’ˆã€‚å¦‚æœæœªæ‰¾åˆ°åŒ¹é…çš„èŠ‚ç‚¹ï¼Œ åˆ™è¿”å› NULLã€‚  </p>
<h4 id="2-1-4-of-find-compatible-node"><a href="#2-1-4-of-find-compatible-node" class="headerlink" title="2.1.4Â of_find_compatible_node()"></a><font size=3>2.1.4Â <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/base.c#L996">of_find_compatible_node()</a></font></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> device_node *<span class="title function_">of_find_compatible_node</span><span class="params">(<span class="keyword">struct</span> device_node *from,</span></span><br><span class="line"><span class="params">	<span class="type">const</span> <span class="type">char</span> *type, <span class="type">const</span> <span class="type">char</span> *compatible)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">device_node</span> *<span class="title">np</span>;</span></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> flags;</span><br><span class="line"></span><br><span class="line">	raw_spin_lock_irqsave(&amp;devtree_lock, flags);</span><br><span class="line">	for_each_of_allnodes_from(from, np)</span><br><span class="line">		<span class="keyword">if</span> (__of_device_is_compatible(np, compatible, type, <span class="literal">NULL</span>) &amp;&amp;</span><br><span class="line">		    of_node_get(np))</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	of_node_put(from);</span><br><span class="line">	raw_spin_unlock_irqrestore(&amp;devtree_lock, flags);</span><br><span class="line">	<span class="keyword">return</span> np;</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL(of_find_compatible_node);</span><br></pre></td></tr></table></figure>

<p>è¯¥å‡½æ•°æ ¹æ® compatible æ‰¾åˆ°èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹å¦‚æœå®šä¹‰äº† compatible å±æ€§ï¼Œé‚£æˆ‘ä»¬å¯ä»¥æ ¹æ® compatible å±æ€§æ‰¾åˆ°å®ƒã€‚  </p>
<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>
<ul>
<li>fromï¼š æŒ‡å®šèµ·å§‹èŠ‚ç‚¹ï¼Œ è¡¨ç¤ºä»å“ªä¸ªèŠ‚ç‚¹å¼€å§‹æŸ¥æ‰¾ã€‚ å¦‚æœ from å‚æ•°ä¸º NULLï¼Œ åˆ™ä»è®¾å¤‡æ ‘çš„æ ¹èŠ‚ç‚¹å¼€å§‹æŸ¥æ‰¾ã€‚</li>
<li>typeï¼š è¦åŒ¹é…çš„è®¾å¤‡ç±»å‹å­—ç¬¦ä¸²ï¼Œç”¨æ¥æŒ‡å®š device_type å±æ€§çš„å€¼ï¼Œå¯ä»¥ä¼ å…¥ NULLï¼Œè¡¨ç¤ºå¿½ç•¥æ‰ device_type å±æ€§ã€‚</li>
<li>compatibleï¼š è¦åŒ¹é…çš„å…¼å®¹æ€§å­—ç¬¦ä¸²ï¼Œ é€šå¸¸æ˜¯è®¾å¤‡æ ‘èŠ‚ç‚¹çš„ compatible å±æ€§ä¸­çš„å€¼ã€‚</li>
</ul>
<p><strong>è¿”å›å€¼ï¼š</strong>å¦‚æœæ‰¾åˆ°åŒ¹é…çš„èŠ‚ç‚¹ï¼Œ åˆ™è¿”å›å¯¹åº”çš„ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of.h#L51">struct device_node</a> æŒ‡é’ˆã€‚å¦‚æœæœªæ‰¾åˆ°åŒ¹é…çš„èŠ‚ç‚¹ï¼Œ åˆ™è¿”å› NULLã€‚  </p>
<p>ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/base.c#L996">of_find_compatible_node()</a> å‡½æ•°æ—¶ï¼Œ å¯ä»¥æŒ‡å®šèµ·å§‹èŠ‚ç‚¹å’Œéœ€è¦åŒ¹é…çš„è®¾å¤‡ç±»å‹å­—ç¬¦ä¸²ä»¥åŠå…¼å®¹æ€§å­—ç¬¦ä¸²ã€‚ å‡½æ•°ä¼šä»èµ·å§‹èŠ‚ç‚¹å¼€å§‹éå†è®¾å¤‡æ ‘ï¼Œ æŸ¥æ‰¾ä¸æŒ‡å®šå…¼å®¹æ€§å­—ç¬¦ä¸²åŒ¹é…çš„èŠ‚ç‚¹ï¼Œå¹¶è¿”å›åŒ¹é…èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚  </p>
<h4 id="2-1-5-of-find-node-by-phandle"><a href="#2-1-5-of-find-node-by-phandle" class="headerlink" title="2.1.5Â of_find_node_by_phandle()"></a><font size=3>2.1.5Â <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/base.c#L1170">of_find_node_by_phandle()</a></font></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> device_node *<span class="title function_">of_find_node_by_phandle</span><span class="params">(phandle handle)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//......</span></span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL(of_find_node_by_phandle);</span><br></pre></td></tr></table></figure>

<p>è¯¥å‡½æ•°æ ¹æ® phandle æ‰¾åˆ°èŠ‚ç‚¹ã€‚ dts æ–‡ä»¶è¢«ç¼–è¯‘ä¸º dtb æ–‡ä»¶æ—¶ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªæ•°å­— IDï¼Œè¿™äº›æ•°å­— ID å½¼æ­¤ä¸åŒã€‚å¯ä»¥ä½¿ç”¨æ•°å­— ID æ¥æ‰¾åˆ° device_nodeã€‚è¿™äº›æ•°å­— ID å°±æ˜¯ phandleã€‚  </p>
<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>
<ul>
<li>phandleï¼š è¦æŸ¥æ‰¾èŠ‚ç‚¹çš„æ•°å­—idã€‚</li>
</ul>
<p><strong>è¿”å›å€¼ï¼š</strong>å¦‚æœæ‰¾åˆ°åŒ¹é…çš„èŠ‚ç‚¹ï¼Œ åˆ™è¿”å›å¯¹åº”çš„ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of.h#L51">struct device_node</a> æŒ‡é’ˆã€‚å¦‚æœæœªæ‰¾åˆ°åŒ¹é…çš„èŠ‚ç‚¹ï¼Œ åˆ™è¿”å› NULLã€‚  </p>
<h4 id="2-1-6-of-find-matching-node-and-match"><a href="#2-1-6-of-find-matching-node-and-match" class="headerlink" title="2.1.6Â of_find_matching_node_and_match()"></a><font size=3>2.1.6Â <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/base.c#L1104">of_find_matching_node_and_match()</a></font></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> device_node *<span class="title function_">of_find_matching_node_and_match</span><span class="params">(<span class="keyword">struct</span> device_node *from,</span></span><br><span class="line"><span class="params">					<span class="type">const</span> <span class="keyword">struct</span> of_device_id *matches,</span></span><br><span class="line"><span class="params">					<span class="type">const</span> <span class="keyword">struct</span> of_device_id **match)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯¥å‡½æ•°é€šè¿‡ of_device_id åŒ¹é…è¡¨æ¥æŸ¥æ‰¾æŒ‡å®šçš„èŠ‚ç‚¹ã€‚</p>
<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>
<ul>
<li>fromï¼šå¼€å§‹æŸ¥æ‰¾çš„èŠ‚ç‚¹ï¼Œå¦‚æœä¸º NULL è¡¨ç¤ºä»æ ¹èŠ‚ç‚¹å¼€å§‹æŸ¥æ‰¾æ•´ä¸ªè®¾å¤‡æ ‘ã€‚</li>
<li>matchesï¼š <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/mod_devicetable.h#L241">of_device_id</a> åŒ¹é…è¡¨ï¼Œä¹Ÿå°±æ˜¯åœ¨æ­¤åŒ¹é…è¡¨é‡Œé¢æŸ¥æ‰¾èŠ‚ç‚¹ï¼ˆè¯¥è¡¨åŒ…å«è¦æœç´¢çš„åŒ¹é…é¡¹ï¼‰ã€‚</li>
<li>matchï¼š æ‰¾åˆ°çš„åŒ¹é…çš„ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/mod_devicetable.h#L241">of_device_id</a>ã€‚</li>
</ul>
<p><strong>è¿”å›å€¼ï¼š</strong>å¦‚æœæ‰¾åˆ°åŒ¹é…çš„èŠ‚ç‚¹ï¼Œ åˆ™è¿”å›å¯¹åº”çš„ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of.h#L51">struct device_node</a> æŒ‡é’ˆã€‚å¦‚æœæœªæ‰¾åˆ°åŒ¹é…çš„èŠ‚ç‚¹ï¼Œ åˆ™è¿”å› NULLã€‚</p>
<p><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/base.c#L1104">of_find_matching_node_and_match()</a>å‡½æ•°åœ¨è®¾å¤‡æ ‘ä¸­éå†èŠ‚ç‚¹ï¼Œ å¯¹æ¯ä¸ªèŠ‚ç‚¹ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/base.c#L1063">__of_match_node()</a> å‡½æ•°è¿›è¡ŒåŒ¹é…ã€‚ å¦‚æœæ‰¾åˆ°åŒ¹é…çš„èŠ‚ç‚¹ï¼Œ å°†è¿”å›è¯¥èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œ å¹¶å°† match æŒ‡é’ˆæ›´æ–°ä¸ºåŒ¹é…åˆ°çš„ of_device_id æ¡ç›®ï¼Œ å‡½æ•°ä¼šè‡ªåŠ¨å¢åŠ åŒ¹é…èŠ‚ç‚¹çš„å¼•ç”¨è®¡æ•°ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of.h&gt;</span></span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">of_device_id</span> <span class="title">my_match_table</span>[] =</span> &#123;</span><br><span class="line">    &#123; .compatible = <span class="string">&quot;vendor,device&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="comment">/* sentinel */</span> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">of_device_id</span> *<span class="title">match</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">device_node</span> *<span class="title">np</span>;</span></span><br><span class="line"><span class="comment">// ä»æ ¹èŠ‚ç‚¹å¼€å§‹æŸ¥æ‰¾åŒ¹é…çš„èŠ‚ç‚¹</span></span><br><span class="line">np = of_find_matching_node_and_match(<span class="literal">NULL</span>, my_match_table, &amp;match);</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª of_device_id åŒ¹é…è¡¨ my_match_tableï¼Œ å…¶ä¸­åŒ…å«äº†ä¸€ä¸ªå…¼å®¹æ€§å­—ç¬¦ä¸²ä¸ºâ€vendor,deviceâ€çš„åŒ¹é…é¡¹ã€‚ ç„¶åï¼Œ æˆ‘ä»¬ä½¿ç”¨ of_find_matching_node_and_match å‡½æ•°ä»æ ¹èŠ‚ç‚¹å¼€å§‹æŸ¥æ‰¾åŒ¹é…çš„èŠ‚ç‚¹ã€‚  </p>
<h3 id="2-2-æŸ¥æ‰¾çˆ¶å­èŠ‚ç‚¹"><a href="#2-2-æŸ¥æ‰¾çˆ¶å­èŠ‚ç‚¹" class="headerlink" title="2.2 æŸ¥æ‰¾çˆ¶å­èŠ‚ç‚¹"></a><font size=3>2.2 æŸ¥æ‰¾çˆ¶å­èŠ‚ç‚¹</font></h3><h4 id="2-2-1-of-get-parent"><a href="#2-2-1-of-get-parent" class="headerlink" title="2.2.1Â of_get_parent() "></a><font size=3>2.2.1Â <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/base.c#L669">of_get_parent()</a> </font></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> device_node *<span class="title function_">of_get_parent</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *node)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">device_node</span> *<span class="title">np</span>;</span></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> flags;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!node)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	raw_spin_lock_irqsave(&amp;devtree_lock, flags);</span><br><span class="line">	np = of_node_get(node-&gt;parent);</span><br><span class="line">	raw_spin_unlock_irqrestore(&amp;devtree_lock, flags);</span><br><span class="line">	<span class="keyword">return</span> np;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯¥å‡½æ•°æ¥æ”¶ä¸€ä¸ªæŒ‡å‘è®¾å¤‡æ ‘èŠ‚ç‚¹çš„æŒ‡é’ˆ nodeï¼Œ å¹¶è¿”å›è¯¥èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ï¼ˆå¦‚æœæœ‰çˆ¶èŠ‚ç‚¹çš„è¯ï¼‰çš„æŒ‡é’ˆã€‚  </p>
<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>
<ul>
<li>nodeï¼š è¦è·å–çˆ¶èŠ‚ç‚¹çš„è®¾å¤‡æ ‘èŠ‚ç‚¹æŒ‡é’ˆã€‚</li>
</ul>
<p><strong>è¿”å›å€¼ï¼š</strong>å¦‚æœæ‰¾åˆ°åŒ¹é…çš„èŠ‚ç‚¹ï¼Œ åˆ™è¿”å›å¯¹åº”çš„ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of.h#L51">struct device_node</a> æŒ‡é’ˆã€‚å¦‚æœæœªæ‰¾åˆ°åŒ¹é…çš„èŠ‚ç‚¹ï¼Œ åˆ™è¿”å› NULLã€‚  </p>
<p>ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/base.c#L669">of_get_parent()</a> å‡½æ•°æ—¶ï¼Œ å¯ä»¥å°†ç‰¹å®šçš„è®¾å¤‡æ ‘èŠ‚ç‚¹ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°ï¼Œ ç„¶åå®ƒå°†è¿”å›è¯¥èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ã€‚ è¿™å¯¹äºåœ¨è®¾å¤‡æ ‘ä¸­å¯¼èˆªå’Œè®¿é—®èŠ‚ç‚¹ä¹‹é—´çš„å±‚æ¬¡å…³ç³»éå¸¸æœ‰ç”¨ã€‚  </p>
<p>çˆ¶èŠ‚ç‚¹åœ¨è®¾å¤‡æ ‘ä¸­è¡¨ç¤ºäº†èŠ‚ç‚¹ä¹‹é—´çš„å±‚æ¬¡ç»“æ„å…³ç³»ã€‚ é€šè¿‡è·å–çˆ¶èŠ‚ç‚¹ï¼Œ æˆ‘ä»¬å¯ä»¥è®¿é—®ä¸Šä¸€çº§èŠ‚ç‚¹çš„å±æ€§å’Œé…ç½®ä¿¡æ¯ï¼Œ ä»è€Œæ›´å¥½åœ°ç†è§£è®¾å¤‡æ ‘ä¸­çš„èŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»ã€‚  </p>
<h4 id="2-2-2-of-get-next-parent"><a href="#2-2-2-of-get-next-parent" class="headerlink" title="2.2.2Â of_get_next_parent()"></a><font size=3>2.2.2Â <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/base.c#L702">of_get_next_parent()</a></font></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> device_node *<span class="title function_">of_get_next_parent</span><span class="params">(<span class="keyword">struct</span> device_node *node)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">device_node</span> *<span class="title">parent</span>;</span></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> flags;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!node)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	raw_spin_lock_irqsave(&amp;devtree_lock, flags);</span><br><span class="line">	parent = of_node_get(node-&gt;parent);</span><br><span class="line">	of_node_put(node);</span><br><span class="line">	raw_spin_unlock_irqrestore(&amp;devtree_lock, flags);</span><br><span class="line">	<span class="keyword">return</span> parent;</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL(of_get_next_parent);</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‡½æ•°åæ¯”è¾ƒå¥‡æ€ªï¼Œæ€ä¹ˆå¯èƒ½æœ‰â€œ next parentâ€ï¼Ÿå®ƒå®é™…ä¸Šä¹Ÿæ˜¯æ‰¾åˆ° device_node çš„çˆ¶èŠ‚ç‚¹ï¼Œè·Ÿ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/base.c#L669">of_get_parent()</a> çš„è¿”å›ç»“æœæ˜¯ä¸€æ ·çš„ã€‚å·®åˆ«åœ¨äºå®ƒå¤šè°ƒç”¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/dynamic.c#L40">of_node_put()</a> å‡½æ•°ï¼ŒæŠŠ node èŠ‚ç‚¹çš„å¼•ç”¨è®¡æ•°å‡å°‘äº† 1ã€‚è¿™æ„å‘³ç€è°ƒç”¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/base.c#L702">of_get_next_parent()</a> ä¹‹åï¼Œæˆ‘ä»¬ä¸å†éœ€è¦è°ƒç”¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/dynamic.c#L40">of_node_put()</a> é‡Šæ”¾ node èŠ‚ç‚¹      </p>
<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>
<ul>
<li>nodeï¼š è¦è·å–çˆ¶èŠ‚ç‚¹çš„è®¾å¤‡æ ‘èŠ‚ç‚¹æŒ‡é’ˆã€‚</li>
</ul>
<p><strong>è¿”å›å€¼ï¼š</strong>å¦‚æœæ‰¾åˆ°åŒ¹é…çš„èŠ‚ç‚¹ï¼Œ åˆ™è¿”å›å¯¹åº”çš„ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of.h#L51">struct device_node</a> æŒ‡é’ˆã€‚å¦‚æœæœªæ‰¾åˆ°åŒ¹é…çš„èŠ‚ç‚¹ï¼Œ åˆ™è¿”å› NULLã€‚  </p>
<h4 id="2-2-3-of-get-next-child"><a href="#2-2-3-of-get-next-child" class="headerlink" title="2.2.3Â of_get_next_child()"></a><font size=3>2.2.3Â <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/base.c#L737">of_get_next_child()</a></font></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> device_node *<span class="title function_">of_get_next_child</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *node,</span></span><br><span class="line"><span class="params">	<span class="keyword">struct</span> device_node *prev)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">device_node</span> *<span class="title">next</span>;</span></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> flags;</span><br><span class="line"></span><br><span class="line">	raw_spin_lock_irqsave(&amp;devtree_lock, flags);</span><br><span class="line">	next = __of_get_next_child(node, prev);</span><br><span class="line">	raw_spin_unlock_irqrestore(&amp;devtree_lock, flags);</span><br><span class="line">	<span class="keyword">return</span> next;</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL(of_get_next_child);</span><br></pre></td></tr></table></figure>

<p>è¯¥å‡½æ•°å‡½æ•°ç”¨äºè·å–è®¾å¤‡æ ‘èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå­èŠ‚ç‚¹ã€‚   </p>
<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>
<ul>
<li>nodeï¼š å½“å‰èŠ‚ç‚¹ï¼Œ ç”¨äºæŒ‡å®šè¦è·å–å­èŠ‚ç‚¹çš„èµ·å§‹èŠ‚ç‚¹ã€‚</li>
<li>prevï¼š ä¸Šä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œ ç”¨äºæŒ‡å®šä»å“ªä¸ªå­èŠ‚ç‚¹å¼€å§‹è·å–ä¸‹ä¸€ä¸ªå­èŠ‚ç‚¹ã€‚ å¦‚æœä¸º NULLï¼Œ åˆ™ä»èµ·å§‹èŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹å¼€å§‹ã€‚</li>
</ul>
<p><strong>è¿”å›å€¼ï¼š</strong>å¦‚æœæ‰¾åˆ°åŒ¹é…çš„èŠ‚ç‚¹ï¼Œ åˆ™è¿”å›å¯¹åº”çš„ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of.h#L51">struct device_node</a> æŒ‡é’ˆã€‚å¦‚æœæœªæ‰¾åˆ°åŒ¹é…çš„èŠ‚ç‚¹ï¼Œ åˆ™è¿”å› NULLã€‚  </p>
<p>ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/base.c#L737">of_get_next_child()</a> å‡½æ•°æ—¶ï¼Œ å¯ä»¥ä¼ é€’å½“å‰èŠ‚ç‚¹ä»¥åŠä¸Šä¸€ä¸ªå­èŠ‚ç‚¹ä½œä¸ºå‚æ•°ã€‚ å‡½æ•°å°†ä»ä¸Šä¸€ä¸ªå­èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹å¼€å§‹ï¼Œ æŸ¥æ‰¾å¹¶è¿”å›ä¸‹ä¸€ä¸ªå­èŠ‚ç‚¹ã€‚è®¾å¤‡æ ‘ä¸­çš„å­èŠ‚ç‚¹è¡¨ç¤ºäº†èŠ‚ç‚¹ä¹‹é—´çš„å±‚æ¬¡å…³ç³»ã€‚ é€šè¿‡è·å–å­èŠ‚ç‚¹ï¼Œ å¯ä»¥éå†å’Œè®¿é—®å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œ ä»¥ä¾¿è¿›ä¸€æ­¥å¤„ç†å®ƒä»¬çš„å±æ€§å’Œé…ç½®ä¿¡æ¯ã€‚</p>
<h4 id="2-2-4-of-get-next-available-child"><a href="#2-2-4-of-get-next-available-child" class="headerlink" title="2.2.4Â of_get_next_available_child()"></a><font size=3>2.2.4Â <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/base.c#L759">of_get_next_available_child()</a></font></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> device_node *<span class="title function_">of_get_next_available_child</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *node,</span></span><br><span class="line"><span class="params">	<span class="keyword">struct</span> device_node *prev)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯¥å‡½æ•°å–å‡ºä¸‹ä¸€ä¸ªâ€œå¯ç”¨â€çš„å­èŠ‚ç‚¹ï¼Œæœ‰äº›èŠ‚ç‚¹çš„ status æ˜¯â€œdisabledâ€ï¼Œé‚£å°±ä¼šè·³è¿‡è¿™äº›èŠ‚ç‚¹ã€‚    </p>
<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>
<ul>
<li>nodeï¼š å½“å‰èŠ‚ç‚¹ï¼Œ ç”¨äºæŒ‡å®šè¦è·å–å­èŠ‚ç‚¹çš„èµ·å§‹èŠ‚ç‚¹ã€‚</li>
<li>prevï¼š ä¸Šä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œ ç”¨äºæŒ‡å®šä»å“ªä¸ªå­èŠ‚ç‚¹å¼€å§‹è·å–ä¸‹ä¸€ä¸ªå­èŠ‚ç‚¹ã€‚ å¦‚æœä¸º NULLï¼Œ åˆ™ä»èµ·å§‹èŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹å¼€å§‹ã€‚</li>
</ul>
<p><strong>è¿”å›å€¼ï¼š</strong>å¦‚æœæ‰¾åˆ°åŒ¹é…çš„èŠ‚ç‚¹ï¼Œ åˆ™è¿”å›å¯¹åº”çš„ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of.h#L51">struct device_node</a> æŒ‡é’ˆã€‚å¦‚æœæœªæ‰¾åˆ°åŒ¹é…çš„èŠ‚ç‚¹ï¼Œ åˆ™è¿”å› NULLã€‚  </p>
<h4 id="2-2-5-of-get-child-by-name"><a href="#2-2-5-of-get-child-by-name" class="headerlink" title="2.2.5Â of_get_child_by_name()"></a><font size=3>2.2.5Â <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/base.c#L815">of_get_child_by_name()</a></font></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> device_node *<span class="title function_">of_get_child_by_name</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *node,</span></span><br><span class="line"><span class="params">				<span class="type">const</span> <span class="type">char</span> *name)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">device_node</span> *<span class="title">child</span>;</span></span><br><span class="line"></span><br><span class="line">	for_each_child_of_node(node, child)</span><br><span class="line">		<span class="keyword">if</span> (child-&gt;name &amp;&amp; (of_node_cmp(child-&gt;name, name) == <span class="number">0</span>))</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">return</span> child;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯¥å‡½æ•°æ ¹æ®åå­—å–å‡ºå­èŠ‚ç‚¹ã€‚</p>
<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>
<ul>
<li>nodeï¼š å½“å‰èŠ‚ç‚¹ï¼Œ ç”¨äºæŒ‡å®šè¦è·å–å­èŠ‚ç‚¹çš„èµ·å§‹èŠ‚ç‚¹ã€‚</li>
<li>nameï¼š è¡¨ç¤ºå­èŠ‚ç‚¹çš„åå­—ã€‚</li>
</ul>
<p><strong>è¿”å›å€¼ï¼š</strong>å¦‚æœæ‰¾åˆ°åŒ¹é…çš„èŠ‚ç‚¹ï¼Œ åˆ™è¿”å›å¯¹åº”çš„ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of.h#L51">struct device_node</a> æŒ‡é’ˆã€‚å¦‚æœæœªæ‰¾åˆ°åŒ¹é…çš„èŠ‚ç‚¹ï¼Œ åˆ™è¿”å› NULLã€‚  </p>
<h3 id="2-3-è·å–å±æ€§"><a href="#2-3-è·å–å±æ€§" class="headerlink" title="2.3 è·å–å±æ€§"></a><font size=3>2.3 è·å–å±æ€§</font></h3><p>èŠ‚ç‚¹çš„å±æ€§ä¿¡æ¯é‡Œé¢ä¿å­˜äº†é©±åŠ¨æ‰€éœ€è¦çš„å†…å®¹ï¼Œå› æ­¤å¯¹äºå±æ€§å€¼çš„æå–éå¸¸é‡è¦ï¼Œ Linux å†…æ ¸ä¸­ä½¿ç”¨ç»“æ„ä½“ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of.h#L31">struct property</a> è¡¨ç¤ºå±æ€§ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">property</span> &#123;</span></span><br><span class="line">	<span class="type">char</span>	*name;</span><br><span class="line">	<span class="type">int</span>	length;</span><br><span class="line">	<span class="type">void</span>	*value;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">property</span> *<span class="title">next</span>;</span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(CONFIG_OF_DYNAMIC) || defined(CONFIG_SPARC)</span></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> _flags;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(CONFIG_OF_PROMTREE)</span></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> unique_id;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(CONFIG_OF_KOBJ)</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">bin_attribute</span> <span class="title">attr</span>;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="2-3-1-of-find-property"><a href="#2-3-1-of-find-property" class="headerlink" title="2.3.1 of_find_property()"></a><font size=3>2.3.1 <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/base.c#L264">of_find_property()</a></font></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> property *<span class="title function_">of_find_property</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *np,</span></span><br><span class="line"><span class="params">				  <span class="type">const</span> <span class="type">char</span> *name,</span></span><br><span class="line"><span class="params">				  <span class="type">int</span> *lenp)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">property</span> *<span class="title">pp</span>;</span></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> flags;</span><br><span class="line"></span><br><span class="line">	raw_spin_lock_irqsave(&amp;devtree_lock, flags);</span><br><span class="line">	pp = __of_find_property(np, name, lenp);</span><br><span class="line">	raw_spin_unlock_irqrestore(&amp;devtree_lock, flags);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> pp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯¥å‡½æ•°ç”¨äºåœ¨èŠ‚ç‚¹ np ä¸‹æŸ¥æ‰¾æŒ‡å®šåç§° name çš„å±æ€§ã€‚  </p>
<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>
<ul>
<li>np: è¦æŸ¥æ‰¾çš„èŠ‚ç‚¹ã€‚</li>
<li>name: è¦æŸ¥æ‰¾çš„å±æ€§çš„å±æ€§åã€‚</li>
<li>lenp: ä¸€ä¸ªæŒ‡å‘æ•´æ•°çš„æŒ‡é’ˆï¼Œ ç”¨äºæ¥æ”¶å±æ€§å€¼çš„å­—èŠ‚æ•°ã€‚</li>
</ul>
<p><strong>è¿”å›å€¼ï¼š</strong>å¦‚æœæˆåŠŸæ‰¾åˆ°äº†æŒ‡å®šåç§°çš„å±æ€§ï¼Œ åˆ™è¿”å›å¯¹åº”çš„å±æ€§ç»“æ„ä½“æŒ‡é’ˆ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of.h#L31">struct property *</a> ï¼› å¦‚æœæœªæ‰¾åˆ°ï¼Œ åˆ™è¿”å› NULLã€‚  </p>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<p>åœ¨è®¾å¤‡æ ‘ä¸­ï¼ŒèŠ‚ç‚¹å¤§æ¦‚æ˜¯è¿™æ ·ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxx_node &#123;</span><br><span class="line">	xxx_pp_name = â€œhelloâ€;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°èŠ‚ç‚¹ä¸­ï¼Œâ€œ xxx_pp_nameâ€å°±æ˜¯å±æ€§çš„åå­—ï¼Œå€¼çš„é•¿åº¦æ˜¯ 6ã€‚  </p>
<h4 id="2-3-2-of-property-count-elems-of-size"><a href="#2-3-2-of-property-count-elems-of-size" class="headerlink" title="2.3.2 of_property_count_elems_of_size()"></a><font size=3>2.3.2 <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/property.c#L31">of_property_count_elems_of_size()</a></font></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">of_property_count_elems_of_size</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *np,</span></span><br><span class="line"><span class="params">				<span class="type">const</span> <span class="type">char</span> *propname, <span class="type">int</span> elem_size)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯¥å‡½æ•°åœ¨è®¾å¤‡æ ‘ä¸­çš„è®¾å¤‡èŠ‚ç‚¹ä¸‹æŸ¥æ‰¾æŒ‡å®šåç§°çš„å±æ€§ï¼Œ å¹¶è·å–è¯¥å±æ€§ä¸­å…ƒç´ çš„æ•°é‡ã€‚ è°ƒç”¨è¯¥å‡½æ•°å¯ä»¥ç”¨äºè·å–è®¾å¤‡æ ‘å±æ€§ä¸­æŸä¸ªå±æ€§çš„å…ƒç´ æ•°é‡ï¼Œ æ¯”å¦‚ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨çš„å…ƒç´ æ•°é‡æˆ–ä¸€ä¸ªæ•´æ•°æ•°ç»„çš„å…ƒç´ æ•°é‡ç­‰ï¼Œåœ¨æ¯”å¦‚æˆ‘ä»¬å¸¸è§çš„ reg å±æ€§å€¼å°±æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆä½¿ç”¨æ­¤å‡½æ•°å¯ä»¥è·å–åˆ°è¿™ä¸ªæ•°ç»„çš„å¤§å° ã€‚    </p>
<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>
<ul>
<li>np: è®¾å¤‡èŠ‚ç‚¹ã€‚</li>
<li>propname: éœ€è¦è·å–å…ƒç´ æ•°é‡çš„å±æ€§åã€‚</li>
<li>elem_size: å•ä¸ªå…ƒç´ çš„å°ºå¯¸ã€‚</li>
</ul>
<p><strong>è¿”å›å€¼ï¼š</strong>å¦‚æœæˆåŠŸè·å–äº†æŒ‡å®šå±æ€§ä¸­å…ƒç´ çš„æ•°é‡ï¼Œ åˆ™è¿”å›è¯¥æ•°é‡ï¼› å¦‚æœæœªæ‰¾åˆ°å±æ€§æˆ–å±æ€§ä¸­æ²¡æœ‰å…ƒç´ ï¼Œ åˆ™è¿”å› 0ã€‚  </p>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<p>åœ¨è®¾å¤‡æ ‘ä¸­ï¼ŒèŠ‚ç‚¹å¤§æ¦‚æ˜¯è¿™æ ·ï¼š  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxx_node &#123;</span><br><span class="line">	xxx_pp_name = &lt;<span class="number">0x50000000</span> <span class="number">1024</span>&gt; &lt;<span class="number">0x60000000</span> <span class="number">2048</span>&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>è°ƒç”¨ of_property_count_elems_of_size(np, â€œxxx_pp_nameâ€, 8)æ—¶ï¼Œè¿”å›å€¼æ˜¯ 2ï¼›  </li>
<li>è°ƒç”¨ of_property_count_elems_of_size(np, â€œxxx_pp_nameâ€, 4)æ—¶ï¼Œè¿”å›å€¼æ˜¯ 4ã€‚</li>
</ul>
<h4 id="2-3-3-è¯»æ•°ç»„-u8-u16-u32-u64"><a href="#2-3-3-è¯»æ•°ç»„-u8-u16-u32-u64" class="headerlink" title="2.3.3 è¯»æ•°ç»„ u8&#x2F;u16&#x2F;u32&#x2F;u64"></a><font size=3>2.3.3 è¯»æ•°ç»„ u8&#x2F;u16&#x2F;u32&#x2F;u64</font></h4><p>ä¸‹é¢å››ä¸ªå‡½æ•°å®šä¹‰åœ¨ï¼š<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/property.c">property.c - drivers&#x2F;of&#x2F;property.c</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä»æŒ‡å®šå±æ€§ä¸­è¯»å–å˜é•¿çš„ u8 æ•°ç»„</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">of_property_read_variable_u8_array</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *np,</span></span><br><span class="line"><span class="params">					<span class="type">const</span> <span class="type">char</span> *propname, u8 *out_values,</span></span><br><span class="line"><span class="params">					<span class="type">size_t</span> sz_min, <span class="type">size_t</span> sz_max)</span>;</span><br><span class="line"><span class="comment">//ä»æŒ‡å®šå±æ€§ä¸­è¯»å–å˜é•¿çš„ u16 æ•°ç»„</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">of_property_read_variable_u16_array</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *np,</span></span><br><span class="line"><span class="params">					<span class="type">const</span> <span class="type">char</span> *propname, u16 *out_values,</span></span><br><span class="line"><span class="params">					<span class="type">size_t</span> sz_min, <span class="type">size_t</span> sz_max)</span>;</span><br><span class="line"><span class="comment">//ä»æŒ‡å®šå±æ€§ä¸­è¯»å–å˜é•¿çš„ u32 æ•°ç»„</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">of_property_read_variable_u32_array</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *np,</span></span><br><span class="line"><span class="params">			       <span class="type">const</span> <span class="type">char</span> *propname, u32 *out_values,</span></span><br><span class="line"><span class="params">			       <span class="type">size_t</span> sz_min, <span class="type">size_t</span> sz_max)</span>;</span><br><span class="line"><span class="comment">//ä»æŒ‡å®šå±æ€§ä¸­è¯»å–å˜é•¿çš„ u64 æ•°ç»„</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">of_property_read_variable_u64_array</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *np,</span></span><br><span class="line"><span class="params">			       <span class="type">const</span> <span class="type">char</span> *propname, u64 *out_values,</span></span><br><span class="line"><span class="params">			       <span class="type">size_t</span> sz_min, <span class="type">size_t</span> sz_max)</span></span><br></pre></td></tr></table></figure>

<p>è¿™å‡ ä¸ªå‡½æ•°ç”¨äºä»è®¾å¤‡æ ‘ä¸­è¯»å–æŒ‡å®šå±æ€§åçš„å˜é•¿æ•°ç»„ã€‚ é€šè¿‡æä¾›è®¾å¤‡èŠ‚ç‚¹ã€ å±æ€§åå’Œè¾“å‡ºæ•°ç»„çš„æŒ‡é’ˆï¼Œ å¯ä»¥å°†è®¾å¤‡æ ‘ä¸­çš„æ•°ç»„æ•°æ®è¯»å–åˆ°æŒ‡å®šçš„å†…å­˜åŒºåŸŸä¸­ã€‚ åŒæ—¶ï¼Œ è¿˜éœ€è¦æŒ‡å®šæ•°ç»„çš„æœ€å°å¤§å°å’Œæœ€å¤§å¤§å°ï¼Œ ä»¥ç¡®ä¿è¯»å–åˆ°çš„æ•°ç»„ç¬¦åˆé¢„æœŸçš„å¤§å°èŒƒå›´ã€‚</p>
<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>
<ul>
<li>np: è®¾å¤‡èŠ‚ç‚¹ã€‚propname: è¦è¯»å–çš„å±æ€§åã€‚</li>
<li>out_values: ç”¨äºå­˜å‚¨è¯»å–åˆ°çš„ u8&#x2F;u16&#x2F;u32&#x2F;u64 æ•°ç»„çš„æŒ‡é’ˆã€‚</li>
<li>sz_min: æ•°ç»„çš„æœ€å°å¤§å°ã€‚</li>
<li>sz_max: æ•°ç»„çš„æœ€å¤§å¤§å°ã€‚</li>
</ul>
<p><strong>è¿”å›å€¼ï¼š</strong>0ï¼Œè¯»å–æˆåŠŸï¼Œè´Ÿå€¼ï¼Œè¯»å–å¤±è´¥ï¼Œ -EINVAL è¡¨ç¤ºå±æ€§ä¸å­˜åœ¨ï¼Œ -ENODATA è¡¨ç¤ºæ²¡æœ‰è¦è¯»å–çš„æ•°æ®ï¼Œ -EOVERFLOW è¡¨ç¤ºå±æ€§å€¼åˆ—è¡¨å¤ªå°ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<p>åœ¨è®¾å¤‡æ ‘ä¸­ï¼ŒèŠ‚ç‚¹å¤§æ¦‚æ˜¯è¿™æ ·ï¼š  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxx_node &#123;</span><br><span class="line">	name2 = &lt;<span class="number">0x50000012</span> <span class="number">0x60000034</span>&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>è°ƒç”¨ of_property_read_variable_u8_array (np, â€œname2â€, out_values, 1, 10)æ—¶ï¼Œout_values ä¸­å°†ä¼šä¿å­˜è¿™ 8 ä¸ªå­—èŠ‚ï¼š 0x12,0x00,0x00,0x50,0x34,0x00,0x00,0x60ã€‚</p>
<p>è°ƒç”¨ of_property_read_variable_u16_array (np, â€œname2â€, out_values, 1, 10)æ—¶ï¼Œout_values ä¸­å°†ä¼šä¿å­˜è¿™ 4 ä¸ª 16 ä½æ•°å€¼ï¼š 0x0012, 0x5000,0x0034,0x6000ã€‚</p>
<p>æ€»ä¹‹ï¼Œ<strong>è¿™äº›å‡½æ•°è¦ä¹ˆèƒ½å–åˆ°å…¨éƒ¨çš„æ•°å€¼ï¼Œè¦ä¹ˆä¸€ä¸ªæ•°å€¼éƒ½å–ä¸åˆ°ï¼›å¦‚æœå€¼çš„é•¿åº¦åœ¨ sz_min å’Œ sz_max ä¹‹é—´ï¼Œå°±è¿”å›å…¨éƒ¨çš„æ•°å€¼ï¼›å¦åˆ™ä¸€ä¸ªæ•°å€¼éƒ½ä¸è¿”å›ã€‚</strong>  </p>
<details class="folding-tag" blue><summary> ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ… </summary>
              <div class='content'>
              <p>ä»è¿™å‡ ä¸ªå‡½æ•°è¡ç”Ÿå‡ºä¸‹é¢ä¸€ç»„å‡½æ•°ï¼š</p><ul><li>è¿™é‡Œçš„å››ä¸ªå‡½æ•°ä¼šè°ƒç”¨of_property_read_variable_uX_array ()</li></ul><p><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of.h#L419">of_property_read_u8_array()</a>ã€<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of.h#L467">of_property_read_u16_array()</a>ã€<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of.h#L495">of_property_read_u32_array()</a>ã€<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of.h#L523">of_property_read_u64_array()</a></p>
              </div>
            </details>  

<h4 id="2-3-4-è¯»æ•´æ•°-u8-u16-u32-u64"><a href="#2-3-4-è¯»æ•´æ•°-u8-u16-u32-u64" class="headerlink" title="2.3.4 è¯»æ•´æ•° u8&#x2F;u16&#x2F;u32&#x2F;u64"></a><font size=3>2.3.4 è¯»æ•´æ•° u8&#x2F;u16&#x2F;u32&#x2F;u64</font></h4><p>ä¸‹é¢çš„ä¸‰ä¸ªå‡½æ•°å®šä¹‰åœ¨è¿™é‡Œï¼š<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of.h">of.h - include&#x2F;linux&#x2F;of.h</a>çš„ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of.h#L1162">1162</a> - <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of.h#L1181">1181</a>ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">int</span> <span class="title function_">of_property_read_u8</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *np,</span></span><br><span class="line"><span class="params">				       <span class="type">const</span> <span class="type">char</span> *propname,</span></span><br><span class="line"><span class="params">				       u8 *out_value)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> of_property_read_u8_array(np, propname, out_value, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">int</span> <span class="title function_">of_property_read_u16</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *np,</span></span><br><span class="line"><span class="params">				       <span class="type">const</span> <span class="type">char</span> *propname,</span></span><br><span class="line"><span class="params">				       u16 *out_value)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> of_property_read_u16_array(np, propname, out_value, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">int</span> <span class="title function_">of_property_read_u32</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *np,</span></span><br><span class="line"><span class="params">				       <span class="type">const</span> <span class="type">char</span> *propname,</span></span><br><span class="line"><span class="params">				       u32 *out_value)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> of_property_read_u32_array(np, propname, out_value, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯»u64æ•´æ•°çš„å‡½æ•°ä¸ä¸Šé¢ä¸å¤ªä¸€æ ·ï¼Œå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/property.c#L302">property.c - drivers&#x2F;of&#x2F;property.c</a>ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">of_property_read_u64</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *np, <span class="type">const</span> <span class="type">char</span> *propname,</span></span><br><span class="line"><span class="params">			 u64 *out_value)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">const</span> __be32 *val = of_find_property_value_of_size(np, propname,</span><br><span class="line">						<span class="keyword">sizeof</span>(*out_value),</span><br><span class="line">						<span class="number">0</span>,</span><br><span class="line">						<span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (IS_ERR(val))</span><br><span class="line">		<span class="keyword">return</span> PTR_ERR(val);</span><br><span class="line"></span><br><span class="line">	*out_value = of_read_number(val, <span class="number">2</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<p>åœ¨è®¾å¤‡æ ‘ä¸­ï¼ŒèŠ‚ç‚¹å¤§æ¦‚æ˜¯è¿™æ ·ï¼š  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xxx_node &#123;</span><br><span class="line">    name1 = &lt;<span class="number">0x50000000</span>&gt;;</span><br><span class="line">    name2 = &lt;<span class="number">0x50000000</span> <span class="number">0x60000000</span>&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>è°ƒç”¨ of_property_read_u32 (np, â€œname1â€, &amp;val)æ—¶ï¼Œ val å°†å¾—åˆ°å€¼ 0x50000000ï¼›  </p>
<p>è°ƒç”¨ of_property_read_u64 (np, â€œname2â€, &amp;val)æ—¶ï¼Œ val å°†å¾—åˆ°å€¼ 0x6000000050000000ã€‚  </p>
<h4 id="2-3-5-è¯»æŸä¸ªæ•´æ•°-u32"><a href="#2-3-5-è¯»æŸä¸ªæ•´æ•°-u32" class="headerlink" title="2.3.5 è¯»æŸä¸ªæ•´æ•° u32"></a><font size=3>2.3.5 è¯»æŸä¸ªæ•´æ•° u32</font></h4><p> <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/property.c#L98">of_property_read_u32_index()</a>å‡½æ•°ç”¨äºè¯»å–æŸä¸ªu32çš„å€¼ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">of_property_read_u32_index</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *np,</span></span><br><span class="line"><span class="params">				       <span class="type">const</span> <span class="type">char</span> *propname,</span></span><br><span class="line"><span class="params">				       u32 index, u32 *out_value)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">const</span> u32 *val = of_find_property_value_of_size(np, propname,</span><br><span class="line">					((index + <span class="number">1</span>) * <span class="keyword">sizeof</span>(*out_value)),</span><br><span class="line">					<span class="number">0</span>,</span><br><span class="line">					<span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (IS_ERR(val))</span><br><span class="line">		<span class="keyword">return</span> PTR_ERR(val);</span><br><span class="line"></span><br><span class="line">	*out_value = be32_to_cpup(((__be32 *)val) + index);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯¥å‡½æ•°åœ¨è®¾å¤‡æ ‘ä¸­çš„è®¾å¤‡èŠ‚ç‚¹ä¸‹æŸ¥æ‰¾æŒ‡å®šåç§°çš„å±æ€§ï¼Œ å¹¶è·å–è¯¥å±æ€§åœ¨ç»™å®šç´¢å¼•ä½ç½®å¤„çš„u32 ç±»å‹çš„æ•°æ®å€¼ã€‚è¿™ä¸ªå‡½æ•°é€šå¸¸ç”¨äºä»è®¾å¤‡æ ‘å±æ€§ä¸­è¯»å–ç‰¹å®šç´¢å¼•ä½ç½®çš„æ•´æ•°å€¼ã€‚ é€šè¿‡æŒ‡å®šå±æ€§åå’Œç´¢å¼•ï¼Œå¯ä»¥è·å–å±æ€§ä¸­æŒ‡å®šä½ç½®çš„å…·ä½“æ•°å€¼ã€‚  </p>
<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>
<ul>
<li>np: è®¾å¤‡èŠ‚ç‚¹ã€‚</li>
<li>propname: è¦è¯»å–çš„å±æ€§åã€‚</li>
<li>index: è¦è¯»å–çš„å±æ€§å€¼åœ¨å±æ€§ä¸­çš„ç´¢å¼•ï¼Œ ç´¢å¼•ä» 0 å¼€å§‹ã€‚</li>
<li>out_value: ç”¨äºå­˜å‚¨è¯»å–åˆ°çš„å€¼çš„æŒ‡é’ˆã€‚</li>
</ul>
<p><strong>è¿”å›å€¼ï¼š</strong>0 è¯»å–æˆåŠŸï¼Œè´Ÿå€¼ï¼Œè¯»å–å¤±è´¥ï¼Œ -EINVAL è¡¨ç¤ºå±æ€§ä¸å­˜åœ¨ï¼Œ -ENODATA è¡¨ç¤ºæ²¡æœ‰è¦è¯»å–çš„æ•°æ®ï¼Œ -EOVERFLOW è¡¨ç¤ºå±æ€§å€¼åˆ—è¡¨å¤ªå°ã€‚  </p>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<p>åœ¨è®¾å¤‡æ ‘ä¸­ï¼ŒèŠ‚ç‚¹å¤§æ¦‚æ˜¯è¿™æ ·ï¼š  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxx_node &#123;</span><br><span class="line">	name2 = &lt;<span class="number">0x50000000</span> <span class="number">0x60000000</span>&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è°ƒç”¨ of_property_read_u32 (np, â€œname2â€, 1, &amp;val)æ—¶ï¼Œ val å°†å¾—åˆ°å€¼ 0x60000000ã€‚  </p>
<h4 id="2-3-6-è¯»æŸä¸ªæ•´æ•°-u64"><a href="#2-3-6-è¯»æŸä¸ªæ•´æ•°-u64" class="headerlink" title="2.3.6 è¯»æŸä¸ªæ•´æ•° u64"></a><font size=3>2.3.6 è¯»æŸä¸ªæ•´æ•° u64</font></h4><p><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/property.c#L145">of_property_read_u64_index()</a>ç”¨äºè¯»å–æŸä¸ªu64çš„å€¼ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">of_property_read_u64_index</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *np,</span></span><br><span class="line"><span class="params">				       <span class="type">const</span> <span class="type">char</span> *propname,</span></span><br><span class="line"><span class="params">				       u32 index, u64 *out_value)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">const</span> u64 *val = of_find_property_value_of_size(np, propname,</span><br><span class="line">					((index + <span class="number">1</span>) * <span class="keyword">sizeof</span>(*out_value)),</span><br><span class="line">					<span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (IS_ERR(val))</span><br><span class="line">		<span class="keyword">return</span> PTR_ERR(val);</span><br><span class="line"></span><br><span class="line">	*out_value = be64_to_cpup(((__be64 *)val) + index);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯¥å‡½æ•°åœ¨è®¾å¤‡æ ‘ä¸­çš„è®¾å¤‡èŠ‚ç‚¹ä¸‹æŸ¥æ‰¾æŒ‡å®šåç§°çš„å±æ€§ï¼Œ å¹¶è·å–è¯¥å±æ€§åœ¨ç»™å®šç´¢å¼•ä½ç½®å¤„çš„u64 ç±»å‹çš„æ•°æ®å€¼ã€‚è¿™ä¸ªå‡½æ•°é€šå¸¸ç”¨äºä»è®¾å¤‡æ ‘å±æ€§ä¸­è¯»å–ç‰¹å®šç´¢å¼•ä½ç½®çš„ 64 ä½æ•´æ•°å€¼ã€‚ é€šè¿‡æŒ‡å®šå±æ€§åå’Œç´¢å¼•ï¼Œ å¯ä»¥è·å–å±æ€§ä¸­æŒ‡å®šä½ç½®çš„å…·ä½“æ•°å€¼ã€‚    </p>
<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>
<ul>
<li>np: è®¾å¤‡èŠ‚ç‚¹ã€‚</li>
<li>propname: è¦è¯»å–çš„å±æ€§åã€‚</li>
<li>index: è¦è¯»å–çš„å±æ€§å€¼åœ¨å±æ€§ä¸­çš„ç´¢å¼•ï¼Œ ç´¢å¼•ä» 0 å¼€å§‹ã€‚</li>
<li>out_value: ç”¨äºå­˜å‚¨è¯»å–åˆ°çš„å€¼çš„æŒ‡é’ˆã€‚</li>
</ul>
<p><strong>è¿”å›å€¼ï¼š</strong>0 è¯»å–æˆåŠŸï¼Œè´Ÿå€¼ï¼Œè¯»å–å¤±è´¥ï¼Œ -EINVAL è¡¨ç¤ºå±æ€§ä¸å­˜åœ¨ï¼Œ -ENODATA è¡¨ç¤ºæ²¡æœ‰è¦è¯»å–çš„æ•°æ®ï¼Œ -EOVERFLOW è¡¨ç¤ºå±æ€§å€¼åˆ—è¡¨å¤ªå°ã€‚  </p>
<h4 id="2-3-7-è¯»å­—ç¬¦ä¸²"><a href="#2-3-7-è¯»å­—ç¬¦ä¸²" class="headerlink" title="2.3.7 è¯»å­—ç¬¦ä¸²"></a><font size=3>2.3.7 è¯»å­—ç¬¦ä¸²</font></h4><p><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/property.c#L378">of_property_read_string()</a>å‡½æ•°ç”¨äºè¯»å–å±æ€§ä¸­å­—ç¬¦ä¸²å€¼ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">of_property_read_string</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *np, <span class="type">const</span> <span class="type">char</span> *propname,</span></span><br><span class="line"><span class="params">				<span class="type">const</span> <span class="type">char</span> **out_string)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">property</span> *<span class="title">prop</span> =</span> of_find_property(np, propname, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">if</span> (!prop)</span><br><span class="line">		<span class="keyword">return</span> -EINVAL;</span><br><span class="line">	<span class="keyword">if</span> (!prop-&gt;value)</span><br><span class="line">		<span class="keyword">return</span> -ENODATA;</span><br><span class="line">	<span class="keyword">if</span> (strnlen(prop-&gt;value, prop-&gt;length) &gt;= prop-&gt;length)</span><br><span class="line">		<span class="keyword">return</span> -EILSEQ;</span><br><span class="line">	*out_string = prop-&gt;value;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯¥å‡½æ•°åœ¨è®¾å¤‡æ ‘ä¸­çš„è®¾å¤‡èŠ‚ç‚¹ä¸‹æŸ¥æ‰¾æŒ‡å®šåç§°çš„å±æ€§ï¼Œ å¹¶è·å–è¯¥å±æ€§çš„å­—ç¬¦ä¸²å€¼ï¼Œ æœ€åè¿”å›è¯»å–åˆ°çš„å­—ç¬¦ä¸²çš„æŒ‡é’ˆï¼Œ é€šå¸¸ç”¨äºä»è®¾å¤‡æ ‘å±æ€§ä¸­è¯»å–å­—ç¬¦ä¸²å€¼ã€‚ é€šè¿‡æŒ‡å®šå±æ€§åï¼Œ å¯ä»¥è·å–å±æ€§ä¸­çš„å­—ç¬¦ä¸²æ•°æ®ã€‚  </p>
<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>
<ul>
<li>np: è®¾å¤‡èŠ‚ç‚¹ã€‚</li>
<li>propname: è¦è¯»å–çš„å±æ€§åã€‚</li>
<li>out_string: ç”¨äºå­˜å‚¨è¯»å–åˆ°çš„å­—ç¬¦ä¸²çš„æŒ‡é’ˆã€‚</li>
</ul>
<p><strong>è¿”å›å€¼ï¼š</strong>å¦‚æœæˆåŠŸè¯»å–åˆ°äº†æŒ‡å®šå±æ€§çš„å­—ç¬¦ä¸²ï¼Œ åˆ™è¿”å› 0ï¼› å¦‚æœæœªæ‰¾åˆ°å±æ€§æˆ–è¯»å–å¤±è´¥ï¼Œ åˆ™è¿”å›ç›¸åº”çš„é”™è¯¯ç ã€‚  </p>
<h4 id="2-3-8-è¯»è·å–-address-cells"><a href="#2-3-8-è¯»è·å–-address-cells" class="headerlink" title="2.3.8 è¯»è·å–#address-cells  "></a><font size=3>2.3.8 è¯»è·å–#address-cells  </font></h4><p><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/base.c#L81">of_n_addr_cells()</a>å‡½æ•°ç”¨äºè¯»å–#address-cells å±æ€§å€¼ ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">of_n_addr_cells</span><span class="params">(<span class="keyword">struct</span> device_node *np)</span></span><br><span class="line">&#123;</span><br><span class="line">	u32 cells;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">do</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (np-&gt;parent)</span><br><span class="line">			np = np-&gt;parent;</span><br><span class="line">		<span class="keyword">if</span> (!of_property_read_u32(np, <span class="string">&quot;#address-cells&quot;</span>, &amp;cells))</span><br><span class="line">			<span class="keyword">return</span> cells;</span><br><span class="line">	&#125; <span class="keyword">while</span> (np-&gt;parent);</span><br><span class="line">	<span class="comment">/* No #address-cells property for the root node */</span></span><br><span class="line">	<span class="keyword">return</span> OF_ROOT_NODE_ADDR_CELLS_DEFAULT;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>
<ul>
<li>np: è¦æŸ¥æ‰¾çš„èŠ‚ç‚¹ã€‚</li>
</ul>
<p><strong>è¿”å›å€¼ï¼š</strong>è·å–åˆ°çš„#address-cells å±æ€§å€¼ã€‚  </p>
<h4 id="2-3-9-è¯»å–-size-cells"><a href="#2-3-9-è¯»å–-size-cells" class="headerlink" title="2.3.9 è¯»å–#size-cells  "></a><font size=3>2.3.9 è¯»å–#size-cells  </font></h4><p><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/base.c#L96">of_n_size_cells()</a>ç”¨äºè¯»å–#size-cells å±æ€§å€¼ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">of_n_size_cells</span><span class="params">(<span class="keyword">struct</span> device_node *np)</span></span><br><span class="line">&#123;</span><br><span class="line">	u32 cells;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">do</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (np-&gt;parent)</span><br><span class="line">			np = np-&gt;parent;</span><br><span class="line">		<span class="keyword">if</span> (!of_property_read_u32(np, <span class="string">&quot;#size-cells&quot;</span>, &amp;cells))</span><br><span class="line">			<span class="keyword">return</span> cells;</span><br><span class="line">	&#125; <span class="keyword">while</span> (np-&gt;parent);</span><br><span class="line">	<span class="comment">/* No #size-cells property for the root node */</span></span><br><span class="line">	<span class="keyword">return</span> OF_ROOT_NODE_SIZE_CELLS_DEFAULT;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>
<ul>
<li>np: è¦æŸ¥æ‰¾çš„èŠ‚ç‚¹ã€‚</li>
</ul>
<p><strong>è¿”å›å€¼ï¼š</strong>è·å–åˆ°çš„#size-cells å±æ€§å€¼ã€‚  </p>
<h3 id="2-4-å…¶ä»–å‡½æ•°"><a href="#2-4-å…¶ä»–å‡½æ•°" class="headerlink" title="2.4 å…¶ä»–å‡½æ•°"></a><font size=3>2.4 å…¶ä»–å‡½æ•°</font></h3><h4 id="2-4-1-of-device-is-compatible"><a href="#2-4-1-of-device-is-compatible" class="headerlink" title="2.4.1 of_device_is_compatible()  "></a><font size=3>2.4.1 <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/base.c#L541">of_device_is_compatible()</a>  </font></h4><p><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/base.c#L541">of_device_is_compatible()</a> ç”¨äºå‡½æ•°ç”¨äºæŸ¥çœ‹èŠ‚ç‚¹çš„ compatible å±æ€§æ˜¯å¦æœ‰åŒ…å« compat æŒ‡å®šçš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯æ£€æŸ¥è®¾å¤‡èŠ‚ç‚¹çš„å…¼å®¹æ€§ :</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">of_device_is_compatible</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *device,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> <span class="type">char</span> *compat)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> flags;</span><br><span class="line">	<span class="type">int</span> res;</span><br><span class="line"></span><br><span class="line">	raw_spin_lock_irqsave(&amp;devtree_lock, flags);</span><br><span class="line">	res = __of_device_is_compatible(device, compat, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">	raw_spin_unlock_irqrestore(&amp;devtree_lock, flags);</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>
<ul>
<li>deviceï¼šè®¾å¤‡èŠ‚ç‚¹ã€‚</li>
<li>compatï¼šè¦æŸ¥çœ‹çš„å­—ç¬¦ä¸²ã€‚</li>
</ul>
<p><strong>è¿”å›å€¼ï¼š</strong>0ï¼ŒèŠ‚ç‚¹çš„ compatible å±æ€§ä¸­ä¸åŒ…å« compat æŒ‡å®šçš„å­—ç¬¦ä¸²ï¼› æ­£æ•°ï¼ŒèŠ‚ç‚¹çš„ compatibleå±æ€§ä¸­åŒ…å« compat æŒ‡å®šçš„å­—ç¬¦ä¸²ã€‚    </p>
<h4 id="2-4-2-of-get-address"><a href="#2-4-2-of-get-address" class="headerlink" title="2.4.2 of_get_address() "></a><font size=3>2.4.2 <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/address.c#L694">of_get_address()</a> </font></h4><p><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/address.c#L694">of_get_address()</a>ç”¨äºå‡½æ•°ç”¨äºè·å–åœ°å€ç›¸å…³å±æ€§ï¼Œä¸»è¦æ˜¯â€œregâ€æˆ–è€…â€œassigned-addressesâ€å±æ€§å€¼ :</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> __be32 *<span class="title function_">of_get_address</span><span class="params">(<span class="keyword">struct</span> device_node *dev, <span class="type">int</span> index, u64 *size,</span></span><br><span class="line"><span class="params">		    <span class="type">unsigned</span> <span class="type">int</span> *flags)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>
<ul>
<li>devï¼šè®¾å¤‡èŠ‚ç‚¹ã€‚</li>
<li>indexï¼šè¦è¯»å–çš„åœ°å€æ ‡å·ã€‚</li>
<li>sizeï¼šåœ°å€é•¿åº¦ã€‚</li>
<li>flagsï¼šå‚æ•°ï¼Œæ¯”å¦‚ IORESOURCE_IOã€ IORESOURCE_MEM ç­‰</li>
</ul>
<p><strong>è¿”å›å€¼ï¼š</strong>è¯»å–åˆ°çš„åœ°å€æ•°æ®é¦–åœ°å€ï¼Œä¸º NULL çš„è¯è¡¨ç¤ºè¯»å–å¤±è´¥ã€‚  </p>
<h4 id="2-4-3-of-translate-address"><a href="#2-4-3-of-translate-address" class="headerlink" title="2.4.3 of_translate_address()"></a><font size=3>2.4.3 <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/address.c#L663">of_translate_address()</a></font></h4><p><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/address.c#L663">of_translate_address()</a>ç”¨äºå‡½æ•°è´Ÿè´£å°†ä»è®¾å¤‡æ ‘è¯»å–åˆ°çš„åœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">u64 <span class="title function_">of_translate_address</span><span class="params">(<span class="keyword">struct</span> device_node *dev, <span class="type">const</span> __be32 *in_addr)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">device_node</span> *<span class="title">host</span>;</span></span><br><span class="line">	u64 ret;</span><br><span class="line"></span><br><span class="line">	ret = __of_translate_address(dev, in_addr, <span class="string">&quot;ranges&quot;</span>, &amp;host);</span><br><span class="line">	<span class="keyword">if</span> (host) &#123;</span><br><span class="line">		of_node_put(host);</span><br><span class="line">		<span class="keyword">return</span> OF_BAD_ADDR;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>
<ul>
<li>devï¼šè®¾å¤‡èŠ‚ç‚¹ã€‚</li>
<li>in_addrï¼šè¦è½¬æ¢çš„åœ°å€ã€‚</li>
</ul>
<p><strong>è¿”å›å€¼ï¼š</strong>å¾—åˆ°çš„ç‰©ç†åœ°å€ï¼Œå¦‚æœä¸º OF_BAD_ADDR çš„è¯è¡¨ç¤ºè½¬æ¢å¤±è´¥ã€‚  </p>
<h4 id="2-4-4-of-address-to-resource"><a href="#2-4-4-of-address-to-resource" class="headerlink" title="2.4.4 of_address_to_resource()"></a><font size=3>2.4.4 <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/address.c#L780">of_address_to_resource()</a></font></h4><p><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/address.c#L780">of_address_to_resource()</a>å‡½æ•°çœ‹åå­—åƒæ˜¯ä»è®¾å¤‡æ ‘é‡Œé¢æå–èµ„æºå€¼ï¼Œä½†æ˜¯æœ¬è´¨ä¸Šå°±æ˜¯å°† reg å±æ€§å€¼ï¼Œç„¶åå°†å…¶è½¬æ¢ä¸º resource ç»“æ„ä½“ç±»å‹ï¼š  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">of_address_to_resource</span><span class="params">(<span class="keyword">struct</span> device_node *dev, <span class="type">int</span> index,</span></span><br><span class="line"><span class="params">			   <span class="keyword">struct</span> resource *r)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">const</span> __be32	*addrp;</span><br><span class="line">	u64		size;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span>	flags;</span><br><span class="line">	<span class="type">const</span> <span class="type">char</span>	*name = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	addrp = of_get_address(dev, index, &amp;size, &amp;flags);</span><br><span class="line">	<span class="keyword">if</span> (addrp == <span class="literal">NULL</span>)</span><br><span class="line">		<span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Get optional &quot;reg-names&quot; property to add a name to a resource */</span></span><br><span class="line">	of_property_read_string_index(dev, <span class="string">&quot;reg-names&quot;</span>,	index, &amp;name);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> __of_address_to_resource(dev, addrp, size, flags, name, r);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>
<ul>
<li>devï¼šè®¾å¤‡èŠ‚ç‚¹ã€‚</li>
<li>indexï¼šåœ°å€èµ„æºæ ‡å·ã€‚</li>
<li>rï¼šå¾—åˆ°çš„ resource ç±»å‹çš„èµ„æºå€¼ã€‚</li>
</ul>
<p><strong>è¿”å›å€¼ï¼š</strong>0ï¼ŒæˆåŠŸï¼›è´Ÿå€¼ï¼Œå¤±è´¥ã€‚    </p>
<details class="folding-tag" blue><summary> å…³äºresource </summary>
              <div class='content'>
              <p>IICã€ SPIã€ GPIO ç­‰è¿™äº›å¤–è®¾éƒ½æœ‰å¯¹åº”çš„å¯„å­˜å™¨ï¼Œè¿™äº›å¯„å­˜å™¨å…¶å®å°±æ˜¯ä¸€ç»„å†…å­˜ç©ºé—´ï¼Œ Linuxå†…æ ¸ä½¿ç”¨ resource ç»“æ„ä½“æ¥æè¿°ä¸€æ®µå†…å­˜ç©ºé—´ï¼Œâ€œresourceâ€ç¿»è¯‘å‡ºæ¥å°±æ˜¯â€œèµ„æºâ€ï¼Œå› æ­¤ç”¨ resourceç»“æ„ä½“æè¿°çš„éƒ½æ˜¯è®¾å¤‡èµ„æºä¿¡æ¯ï¼Œresource ç»“æ„ä½“å®šä¹‰åœ¨æ–‡ä»¶ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/ioport.h#L19">ioport.h - include&#x2F;linux&#x2F;ioport.h</a>ä¸­ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">resource</span> &#123;</span></span><br><span class="line">	<span class="type">resource_size_t</span> start;</span><br><span class="line">	<span class="type">resource_size_t</span> end;</span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *name;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> flags;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> desc;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">resource</span> *<span class="title">parent</span>, *<span class="title">sibling</span>, *<span class="title">child</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¯¹äº 32 ä½çš„ SOC æ¥è¯´ï¼Œ resource_size_t æ˜¯ u32 ç±»å‹çš„ã€‚å…¶ä¸­ start è¡¨ç¤ºå¼€å§‹åœ°å€ï¼Œ end è¡¨ç¤ºç»“æŸåœ°å€ï¼Œ name æ˜¯è¿™ä¸ªèµ„æºçš„åå­—ï¼Œ flags æ˜¯èµ„æºæ ‡å¿—ä½ï¼Œä¸€èˆ¬è¡¨ç¤ºèµ„æºç±»å‹ï¼Œå¯é€‰çš„èµ„æºæ ‡å¿—å®šä¹‰åœ¨æ–‡ä»¶ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/ioport.h#L29">ioport.h - include&#x2F;linux&#x2F;ioport.h</a> ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤º  </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> IORESOURCE_BITS		0x000000ff	<span class="comment">/* Bus-specific bits */</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IORESOURCE_TYPE_BITS	0x00001f00	<span class="comment">/* Resource type */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IORESOURCE_IO		0x00000100	<span class="comment">/* PCI/ISA I/O ports */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IORESOURCE_MEM		0x00000200</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IORESOURCE_REG		0x00000300	<span class="comment">/* Register offsets */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IORESOURCE_IRQ		0x00000400</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IORESOURCE_DMA		0x00000800</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IORESOURCE_BUS		0x00001000</span></span><br><span class="line"><span class="comment">//......</span></span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬æœ€å¸¸è§çš„èµ„æºæ ‡å¿—å°±æ˜¯ IORESOURCE_MEM ã€ IORESOURCE_REG å’ŒIORESOURCE_IRQ ç­‰ã€‚  </p>
              </div>
            </details>

<h4 id="2-4-5-of-iomap"><a href="#2-4-5-of-iomap" class="headerlink" title="2.4.5 of_iomap()"></a><font size=3>2.4.5 <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/address.c#L826">of_iomap()</a></font></h4><p><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/address.c#L826">of_iomap()</a>å‡½æ•°ç”¨äºç›´æ¥å†…å­˜æ˜ å°„ï¼Œä»¥å‰æˆ‘ä»¬ä¼šé€šè¿‡ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/arch/arm/include/asm/io.h#L400">ioremap()</a> å‡½æ•°æ¥å®Œæˆç‰©ç†åœ°å€åˆ°è™šæ‹Ÿåœ°å€çš„æ˜ å°„ï¼Œé‡‡ç”¨è®¾å¤‡æ ‘ä»¥åå°±å¯ä»¥ç›´æ¥é€šè¿‡ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/address.c#L826">of_iomap()</a> å‡½æ•°æ¥è·å–å†…å­˜åœ°å€æ‰€å¯¹åº”çš„è™šæ‹Ÿåœ°å€ï¼Œä¸éœ€è¦ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/arch/arm/include/asm/io.h#L400">ioremap()</a> å‡½æ•°äº†ã€‚å½“ç„¶äº†ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/arch/arm/include/asm/io.h#L400">ioremap()</a> å‡½æ•°æ¥å®Œæˆç‰©ç†åœ°å€åˆ°è™šæ‹Ÿåœ°å€çš„å†…å­˜æ˜ å°„ï¼Œåªæ˜¯åœ¨é‡‡ç”¨è®¾å¤‡æ ‘ä»¥åï¼Œå¤§éƒ¨åˆ†çš„é©±åŠ¨éƒ½ä½¿ç”¨  <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/address.c#L826">of_iomap()</a> å‡½æ•°äº†ã€‚  <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/address.c#L826">of_iomap()</a> å‡½æ•°æœ¬è´¨ä¸Šä¹Ÿæ˜¯å°† reg å±æ€§ä¸­åœ°å€ä¿¡æ¯è½¬æ¢ä¸ºè™šæ‹Ÿåœ°å€ï¼Œå¦‚æœ reg å±æ€§æœ‰å¤šæ®µçš„è¯ï¼Œå¯ä»¥é€šè¿‡ index å‚æ•°æŒ‡å®šè¦å®Œæˆå†…å­˜æ˜ å°„çš„æ˜¯å“ªä¸€æ®µï¼Œ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/address.c#L826">of_iomap()</a> å‡½æ•°åŸå‹å¦‚ä¸‹  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __iomem *<span class="title function_">of_iomap</span><span class="params">(<span class="keyword">struct</span> device_node *np, <span class="type">int</span> index)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">resource</span> <span class="title">res</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (of_address_to_resource(np, index, &amp;res))</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> ioremap(res.start, resource_size(&amp;res));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>
<ul>
<li>npï¼šè®¾å¤‡èŠ‚ç‚¹ã€‚</li>
<li>indexï¼š reg å±æ€§ä¸­è¦å®Œæˆå†…å­˜æ˜ å°„çš„æ®µï¼Œå¦‚æœ reg å±æ€§åªæœ‰ä¸€æ®µçš„è¯, index å°±è®¾ç½®ä¸º 0ã€‚</li>
</ul>
<p><strong>è¿”å›å€¼ï¼š</strong>ç»è¿‡å†…å­˜æ˜ å°„åçš„è™šæ‹Ÿå†…å­˜é¦–åœ°å€ï¼Œå¦‚æœä¸º NULL çš„è¯è¡¨ç¤ºå†…å­˜æ˜ å°„å¤±è´¥ã€‚  </p>
<h2 id="3-platform-device-ç›¸å…³çš„å‡½æ•°"><a href="#3-platform-device-ç›¸å…³çš„å‡½æ•°" class="headerlink" title="3.Â platform_device ç›¸å…³çš„å‡½æ•°  "></a><font size=3>3.Â platform_device ç›¸å…³çš„å‡½æ•°  </font></h2><p>æˆ‘ä»¬çŸ¥é“ï¼Œè®¾å¤‡æ ‘çš„èŠ‚ç‚¹æœ‰ä¸€äº›ä¼šè½¬åŒ–æˆplatform_deviceï¼Œé’ˆå¯¹è¿™ç§ç±»å‹çš„èŠ‚ç‚¹ï¼Œä¹Ÿæœ‰å‡ ä¸ªç›¸å…³çš„å‡½æ•°ã€‚</p>
<h3 id="3-1-of-find-device-by-node"><a href="#3-1-of-find-device-by-node" class="headerlink" title="3.1Â of_find_device_by_node()"></a><font size=3>3.1Â <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/of/platform.c#L45">of_find_device_by_node()</a></font></h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> platform_device *<span class="title function_">of_find_device_by_node</span><span class="params">(<span class="keyword">struct</span> device_node *np)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">device</span> *<span class="title">dev</span>;</span></span><br><span class="line"></span><br><span class="line">	dev = bus_find_device(&amp;platform_bus_type, <span class="literal">NULL</span>, np, of_dev_node_match);</span><br><span class="line">	<span class="keyword">return</span> dev ? to_platform_device(dev) : <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL(of_find_device_by_node);</span><br></pre></td></tr></table></figure>

<p>è®¾å¤‡æ ‘ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåœ¨å†…æ ¸é‡Œéƒ½æœ‰ä¸€ä¸ª device_nodeï¼›æˆ‘ä»¬å¯ä»¥ä½¿ç”¨device_node å»æ‰¾åˆ°å¯¹åº”çš„ platform_deviceã€‚  </p>
<h3 id="3-2-platform-get-resource"><a href="#3-2-platform-get-resource" class="headerlink" title="3.2Â platform_get_resource()"></a><font size=3>3.2Â <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/base/platform.c#L60">platform_get_resource()</a></font></h3><p>è¿™ä¸ªå‡½æ•°è·Ÿè®¾å¤‡æ ‘æ²¡ä»€ä¹ˆå…³ç³»ï¼Œä½†æ˜¯è®¾å¤‡æ ‘ä¸­çš„èŠ‚ç‚¹è¢«è½¬æ¢ä¸ºplatform_device åï¼Œè®¾å¤‡æ ‘ä¸­çš„ reg å±æ€§ã€ interrupts å±æ€§ä¹Ÿä¼šè¢«è½¬æ¢ä¸ºâ€œ resourceâ€ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªå‡½æ•°è·å–è¿™äº›èµ„æºï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> resource *<span class="title function_">platform_get_resource</span><span class="params">(<span class="keyword">struct</span> platform_device *dev,</span></span><br><span class="line"><span class="params">				       <span class="type">unsigned</span> <span class="type">int</span> type, <span class="type">unsigned</span> <span class="type">int</span> num)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; dev-&gt;num_resources; i++) &#123;</span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">resource</span> *<span class="title">r</span> =</span> &amp;dev-&gt;resource[i];</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (type == resource_type(r) &amp;&amp; num-- == <span class="number">0</span>)</span><br><span class="line">			<span class="keyword">return</span> r;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL_GPL(platform_get_resource);</span><br></pre></td></tr></table></figure>

<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>
<ul>
<li>devï¼šstruct platform_deviceç±»å‹æŒ‡é’ˆï¼ŒåŒ…å«äº†è®¾å¤‡æ ‘èŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯ã€‚</li>
<li>typeï¼šèµ„æºçš„ç±»å‹ï¼ŒIORESOURCE_MEMã€ IORESOURCE_REGã€IORESOURCE_IRQ ç­‰  </li>
<li>numï¼šè¿™ç±»èµ„æºä¸­çš„å“ªä¸€ä¸ªã€‚</li>
</ul>
<p>å¯¹äºè®¾å¤‡æ ‘èŠ‚ç‚¹ä¸­çš„ reg å±æ€§ï¼Œå®ƒå¯¹åº” IORESOURCE_MEM ç±»å‹çš„èµ„æºï¼›å¯¹äºè®¾å¤‡æ ‘èŠ‚ç‚¹ä¸­çš„ interrupts å±æ€§ï¼Œå®ƒå¯¹åº”IORESOURCE_IRQ ç±»å‹çš„èµ„æºã€‚  </p>
<h1 id="äºŒã€ofå‡½æ•°ä½¿ç”¨å®ä¾‹"><a href="#äºŒã€ofå‡½æ•°ä½¿ç”¨å®ä¾‹" class="headerlink" title="äºŒã€ofå‡½æ•°ä½¿ç”¨å®ä¾‹"></a><font size=3>äºŒã€ofå‡½æ•°ä½¿ç”¨å®ä¾‹</font></h1><h2 id="1-è®¾å¤‡æ ‘èŠ‚ç‚¹å‡†å¤‡"><a href="#1-è®¾å¤‡æ ‘èŠ‚ç‚¹å‡†å¤‡" class="headerlink" title="1. è®¾å¤‡æ ‘èŠ‚ç‚¹å‡†å¤‡"></a><font size=3>1. è®¾å¤‡æ ‘èŠ‚ç‚¹å‡†å¤‡</font></h2><p>è¿™é‡Œå¯ä»¥åœ¨è®¾å¤‡æ ‘ä¸­æ·»åŠ è¿™æ ·ä¸€ä¸ªèŠ‚ç‚¹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">alpha &#123;</span><br><span class="line">    <span class="meta">#address-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">    <span class="meta">#size-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">    compatible = <span class="string">&quot;simple-bus&quot;</span>;</span><br><span class="line"></span><br><span class="line">    sdev_led &#123;</span><br><span class="line">        <span class="meta">#address-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">        <span class="meta">#size-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">        compatible = <span class="string">&quot;led&quot;</span>;</span><br><span class="line">        status = <span class="string">&quot;okay&quot;</span>;</span><br><span class="line">        reg = &lt; <span class="number">0X020C406C</span> <span class="number">0X04</span> <span class="comment">/* CCM_CCGR1_BASE */</span></span><br><span class="line">                <span class="number">0X020E0068</span> <span class="number">0X04</span> <span class="comment">/* SW_MUX_GPIO1_IO03_BASE */</span></span><br><span class="line">                <span class="number">0X020E02F4</span> <span class="number">0X04</span> <span class="comment">/* SW_PAD_GPIO1_IO03_BASE */</span></span><br><span class="line">                <span class="number">0X0209C000</span> <span class="number">0X04</span> <span class="comment">/* GPIO1_DR_BASE */</span></span><br><span class="line">                <span class="number">0X0209C004</span> <span class="number">0X04</span> &gt;; <span class="comment">/* GPIO1_GDIR_BASE */</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†é¿å…#address-cells &#x3D; &lt;1&gt;; å’Œ #size-cells &#x3D; &lt;1&gt;;è¿™ä¸¤ä¸ªå±æ€§æ”¹å˜æ ¹èŠ‚ç‚¹å…¶ä»–çš„èŠ‚ç‚¹çš„å±æ€§ï¼Œ æ‰€ä»¥åœ¨è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ª alpha èŠ‚ç‚¹ã€‚ åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ #address-cells è®¾ç½®ä¸º 1 è¡¨ç¤ºåœ°å€ä½¿ç”¨ä¸€ä¸ª 32 ä½çš„å•å…ƒï¼Œ #size-cells ä¹Ÿè®¾ç½®ä¸º 1 è¡¨ç¤ºå¤§å°ä½¿ç”¨ä¸€ä¸ª 32 ä½çš„å•å…ƒã€‚  </p>
<p>ç¬¬ 4 è¡Œï¼š å°† compatible å±æ€§è®¾ç½®ä¸ºâ€simple-busâ€ç”¨äºè¡¨ç¤º alpha èŠ‚ç‚¹çš„å…¼å®¹æ€§ï¼Œ æŒ‡æ˜å®ƒæ˜¯ä¸€ä¸ªç®€å•æ€»çº¿è®¾å¤‡ï¼Œ åœ¨è½¬æ¢ platform_device çš„è¿‡ç¨‹ä¸­ï¼Œ ä¼šç»§ç»­æŸ¥æ‰¾è¯¥èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ã€‚  </p>
<p>ç¬¬ 9 è¡Œï¼š sdev_led èŠ‚ç‚¹ä¸‹çš„ compatible å±æ€§ä¸ºâ€ledâ€ï¼Œ è¡¨æ˜è¯¥èŠ‚ç‚¹å°†ä¼šè¢«è½¬æ¢ä¸º platform_deviceã€‚</p>
<p>ç¬¬ 11 è¡Œï¼š è¿™ä¸ªå±æ€§ç”¨äºæè¿° sdev_led èŠ‚ç‚¹çš„å¯„å­˜å™¨ä¿¡æ¯ã€‚å¯ä»¥çœ‹åˆ°æœ‰5ä¸ªå¯„å­˜å™¨ ã€‚</p>
<p>è¿™ä¸ªèŠ‚ç‚¹åœ¨ç¼–è¯‘çš„æ—¶å€™æŠ¥è­¦å‘Šï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ä»€ä¹ˆå¤ªå¤§å½±å“ï¼Œè¿™é‡Œå¯ä»¥å…ˆä¸ç®¡ï¼š</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-04-%E8%AE%BE%E5%A4%87%E6%A0%91%E7%9A%84%E5%BA%94%E7%94%A8/img/image-20250309161117557.png" alt="image-20250309161117557" />

<p>æˆ‘ä»¬ä¹‹å‰ç”¨çš„æ˜¯ä»tftpä¸‹è½½è®¾å¤‡æ ‘ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥æ›¿æ¢æœåŠ¡å™¨ä¸­çš„è®¾å¤‡æ ‘æ–‡ä»¶å³å¯ï¼Œç„¶åé‡å¯è®¾å¤‡ï¼Œçœ‹ä¸€ä¸‹èŠ‚ç‚¹æƒ…å†µï¼š</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-04-%E8%AE%BE%E5%A4%87%E6%A0%91%E7%9A%84%E5%BA%94%E7%94%A8/img/image-20250309161625812.png" alt="image-20250309161625812" />

<h2 id="2-ofè·å–è®¾å¤‡èŠ‚ç‚¹å®ä¾‹"><a href="#2-ofè·å–è®¾å¤‡èŠ‚ç‚¹å®ä¾‹" class="headerlink" title="2. ofè·å–è®¾å¤‡èŠ‚ç‚¹å®ä¾‹"></a><font size=3>2. ofè·å–è®¾å¤‡èŠ‚ç‚¹å®ä¾‹</font></h2><h3 id="2-1-demoæºç "><a href="#2-1-demoæºç " class="headerlink" title="2.1 demoæºç "></a><font size=3>2.1 demoæºç </font></h3><p>æºç å¯ä»¥çœ‹è¿™é‡Œï¼š<a target="_blank" rel="noopener" href="https://gitee.com/sumumm/imx6ull-driver-demo/blob/master/11_device_tree/02_of_get_node/drivers_demo/sdriver_demo.c">11_device_tree&#x2F;02_of_get_node&#x2F;drivers_demo&#x2F;sdriver_demo.c Â· è‹æœ¨&#x2F;imx6ull-driver-demo - ç äº‘ - å¼€æºä¸­å›½</a>ä¸­çš„å‡½æ•°<a target="_blank" rel="noopener" href="https://gitee.com/sumumm/imx6ull-driver-demo/blob/master/11_device_tree/02_of_get_node/drivers_demo/sdriver_demo.c#L73">of_get_node_test(void)</a>ã€‚</p>
<h3 id="2-2-å¼€å‘æ¿æµ‹è¯•"><a href="#2-2-å¼€å‘æ¿æµ‹è¯•" class="headerlink" title="2.2 å¼€å‘æ¿æµ‹è¯•"></a><font size=3>2.2 å¼€å‘æ¿æµ‹è¯•</font></h3><p>æˆ‘ä»¬åŠ è½½é©±åŠ¨ï¼Œä¼šçœ‹åˆ°å¦‚ä¸‹æ‰“å°ä¿¡æ¯ï¼š</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-04-%E8%AE%BE%E5%A4%87%E6%A0%91%E7%9A%84%E5%BA%94%E7%94%A8/img/image-20250309162949432.png" alt="image-20250309162949432" />

<h2 id="3-ofè·å–è®¾å¤‡èŠ‚ç‚¹å±æ€§å®ä¾‹"><a href="#3-ofè·å–è®¾å¤‡èŠ‚ç‚¹å±æ€§å®ä¾‹" class="headerlink" title="3. ofè·å–è®¾å¤‡èŠ‚ç‚¹å±æ€§å®ä¾‹"></a><font size=3>3. ofè·å–è®¾å¤‡èŠ‚ç‚¹å±æ€§å®ä¾‹</font></h2><h3 id="3-1-demoæºç "><a href="#3-1-demoæºç " class="headerlink" title="3.1 demoæºç "></a><font size=3>3.1 demoæºç </font></h3><p>æºç å¯ä»¥çœ‹è¿™é‡Œï¼š<a target="_blank" rel="noopener" href="https://gitee.com/sumumm/imx6ull-driver-demo/blob/master/11_device_tree/02_of_get_node/drivers_demo/sdriver_demo.c">11_device_tree&#x2F;02_of_get_node&#x2F;drivers_demo&#x2F;sdriver_demo.c Â· è‹æœ¨&#x2F;imx6ull-driver-demo - ç äº‘ - å¼€æºä¸­å›½</a>ä¸­çš„å‡½æ•°<a target="_blank" rel="noopener" href="https://gitee.com/sumumm/imx6ull-driver-demo/blob/master/11_device_tree/02_of_get_node/drivers_demo/sdriver_demo.c#L117">of_get_node_property_test(void)</a>ã€‚</p>
<h3 id="3-2-å¼€å‘æ¿æµ‹è¯•"><a href="#3-2-å¼€å‘æ¿æµ‹è¯•" class="headerlink" title="3.2 å¼€å‘æ¿æµ‹è¯•"></a><font size=3>3.2 å¼€å‘æ¿æµ‹è¯•</font></h3><p>æˆ‘ä»¬åŠ è½½é©±åŠ¨ï¼Œä¼šçœ‹åˆ°å¦‚ä¸‹æ‰“å°ä¿¡æ¯ï¼š</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-04-%E8%AE%BE%E5%A4%87%E6%A0%91%E7%9A%84%E5%BA%94%E7%94%A8/img/image-20250309164449464.png" alt="image-20250309164449464"  />

<h2 id="4-ledå®ä¾‹"><a href="#4-ledå®ä¾‹" class="headerlink" title="4. ledå®ä¾‹"></a><font size=3>4. ledå®ä¾‹</font></h2><p>ä¸Šé¢å·²ç»å¯ä»¥ä»è®¾å¤‡æ ‘è·å–å¯¹åº”çš„èŠ‚ç‚¹å’Œå±æ€§äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥å†™ä¸€ä¸ªledç¯çš„demoï¼Œå¯ä»¥çœ‹è¿™é‡Œï¼š<a target="_blank" rel="noopener" href="https://gitee.com/sumumm/imx6ull-driver-demo/tree/master/11_device_tree/03_dts_led">11_device_tree&#x2F;03_dts_led Â· è‹æœ¨&#x2F;imx6ull-driver-demo - ç äº‘ - å¼€æºä¸­å›½</a>ã€‚</p>
<h1 id="ä¸‰ã€è®¾å¤‡æ ‘ä¸‹çš„å¹³å°è®¾å¤‡é©±åŠ¨"><a href="#ä¸‰ã€è®¾å¤‡æ ‘ä¸‹çš„å¹³å°è®¾å¤‡é©±åŠ¨" class="headerlink" title="ä¸‰ã€è®¾å¤‡æ ‘ä¸‹çš„å¹³å°è®¾å¤‡é©±åŠ¨"></a><font size=3>ä¸‰ã€è®¾å¤‡æ ‘ä¸‹çš„å¹³å°è®¾å¤‡é©±åŠ¨</font></h1><p>å‰é¢æˆ‘ä»¬å­¦ä¹ äº†ä» device_node åˆ° platform_device çš„è½¬æ¢æµç¨‹ï¼Œ è½¬æ¢å®Œæˆä¹‹åæ“ä½œç³»ç»Ÿæ‰èƒ½å¤Ÿè¯†åˆ«å’Œç®¡ç†è®¾å¤‡ï¼Œ ä»è€Œä¸ platform_driver è¿›è¡ŒåŒ¹é… ã€‚è¿™é‡Œæˆ‘ä»¬å°±æ¥å­¦ä¹ ä¸€ä¸‹å§ã€‚</p>
<h2 id="1-platform-device-å¦‚ä½•ä¸-platform-driver-é…å¯¹"><a href="#1-platform-device-å¦‚ä½•ä¸-platform-driver-é…å¯¹" class="headerlink" title="1.Â platform_device å¦‚ä½•ä¸ platform_driver é…å¯¹  "></a><font size=3>1.Â platform_device å¦‚ä½•ä¸ platform_driver é…å¯¹  </font></h2><p>ä»è®¾å¤‡æ ‘è½¬æ¢å¾—æ¥çš„ platform_device ä¼šè¢«æ³¨å†Œè¿›å†…æ ¸é‡Œï¼Œä»¥åå½“æˆ‘ä»¬æ¯æ³¨å†Œä¸€ä¸ª platform_driver æ—¶ï¼Œå®ƒä»¬å°±ä¼šä¸¤ä¸¤ç¡®å®šèƒ½å¦é…å¯¹ï¼Œå¦‚æœèƒ½é…å¯¹æˆåŠŸå°±è°ƒç”¨ platform_driver çš„ probe å‡½æ•°ã€‚ ï¼ˆè¿™é‡Œå…·ä½“å¯ä»¥çœ‹ã€ŠLV06-05-linuxå¹³å°æ€»çº¿æ¨¡å‹-03-å¹³å°æ€»çº¿çš„åŒ¹é….mdã€‹ï¼‰</p>
<p>è¿™é‡Œæˆ‘ä»¬ç®€å•å›é¡¾ä¸€ä¸‹ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/base/platform.c#L950">platform_match()</a>å‡½æ•°ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">platform_match</span><span class="params">(<span class="keyword">struct</span> device *dev, <span class="keyword">struct</span> device_driver *drv)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">platform_device</span> *<span class="title">pdev</span> =</span> to_platform_device(dev);</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">platform_driver</span> *<span class="title">pdrv</span> =</span> to_platform_driver(drv);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* ï¼ˆ1ï¼‰When driver_override is set, only bind to the matching driver */</span></span><br><span class="line">	<span class="keyword">if</span> (pdev-&gt;driver_override)</span><br><span class="line">		<span class="keyword">return</span> !<span class="built_in">strcmp</span>(pdev-&gt;driver_override, drv-&gt;name);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* ï¼ˆ2ï¼‰Attempt an OF style match first */</span></span><br><span class="line">	<span class="keyword">if</span> (of_driver_match_device(dev, drv))</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Then try ACPI style match */</span></span><br><span class="line">	<span class="keyword">if</span> (acpi_driver_match_device(dev, drv))</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* ï¼ˆ3ï¼‰Then try to match against the id table */</span></span><br><span class="line">	<span class="keyword">if</span> (pdrv-&gt;id_table)</span><br><span class="line">		<span class="keyword">return</span> platform_match_id(pdrv-&gt;id_table, pdev) != <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* ï¼ˆ4ï¼‰fall-back to driver name match */</span></span><br><span class="line">	<span class="keyword">return</span> (<span class="built_in">strcmp</span>(pdev-&gt;name, drv-&gt;name) == <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-1-å¼ºåˆ¶é€‰æ‹©é©±åŠ¨"><a href="#1-1-å¼ºåˆ¶é€‰æ‹©é©±åŠ¨" class="headerlink" title="1.1 å¼ºåˆ¶é€‰æ‹©é©±åŠ¨"></a><font size=3>1.1 å¼ºåˆ¶é€‰æ‹©é©±åŠ¨</font></h3><ul>
<li>ï¼ˆ1ï¼‰æœ€å…ˆæ¯”è¾ƒï¼šæ˜¯å¦å¼ºåˆ¶é€‰æ‹©æŸä¸ª driver ã€‚ï¼ˆæ¯”è¾ƒ platform_device.driver_override å’Œ platform_driver.driver.nameï¼‰</li>
</ul>
<p>å¯ä»¥è®¾ç½® platform_device çš„ driver_overrideï¼Œå¼ºåˆ¶é€‰æ‹©æŸä¸ª platform_driverã€‚ </p>
<h3 id="1-2-è®¾å¤‡æ ‘åŒ¹é…"><a href="#1-2-è®¾å¤‡æ ‘åŒ¹é…" class="headerlink" title="1.2 è®¾å¤‡æ ‘åŒ¹é…"></a><font size=3>1.2 è®¾å¤‡æ ‘åŒ¹é…</font></h3><ul>
<li>ï¼ˆ2ï¼‰è®¾å¤‡æ ‘ä¿¡æ¯ã€‚ï¼ˆæ¯”è¾ƒplatform_device.dev.of_node å’Œ platform_driver.driver.of_match_tableï¼‰</li>
</ul>
<p>ç”±è®¾å¤‡æ ‘èŠ‚ç‚¹è½¬æ¢å¾—æ¥çš„ platform_device ä¸­ï¼Œå«æœ‰ä¸€ä¸ªç»“æ„ä½“ï¼š of_nodeã€‚å®ƒçš„ç±»å‹ä¸º<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/of.h#L51">struct device_node</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">device_node</span> &#123;</span></span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *name; <span class="comment">// èŠ‚ç‚¹çš„nameå±æ€§</span></span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *type; <span class="comment">// èŠ‚ç‚¹çš„device_typeå±æ€§</span></span><br><span class="line">	phandle phandle;</span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *full_name;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">fwnode_handle</span> <span class="title">fwnode</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">struct</span>	<span class="title">property</span> *<span class="title">properties</span>;</span><span class="comment">//å«æœ‰compatibleå±æ€§</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span>	<span class="title">property</span> *<span class="title">deadprops</span>;</span>	<span class="comment">/* removed properties */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span>	<span class="title">device_node</span> *<span class="title">parent</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span>	<span class="title">device_node</span> *<span class="title">child</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span>	<span class="title">device_node</span> *<span class="title">sibling</span>;</span></span><br><span class="line">	<span class="comment">// ......</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸€ä¸ª platform_driver æ”¯æŒè®¾å¤‡æ ‘ï¼Œå®ƒçš„platform_driver.driver.of_match_table æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç±»å‹ä¸º<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/include/linux/mod_devicetable.h#L241">struct of_device_id</a> ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">of_device_id</span> &#123;</span></span><br><span class="line">	<span class="type">char</span>	name[<span class="number">32</span>];</span><br><span class="line">	<span class="type">char</span>	type[<span class="number">32</span>];</span><br><span class="line">	<span class="type">char</span>	compatible[<span class="number">128</span>];</span><br><span class="line">	<span class="type">const</span> <span class="type">void</span> *data;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨è®¾å¤‡æ ‘ä¿¡æ¯æ¥åˆ¤æ–­ dev å’Œ drv æ˜¯å¦é…å¯¹æ—¶ï¼š</p>
<p>â‘ é¦–å…ˆï¼Œå¦‚æœ of_match_table ä¸­å«æœ‰ compatible å€¼ï¼Œå°±è·Ÿ dev çš„ compatile å±æ€§æ¯”è¾ƒï¼Œè‹¥ä¸€è‡´åˆ™æˆåŠŸï¼Œå¦åˆ™è¿”å›å¤±è´¥ï¼›</p>
<p>â‘¡å…¶æ¬¡ï¼Œå¦‚æœ of_match_table ä¸­å«æœ‰ type å€¼ï¼Œå°±è·Ÿ dev çš„ device_type å±æ€§æ¯”è¾ƒï¼Œè‹¥ä¸€è‡´åˆ™æˆåŠŸï¼Œå¦åˆ™è¿”å›å¤±è´¥ï¼›</p>
<p>â‘¢æœ€åï¼Œå¦‚æœ of_match_table ä¸­å«æœ‰ name å€¼ï¼Œå°±è·Ÿ dev çš„ name å±æ€§æ¯”è¾ƒï¼Œè‹¥ä¸€è‡´åˆ™æˆåŠŸï¼Œå¦åˆ™è¿”å›å¤±è´¥ã€‚</p>
<p>è€Œè®¾å¤‡æ ‘ä¸­å»ºè®®ä¸å†ä½¿ç”¨ devcie_type å’Œ name å±æ€§ï¼Œæ‰€ä»¥åŸºæœ¬ä¸Šåªä½¿ç”¨è®¾å¤‡èŠ‚ç‚¹çš„ compatible å±æ€§æ¥å¯»æ‰¾åŒ¹é…çš„ platform_driverã€‚  </p>
<h3 id="1-3-idåŒ¹é…"><a href="#1-3-idåŒ¹é…" class="headerlink" title="1.3 idåŒ¹é…"></a><font size=3>1.3 idåŒ¹é…</font></h3><ul>
<li>ï¼ˆ3ï¼‰æ¯”è¾ƒ platform_device_id ï¼ˆ æ¯”è¾ƒ platform_device. name å’Œ platform_driver.id_table[i].nameï¼‰</li>
</ul>
<p>id_table ä¸­å¯èƒ½æœ‰å¤šé¡¹ã€‚ platform_driver.id_table æ˜¯â€œ platform_device_idâ€æŒ‡é’ˆï¼Œè¡¨ç¤ºè¯¥ drvæ”¯æŒè‹¥å¹²ä¸ª deviceï¼Œå®ƒé‡Œé¢åˆ—å‡ºäº†å„ä¸ª device çš„{.name, .driver_data}ï¼Œå…¶ä¸­çš„â€œ nameâ€è¡¨ç¤ºè¯¥ drv æ”¯æŒçš„è®¾å¤‡çš„åå­—ï¼Œ driver_data æ˜¯äº›æä¾›ç»™è¯¥device çš„ç§æœ‰æ•°æ®ã€‚  </p>
<h3 id="1-4-nameåŒ¹é…"><a href="#1-4-nameåŒ¹é…" class="headerlink" title="1.4 nameåŒ¹é…"></a><font size=3>1.4 nameåŒ¹é…</font></h3><ul>
<li>ï¼ˆ4ï¼‰åç§°åŒ¹é…ï¼Œæ¯”è¾ƒplatform_device.name å’Œ platform_driver.driver.name</li>
</ul>
<p>platform_driver.id_table å¯èƒ½ä¸ºç©ºï¼Œè¿™æ—¶å¯ä»¥æ ¹æ® platform_driver.driver.name æ¥å¯»æ‰¾åŒåçš„platform_deviceã€‚ </p>
<h3 id="1-5-æ€»ç»“"><a href="#1-5-æ€»ç»“" class="headerlink" title="1.5 æ€»ç»“"></a><font size=3>1.5 æ€»ç»“</font></h3><img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-04-%E8%AE%BE%E5%A4%87%E6%A0%91%E7%9A%84%E5%BA%94%E7%94%A8/img/image-20250119115206386.png" alt="image-20250119115206386" />

<h2 id="2-è®¾å¤‡æ ‘åŒ¹é…å®ä¾‹"><a href="#2-è®¾å¤‡æ ‘åŒ¹é…å®ä¾‹" class="headerlink" title="2. è®¾å¤‡æ ‘åŒ¹é…å®ä¾‹"></a><font size=3>2. è®¾å¤‡æ ‘åŒ¹é…å®ä¾‹</font></h2><h3 id="2-1-éœ€è¦å“ªäº›æ¡ä»¶ï¼Ÿ"><a href="#2-1-éœ€è¦å“ªäº›æ¡ä»¶ï¼Ÿ" class="headerlink" title="2.1 éœ€è¦å“ªäº›æ¡ä»¶ï¼Ÿ"></a><font size=3>2.1 éœ€è¦å“ªäº›æ¡ä»¶ï¼Ÿ</font></h3><p>åœ¨æˆ‘ä»¬çš„å·¥ä½œä¸­ï¼Œé©±åŠ¨è¦æ±‚è®¾å¤‡æ ‘èŠ‚ç‚¹æä¾›ä»€ä¹ˆï¼Œæˆ‘ä»¬å°±å¾—æŒ‰è¿™è¦æ±‚å»ç¼–å†™è®¾å¤‡æ ‘ã€‚åŒ¹é…è¿‡ç¨‹æ‰€è¦æ±‚çš„ä¸œè¥¿æ˜¯å›ºå®šçš„ï¼š  </p>
<ul>
<li>ï¼ˆ1ï¼‰è®¾å¤‡æ ‘è¦æœ‰ compatible å±æ€§ï¼Œå®ƒçš„å€¼æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">/&#123;</span><br><span class="line">    alpha &#123;</span><br><span class="line">        <span class="meta">#address-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">        <span class="meta">#size-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">        compatible = <span class="string">&quot;simple-bus&quot;</span>;</span><br><span class="line"></span><br><span class="line">        sdev_led &#123;</span><br><span class="line">            <span class="meta">#address-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">            <span class="meta">#size-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">            compatible = <span class="string">&quot;led&quot;</span>;</span><br><span class="line">            status = <span class="string">&quot;okay&quot;</span>;</span><br><span class="line">            reg = &lt; <span class="number">0X020C406C</span> <span class="number">0X04</span> <span class="comment">/* CCM_CCGR1_BASE */</span></span><br><span class="line">                    <span class="number">0X020E0068</span> <span class="number">0X04</span> <span class="comment">/* SW_MUX_GPIO1_IO03_BASE */</span></span><br><span class="line">                    <span class="number">0X020E02F4</span> <span class="number">0X04</span> <span class="comment">/* SW_PAD_GPIO1_IO03_BASE */</span></span><br><span class="line">                    <span class="number">0X0209C000</span> <span class="number">0X04</span> <span class="comment">/* GPIO1_DR_BASE */</span></span><br><span class="line">                    <span class="number">0X0209C004</span> <span class="number">0X04</span> &gt;; <span class="comment">/* GPIO1_GDIR_BASE */</span></span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>ï¼ˆ2ï¼‰platform_driver ä¸­è¦æœ‰ of_match_tableï¼Œå…¶ä¸­ä¸€é¡¹çš„.compatible æˆå‘˜è®¾ç½®ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²</li>
</ul>
<p>æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªè®¾å¤‡æ ‘é©±åŠ¨åŒ¹é…è¡¨ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* è®¾å¤‡æ ‘åŒ¹é…åˆ—è¡¨ */</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">of_device_id</span> <span class="title">led_of_match</span>[] =</span> &#123;</span><br><span class="line">	&#123; .compatible = <span class="string">&quot;led&quot;</span> &#125;, <span class="comment">// è¿™é‡Œç”¨äºåŒ¹é…è®¾å¤‡æ ‘ä¸­çš„ compatible å±æ€§èŠ‚ç‚¹</span></span><br><span class="line">	&#123; <span class="comment">/* Sentinel */</span> &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>ï¼ˆ3ï¼‰ä¸Šè¿° 2 ä¸ªå­—ç¬¦ä¸²è¦ä¸€è‡´ã€‚</li>
</ul>
<h3 id="2-2-åŸºæœ¬æ¡†æ¶"><a href="#2-2-åŸºæœ¬æ¡†æ¶" class="headerlink" title="2.2 åŸºæœ¬æ¡†æ¶"></a><font size=3>2.2 åŸºæœ¬æ¡†æ¶</font></h3><p>å®šä¹‰platform_driverçš„æ—¶å€™è¦ç”¨ä¸Šé¢çš„è¿™ä¸ªè¡¨ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®šä¹‰å¹³å°é©±åŠ¨ç»“æ„ä½“</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">platform_driver</span> <span class="title">g_sdrv_platform</span> =</span> &#123;</span><br><span class="line">    .probe = sdrv_probe,   <span class="comment">// å¹³å°è®¾å¤‡çš„æ¢æµ‹å‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line">    .remove = sdrv_remove, <span class="comment">//  å¹³å°è®¾å¤‡çš„ç§»é™¤å‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line">    .driver = &#123;</span><br><span class="line">        .name = <span class="string">&quot;imx6ul-led-driver&quot;</span>, <span class="comment">// å’Œè®¾å¤‡åç§°ç›¸åŒæ—¶ï¼Œå¯ä»¥åŒ¹é…æˆåŠŸ</span></span><br><span class="line">                                   <span class="comment">// ä¼šåœ¨ /sys/bus/platform/driversä¸­åˆ›å»ºå¯¹åº”ç›®å½•ï¼Œå³/sys/bus/platform/drivers/driver-name</span></span><br><span class="line">        .owner = THIS_MODULE,</span><br><span class="line">		.of_match_table	= led_of_match, <span class="comment">/* è®¾å¤‡æ ‘åŒ¹é…è¡¨ */</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>åŸºæœ¬æ¡†æ¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">sdrv_probe</span><span class="params">(<span class="keyword">struct</span> platform_device *pdev)</span></span><br><span class="line">&#123;</span><br><span class="line">    PRT(<span class="string">&quot;probing platform device &amp; driver!pdev-&gt;name=%s\n&quot;</span>, pdev-&gt;name);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">sdrv_remove</span><span class="params">(<span class="keyword">struct</span> platform_device *pdev)</span></span><br><span class="line">&#123;</span><br><span class="line">    PRT(<span class="string">&quot;removing platform driver!pdev-&gt;name=%s\n&quot;</span>, pdev-&gt;name);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* è®¾å¤‡æ ‘åŒ¹é…åˆ—è¡¨ */</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">of_device_id</span> <span class="title">led_of_match</span>[] =</span> &#123;</span><br><span class="line">	&#123; .compatible = <span class="string">&quot;led&quot;</span> &#125;, <span class="comment">// è¿™é‡Œç”¨äºåŒ¹é…è®¾å¤‡æ ‘ä¸­çš„ compatible å±æ€§èŠ‚ç‚¹</span></span><br><span class="line">	&#123; <span class="comment">/* Sentinel */</span> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®šä¹‰å¹³å°é©±åŠ¨ç»“æ„ä½“</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">platform_driver</span> <span class="title">g_sdrv_platform</span> =</span> &#123;</span><br><span class="line">    .probe = sdrv_probe,   <span class="comment">// å¹³å°è®¾å¤‡çš„æ¢æµ‹å‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line">    .remove = sdrv_remove, <span class="comment">//  å¹³å°è®¾å¤‡çš„ç§»é™¤å‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line">    .driver = &#123;</span><br><span class="line">        .name = <span class="string">&quot;imx6ul-led-driver&quot;</span>, <span class="comment">// å’Œè®¾å¤‡åç§°ç›¸åŒæ—¶ï¼Œå¯ä»¥åŒ¹é…æˆåŠŸ</span></span><br><span class="line">                                   <span class="comment">// ä¼šåœ¨ /sys/bus/platform/driversä¸­åˆ›å»ºå¯¹åº”ç›®å½•ï¼Œå³/sys/bus/platform/drivers/driver-name</span></span><br><span class="line">        .owner = THIS_MODULE,</span><br><span class="line">		.of_match_table	= led_of_match, <span class="comment">/* è®¾å¤‡æ ‘åŒ¹é…è¡¨ */</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> __init <span class="type">int</span> <span class="title function_">sdrv_demo_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">	printk(<span class="string">&quot;*** [%s:%d]Build Time: %s %s, git version:%s LINUX_VERSION=%d.%d.%d ***\n&quot;</span>, __FUNCTION__,</span><br><span class="line">           __LINE__, KERNEL_KO_DATE, KERNEL_KO_TIME, KERNEL_KO_VERSION, </span><br><span class="line">           (LINUX_VERSION_CODE &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>, (LINUX_VERSION_CODE &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>, LINUX_VERSION_CODE &amp; <span class="number">0xff</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ³¨å†Œå¹³å°é©±åŠ¨</span></span><br><span class="line">    ret = platform_driver_register(&amp;g_sdrv_platform);</span><br><span class="line">    <span class="keyword">if</span> (ret) </span><br><span class="line">    &#123;</span><br><span class="line">        PRT(<span class="string">&quot;Failed to register platform driver!ret=%d\n&quot;</span>, ret);</span><br><span class="line">        <span class="keyword">goto</span> err_platform_driver_register;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//PRT(&quot;sdrv_demo module init success!\n&quot;);</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">err_platform_driver_register:</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> __exit <span class="type">void</span> <span class="title function_">sdrv_demo_exit</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// æ³¨é”€å¹³å°é©±åŠ¨</span></span><br><span class="line">    platform_driver_unregister(&amp;g_sdrv_platform);</span><br><span class="line">    <span class="comment">//PRT(&quot;sdrv_demo module exit!\n&quot;);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module_init(sdrv_demo_init); <span class="comment">// å°†__initå®šä¹‰çš„å‡½æ•°æŒ‡å®šä¸ºé©±åŠ¨çš„å…¥å£å‡½æ•°</span></span><br><span class="line">module_exit(sdrv_demo_exit); <span class="comment">// å°†__exitå®šä¹‰çš„å‡½æ•°æŒ‡å®šä¸ºé©±åŠ¨çš„å‡ºå£å‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* æ¨¡å—ä¿¡æ¯(é€šè¿‡ modinfo xxx.ko æŸ¥çœ‹) */</span></span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL v2&quot;</span>);            <span class="comment">/* æºç çš„è®¸å¯è¯åè®® */</span></span><br><span class="line">MODULE_AUTHOR(<span class="string">&quot;sumu&quot;</span>);               <span class="comment">/* å­—ç¬¦ä¸²å¸¸é‡å†…å®¹ä¸ºæ¨¡å—ä½œè€…è¯´æ˜ */</span></span><br><span class="line">MODULE_DESCRIPTION(<span class="string">&quot;Description&quot;</span>);   <span class="comment">/* å­—ç¬¦ä¸²å¸¸é‡å†…å®¹ä¸ºæ¨¡å—åŠŸèƒ½è¯´æ˜ */</span></span><br><span class="line">MODULE_ALIAS(<span class="string">&quot;module&#x27;s other name&quot;</span>); <span class="comment">/* å­—ç¬¦ä¸²å¸¸é‡å†…å®¹ä¸ºæ¨¡å—åˆ«å */</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-demoæºç "><a href="#2-3-demoæºç " class="headerlink" title="2.3 demoæºç "></a><font size=3>2.3 demoæºç </font></h3><p>demoæºç å¯ä»¥çœ‹è¿™é‡Œï¼š<a target="_blank" rel="noopener" href="https://gitee.com/sumumm/imx6ull-driver-demo/tree/master/11_device_tree/04_platform_dtb_match">11_device_tree&#x2F;04_platform_dtb_match Â· è‹æœ¨&#x2F;imx6ull-driver-demo - ç äº‘ - å¼€æºä¸­å›½</a></p>
<p>éœ€è¦æ³¨æ„ï¼Œè¿™ä¸ªdemoä¸­å®Œæˆäº†å¹³å°è®¾å¤‡é©±åŠ¨çš„è®¾å¤‡æ ‘åŒ¹é…è¿‡ç¨‹ï¼Œä½†æ˜¯è·å–èŠ‚ç‚¹çš„ä¿¡æ¯çš„æ—¶å€™è¿˜æ˜¯é€šè¿‡ofç›¸å…³å‡½æ•°è·å–ï¼Œä¸‹ä¸€ä¸ªdemoæˆ‘ä»¬å†ç ”ç©¶é€šè¿‡platform_deviceæ¥è·å–èŠ‚ç‚¹ä¿¡æ¯ã€‚</p>
<h3 id="2-4-è°ƒè¯•æŠ€å·§"><a href="#2-4-è°ƒè¯•æŠ€å·§" class="headerlink" title="2.4 è°ƒè¯•æŠ€å·§"></a><font size=3>2.4 è°ƒè¯•æŠ€å·§</font></h3><ul>
<li>è®¾å¤‡æ ‘èŠ‚ç‚¹</li>
</ul>
<p>æˆ‘ä»¬æ¢äº†è®¾å¤‡æ ‘åå°±éœ€è¦çœ‹ä¸€ä¸‹æ˜¯ä¸æ˜¯ç”Ÿæˆäº†æ­£ç¡®çš„èŠ‚ç‚¹ï¼Œå¯ä»¥åˆ°ä»¥ä¸‹ç›®å½•å»çœ‹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ls /sys/firmware/devicetree/base</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æˆ–è€…</span> </span><br><span class="line">ls /proc/device-tree/</span><br></pre></td></tr></table></figure>

<ul>
<li>platform_deviceæŸ¥çœ‹</li>
</ul>
<p>æˆ‘ä»¬åˆ›å»ºçš„èŠ‚ç‚¹æ˜¯ä¼šè¢«è½¬åŒ–ä¸ºplatform_deviceçš„ï¼Œå¯ä»¥çœ‹è¿™ä¸ªç›®å½•ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls /sys/bus/platform/devices</span><br></pre></td></tr></table></figure>

<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-04-%E8%AE%BE%E5%A4%87%E6%A0%91%E7%9A%84%E5%BA%94%E7%94%A8/img/image-20250309193144637.png" alt="image-20250309193144637" />

<ul>
<li>platform_driver çš„ä¿¡æ¯</li>
</ul>
<p>ä»¥ä¸‹ç›®å½•å«æœ‰æ³¨å†Œè¿›å†…æ ¸çš„æ‰€æœ‰ platform_driverï¼š  </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls /sys/bus/platform/drivers</span><br></pre></td></tr></table></figure>

<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-04-%E8%AE%BE%E5%A4%87%E6%A0%91%E7%9A%84%E5%BA%94%E7%94%A8/img/image-20250309193337157.png" alt="image-20250309193337157" />

<p>ä¸€ä¸ª driver å¯¹åº”ä¸€ä¸ªç›®å½•ï¼Œè¿›å…¥æŸä¸ªç›®å½•åï¼Œå¦‚æœå®ƒæœ‰é…å¯¹çš„è®¾å¤‡ï¼Œå¯ä»¥ç›´æ¥çœ‹åˆ°ã€‚ä¾‹å¦‚è¿™é‡Œæˆ‘ä»¬çš„imx6ul-led-driverå°±åŒ¹é…äº†alphaï¼šsdev_ledè®¾å¤‡ã€‚  </p>
<blockquote>
<p>æ³¨æ„ï¼š ä¸€ä¸ªå¹³å°è®¾å¤‡åªèƒ½é…å¯¹ä¸€ä¸ªå¹³å°é©±åŠ¨ï¼Œä¸€ä¸ªå¹³å°é©±åŠ¨å¯ä»¥é…å¯¹å¤šä¸ªå¹³å°è®¾å¤‡ã€‚  </p>
</blockquote>
<h2 id="3-ä»platform-deviceè·å–èŠ‚ç‚¹ä¿¡æ¯"><a href="#3-ä»platform-deviceè·å–èŠ‚ç‚¹ä¿¡æ¯" class="headerlink" title="3. ä»platform_deviceè·å–èŠ‚ç‚¹ä¿¡æ¯"></a><font size=3>3. ä»platform_deviceè·å–èŠ‚ç‚¹ä¿¡æ¯</font></h2><h3 id="3-1-æ€ä¹ˆæ‹¿åˆ°èŠ‚ç‚¹ï¼Ÿ"><a href="#3-1-æ€ä¹ˆæ‹¿åˆ°èŠ‚ç‚¹ï¼Ÿ" class="headerlink" title="3.1 æ€ä¹ˆæ‹¿åˆ°èŠ‚ç‚¹ï¼Ÿ"></a><font size=3>3.1 æ€ä¹ˆæ‹¿åˆ°èŠ‚ç‚¹ï¼Ÿ</font></h3><p>å¯ä»¥é€šè¿‡è®¾å¤‡æ ‘èŠ‚ç‚¹æŒ‡å®šèµ„æºï¼Œ platform_driver è·å¾—èµ„æºï¼Œé‚£ä¹ˆ platform_driveæ€ä¹ˆè·å¾—èµ„æºï¼Ÿ æˆ‘ä»¬çœ‹ä¸€ä¸‹probeå‡½æ•°ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">sdrv_probe</span><span class="params">(<span class="keyword">struct</span> platform_device *pdev)</span></span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨åŒ¹é…æˆåŠŸåï¼Œä¼šä¼ å…¥platform_deviceçš„æŒ‡é’ˆï¼Œæˆ‘ä»¬å‰é¢çŸ¥é“ï¼Œplatform_device.dev.of_nodeä¸­å­˜å‚¨äº†èŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥æ ¹æ®è¿™ä¸ªæ¥æ‰¾åˆ°å¯¹åº”çš„èŠ‚ç‚¹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">device_node</span>* <span class="title">np</span> =</span> pdev-&gt;dev.of_node;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-demoæºç "><a href="#3-2-demoæºç " class="headerlink" title="3.2 demoæºç "></a><font size=3>3.2 demoæºç </font></h3><p>æºç å¯ä»¥çœ‹è¿™é‡Œï¼š<a target="_blank" rel="noopener" href="https://gitee.com/sumumm/imx6ull-driver-demo/tree/master/11_device_tree/05_platform_get_node">11_device_tree&#x2F;05_platform_get_node Â· è‹æœ¨&#x2F;imx6ull-driver-demo - ç äº‘ - å¼€æºä¸­å›½</a>ï¼Œæºç ä¸­æ˜¯é€šè¿‡è¿™è¡Œè·å–èŠ‚ç‚¹ï¼š</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-04-%E8%AE%BE%E5%A4%87%E6%A0%91%E7%9A%84%E5%BA%94%E7%94%A8/img/image-20250309195107101.png" alt="image-20250309195107101" />

<h3 id="3-3-å¼€å‘æ¿æµ‹è¯•"><a href="#3-3-å¼€å‘æ¿æµ‹è¯•" class="headerlink" title="3.3 å¼€å‘æ¿æµ‹è¯•"></a><font size=3>3.3 å¼€å‘æ¿æµ‹è¯•</font></h3><p>æˆ‘ä»¬åŠ è½½é©±åŠ¨å¯ä»¥çœ‹åˆ°ï¼š</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV06-10-%E8%AE%BE%E5%A4%87%E6%A0%91-04-%E8%AE%BE%E5%A4%87%E6%A0%91%E7%9A%84%E5%BA%94%E7%94%A8/img/image-20250309195026404.png" alt="image-20250309195026404" />


    </div>

    
    
    

    <footer class="post-footer">




    <div>
        
            <div style="text-align:center;color: #ccc;font-size:14px;">
            ----------æœ¬æ–‡ç»“æŸ
            <i class="fas fa-fan fa-spin" style="color: #FF1493; font-size: 1rem"></i>
            æ„Ÿè°¢æ‚¨çš„é˜…è¯»----------
            </div>
        
    </div>





  
  <div class="my_post_copyright"> 
    <p><span>æ–‡ç« æ ‡é¢˜:</span><a href="/post/3df14f88.html">LV06-10-è®¾å¤‡æ ‘-04-è®¾å¤‡æ ‘çš„åº”ç”¨</a></p>
    <p><span>æ–‡ç« ä½œè€…:</span><a href="/" title="æ¬¢è¿è®¿é—® ã€Šè‹æœ¨ã€‹ çš„å­¦ä¹ ç¬”è®°">è‹æœ¨</a></p>
    <p><span>å‘å¸ƒæ—¶é—´:</span>2025å¹´03æœˆ17æ—¥ - 07:45</p>
    <p><span>æœ€åæ›´æ–°:</span>2025å¹´06æœˆ14æ—¥ - 00:25</p>
    <p><span>åŸå§‹é“¾æ¥:</span><a href="/post/3df14f88.html" title="LV06-10-è®¾å¤‡æ ‘-04-è®¾å¤‡æ ‘çš„åº”ç”¨">https://sumumm.github.io/post/3df14f88.html</a></p>
    <p><span>è®¸å¯åè®®:</span><i class="fab fa-creative-commons"></i> <a rel="license" href= "https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç¦æ­¢æ¼”ç» 4.0 å›½é™…</a> è½¬è½½è¯·ä¿ç•™åŸæ–‡é“¾æ¥åŠä½œè€…ã€‚</p>  
  </div>
  


          <div class="post-tags">
              <a href="/tags/LV06-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/" rel="tag"><i class="fa fa-tag"></i> LV06-é©±åŠ¨å¼€å‘</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/post/238c1e95.html" rel="prev" title="LV06-10-è®¾å¤‡æ ‘-05-rangeså±æ€§">
                  <i class="fa fa-angle-left"></i> LV06-10-è®¾å¤‡æ ‘-05-rangeså±æ€§
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/post/cb9c294a.html" rel="next" title="LV06-10-è®¾å¤‡æ ‘-03-è®¾å¤‡æ ‘æ·±å…¥åˆ†æ">
                  LV06-10-è®¾å¤‡æ ‘-03-è®¾å¤‡æ ‘æ·±å…¥åˆ†æ <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2017 â€“ 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">è‹æœ¨</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>ç«™ç‚¹æ€»å­—æ•°ï¼š</span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">3.7m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>ç«™ç‚¹é˜…è¯»æ—¶é•¿ &asymp;</span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">225:26</span>
  </span>
</div>




    <span id="sitetime"></span>
    <script defer language=javascript>
        function siteTime()
        {
            window.setTimeout("siteTime()", 1000);
            var seconds = 1000;
            var minutes = seconds * 60;
            var hours = minutes * 60;
            var days = hours * 24;
            var years = days * 365;
            var today = new Date();
            var todayYear = today.getFullYear();
            var todayMonth = today.getMonth()+1;
            var todayDate = today.getDate();
            var todayHour = today.getHours();
            var todayMinute = today.getMinutes();
            var todaySecond = today.getSeconds();
            /*==================================================
            Date.UTC() -- è¿”å›dateå¯¹è±¡è·ä¸–ç•Œæ ‡å‡†æ—¶é—´(UTC)1970å¹´1æœˆ1æ—¥åˆå¤œä¹‹é—´çš„æ¯«ç§’æ•°(æ—¶é—´æˆ³)
            year        - ä½œä¸ºdateå¯¹è±¡çš„å¹´ä»½ï¼Œä¸º4ä½å¹´ä»½å€¼
            month       - 0-11ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„æœˆä»½
            day         - 1-31ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„å¤©æ•°
            hours       - 0(åˆå¤œ24ç‚¹)-23ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„å°æ—¶æ•°
            minutes     - 0-59ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„åˆ†é’Ÿæ•°
            seconds     - 0-59ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„ç§’æ•°
            microseconds - 0-999ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„æ¯«ç§’æ•°
            ==================================================*/
            var t1 = Date.UTC(2017, 
                              5, 
                              19, 
                              0, 
                              0, 
                              0); //åŒ—äº¬æ—¶é—´
            var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond);
            var diff = t2-t1;
            var diffYears = Math.floor(diff/years);
            var diffDays = Math.floor((diff/days)-diffYears*365);
            var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours);
            var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes);
            var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds);
            document.getElementById("sitetime").innerHTML="å·²åœ¨è¿™é‡Œ "+diffYears+" å¹´ "+diffDays+" å¤© "+diffHours+" å°æ—¶ "+diffMinutes+" åˆ†é’Ÿ "+diffSeconds+" ç§’";
        }
        siteTime();
    </script>



    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.umd.js" integrity="sha256-ytMJGN3toR+a84u7g7NuHm91VIR06Q41kMWDr2pq7Zo=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>


  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


 
        <div id="click-show-text"
            data-mobile = false
            data-text = å¯Œå¼º,æ°‘ä¸»,æ–‡æ˜,å’Œè°,è‡ªç”±,å¹³ç­‰,å…¬æ­£,æ³•åˆ¶,çˆ±å›½,æ•¬ä¸š,è¯šä¿¡,å‹å–„
            data-fontsize = 15px
            data-random= false>
        </div>
       

      
        <script async src=https://cdn.jsdelivr.net/npm/hexo-next-mouse-effect@latest/click/showText.js></script>
      

      
    




    <script async src="/js/fancybox_param.js"></script>





<!-- APlayeræœ¬ä½“ -->



</body>
</html>
