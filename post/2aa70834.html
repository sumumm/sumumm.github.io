<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha256-wiz7ZSCn/btzhjKDQBms9Hx4sSeUYsDrTLg7roPstac=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.css" integrity="sha256-6cQIC71/iBIYXFK+0RHAvwmjwWzkWd+r7v/BX3/vZDc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/green/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"sumumm.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.19.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":300},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="æœ¬æ–‡ä¸»è¦æ˜¯kernelâ€”â€”é¡¶å±‚MakefileåŸºç¡€è§£æçš„ç›¸å…³ç¬”è®°ï¼Œè‹¥ç¬”è®°ä¸­æœ‰é”™è¯¯æˆ–è€…ä¸åˆé€‚çš„åœ°æ–¹ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ğŸ˜ƒã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="LV05-03-Kernel-03-01-é¡¶å±‚MakefileåŸºç¡€è§£æ">
<meta property="og:url" content="https://sumumm.github.io/post/2aa70834.html">
<meta property="og:site_name" content="è‹æœ¨">
<meta property="og:description" content="æœ¬æ–‡ä¸»è¦æ˜¯kernelâ€”â€”é¡¶å±‚MakefileåŸºç¡€è§£æçš„ç›¸å…³ç¬”è®°ï¼Œè‹¥ç¬”è®°ä¸­æœ‰é”™è¯¯æˆ–è€…ä¸åˆé€‚çš„åœ°æ–¹ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ğŸ˜ƒã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-11-26T23:53:43.000Z">
<meta property="article:modified_time" content="2025-06-13T16:25:57.044Z">
<meta property="article:author" content="è‹æœ¨">
<meta property="article:tag" content="LV05-ç³»ç»Ÿé•œåƒ">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://sumumm.github.io/post/2aa70834.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":"","permalink":"https://sumumm.github.io/post/2aa70834.html","path":"post/2aa70834.html","title":"LV05-03-Kernel-03-01-é¡¶å±‚MakefileåŸºç¡€è§£æ"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>LV05-03-Kernel-03-01-é¡¶å±‚MakefileåŸºç¡€è§£æ | è‹æœ¨</title>
  








    <script src="/js/browser_tools_disable.js"></script>

  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start --><link rel="stylesheet" href="https://unpkg.com/hexo-next-tags-plus@latest/lib/tag_plus.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">è‹æœ¨</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">æˆ‘çš„å­¦ä¹ ä¹‹è·¯</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>è‹æœ¨çš„å®¶</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»é¡µ<span class="badge">42</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£é¡µ<span class="badge">673</span></a></li><li class="menu-item menu-item-flink"><a href="/flink/" rel="section"><i class="fa fa-link fa-fw"></i>å‹äººå¸</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äºæˆ‘</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E6%A6%82%E8%BF%B0"><span class="nav-text">ä¸€ã€æ¦‚è¿°</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8C%E3%80%81make-xxx-defconfig"><span class="nav-text">äºŒã€make xxx_defconfig</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E6%89%93%E5%8D%B0%E4%BF%A1%E6%81%AF"><span class="nav-text">1. æ‰“å°ä¿¡æ¯</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-config%E7%9B%AE%E6%A0%87"><span class="nav-text">2. %configç›®æ ‡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-build%E5%8F%98%E9%87%8F"><span class="nav-text">3. buildå˜é‡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-scripts-basic"><span class="nav-text">4.Â scripts_basic</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-Makefile-build"><span class="nav-text">5.Â Makefile.build</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-scripts-basic-%E7%9B%AE%E6%A0%87%E5%AF%B9%E5%BA%94%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="nav-text">5.1Â scripts_basic ç›®æ ‡å¯¹åº”çš„å‘½ä»¤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-config-%E7%9B%AE%E6%A0%87%E5%AF%B9%E5%BA%94%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="nav-text">5.2Â %config ç›®æ ‡å¯¹åº”çš„å‘½ä»¤</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%89%E3%80%81make-all"><span class="nav-text">ä¸‰ã€make all</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-all%E7%9B%AE%E6%A0%87"><span class="nav-text">1. _allç›®æ ‡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-all%E7%9B%AE%E6%A0%87"><span class="nav-text">2. allç›®æ ‡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-vmlinux%E7%9B%AE%E6%A0%87"><span class="nav-text">3.Â vmlinuxç›®æ ‡</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-vmlinux%E7%AE%80%E5%8D%95%E5%B1%95%E5%BC%80"><span class="nav-text">3.1Â vmlinuxç®€å•å±•å¼€</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E4%BE%9D%E8%B5%96%E7%9A%84%E5%8F%98%E9%87%8F"><span class="nav-text">3.2 ä¾èµ–çš„å˜é‡</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-1-head-y"><span class="nav-text">3.2.1 head-y</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-2-init-y%E3%80%81drivers-y-%E5%92%8C-net-y"><span class="nav-text">3.2.2 init-yã€drivers-y å’Œ net-y</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-3-libs-y1%E5%92%8Clibs-y2"><span class="nav-text">3.2.3 libs-y1å’Œlibs-y2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-4-core-y"><span class="nav-text">3.2.4 core-y</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-5-%E6%80%BB%E7%BB%93"><span class="nav-text">3.2.5 æ€»ç»“</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-if-changed%E5%87%BD%E6%95%B0"><span class="nav-text">3.3Â if_changedå‡½æ•°</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-1-any-prereq"><span class="nav-text">3.3.1Â any-prereq</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-2-arg-check"><span class="nav-text">3.3.2Â arg-check</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-3-cmd-1"><span class="nav-text">3.3.3Â cmd_$(1)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-4-link-vmlinux-sh"><span class="nav-text">3.3.4Â link-vmlinux.sh</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-%E6%89%93%E5%8D%B0%E4%BF%A1%E6%81%AF"><span class="nav-text">3.4 æ‰“å°ä¿¡æ¯</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-built-in-a%E7%94%9F%E6%88%90%E8%BF%87%E7%A8%8B"><span class="nav-text">4. built-in.aç”Ÿæˆè¿‡ç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-vmlinux-deps%E5%8F%98%E9%87%8F"><span class="nav-text">4.1Â vmlinux-depså˜é‡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-vmlinux-deps%E7%9A%84%E4%BE%9D%E8%B5%96"><span class="nav-text">4.2 vmlinux-depsçš„ä¾èµ–</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-vmlinux-dirs%E5%8F%98%E9%87%8F"><span class="nav-text">4.3Â vmlinux-dirså˜é‡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-vmlinux-dirs%E7%9A%84%E4%BE%9D%E8%B5%96"><span class="nav-text">4.4Â vmlinux-dirsçš„ä¾èµ–</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-1-%E8%A7%84%E5%88%99%E5%B1%95%E5%BC%80"><span class="nav-text">4.4.1 è§„åˆ™å±•å¼€</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-2-%E5%91%BD%E4%BB%A4%E5%88%86%E6%9E%90"><span class="nav-text">4.4.2 å‘½ä»¤åˆ†æ</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-%E6%89%93%E5%8D%B0%E4%BF%A1%E6%81%AF"><span class="nav-text">4.5 æ‰“å°ä¿¡æ¯</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9B%9B%E3%80%81make-zImage"><span class="nav-text">å››ã€make zImage</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-vmlinux%E3%80%81-Image%EF%BC%8C-zImage%E3%80%81-uImage-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-text">1.Â vmlinuxã€ Imageï¼Œ zImageã€ uImage çš„åŒºåˆ«  </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-zImage"><span class="nav-text">2. zImage</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="è‹æœ¨"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">è‹æœ¨</p>
  <div class="site-description" itemprop="description">è«é“æ¡‘æ¦†æ™šï¼Œä¸ºéœå°šæ»¡å¤©</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">673</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">42</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">æ ‡ç­¾</span>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/sumumm" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;sumumm" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sumumm.github.io/post/2aa70834.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="è‹æœ¨">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è‹æœ¨">
      <meta itemprop="description" content="è«é“æ¡‘æ¦†æ™šï¼Œä¸ºéœå°šæ»¡å¤©">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="LV05-03-Kernel-03-01-é¡¶å±‚MakefileåŸºç¡€è§£æ | è‹æœ¨">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          LV05-03-Kernel-03-01-é¡¶å±‚MakefileåŸºç¡€è§£æ
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2024-11-27 07:53:43" itemprop="dateCreated datePublished" datetime="2024-11-27T07:53:43+08:00">2024-11-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">åµŒå…¥å¼å¼€å‘</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/" itemprop="url" rel="index"><span itemprop="name">02IMX6ULLå¹³å°</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV05-%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F/" itemprop="url" rel="index"><span itemprop="name">LV05-ç³»ç»Ÿé•œåƒ</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>8k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>29 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>æœ¬æ–‡ä¸»è¦æ˜¯kernelâ€”â€”é¡¶å±‚MakefileåŸºç¡€è§£æçš„ç›¸å…³ç¬”è®°ï¼Œè‹¥ç¬”è®°ä¸­æœ‰é”™è¯¯æˆ–è€…ä¸åˆé€‚çš„åœ°æ–¹ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ğŸ˜ƒã€‚</p>
<span id="more"></span>

<!-- Photo: https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV05-%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F/LV05-03-Kernel-03-01-%E9%A1%B6%E5%B1%82Makefile%E5%9F%BA%E7%A1%80%E8%A7%A3%E6%9E%90/img/ -->

<details class="folding-tag" blue><summary> ç‚¹å‡»æŸ¥çœ‹ä½¿ç”¨å·¥å…·åŠç‰ˆæœ¬ </summary>
              <div class='content'>
              <table>    <tr>        <td align="center" rowspan="5">PCç«¯å¼€å‘ç¯å¢ƒ</td>        <td align="center" width=150px>Windows</td>        <td align="left">Windows11</td>    </tr>    <tr>        <td align="center">Ubuntu</td>        <td align="left">Ubuntu20.04.2çš„64ä½ç‰ˆæœ¬</td>      </tr>    <tr>        <td align="center">VMwareÂ® Workstation 17 Pro</td>        <td align="left">17.6.0 build-24238078</td>      </tr>    <tr>        <td align="center">ç»ˆç«¯è½¯ä»¶</td>        <td align="left">MobaXterm(Professional Edition v23.0 Build 5042 (license))</td>    </tr>    <tr>        <td align="center">Win32DiskImager</td>        <td align="left">Win32DiskImager v1.0</td>      </tr>    <tr>        <td align="center" rowspan="3">Linuxå¼€å‘æ¿ç¯å¢ƒ</td>        <td align="center">Linuxå¼€å‘æ¿</td>        <td align="left">æ­£ç‚¹åŸå­ i.MX6ULL Linux é˜¿å°”æ³•å¼€å‘æ¿</td>      </tr>    <tr>        <td align="center">uboot</td>        <td align="left">NXPå®˜æ–¹æä¾›çš„ubootï¼Œä½¿ç”¨çš„ubootç‰ˆæœ¬ä¸ºU-Boot 2019.04</td>      </tr>    <tr>        <td align="center">linuxå†…æ ¸</td>        <td align="left">linux-4.19.71(NXPå®˜æ–¹æä¾›)</td>      </tr></table>
              </div>
            </details>

<details class="folding-tag" blue><summary> ç‚¹å‡»æŸ¥çœ‹æœ¬æ–‡å‚è€ƒèµ„æ–™ </summary>
              <div class='content'>
              <table>    <tr>        <td align="center">åˆ†ç±»</td>        <td align="center">ç½‘å€</td>        <td align="center">è¯´æ˜</td>    </tr>    <tr>        <td align="center" rowspan="5">å®˜æ–¹ç½‘ç«™</td>        <td align="left"><a href="https://www.arm.com/" target="_blank">https://www.arm.com/</a></td>        <td align="left">ARMå®˜æ–¹ç½‘ç«™ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°Cotex-Mxä»¥åŠARMVxçš„ä¸€äº›æ–‡æ¡£</td>    </tr>    <tr>        <td align="left"><a href="https://www.nxp.com.cn/" target="_blank">https://www.nxp.com.cn/ </a></td>        <td align="left">NXPå®˜æ–¹ç½‘ç«™</td>    </tr>    <tr>        <td align="left"><a href="https://www.nxpic.org.cn/" target="_blank">https://www.nxpic.org.cn/</a></td><td align="left">NXP å®˜æ–¹ç¤¾åŒº</td>    </tr>    <tr>        <td align="left"><a href="https://u-boot.readthedocs.io/en/latest/" target="_blank">https://u-boot.readthedocs.io/en/latest/</a></td><td align="left">u-bootå®˜ç½‘</td>    </tr>    <tr>        <td align="left"><a href="https://www.kernel.org/" target="_blank">https://www.kernel.org/</a></td><td align="left">linuxå†…æ ¸å®˜ç½‘</td>    </tr></table>
              </div>
            </details>

<details class="folding-tag" blue><summary> ç‚¹å‡»æŸ¥çœ‹ç›¸å…³æ–‡ä»¶ä¸‹è½½ </summary>
              <div class='content'>
              <table>    <tr>        <td align="center">åˆ†ç±»</td>        <td align="center">ç½‘å€</td>        <td align="center">è¯´æ˜</td>    </tr>    <tr>        <td align="center" rowspan="3">NXP</td>        <td align="left"><a href="https://github.com/nxp-imx" target="_blank">https://github.com/nxp-imx</a></td>        <td align="left">NXP imxå¼€å‘èµ„æºGitHubç»„ç»‡ï¼Œé‡Œè¾¹ä¼šæœ‰u-bootå’Œlinuxå†…æ ¸çš„ä»“åº“</td>    </tr>    <tr>        <td align="left"><a href="https://github.com/nxp-imx/linux-imx/releases/tag/v4.19.71" target="_blank">nxp-imx/linux-imx/releases/tag/v4.19.71</a></td>        <td align="left">NXP linuxå†…æ ¸ä»“åº“tagsä¸­çš„v4.19.71</td>    </tr>    <tr>        <td align="left"><a href="https://github.com/nxp-imx/uboot-imx/releases/tag/rel_imx_4.19.35_1.1.0" target="_blank">nxp-imx/uboot-imx/releases/tag/rel_imx_4.19.35_1.1.0</a></td>        <td align="left">NXP u-bootä»“åº“tagsä¸­çš„rel_imx_4.19.35_1.1.0</td>    </tr>    <tr>        <td align="center" rowspan="2">I.MX6ULL</td>        <td align="left"><a href="https://www.nxp.com.cn/docs/en/data-sheet/IMX6ULLIEC.pdf" target="_blank">i.MX 6ULL Applications Processors for Industrial Products</a></td>        <td align="left">I.MX6ULL èŠ¯ç‰‡æ‰‹å†Œï¼ˆdatasheetï¼Œå¯ä»¥åœ¨çº¿æŸ¥çœ‹ï¼‰</td>    </tr>    <tr>        <td align="left"><a href="https://www.nxp.com.cn/webapp/Download?colCode=IMX6ULLRM&lang_cd=zh" target="_blank">i.MX 6ULL Applications ProcessorReference Manual</a></td>        <td align="left">I.MX6ULL å‚è€ƒæ‰‹å†Œï¼ˆä¸‹è½½åæ‰èƒ½æŸ¥çœ‹ï¼Œéœ€è¦ç™»å½•NXPå®˜ç½‘ï¼‰</td>    </tr>    <tr>        <td align="center" rowspan="2">Source Code</td>        <td align="left"><a href="https://elixir.bootlin.com/linux/latest/source" target="_blank">https://elixir.bootlin.com/linux/latest/source</a></td>        <td align="left">linux kernelæºç </td>    </tr>    <tr>        <td align="left"><a href="https://elixir.bootlin.com/u-boot/latest/source" target="_blank">https://elixir.bootlin.com/u-boot/latest/source</a></td>        <td align="left">ubootæºç </td>    </tr></table>
              </div>
            </details>

<h1 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a><font size=3>ä¸€ã€æ¦‚è¿°</font></h1><p>å…¶å®å¤§æ¦‚ç¿»ä¸€ä¸‹linuxå†…æ ¸çš„é¡¶å±‚ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile">Makefile</a> å°±ä¼šå‘ç°ï¼Œå®ƒå’Œu-bootçš„é¡¶å±‚ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/u-boot/v2019.04/source/Makefile">Makefile</a> ç»“æ„æ˜¯å¾ˆç±»ä¼¼çš„ï¼Œå¤§éƒ¨åˆ†éƒ½å·®ä¸å¤šï¼Œä¹‹å‰å·²ç»è¯¦ç»†å»åˆ†æè¿‡u-bootçš„é¡¶å±‚Makefileäº†ï¼Œå¯ä»¥çœ‹è¿™é‡Œï¼š<a href="https://sumumm.github.io/post/ca32061f.html">LV05-02-U-Boot-06-01-é¡¶å±‚MakefileåŸºç¡€è§£æ | è‹æœ¨</a>ã€‚è¿™é‡Œä¸€äº›åŸºç¡€çš„ä¸œè¥¿å°±ä¸å†è¯¦ç»†åˆ†æäº†ã€‚</p>
<h1 id="äºŒã€make-xxx-defconfig"><a href="#äºŒã€make-xxx-defconfig" class="headerlink" title="äºŒã€make xxx_defconfig"></a><font size=3>äºŒã€make xxx_defconfig</font></h1><h2 id="1-æ‰“å°ä¿¡æ¯"><a href="#1-æ‰“å°ä¿¡æ¯" class="headerlink" title="1. æ‰“å°ä¿¡æ¯"></a><font size=3>1. æ‰“å°ä¿¡æ¯</font></h2><p>å…ˆçœ‹ä¸€ä¸‹é…ç½®è¿‡ç¨‹çš„æ‰“å°ä¿¡æ¯å§ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make V=0 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- distclean</span><br><span class="line">make V=1 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- imx_v6_v7_defconfig</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¼šåœ¨ç»ˆç«¯çœ‹åˆ°ä»¥ä¸‹æ‰“å°ä¿¡æ¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">make -f ./scripts/Makefile.build obj=scripts/basic</span><br><span class="line">  gcc -Wp,-MD,scripts/basic/.fixdep.d -Wall -Wmissing-prototypes -Wstrict-prototypes -O2 -fomit-frame-pointer -std=gnu89         -o scripts/basic/fixdep scripts/basic/fixdep.c   </span><br><span class="line">rm -f .tmp_quiet_recordmcount</span><br><span class="line">make -f ./scripts/Makefile.build obj=scripts/kconfig imx_v6_v7_defconfig</span><br><span class="line">  gcc -Wp,-MD,scripts/kconfig/.conf.o.d -Wall -Wmissing-prototypes -Wstrict-prototypes -O2 -fomit-frame-pointer -std=gnu89       -c -o scripts/kconfig/conf.o scripts/kconfig/conf.c</span><br><span class="line">  bison -oscripts/kconfig/zconf.tab.c -t -l scripts/kconfig/zconf.y</span><br><span class="line">  flex -oscripts/kconfig/zconf.lex.c -L scripts/kconfig/zconf.l</span><br><span class="line">  gcc -Wp,-MD,scripts/kconfig/.zconf.tab.o.d -Wall -Wmissing-prototypes -Wstrict-prototypes -O2 -fomit-frame-pointer -std=gnu89      -Iscripts/kconfig -c -o scripts/kconfig/zconf.tab.o scripts/kconfig/zconf.tab.c</span><br><span class="line">  gcc   -o scripts/kconfig/conf scripts/kconfig/conf.o scripts/kconfig/zconf.tab.o   </span><br><span class="line">scripts/kconfig/conf  --defconfig=arch/arm/configs/imx_v6_v7_defconfig Kconfig</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># configuration written to .config</span></span></span><br><span class="line"><span class="meta prompt_">#</span></span><br></pre></td></tr></table></figure>

<p>åé¢æˆ‘ä»¬åˆ†æçš„æ—¶å€™ä¼šç”¨åˆ°ã€‚</p>
<h2 id="2-configç›®æ ‡"><a href="#2-configç›®æ ‡" class="headerlink" title="2. %configç›®æ ‡"></a><font size=3>2. %configç›®æ ‡</font></h2><p>ç¬¬ä¸€æ¬¡ç¼–è¯‘ Linux ä¹‹å‰éƒ½è¦ä½¿ç”¨â€œmake xxx_defconfigâ€å…ˆé…ç½® Linux å†…æ ¸ï¼Œåœ¨é¡¶å±‚ Makefile ä¸­æœ‰â€œ%configâ€è¿™ä¸ªç›®æ ‡ã€‚å®ƒå®šä¹‰åœ¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L533">Makefile - <em>%config</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">%config: scripts_basic outputmakefile FORCE</span></span><br><span class="line">	<span class="variable">$(Q)</span><span class="variable">$(MAKE)</span> <span class="variable">$(build)</span>=scripts/kconfig <span class="variable">$@</span></span><br></pre></td></tr></table></figure>

<p>â€œ%configâ€ä¾èµ– scripts_basicã€outputmakefile å’Œ FORCEï¼Œâ€œ%configâ€çœŸæ­£æœ‰æ„ä¹‰çš„ä¾èµ–å°±åªæœ‰ scripts_basicã€‚å…¶ä»–çš„è¿™å‡ ä¸ªå˜é‡è¿™é‡Œç›´æ¥åŠ æ‰“å°ä¿¡æ¯æ¥çœ‹å§ï¼Œå°±ä¸é€ä¸ªåˆ†æäº†ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">%config: scripts_basic outputmakefile FORCE</span></span><br><span class="line">	@echo <span class="string">&quot;Q=<span class="variable">$(Q)</span>&quot;</span></span><br><span class="line">	@echo <span class="string">&quot;MAKE=<span class="variable">$(MAKE)</span>&quot;</span></span><br><span class="line">	@echo <span class="string">&quot;build=<span class="variable">$(build)</span>&quot;</span></span><br><span class="line">	@echo <span class="string">&quot;@=<span class="variable">$@</span>&quot;</span></span><br><span class="line">	<span class="variable">$(Q)</span><span class="variable">$(MAKE)</span> <span class="variable">$(build)</span>=scripts/kconfig <span class="variable">$@</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åæ‰§è¡Œï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make V=0 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- distclean</span><br><span class="line">make V=1 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- imx_v6_v7_defconfig</span><br></pre></td></tr></table></figure>

<p>å°±ä¼šçœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Q=</span><br><span class="line">MAKE=make</span><br><span class="line">build=-f ./scripts/Makefile.build obj</span><br><span class="line">@=imx_v6_v7_defconfig</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ä¸Šé¢çš„è§„åˆ™å±•å¼€å°±æ˜¯ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">%config: scripts_basic outputmakefile FORCE</span></span><br><span class="line">	make -f ./scripts/Makefile.build obj=scripts/kconfig imx_v6_v7_defconfig <span class="comment"># ä¹Ÿå¯ä»¥æœ‰@ï¼Œè§†é…ç½®è€Œå®š</span></span><br></pre></td></tr></table></figure>

<h2 id="3-buildå˜é‡"><a href="#3-buildå˜é‡" class="headerlink" title="3. buildå˜é‡"></a><font size=3>3. buildå˜é‡</font></h2><p>è¿™ä¸ªbuildå˜é‡å®šä¹‰åœ¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Kbuild.include#L184">Kbuild.include - scripts&#x2F;Kbuild.include - <em>build</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###</span></span><br><span class="line"><span class="comment"># Shorthand for $(Q)$(MAKE) -f scripts/Makefile.build obj=</span></span><br><span class="line"><span class="comment"># Usage:</span></span><br><span class="line"><span class="comment"># $(Q)$(MAKE) $(build)=dir</span></span><br><span class="line">build := -f <span class="variable">$(srctree)</span>/scripts/Makefile.build obj</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªsrctreeæ˜¯å®šä¹‰åœ¨é¡¶å±‚ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L190">Makefile - <em>srctree</em></a> ä¸­ï¼Œåˆ†æä¹‹åsrctree&#x3D;<code>.</code>ã€‚æ‰€ä»¥è¿™é‡Œå°±æ˜¯ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">build := -f ./scripts/Makefile.build obj</span><br></pre></td></tr></table></figure>

<h2 id="4-scripts-basic"><a href="#4-scripts-basic" class="headerlink" title="4.Â scripts_basic"></a><font size=3>4.Â scripts_basic</font></h2><p>æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªscripts_basicè§„åˆ™ï¼Œå®ƒå®šä¹‰åœ¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L465">Makefile - <em>scripts_basic</em></a> ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Basic helpers built in scripts/basic/</span></span><br><span class="line">PHONY += scripts_basic</span><br><span class="line"><span class="section">scripts_basic:</span></span><br><span class="line">	<span class="variable">$(Q)</span><span class="variable">$(MAKE)</span> <span class="variable">$(build)</span>=scripts/basic</span><br><span class="line">	<span class="variable">$(Q)</span>rm -f .tmp_quiet_recordmcount</span><br></pre></td></tr></table></figure>

<p>å‰é¢æˆ‘ä»¬å·²ç»æ‰“å°äº†ç›¸å…³çš„å˜é‡çš„å€¼ï¼Œæ‰€ä»¥è¿™é‡Œå…¶å®å°±æ˜¯ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">scripts_basic:</span></span><br><span class="line">    @make -f ./scripts/Makefile.build obj=scripts/basic <span class="comment"># ä¹Ÿå¯ä»¥æ²¡æœ‰@ï¼Œè§†é…ç½®è€Œå®š</span></span><br><span class="line">    @rm -f . tmp_quiet_recordmcount                     <span class="comment"># ä¹Ÿå¯ä»¥æ²¡æœ‰@</span></span><br></pre></td></tr></table></figure>

<h2 id="5-Makefile-build"><a href="#5-Makefile-build" class="headerlink" title="5.Â Makefile.build"></a><font size=3>5.Â Makefile.build</font></h2><p>ä»å‰é¢çš„%configå’Œscripts_basicç›®æ ‡å¯ä»¥çŸ¥é“ï¼Œâ€œmake xxx_defconfigâ€œé…ç½® Linux çš„æ—¶å€™å¦‚ä¸‹ä¸¤è¡Œå‘½ä»¤ä¼šæ‰§è¡Œè„šæœ¬ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build">Makefile.build - scripts&#x2F;Makefile.build</a> ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@make -f ./scripts/Makefile.build obj=scripts/basic</span><br><span class="line">@make -f ./scripts/Makefile.build obj=scripts/kconfig xxx_defconfig</span><br></pre></td></tr></table></figure>

<h3 id="5-1-scripts-basic-ç›®æ ‡å¯¹åº”çš„å‘½ä»¤"><a href="#5-1-scripts-basic-ç›®æ ‡å¯¹åº”çš„å‘½ä»¤" class="headerlink" title="5.1Â scripts_basic ç›®æ ‡å¯¹åº”çš„å‘½ä»¤"></a><font size=3>5.1Â scripts_basic ç›®æ ‡å¯¹åº”çš„å‘½ä»¤</font></h3><p>scripts_basic ç›®æ ‡å¯¹åº”çš„å‘½ä»¤ä¸ºï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@make -f ./scripts/Makefile.build obj=scripts/basic</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ‰“å¼€ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L43">Makefile.build - scripts&#x2F;Makefile.build</a> æ–‡ä»¶ï¼Œä¼šçœ‹åˆ°è¿™ä¸¤ä¸ªå˜é‡ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The filename Kbuild has precedence over Makefile</span></span><br><span class="line">kbuild-dir := <span class="variable">$(<span class="built_in">if</span> $(<span class="built_in">filter</span> /%,<span class="variable">$(src)</span>)</span>,<span class="variable">$(src)</span>,<span class="variable">$(srctree)</span>/<span class="variable">$(src)</span>)</span><br><span class="line">kbuild-file := <span class="variable">$(<span class="built_in">if</span> $(<span class="built_in">wildcard</span> $(kbuild-<span class="built_in">dir</span>)</span>/Kbuild),$(kbuild-dir)/Kbuild,$(kbuild-dir)/Makefile)</span><br><span class="line"><span class="keyword">include</span> $(kbuild-file)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„srcå˜é‡å®šä¹‰åœ¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L6">Makefile.build - scripts&#x2F;Makefile.build - <em>src</em></a></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">src := <span class="variable">$(obj)</span></span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ src&#x3D;scripts&#x2F;basicï¼Œæ­¤æ—¶æˆ‘ä»¬å°† kbuild-dir å’Œ kbuild-file å±•å¼€ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kbuild-dir=./scripts/basic</span><br><span class="line">kbuild-file=./scripts/basic/Makefile</span><br><span class="line"><span class="keyword">include</span> ./scripts/basic/Makefile</span><br></pre></td></tr></table></figure>

<p>ç»§ç»­å¾€ååˆ†æï¼Œå°±å¯ä»¥çœ‹åˆ°è¿™ä¸ªç›®æ ‡<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L80">Makefile.build - scripts&#x2F;Makefile.build - <em>__build</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># We keep a list of all modules in $(MODVERDIR)</span></span><br><span class="line"></span><br><span class="line"><span class="section">__build: $(if <span class="variable">$(KBUILD_BUILTIN)</span>,$(builtin-target) $(lib-target) $(extra-y)) \</span></span><br><span class="line">	 <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(KBUILD_MODULES)</span>,$(obj-m)</span> $(modorder-target)) \</span><br><span class="line">	 $(subdir-ym) <span class="variable">$(always)</span></span><br><span class="line">	@:</span><br></pre></td></tr></table></figure>

<p>__build æ˜¯é»˜è®¤ç›®æ ‡ï¼Œå› ä¸ºå‘½ä»¤â€œ@make -f .&#x2F;scripts&#x2F;Makefile.build obj&#x3D;scripts&#x2F;basicâ€æ²¡æœ‰æŒ‡å®šç›®æ ‡ï¼Œæ‰€ä»¥ä¼šä½¿ç”¨åˆ°é»˜è®¤ç›®æ ‡__buildã€‚åœ¨é¡¶å±‚ Makefile ä¸­ï¼ŒKBUILD_BUILTIN ä¸º 1ï¼Œ KBUILD_MODULES ä¸ºç©ºï¼Œå› æ­¤å±•å¼€åç›®æ ‡__build ä¸ºï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">__build:$(builtin-target) $(lib-target) $(extra-y)) $(subdir-ym) <span class="variable">$(always)</span></span></span><br><span class="line">	@:</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºç›®æ ‡__build æœ‰ 5 ä¸ªä¾èµ–ï¼šbuiltin-targetã€lib-targetã€extra-yã€subdir-ym å’Œ alwaysã€‚æˆ‘ä»¬ç›´æ¥æ·»åŠ æ‰“å°ä¿¡æ¯çœ‹ä¸€ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">__build: $(if <span class="variable">$(KBUILD_BUILTIN)</span>,$(builtin-target) $(lib-target) $(extra-y)) \</span></span><br><span class="line">	 <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(KBUILD_MODULES)</span>,$(obj-m)</span> $(modorder-target)) \</span><br><span class="line">	 $(subdir-ym) <span class="variable">$(always)</span></span><br><span class="line">	@:</span><br><span class="line">	@echo <span class="string">&quot;builtin-target=&quot;</span>$(builtin-target) </span><br><span class="line">	@echo <span class="string">&quot;lib-target=&quot;</span>$(lib-target) </span><br><span class="line">	@echo <span class="string">&quot;extra-y=&quot;</span>$(extra-y)</span><br><span class="line">	@echo <span class="string">&quot;subdir-ym=&quot;</span>$(subdir-ym) </span><br><span class="line">	@echo <span class="string">&quot;always=&quot;</span><span class="variable">$(always)</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åæ‰§è¡Œï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make V=0 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- distclean</span><br><span class="line">make V=1 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- imx_v6_v7_defconfig</span><br></pre></td></tr></table></figure>

<p>ä¼šçœ‹åˆ°è¿™ 5 ä¸ªä¾èµ–çš„å…·ä½“å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">builtin-target=</span><br><span class="line">lib-target=</span><br><span class="line">extra-y=</span><br><span class="line">subdir-ym=</span><br><span class="line">always=scripts/basic/fixdep</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥æœ€ç»ˆçš„__buildä¸ºï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">__build: scripts/basic/fixdep</span></span><br><span class="line">	@:</span><br></pre></td></tr></table></figure>

<p>__build ä¾èµ–äº scripts&#x2F;basic&#x2F;fixdepï¼Œæ‰€ä»¥è¦å…ˆå°† scripts&#x2F;basic&#x2F;fixdepæ–‡ä»¶ç¼–è¯‘æˆ fixdepã€‚ </p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œscripts_basic ç›®æ ‡çš„ä½œç”¨å°±æ˜¯ç¼–è¯‘å‡º scripts&#x2F;basic&#x2F;fixdepè½¯ä»¶ã€‚</p>
<h3 id="5-2-config-ç›®æ ‡å¯¹åº”çš„å‘½ä»¤"><a href="#5-2-config-ç›®æ ‡å¯¹åº”çš„å‘½ä»¤" class="headerlink" title="5.2Â %config ç›®æ ‡å¯¹åº”çš„å‘½ä»¤"></a><font size=3>5.2Â %config ç›®æ ‡å¯¹åº”çš„å‘½ä»¤</font></h3><p>%config ç›®æ ‡å¯¹åº”çš„å‘½ä»¤ä¸ºï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make -f ./scripts/Makefile.build obj=scripts/kconfig xxx_defconfig</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ¨æµ‹ä¸€ä¸‹ï¼Œ<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L80">Makefile.build - scripts&#x2F;Makefile.build</a>é‡Œé¢åº”è¯¥æœ‰ä¸€ä¸ªdefconfigç›¸å…³çš„ç›®æ ‡æ‰å¯¹ï¼Œä½†æ˜¯å»æœä¸€ä¸‹å¥½åƒæ²¡æœ‰ï¼Œæˆ‘ä»¬å’Œå‰é¢ä¸€æ ·ï¼Œå…ˆçœ‹ä¸€ä¸‹<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L43">Makefile.build - scripts&#x2F;Makefile.build</a> ä¸­çš„kbuild-dirå’Œkbuild-fileï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kbuild-dir := <span class="variable">$(<span class="built_in">if</span> $(<span class="built_in">filter</span> /%,<span class="variable">$(src)</span>)</span>,<span class="variable">$(src)</span>,<span class="variable">$(srctree)</span>/<span class="variable">$(src)</span>)</span><br><span class="line">kbuild-file := <span class="variable">$(<span class="built_in">if</span> $(<span class="built_in">wildcard</span> $(kbuild-<span class="built_in">dir</span>)</span>/Kbuild),$(kbuild-dir)/Kbuild,$(kbuild-dir)/Makefile)</span><br><span class="line"><span class="keyword">include</span> $(kbuild-file)</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬çŸ¥é“srctree&#x3D;<code>.</code>ï¼Œsrc&#x3D;scripts&#x2F;kconfigï¼Œæ‰€ä»¥è¿™é‡Œå±•å¼€å°±æ˜¯ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kbuild-dir = ./scripts/kconfig</span><br><span class="line">kbuild-file = ./scripts/kconfig/Makefile</span><br><span class="line"><span class="keyword">include</span> ./scripts/kconfig/Makefile</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºï¼ŒMakefile.build ä¼šè¯»å– scripts&#x2F;kconfig&#x2F;Makefile ä¸­çš„å†…å®¹ï¼Œæ­¤æ–‡ä»¶æœ‰å¦‚ä¸‹æ‰€ç¤ºå†…å®¹<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/kconfig/Makefile#L103">Makefile - scripts&#x2F;kconfig&#x2F;Makefile - <em>%_defconfig</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">%_defconfig: <span class="variable">$(obj)</span>/conf</span></span><br><span class="line">	<span class="variable">$(Q)</span><span class="variable">$&lt;</span> <span class="variable">$(silent)</span> --defconfig=arch/<span class="variable">$(SRCARCH)</span>/configs/<span class="variable">$@</span> <span class="variable">$(Kconfig)</span></span><br></pre></td></tr></table></figure>

<p>ç›®æ ‡%_defconfig ä¸ xxx_defconfig åŒ¹é…ï¼Œæ‰€ä»¥ä¼šæ‰§è¡Œè¿™æ¡è§„åˆ™ï¼ŒSRCARCHå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L326">Makefile - <em>SRCARCH</em></a>ï¼Œæˆ‘ä»¬ç¼–è¯‘çš„æ˜¯ARMå¹³å°ï¼Œè¿™é‡Œå°±æœ‰ARCARCH&#x3D;armã€‚Kconfigå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/kconfig/Makefile#L9">Makefile - scripts&#x2F;kconfig&#x2F;Makefile - <em>Kconfig</em></a>ï¼Œæœ€åå®ƒçš„å€¼ä¸ºKconfigï¼Œè¿™é‡Œå°†å…¶å±•å¼€å°±æ˜¯ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">%_defconfig: scripts/kconfig/conf</span></span><br><span class="line">    @ scripts/kconfig/conf --defconfig=arch/arm/configs/%_defconfig Kconfig</span><br></pre></td></tr></table></figure>

<p>%_defconfigä¾èµ–scripts&#x2F;kconfig&#x2F;confï¼Œæ‰€ä»¥ä¼šç¼–è¯‘scripts&#x2F;kconfig&#x2F;conf.cç”Ÿæˆconfè¿™ä¸ªè½¯ä»¶ã€‚ æ­¤è½¯ä»¶å°±ä¼šå°† %_defconfig ä¸­çš„é…ç½®è¾“å‡ºåˆ°.config æ–‡ä»¶ä¸­ï¼Œæœ€ç»ˆç”Ÿæˆ Linux kernel æ ¹ç›®å½•ä¸‹çš„.config æ–‡ä»¶ã€‚å…·ä½“æ€ä¹ˆç”Ÿæˆçš„è¿™é‡Œå°±æ²¡æœ‰ä»”ç»†å»ç ”ç©¶äº†ï¼Œå¤§æ¦‚çŸ¥é“è¿™é‡Œæ˜¯è¿™æ ·ç”Ÿæˆçš„å°±å¯ä»¥äº†ã€‚</p>
<h1 id="ä¸‰ã€make-all"><a href="#ä¸‰ã€make-all" class="headerlink" title="ä¸‰ã€make all"></a><font size=3>ä¸‰ã€make all</font></h1><p>ä½¿ç”¨å‘½ä»¤â€œmake xxx_defconfigâ€é…ç½®å¥½ Linux å†…æ ¸ä»¥åå°±å¯ä»¥ä½¿ç”¨â€œmakeâ€æˆ–è€…â€œmake allâ€ å‘½ä»¤è¿›è¡Œç¼–è¯‘ã€‚</p>
<h2 id="1-allç›®æ ‡"><a href="#1-allç›®æ ‡" class="headerlink" title="1. _allç›®æ ‡"></a><font size=3>1. _allç›®æ ‡</font></h2><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹é¡¶å±‚Makefileä¸­å…³äº_allç›®æ ‡çš„ä¸€äº›ç›¸å…³çš„å†…å®¹ï¼Œå®ƒåœ¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L15">Makefile - <em>_all</em></a> å’Œ<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L541">Makefile - <em>_all</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># That&#x27;s our default target when none is given on the command line</span></span><br><span class="line">PHONY := _all</span><br><span class="line"><span class="section">_all:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ......</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If building an external module we do not care about the all: rule</span></span><br><span class="line"><span class="comment"># but instead _all depend on modules</span></span><br><span class="line">PHONY += all</span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(KBUILD_EXTMOD)</span>,)</span><br><span class="line"><span class="section">_all: all     # (1)</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="section">_all: modules # (2)</span></span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p>_all æ˜¯é»˜è®¤ç›®æ ‡ï¼Œå¦‚æœä½¿ç”¨å‘½ä»¤â€œmakeâ€ç¼–è¯‘ Linux çš„è¯æ­¤ç›®æ ‡å°±ä¼šè¢«åŒ¹é…ã€‚ç»§ç»­å¾€ä¸‹çš„è¯ï¼Œæˆ‘ä»¬çœ‹åˆ°è¿˜æœ‰ä¸€ä¸ªå˜é‡æ¥æ§åˆ¶é»˜è®¤ç›®æ ‡çš„ä¾èµ–ï¼Œå¦‚æœ KBUILD_EXTMOD ä¸ºç©ºçš„è¯ ifeqä¸­çš„(1)ä»£ç æˆç«‹ã€‚æ·»åŠ æ‰“å°ä¿¡æ¯å°±ä¼šå‘ç°è¿™é‡Œæˆ‘ä»¬æ‰§è¡Œmake allçš„è¯ï¼Œ(1)æ˜¯æˆç«‹çš„ï¼Œæ‰€ä»¥_allç›®æ ‡åˆä¾èµ–äºallã€‚</p>
<h2 id="2-allç›®æ ‡"><a href="#2-allç›®æ ‡" class="headerlink" title="2. allç›®æ ‡"></a><font size=3>2. allç›®æ ‡</font></h2><p>æˆ‘ä»¬å†çœ‹ä¸€ä¸‹allç›®æ ‡ï¼Œå®ƒå®šä¹‰åœ¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L597">Makefile - <em>all</em></a> ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The all: target is the default when no target is given on the</span></span><br><span class="line"><span class="comment"># command line.</span></span><br><span class="line"><span class="comment"># This allow a user to issue only &#x27;make&#x27; to build a kernel including modules</span></span><br><span class="line"><span class="comment"># Defaults to vmlinux, but the arch makefile usually adds further targets</span></span><br><span class="line"><span class="section">all: vmlinux</span></span><br></pre></td></tr></table></figure>

<p>ç›®æ ‡ all ä¾èµ– vmlinuxï¼Œæ‰€ä»¥æ¥ä¸‹æ¥çš„é‡ç‚¹å°±æ˜¯ vmlinuxï¼</p>
<h2 id="3-vmlinuxç›®æ ‡"><a href="#3-vmlinuxç›®æ ‡" class="headerlink" title="3.Â vmlinuxç›®æ ‡"></a><font size=3>3.Â vmlinuxç›®æ ‡</font></h2><h3 id="3-1-vmlinuxç®€å•å±•å¼€"><a href="#3-1-vmlinuxç®€å•å±•å¼€" class="headerlink" title="3.1Â vmlinuxç®€å•å±•å¼€"></a><font size=3>3.1Â vmlinuxç®€å•å±•å¼€</font></h3><p>vmlinuxç›®æ ‡å®šä¹‰åœ¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L1019">Makefile - <em>vmlinux</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">vmlinux: scripts/link-vmlinux.sh autoksyms_recursive $(vmlinux-deps) FORCE</span></span><br><span class="line"><span class="keyword">ifdef</span> CONFIG_HEADERS_CHECK</span><br><span class="line">	<span class="variable">$(Q)</span><span class="variable">$(MAKE)</span> -f <span class="variable">$(srctree)</span>/Makefile headers_check</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"><span class="keyword">ifdef</span> CONFIG_GDB_SCRIPTS</span><br><span class="line">	<span class="variable">$(Q)</span>ln -fsn <span class="variable">$(<span class="built_in">abspath</span> <span class="variable">$(srctree)</span>/scripts/gdb/vmlinux-gdb.py)</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line">	+<span class="variable">$(<span class="built_in">call</span> if_changed,link-vmlinux)</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºç›®æ ‡ vmlinux ä¾èµ– scripts&#x2F;link-vmlinux.shã€vmlinux-depså’ŒFORCEï¼Œå…¶ä¸­vmlinux-depså®šä¹‰åœ¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L989">Makefile - <em>vmlinux-deps</em></a> ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmlinux-deps := <span class="variable">$(KBUILD_LDS)</span> <span class="variable">$(KBUILD_VMLINUX_INIT)</span> <span class="variable">$(KBUILD_VMLINUX_MAIN)</span> <span class="variable">$(KBUILD_VMLINUX_LIBS)</span></span><br></pre></td></tr></table></figure>

<p>è¿™å‡ ä¸ªå˜é‡éƒ½å®šä¹‰åœ¨è¿™ä¸ªä½ç½® <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L980">Makefile - <em>Externally visible symbols</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Externally visible symbols (used by link-vmlinux.sh)</span></span><br><span class="line"><span class="keyword">export</span> KBUILD_VMLINUX_INIT := $(head-y) $(init-y)</span><br><span class="line"><span class="keyword">export</span> KBUILD_VMLINUX_MAIN := $(core-y) $(libs-y2) $(drivers-y) $(net-y) $(virt-y)</span><br><span class="line"><span class="keyword">export</span> KBUILD_VMLINUX_LIBS := $(libs-y1)</span><br><span class="line"><span class="keyword">export</span> KBUILD_LDS          := arch/<span class="variable">$(SRCARCH)</span>/kernel/vmlinux.lds</span><br></pre></td></tr></table></figure>

<p>å‰é¢æˆ‘ä»¬çŸ¥é“ SRCARCH&#x3D;armï¼Œæ‰€ä»¥KBUILD_LDS:&#x3D; arch&#x2F;arm&#x2F;kernel&#x2F;vmlinux.ldsï¼Œæ‰€ä»¥vmlinuxçš„ä¾èµ–ä¸ºï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scripts/link-vmlinux.sh autoksyms_recursive $(head-y) $(init-y) $(core-y) $(libs-y2) $(drivers-y) $(net-y) $(virt-y) $(libs-y1) arch/<span class="variable">$(SRCARCH)</span>/kernel/vmlinux.lds FORCE</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æœç´¢ä¸€ä¸‹ CONFIG_HEADERS_CHECK å’Œ CONFIG_GDB_SCRIPTSï¼Œä¼šå‘ç°NXPå®˜æ–¹çš„evkè¯„ä¼°æ¿æ‰€å¯¹åº”çš„é»˜è®¤é…ç½®æ–‡ä»¶ imx_v6_v7_defconfig æ˜¯æ²¡æœ‰è¿™ä¸¤ä¸ªå®šä¹‰çš„ï¼Œæœ€ç»ˆçš„.configä¸­ä¹Ÿæ²¡æœ‰é…ç½®è¿™ä¸¤ä¸ªé€‰é¡¹ã€‚è¿™é‡Œå°±å…ˆä¸ç®¡äº†ï¼Œç„¶åæˆ‘ä»¬å±•å¼€ä¸€ä¸‹è¿™ä¸ªvmlinuxï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">vmlinux: scripts/link-vmlinux.sh autoksyms_recursive $(head-y) $(init-y) $(core-y) $(libs-y2) $(drivers-y) $(net-y) $(virt-y) $(libs-y1) arch/<span class="variable">$(SRCARCH)</span>/kernel/vmlinux.lds FORCE</span></span><br><span class="line">	+<span class="variable">$(<span class="built_in">call</span> if_changed,link-vmlinux)</span></span><br></pre></td></tr></table></figure>

<p>å½“ä¾èµ–å‡†å¤‡å¥½åï¼Œè°ƒç”¨if_changedè¿™ä¸ªå‡½æ•°å°±æ˜¯ç”Ÿæˆvmlinuxã€‚</p>
<h3 id="3-2-ä¾èµ–çš„å˜é‡"><a href="#3-2-ä¾èµ–çš„å˜é‡" class="headerlink" title="3.2 ä¾èµ–çš„å˜é‡"></a><font size=3>3.2 ä¾èµ–çš„å˜é‡</font></h3><h4 id="3-2-1-head-y"><a href="#3-2-1-head-y" class="headerlink" title="3.2.1 head-y"></a><font size=3>3.2.1 head-y</font></h4><p>head-yè¿™ä¸ªå˜é‡æ˜¯å®šä¹‰åœ¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/arch/arm/Makefile#L138">Makefile - arch&#x2F;arm&#x2F;Makefile - <em>head-y</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Default value</span></span><br><span class="line">head-y		:= arch/arm/kernel/head<span class="variable">$(MMUEXT)</span>.o</span><br></pre></td></tr></table></figure>

<p>å½“ä¸ä½¿èƒ½ MMU çš„è¯ MMUEXT&#x3D;-nommuï¼Œå¦‚æœä½¿èƒ½ MMU çš„è¯ä¸ºç©ºï¼Œå› æ­¤ head-y æœ€ç»ˆçš„ å€¼ä¸ºï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">head-y = arch/arm/kernel/head.o</span><br></pre></td></tr></table></figure>

<h4 id="3-2-2-init-yã€drivers-y-å’Œ-net-y"><a href="#3-2-2-init-yã€drivers-y-å’Œ-net-y" class="headerlink" title="3.2.2 init-yã€drivers-y å’Œ net-y"></a><font size=3>3.2.2 init-yã€drivers-y å’Œ net-y</font></h4><p>init-yã€drivers-y å’Œ net-yè¿™ä¸‰ä¸ªå˜é‡æ˜¯å®šä¹‰åœ¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L580">Makefile - <em>Objects we will link into vmlinux &#x2F; subdirs we need to visit</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">init-y		:= init/</span><br><span class="line">drivers-y	:= drivers/ sound/ firmware/</span><br><span class="line">net-y		:= net/</span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰ä¸€ä¸ªä½ç½®ä¹Ÿæœ‰ï¼Œåœ¨è¿™é‡Œ<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L972">Makefile</a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">init-y		:= <span class="variable">$(<span class="built_in">patsubst</span> %/, %/built-in.a, $(init-y)</span>)</span><br><span class="line">core-y		:= <span class="variable">$(<span class="built_in">patsubst</span> %/, %/built-in.a, $(core-y)</span>)</span><br><span class="line">drivers-y	:= <span class="variable">$(<span class="built_in">patsubst</span> %/, %/built-in.a, $(drivers-y)</span>)</span><br><span class="line">net-y		:= <span class="variable">$(<span class="built_in">patsubst</span> %/, %/built-in.a, $(net-y)</span>)</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥init-yã€drivers-y å’Œ net-y æœ€ç»ˆçš„å€¼ä¸ºï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nit-y = init/built-in.a</span><br><span class="line">drivers-y = drivers/built-in.a sound/built-in.a firmware/built-in.a</span><br><span class="line">net-y = net/built-in.a</span><br></pre></td></tr></table></figure>

<h4 id="3-2-3-libs-y1å’Œlibs-y2"><a href="#3-2-3-libs-y1å’Œlibs-y2" class="headerlink" title="3.2.3 libs-y1å’Œlibs-y2"></a><font size=3>3.2.3 libs-y1å’Œlibs-y2</font></h4><p>libs-y1ã€ libs-y2åŸºæœ¬å’Œ init-y ä¸€æ ·ï¼Œåœ¨é¡¶å±‚ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L976">Makefile - <em>libs-y1å’Œlibs-y2</em></a> ä¸­æœ‰å¦‚ä¸‹å®šä¹‰ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">libs-y1		:= <span class="variable">$(<span class="built_in">patsubst</span> %/, %/lib.a, $(libs-y)</span>)</span><br><span class="line">libs-y2		:= <span class="variable">$(<span class="built_in">patsubst</span> %/, %/built-in.a, $(<span class="built_in">filter</span>-out %.a, $(libs-y)</span>))</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­libs-yå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L584">Makefile - <em>libs-y</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">libs-y		:= lib/</span><br></pre></td></tr></table></figure>

<p>å¦å¤–ï¼Œè¿™ä¸ªlibs-yåœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/arch/arm/Makefile#L300">Makefile - arch&#x2F;arm&#x2F;Makefile - <em>libs-y</em></a> ä¸­ä¹Ÿæœ‰å®šä¹‰ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">libs-y				:= arch/arm/lib/ $(libs-y)</span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆlibs-yçš„å€¼ä¸ºï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">libs-y = arch/arm/lib lib/</span><br></pre></td></tr></table></figure>

<p>libs-y2ä¸­filter-outæ˜¯åè¿‡æ»¤å‡½æ•°ï¼Œå°±æ˜¯åŒ¹é…é™¤.aç»“å°¾çš„æ–‡ä»¶ä»¥å¤–çš„æ–‡ä»¶ï¼Œç„¶åå†åŒ¹é…ç›®å½•ä¸­çš„built-in.aï¼Œæ‰€ä»¥è¿™é‡Œå°±æœ‰</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">libs-y1		:= arch/arm/lib/lib.a lib/lib.a</span><br><span class="line">libs-y2		:= arch/arm/lib/built-in.a lib/built-in.a</span><br></pre></td></tr></table></figure>

<h4 id="3-2-4-core-y"><a href="#3-2-4-core-y" class="headerlink" title="3.2.4 core-y"></a><font size=3>3.2.4 core-y</font></h4><p>core-yå®šä¹‰åœ¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L585">Makefile - <em>Objects we will link into vmlinux &#x2F; subdirs we need to visit</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">core-y		:= usr/</span><br></pre></td></tr></table></figure>

<p>åœ¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L963">Makefile - <em>core-y</em></a> è¿™é‡Œä¼šè¿½åŠ ä¸€äº›å€¼ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">core-y		+= kernel/ certs/ mm/ fs/ ipc/ security/ crypto/ block/</span><br><span class="line"><span class="comment">#......</span></span><br><span class="line">core-y		:= <span class="variable">$(<span class="built_in">patsubst</span> %/, %/built-in.a, $(core-y)</span>)</span><br></pre></td></tr></table></figure>

<p>åœ¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/arch/arm/Makefile#L291">Makefile - arch&#x2F;arm&#x2F;Makefile - <em>core-y</em></a> ä¹Ÿä¼šè¿½åŠ ä¸€äº›å€¼ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">core-<span class="variable">$(CONFIG_FPE_NWFPE)</span>	+= arch/arm/nwfpe/</span><br><span class="line">core-<span class="variable">$(CONFIG_FPE_FASTFPE)</span>	+= <span class="variable">$(FASTFPE_OBJ)</span></span><br><span class="line">core-<span class="variable">$(CONFIG_VFP)</span>		+= arch/arm/vfp/</span><br><span class="line">core-<span class="variable">$(CONFIG_XEN)</span>		+= arch/arm/xen/</span><br><span class="line">core-<span class="variable">$(CONFIG_KVM_ARM_HOST)</span> 	+= arch/arm/kvm/</span><br><span class="line">core-<span class="variable">$(CONFIG_VDSO)</span>		+= arch/arm/vdso/</span><br><span class="line"></span><br><span class="line"><span class="comment"># If we have a machine-specific directory, then include it in the build.</span></span><br><span class="line">core-y				+= arch/arm/kernel/ arch/arm/mm/ arch/arm/common/</span><br><span class="line">core-y				+= arch/arm/probes/</span><br><span class="line">core-y				+= arch/arm/net/</span><br><span class="line">core-y				+= arch/arm/crypto/</span><br><span class="line">core-y				+= arch/arm/firmware/</span><br><span class="line">core-y				+= <span class="variable">$(machdirs)</span> <span class="variable">$(platdirs)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰ä¸€éƒ¨åˆ†æ ¹æ®ä¸åŒçš„é…ç½®å‘ core-y è¿½åŠ ä¸åŒçš„å€¼ï¼Œæ¯”å¦‚ä½¿èƒ½ VFP çš„è¯å°±ä¼šåœ¨.config ä¸­æœ‰ CONFIG_VFP&#x3D;y è¿™ä¸€è¡Œï¼Œé‚£ä¹ˆ core-y å°±ä¼šè¿½åŠ â€œarch&#x2F;arm&#x2F;vfp&#x2F;â€ã€‚å¦å¤–ä¸€éƒ¨åˆ†å°±æ˜¯å¯¹ core-y ç›´æ¥è¿½åŠ çš„å€¼ã€‚æ‰€ä»¥æ€»çš„æ¥è¯´ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">core-y		        := usr/</span><br><span class="line">core-y		        += kernel/ certs/ mm/ fs/ ipc/ security/ crypto/ block/</span><br><span class="line">core-y				+= arch/arm/kernel/ arch/arm/mm/ arch/arm/common/</span><br><span class="line">core-y				+= arch/arm/probes/</span><br><span class="line">core-y				+= arch/arm/net/</span><br><span class="line">core-y				+= arch/arm/crypto/</span><br><span class="line">core-y				+= arch/arm/firmware/</span><br><span class="line">core-y				+= <span class="variable">$(machdirs)</span> <span class="variable">$(platdirs)</span></span><br><span class="line">core-<span class="variable">$(CONFIG_FPE_NWFPE)</span>	+= arch/arm/nwfpe/</span><br><span class="line">core-<span class="variable">$(CONFIG_FPE_FASTFPE)</span>	+= <span class="variable">$(FASTFPE_OBJ)</span></span><br><span class="line">core-<span class="variable">$(CONFIG_VFP)</span>		    += arch/arm/vfp/</span><br><span class="line">core-<span class="variable">$(CONFIG_XEN)</span>		    += arch/arm/xen/</span><br><span class="line">core-<span class="variable">$(CONFIG_KVM_ARM_HOST)</span> += arch/arm/kvm/</span><br><span class="line">core-<span class="variable">$(CONFIG_VDSO)</span>		    += arch/arm/vdso/</span><br></pre></td></tr></table></figure>

<p>æœ€åæœ‰ä¸€å¥<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L973">Makefile - <em>core-y</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">core-y		:= <span class="variable">$(<span class="built_in">patsubst</span> %/, %/built-in.a, $(core-y)</span>)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ˜¯core-yæœ€ç»ˆåŒ¹é…çš„æ–‡ä»¶ï¼Œå°±æ˜¯åŒ¹é…ä¸Šé¢æ‰€æœ‰çš„ç›®å½•ä¸­çš„built-in.aæ–‡ä»¶ã€‚</p>
<h4 id="3-2-5-æ€»ç»“"><a href="#3-2-5-æ€»ç»“" class="headerlink" title="3.2.5 æ€»ç»“"></a><font size=3>3.2.5 æ€»ç»“</font></h4><p>è¿™äº›å˜é‡éƒ½æ˜¯ä¸€äº› built-in.o æˆ–.a ç­‰æ–‡ä»¶ï¼Œè¿™ä¸ªå’Œ uboot ä¸€æ ·ï¼Œéƒ½æ˜¯å°†ç›¸åº”ç›®å½•ä¸­çš„æºç æ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼Œç„¶ååœ¨å„è‡ªç›®å½•ä¸‹ç”Ÿæˆ built-in.o æ–‡ä»¶ï¼Œæœ‰äº›ç”Ÿæˆäº†.a åº“æ–‡ä»¶ã€‚æœ€ç»ˆå°†è¿™äº› built-in.o å’Œ.a æ–‡ ä»¶è¿›è¡Œé“¾æ¥å³å¯å½¢æˆ ELF æ ¼å¼çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯ vmlinuxï¼ä½†æ˜¯é“¾æ¥æ˜¯éœ€è¦é“¾æ¥è„šæœ¬çš„ï¼Œ vmlinux çš„ä¾èµ– arch&#x2F;arm&#x2F;kernel&#x2F;vmlinux.lds å°±æ˜¯æ•´ä¸ª Linux çš„é“¾æ¥è„šæœ¬ã€‚</p>
<h3 id="3-3-if-changedå‡½æ•°"><a href="#3-3-if-changedå‡½æ•°" class="headerlink" title="3.3Â if_changedå‡½æ•°"></a><font size=3>3.3Â if_changedå‡½æ•°</font></h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹if_changedå‡½æ•°ï¼Œå‰é¢æˆ‘ä»¬å°†vmlinuxç›®æ ‡çš„è§„åˆ™å±•å¼€å¾—åˆ°ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">vmlinux: scripts/link-vmlinux.sh autoksyms_recursive $(head-y) $(init-y) $(core-y) $(libs-y2) $(drivers-y) $(net-y) $(virt-y) $(libs-y1) arch/<span class="variable">$(SRCARCH)</span>/kernel/vmlinux.lds FORCE</span></span><br><span class="line">	+<span class="variable">$(<span class="built_in">call</span> if_changed,link-vmlinux)</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œ<code>+</code>è¡¨ç¤ºè¯¥å‘½ä»¤ç»“æœä¸å¯å¿½ç•¥ã€‚è¿™é‡Œè¡¨ç¤ºå°†if_changedå‡½æ•°çš„ç»“æœä½œä¸ºæœ€ç»ˆç”Ÿæˆ vmlinux çš„å‘½ä»¤ã€‚ï¼Œlink-vmlinux æ˜¯å‡½æ•° if_changed çš„ å‚æ•°ï¼Œå‡½æ•° if_changed å®šä¹‰åœ¨æ–‡ä»¶ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Kbuild.include#L259">Kbuild.include - scripts&#x2F;Kbuild.include - <em>if_changed</em></a> ä¸­ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Execute command if command has changed or prerequisite(s) are updated.</span></span><br><span class="line">if_changed = <span class="variable">$(<span class="built_in">if</span> $(<span class="built_in">strip</span> $(any-prereq)</span> $(arg-check)),                       \</span><br><span class="line">	@set -e;                                                             \</span><br><span class="line">	$(echo-cmd) $(cmd_$(1));                                             \</span><br><span class="line">	printf &#x27;%s\n&#x27; &#x27;cmd_<span class="variable">$@</span> := $(make-cmd)&#x27; &gt; $(dot-target).cmd, @:)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>any-prereq ç”¨äºæ£€æŸ¥ä¾èµ–æ–‡ä»¶æ˜¯å¦æœ‰å˜åŒ–ï¼Œå¦‚æœä¾èµ–æ–‡ä»¶æœ‰å˜åŒ–é‚£ä¹ˆ any-prereq å°±ä¸ä¸º ç©ºï¼Œå¦åˆ™å°±ä¸ºç©ºã€‚</p>
</li>
<li><p>arg-check ç”¨äºæ£€æŸ¥å‚æ•°æ˜¯å¦æœ‰å˜åŒ–ï¼Œå¦‚æœæ²¡æœ‰å˜åŒ–é‚£ä¹ˆ arg-check å°±ä¸ºç©ºã€‚</p>
</li>
<li><p><code>@set -e</code>å‘Šè¯‰ bashï¼Œå¦‚æœä»»ä½•è¯­å¥çš„æ‰§è¡Œç»“æœä¸ä¸º true(ä¹Ÿå°±æ˜¯æ‰§è¡Œå‡ºé”™)çš„ è¯å°±ç›´æ¥é€€å‡ºã€‚</p>
</li>
<li><p><code>$(echo-cmd)</code>ç”¨äºæ‰“å°å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ï¼Œæ¯”å¦‚åœ¨é“¾æ¥ vmlinux çš„æ—¶å€™å°±ä¼šè¾“å‡º â€œLINK vmlinuxâ€ã€‚</p>
</li>
<li><p><code>$(cmd_$(1))</code>ä¸­çš„<code>$(1)</code>è¡¨ç¤ºå‚æ•°ï¼Œä¹Ÿå°±æ˜¯ link-vmlinuxï¼Œå› æ­¤<code>$(cmd_$(1))</code>è¡¨ç¤º æ‰§è¡Œ cmd_link-vmlinux çš„å†…å®¹ã€‚</p>
</li>
</ul>
<h4 id="3-3-1-any-prereq"><a href="#3-3-1-any-prereq" class="headerlink" title="3.3.1Â any-prereq"></a><font size=3>3.3.1Â any-prereq</font></h4><p>any-prereqå®šä¹‰åœ¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Kbuild.include#L259">Kbuild.include - scripts&#x2F;Kbuild.include - <em>any-prereq</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Find any prerequisites that is newer than target or that does not exist.</span></span><br><span class="line"><span class="comment"># PHONY targets skipped in both cases.</span></span><br><span class="line">any-prereq = <span class="variable">$(<span class="built_in">filter</span>-out <span class="variable">$(PHONY)</span>,<span class="variable">$?</span>)</span> <span class="variable">$(<span class="built_in">filter</span>-out <span class="variable">$(PHONY)</span> $(<span class="built_in">wildcard</span> <span class="variable">$^</span>)</span>,<span class="variable">$^</span>)</span><br></pre></td></tr></table></figure>

<h4 id="3-3-2-arg-check"><a href="#3-3-2-arg-check" class="headerlink" title="3.3.2Â arg-check"></a><font size=3>3.3.2Â arg-check</font></h4><p>arg-checkå®šä¹‰åœ¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Kbuild.include#L238">Kbuild.include - scripts&#x2F;Kbuild.include - <em>arg-check</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ifneq</span> (<span class="variable">$(KBUILD_NOCMDDEP)</span>,1)</span><br><span class="line"><span class="comment"># Check if both arguments are the same including their order. Result is empty</span></span><br><span class="line"><span class="comment"># string if equal. User may override this check using make KBUILD_NOCMDDEP=1</span></span><br><span class="line">arg-check = <span class="variable">$(<span class="built_in">filter</span>-out $(<span class="built_in">subst</span> <span class="variable">$(space)</span>,<span class="variable">$(space_escape)</span>,$(<span class="built_in">strip</span> $(cmd_<span class="variable">$@</span>)</span>)), \</span><br><span class="line">                         <span class="variable">$(<span class="built_in">subst</span> <span class="variable">$(space)</span>,<span class="variable">$(space_escape)</span>,$(<span class="built_in">strip</span> $(cmd_$1)</span>)))</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">arg-check = <span class="variable">$(<span class="built_in">if</span> $(<span class="built_in">strip</span> $(cmd_<span class="variable">$@</span>)</span>),,1)</span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<h4 id="3-3-3-cmd-1"><a href="#3-3-3-cmd-1" class="headerlink" title="3.3.3Â cmd_$(1)"></a><font size=3>3.3.3Â cmd_$(1)</font></h4><p>æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹è¿™ä¸ª<code>cmd_$(1)</code>ï¼Œå‰é¢æˆ‘ä»¬çŸ¥é“è¿™ä¸ªæ˜¯ cmd_link-vmlinuxï¼Œå®ƒå®šä¹‰åœ¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L1015">Makefile - <em>cmd_link-vmlinux</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Final link of vmlinux with optional arch pass after final link</span></span><br><span class="line">cmd_link-vmlinux =                                                 \</span><br><span class="line">	<span class="variable">$(CONFIG_SHELL)</span> <span class="variable">$&lt;</span> <span class="variable">$(LD)</span> <span class="variable">$(KBUILD_LDFLAGS)</span> <span class="variable">$(LDFLAGS_vmlinux)</span> ;    \</span><br><span class="line">	<span class="variable">$(<span class="built_in">if</span> <span class="variable">$(ARCH_POSTLINK)</span>, <span class="variable">$(MAKE)</span> -f <span class="variable">$(ARCH_POSTLINK)</span> <span class="variable">$@</span>, true)</span></span><br></pre></td></tr></table></figure>

<ul>
<li>CONFIG_SHELLå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L353">Makefile - <em>CONFIG_SHELL</em></a></li>
</ul>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># SHELL used by kbuild</span></span><br><span class="line">CONFIG_SHELL := <span class="variable">$(<span class="built_in">shell</span> <span class="built_in">if</span> [ -x &quot;$$BASH&quot; ]; then echo $$BASH; \</span></span><br><span class="line"><span class="variable">	  else <span class="built_in">if</span> [ -x /bin/bash ]; then echo /bin/bash; \</span></span><br><span class="line"><span class="variable">	  else echo sh; fi ; fi)</span></span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆCONFIG_SHELL&#x3D;&#x2F;bin&#x2F;bashã€‚</p>
<ul>
<li><code>$&lt;</code> è¡¨ç¤ºç›®æ ‡ vmlinux çš„ç¬¬ä¸€ä¸ªä¾èµ–æ–‡ä»¶ï¼š</li>
</ul>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">vmlinux: scripts/link-vmlinux.sh autoksyms_recursive $(vmlinux-deps) FORCE</span></span><br><span class="line"><span class="keyword">ifdef</span> CONFIG_HEADERS_CHECK</span><br><span class="line">	<span class="variable">$(Q)</span><span class="variable">$(MAKE)</span> -f <span class="variable">$(srctree)</span>/Makefile headers_check</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"><span class="keyword">ifdef</span> CONFIG_GDB_SCRIPTS</span><br><span class="line">	<span class="variable">$(Q)</span>ln -fsn <span class="variable">$(<span class="built_in">abspath</span> <span class="variable">$(srctree)</span>/scripts/gdb/vmlinux-gdb.py)</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line">	+<span class="variable">$(<span class="built_in">call</span> if_changed,link-vmlinux)</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œ<code>$&lt;</code>å°±æ˜¯scripts&#x2F;link-vmlinux.shã€‚</p>
<ul>
<li>LDå°±æ˜¯é“¾æ¥å·¥å…·ï¼Œå°±å®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L372">Makefile - <em>LD</em></a>ï¼Œè¿™é‡Œå°±æ˜¯LD&#x3D; arm-linux-gnueabihf-ldã€‚</li>
<li>KBUILD_LDFLAGSå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L431">Makefile - <em>KBUILD_LDFLAGS</em></a>ï¼Œåœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/arch/arm/Makefile#L51">Makefile - arch&#x2F;arm&#x2F;Makefile - <em>KBUILD_LDFLAGS</em></a>ä¸­æœ‰è¿½åŠ ï¼Œæœ€ç»ˆå®ƒçš„å€¼ä¸º-ELã€‚</li>
<li>LDFLAGS_vmlinuxçš„å€¼ç”±é¡¶å±‚ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L400">Makefile</a> å’Œ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/arch/arm/Makefile#L13">Makefile - arch&#x2F;arm&#x2F;Makefile</a> è¿™ä¸¤ä¸ªæ–‡ä»¶å…±åŒå†³å®šã€‚</li>
</ul>
<p>å…¶å®è¿™ä¸ªåœ°æ–¹ç”±äºæ¶‰åŠçš„åœ°æ–¹è¾ƒå¤šï¼Œæˆ‘ä»¬å¯ä»¥åŠ ä¸ªæ‰“å°ä¿¡æ¯ï¼Œè¿™ä¸ª <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/arch/arm/Makefile#L13">Makefile - arch&#x2F;arm&#x2F;Makefile</a> æ–‡ä»¶åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L527">Makefile</a>ä¸­è¢«è°ƒç”¨ï¼ŒLDFLAGS_vmlinuxåœ¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L985">Makefile - <em>LDFLAGS_vmlinux</em></a> è¿™é‡Œè¢«å¯¼å‡ºï¼Œæˆ‘ä»¬å¯ä»¥åŠ ä¸ªæ‰“å°ä¿¡æ¯çœ‹ä¸€ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo <span class="string">&quot;LDFLAGS_vmlinux=<span class="variable">$(LDFLAGS_vmlinux)</span>&quot;</span></span><br><span class="line">+<span class="variable">$(<span class="built_in">call</span> if_changed,link-vmlinux)</span> </span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">make V=0 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- distclean</span><br><span class="line">make V=0 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- imx_v6_v7_defconfig</span><br><span class="line">make V=1 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- all -j16</span><br></pre></td></tr></table></figure>

<p>ä¼šçœ‹åˆ°ä»¥ä¸‹è¾“å‡ºä¿¡æ¯ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LDFLAGS_vmlinux=-p --no-undefined -X --pic-veneer  --build-id</span><br></pre></td></tr></table></figure>

<ul>
<li>ARCH_POSTLINKå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L1012">Makefile - <em>ARCH_POSTLINK</em></a></li>
</ul>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ARCH_POSTLINK := <span class="variable">$(<span class="built_in">wildcard</span> <span class="variable">$(srctree)</span>/arch/<span class="variable">$(SRCARCH)</span>/Makefile.postlink)</span></span><br></pre></td></tr></table></figure>

<p>srctree&#x3D;<code>.</code>ï¼ŒSRCARCH&#x3D;armï¼Œæ‰€ä»¥è¿™é‡Œå°±æ˜¯.&#x2F;arch&#x2F;arm&#x2F;Makefile.postlinkï¼Œè¿™ä¸ªåº”è¯¥æ˜¯ç¼–è¯‘ç”Ÿæˆçš„æ–‡ä»¶å§ï¼Œæˆ‘ä¹Ÿä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œæˆ‘å»ä½¿ç”¨V&#x3D;1å‚æ•°ç¼–è¯‘äº†ä¸€ä¸‹ï¼Œæ²¡æœ‰åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­å‘ç°è¿™ä¸ªæ–‡ä»¶ï¼Œä¹Ÿæ²¡æœ‰åœ¨ç¼–è¯‘å®Œæˆååœ¨ .&#x2F;arch&#x2F;arm ç›®å½•ä¸‹å‘ç°è¿™ä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥è¿™é‡Œè¿™ä¸ªARCH_POSTLINKåº”è¯¥æ˜¯ä¸ºç©ºã€‚</p>
<ul>
<li><code>$@</code>å°±æ˜¯ç›®æ ‡æ–‡ä»¶vmlinux</li>
</ul>
<p>æ‰€ä»¥å±•å¼€å°±æ˜¯ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Final link of vmlinux with optional arch pass after final link</span></span><br><span class="line">cmd_link-vmlinux =                                                 \</span><br><span class="line">	/bin/bash scripts/link-vmlinux.sh -p --no-undefined -X --pic-veneer  --build-id; \</span><br><span class="line">	true</span><br></pre></td></tr></table></figure>

<h4 id="3-3-4-link-vmlinux-sh"><a href="#3-3-4-link-vmlinux-sh" class="headerlink" title="3.3.4Â link-vmlinux.sh"></a><font size=3>3.3.4Â link-vmlinux.sh</font></h4><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªè„šæœ¬ï¼Œå®ƒåœ¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/link-vmlinux.sh">link-vmlinux.sh - scripts&#x2F;link-vmlinux.sh</a>ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Link of vmlinux</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="variable">$&#123;1&#125;</span> - optional extra .o files</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="variable">$&#123;2&#125;</span> - output file</span></span><br><span class="line">vmlinux_link()</span><br><span class="line">&#123;</span><br><span class="line">	local lds=&quot;$&#123;objtree&#125;/$&#123;KBUILD_LDS&#125;&quot;</span><br><span class="line">	local objects</span><br><span class="line"></span><br><span class="line">	if [ &quot;$&#123;SRCARCH&#125;&quot; != &quot;um&quot; ]; then</span><br><span class="line">		objects=&quot;--whole-archive			\</span><br><span class="line">			built-in.a				\</span><br><span class="line">			--no-whole-archive			\</span><br><span class="line">			--start-group				\</span><br><span class="line"><span class="meta prompt_">			$</span><span class="language-bash">&#123;KBUILD_VMLINUX_LIBS&#125;			\</span></span><br><span class="line"><span class="language-bash">			--end-group				\</span></span><br><span class="line"><span class="language-bash">			<span class="variable">$&#123;1&#125;</span><span class="string">&quot;</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash"><span class="string">&#123;LD&#125; <span class="variable">$&#123;KBUILD_LDFLAGS&#125;</span> <span class="variable">$&#123;LDFLAGS_vmlinux&#125;</span> -o <span class="variable">$&#123;2&#125;</span>	\</span></span></span><br><span class="line"><span class="string"><span class="language-bash">			-T <span class="variable">$&#123;lds&#125;</span> <span class="variable">$&#123;objects&#125;</span></span></span></span><br><span class="line">	else</span><br><span class="line">		objects=&quot;-Wl,--whole-archive			\</span><br><span class="line">			built-in.a				\</span><br><span class="line">			-Wl,--no-whole-archive			\</span><br><span class="line">			-Wl,--start-group			\</span><br><span class="line"><span class="meta prompt_">			$</span><span class="language-bash"><span class="string">&#123;KBUILD_VMLINUX_LIBS&#125;			\</span></span></span><br><span class="line"><span class="string"><span class="language-bash">			-Wl,--end-group				\</span></span></span><br><span class="line"><span class="string"><span class="language-bash">			<span class="variable">$&#123;1&#125;</span>&quot;</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">&#123;CC&#125; <span class="variable">$&#123;CFLAGS_vmlinux&#125;</span> -o <span class="variable">$&#123;2&#125;</span>			\</span></span><br><span class="line"><span class="language-bash">			-Wl,-T,<span class="variable">$&#123;lds&#125;</span>				\</span></span><br><span class="line"><span class="language-bash">			<span class="variable">$&#123;objects&#125;</span>				\</span></span><br><span class="line"><span class="language-bash">			-lutil -lrt -lpthread</span></span><br><span class="line">		rm -f linux</span><br><span class="line">	fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">......</span></span><br><span class="line">info LD vmlinux</span><br><span class="line">vmlinux_link &quot;$&#123;kallsymso&#125;&quot; vmlinux</span><br></pre></td></tr></table></figure>

<p>vmliux_link å°±æ˜¯æœ€ç»ˆé“¾æ¥å‡º vmlinux çš„å‡½æ•°ã€‚</p>
<ul>
<li><p>ç¬¬ 9 è¡Œåˆ¤æ–­ SRCARCH æ˜¯å¦ç­‰äºâ€œumâ€ï¼Œå¦‚ æœä¸ç›¸ç­‰çš„è¯å°±æ‰§è¡Œ 20~34 è¡Œçš„ä»£ç ã€‚å› ä¸º SRCARCH&#x3D;armï¼Œå› æ­¤æ¡ä»¶æˆç«‹ï¼Œæ‰§è¡Œ10~19 è¡Œçš„ä»£ç ã€‚</p>
</li>
<li><p>ç¬¬18 ~ 19è¡Œçš„ä»£ç å°±æ˜¯æˆ‘ä»¬ä¹‹å‰çš„é“¾æ¥æ“ä½œã€‚é“¾æ¥è„šæœ¬lds&#x3D; .&#x2F;arch&#x2F;arm&#x2F;kernel&#x2F;vmlinux.ldsã€‚éœ€è¦é“¾æ¥çš„æ–‡ä»¶ç”±å˜é‡ KBUILD_VMLINUX_INIT å’Œ KBUILD_VMLINUX_MAIN æ¥å†³å®šã€‚</p>
</li>
</ul>
<p>KBUILD_VMLINUX_INITå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L981">Makefile - <em>KBUILD_VMLINUX_INIT</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> KBUILD_VMLINUX_INIT := $(head-y) $(init-y)</span><br></pre></td></tr></table></figure>

<p>KBUILD_VMLINUX_MAINå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L982">Makefile - <em>KBUILD_VMLINUX_MAIN</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> KBUILD_VMLINUX_MAIN := $(core-y) $(libs-y2) $(drivers-y) $(net-y) $(virt-y)</span><br></pre></td></tr></table></figure>

<p>å‰é¢åŸºæœ¬å·²ç»åˆ†æè¿‡äº†ï¼Œä½† <code>$(virt-y)</code>è¿™ä¸ªåˆšæ‰æ²¡åˆ†æï¼Œä¸è¿‡éƒ½æ˜¯ä¸€æ ·çš„é“ç†ã€‚</p>
<ul>
<li>ç¬¬ 37 è¡Œè°ƒç”¨ vmlinux_link å‡½æ•°æ¥é“¾æ¥å‡º vmlinuxã€‚</li>
</ul>
<h3 id="3-4-æ‰“å°ä¿¡æ¯"><a href="#3-4-æ‰“å°ä¿¡æ¯" class="headerlink" title="3.4 æ‰“å°ä¿¡æ¯"></a><font size=3>3.4 æ‰“å°ä¿¡æ¯</font></h3><p>ä¸Šé¢åˆ†æäº†é‚£ä¹ˆå¤šï¼Œæˆ‘ä»¬è¯¦ç»†æ¥çœ‹ä¸€ä¸‹æ‰“å°ä¿¡æ¯å§ï¼Œæˆ‘ä»¬æ·»åŠ ä¸ªèµ·å§‹å’Œç»“å°¾æ ‡è®°ï¼Œæ–¹ä¾¿æŸ¥æ‰¾ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">vmlinux: scripts/link-vmlinux.sh autoksyms_recursive $(vmlinux-deps) FORCE</span></span><br><span class="line">	echo <span class="string">&quot;========== vmlinux-start ==========&quot;</span></span><br><span class="line"><span class="keyword">ifdef</span> CONFIG_HEADERS_CHECK</span><br><span class="line">	<span class="variable">$(Q)</span><span class="variable">$(MAKE)</span> -f <span class="variable">$(srctree)</span>/Makefile headers_check</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"><span class="keyword">ifdef</span> CONFIG_GDB_SCRIPTS</span><br><span class="line">	<span class="variable">$(Q)</span>ln -fsn <span class="variable">$(<span class="built_in">abspath</span> <span class="variable">$(srctree)</span>/scripts/gdb/vmlinux-gdb.py)</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line">	echo <span class="string">&quot;========== vmlinux-if_changed ==========&quot;</span></span><br><span class="line">	+<span class="variable">$(<span class="built_in">call</span> if_changed,link-vmlinux)</span></span><br><span class="line">	echo <span class="string">&quot;========== vmlinux-end ==========&quot;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">make V=0 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- distclean</span><br><span class="line">make V=0 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- imx_v6_v7_defconfig</span><br><span class="line">make V=1 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- all -j16</span><br></pre></td></tr></table></figure>

<p>ç„¶åå°±å¯ä»¥çœ‹åˆ°æ‰“å°ä¿¡æ¯ä¸­è¿™ä¸ªvmlinuxè§„åˆ™éƒ½åœ¨åšäº›ä»€ä¹ˆï¼Œè¿™é‡Œæ˜¯ä¸€äº›ç®€åŒ–åçš„é‡è¦æ‰“å°ä¿¡æ¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;========== vmlinux-start ==========&quot;</span><br><span class="line">========== vmlinux-start ==========</span><br><span class="line">echo &quot;========== vmlinux-if_changed ==========&quot;</span><br><span class="line">========== vmlinux-if_changed ==========</span><br><span class="line">  /bin/sh scripts/link-vmlinux.sh arm-linux-gnueabihf-ld  -EL -p --no-undefined -X --pic-veneer  --build-id ;  true</span><br><span class="line">+ &#x27;[&#x27; arm-linux-gnueabihf-ld = clean &#x27;]&#x27;</span><br><span class="line">+ case &quot;$&#123;KCONFIG_CONFIG&#125;&quot; in</span><br><span class="line">+ . ./.config</span><br><span class="line">++ CONFIG_CC_IS_GCC=y</span><br><span class="line">++ CONFIG_GCC_VERSION=40902</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸­é—´éƒ¨åˆ†çœç•¥......</span></span><br><span class="line"></span><br><span class="line">+ local objects</span><br><span class="line">+ &#x27;[&#x27; arm &#x27;!=&#x27; um &#x27;]&#x27;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸­é—´éƒ¨åˆ†çœç•¥......</span></span><br><span class="line">+ arm-linux-gnueabihf-ld -EL -p --no-undefined -X --pic-veneer --build-id -o vmlinux -T ./arch/arm/kernel/vmlinux.lds --whole-archive built-in.a --no-whole-archive --start-group arch/arm/lib/lib.a lib/lib.a --end-group .tmp_kallsyms2.o</span><br><span class="line">+ &#x27;[&#x27; -n y &#x27;]&#x27;</span><br><span class="line">+ info SORTEX vmlinux</span><br><span class="line">+ &#x27;[&#x27; &#x27;&#x27; &#x27;!=&#x27; silent_ &#x27;]&#x27;</span><br><span class="line">+ printf &#x27;  %-7s %s\n&#x27; SORTEX vmlinux</span><br><span class="line">  SORTEX  vmlinux</span><br><span class="line">+ sortextable vmlinux</span><br><span class="line">+ ./scripts/sortextable vmlinux</span><br><span class="line">+ info SYSMAP System.map</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸­é—´éƒ¨åˆ†çœç•¥......</span></span><br><span class="line">echo &quot;========== vmlinux-end ==========&quot;</span><br><span class="line">========== vmlinux-end ==========</span><br></pre></td></tr></table></figure>

<p>ä»è¿™é‡Œçœ‹ï¼Œå‰é¢åˆ†æçš„ä¸€äº›å˜é‡çš„å€¼éƒ½æ˜¯æ­£ç¡®çš„ã€‚</p>
<h2 id="4-built-in-aç”Ÿæˆè¿‡ç¨‹"><a href="#4-built-in-aç”Ÿæˆè¿‡ç¨‹" class="headerlink" title="4. built-in.aç”Ÿæˆè¿‡ç¨‹"></a><font size=3>4. built-in.aç”Ÿæˆè¿‡ç¨‹</font></h2><h3 id="4-1-vmlinux-depså˜é‡"><a href="#4-1-vmlinux-depså˜é‡" class="headerlink" title="4.1Â vmlinux-depså˜é‡"></a><font size=3>4.1Â vmlinux-depså˜é‡</font></h3><p>å‰é¢åœ¨åˆ†æ<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L1019">Makefile - <em>vmlinux</em></a>çš„æ—¶å€™ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">vmlinux: scripts/link-vmlinux.sh autoksyms_recursive $(vmlinux-deps) FORCE</span></span><br><span class="line"><span class="keyword">ifdef</span> CONFIG_HEADERS_CHECK</span><br><span class="line">	<span class="variable">$(Q)</span><span class="variable">$(MAKE)</span> -f <span class="variable">$(srctree)</span>/Makefile headers_check</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"><span class="keyword">ifdef</span> CONFIG_GDB_SCRIPTS</span><br><span class="line">	<span class="variable">$(Q)</span>ln -fsn <span class="variable">$(<span class="built_in">abspath</span> <span class="variable">$(srctree)</span>/scripts/gdb/vmlinux-gdb.py)</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line">	+<span class="variable">$(<span class="built_in">call</span> if_changed,link-vmlinux)</span></span><br></pre></td></tr></table></figure>

<p>vmlinuxæ˜¯ä¾èµ–vmlinux-depsçš„ï¼Œè€Œvmlinux-depså®šä¹‰åœ¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L989">Makefile - <em>vmlinux-deps</em></a> ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmlinux-deps := <span class="variable">$(KBUILD_LDS)</span> <span class="variable">$(KBUILD_VMLINUX_INIT)</span> <span class="variable">$(KBUILD_VMLINUX_MAIN)</span> <span class="variable">$(KBUILD_VMLINUX_LIBS)</span></span><br></pre></td></tr></table></figure>

<p>è¿™å‡ ä¸ªå˜é‡éƒ½å®šä¹‰ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L980">Makefile - <em>Externally visible symbols</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Externally visible symbols (used by link-vmlinux.sh)</span></span><br><span class="line"><span class="keyword">export</span> KBUILD_VMLINUX_INIT := $(head-y) $(init-y)</span><br><span class="line"><span class="keyword">export</span> KBUILD_VMLINUX_MAIN := $(core-y) $(libs-y2) $(drivers-y) $(net-y) $(virt-y)</span><br><span class="line"><span class="keyword">export</span> KBUILD_VMLINUX_LIBS := $(libs-y1)</span><br><span class="line"><span class="keyword">export</span> KBUILD_LDS          := arch/<span class="variable">$(SRCARCH)</span>/kernel/vmlinux.lds</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢äº›æˆ‘ä»¬å‰é¢éƒ½åˆ†æè¿‡äº†ï¼Œä»–ä»¬æœ€ç»ˆæ˜¯ä¸€ç³»åˆ—çš„<code>built-in.a</code>æ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥åŠ ä¸ªæ‰“å°ä¿¡æ¯çœ‹ä¸€çœ¼ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">vmlinux: scripts/link-vmlinux.sh autoksyms_recursive $(vmlinux-deps) FORCE</span></span><br><span class="line">	@echo <span class="string">&quot;vmlinux-deps=$(vmlinux-deps)&quot;</span></span><br><span class="line"><span class="keyword">ifdef</span> CONFIG_HEADERS_CHECK</span><br><span class="line">	<span class="variable">$(Q)</span><span class="variable">$(MAKE)</span> -f <span class="variable">$(srctree)</span>/Makefile headers_check</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"><span class="keyword">ifdef</span> CONFIG_GDB_SCRIPTS</span><br><span class="line">	<span class="variable">$(Q)</span>ln -fsn <span class="variable">$(<span class="built_in">abspath</span> <span class="variable">$(srctree)</span>/scripts/gdb/vmlinux-gdb.py)</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line">	+<span class="variable">$(<span class="built_in">call</span> if_changed,link-vmlinux)</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">make V=0 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- distclean</span><br><span class="line">make V=0 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- imx_v6_v7_defconfig</span><br><span class="line">make V=1 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- all -j16</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°æœ‰å¦‚ä¸‹æ‰“å°ä¿¡æ¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmlinux-deps=arch/arm/kernel/vmlinux.lds arch/arm/kernel/head.o  init/built-in.a  usr/built-in.a  arch/arm/vfp/built-in.a  arch/arm/vdso/built-in.a  arch/arm/kernel/built-in.a  arch/arm/mm/built-in.a  arch/arm/common/built-in.a  arch/arm/probes/built-in.a  arch/arm/net/built-in.a  arch/arm/crypto/built-in.a  arch/arm/firmware/built-in.a  arch/arm/mach-imx/built-in.a  kernel/built-in.a  certs/built-in.a  mm/built-in.a  fs/built-in.a  ipc/built-in.a  security/built-in.a  crypto/built-in.a  block/built-in.a  arch/arm/lib/built-in.a  lib/built-in.a  drivers/built-in.a  sound/built-in.a  firmware/built-in.a  net/built-in.a  virt/built-in.a  arch/arm/lib/lib.a  lib/lib.a</span><br></pre></td></tr></table></figure>

<p>é™¤äº† arch&#x2F;arm&#x2F;kernel&#x2F;vmlinux.lds ä»¥å¤–ï¼Œå…¶ä»–éƒ½æ˜¯è¦ç¼–è¯‘é“¾æ¥ç”Ÿæˆçš„ã€‚</p>
<h3 id="4-2-vmlinux-depsçš„ä¾èµ–"><a href="#4-2-vmlinux-depsçš„ä¾èµ–" class="headerlink" title="4.2 vmlinux-depsçš„ä¾èµ–"></a><font size=3>4.2 vmlinux-depsçš„ä¾èµ–</font></h3><p>æˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹vmlinux-depsï¼Œä¼šçœ‹åˆ°</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The actual objects are generated when descending,</span></span><br><span class="line"><span class="comment"># make sure no implicit rule kicks in</span></span><br><span class="line"><span class="variable">$(<span class="built_in">sort</span> $(vmlinux-deps)</span>): $(vmlinux-dirs) ;</span><br></pre></td></tr></table></figure>

<p>sortå‡½æ•°å°±æ˜¯ç”¨æ¥æ’åºçš„ï¼Œå®ƒä¸€èˆ¬æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">sort</span> &lt;list&gt;)</span></span><br></pre></td></tr></table></figure>

<p>ç»™å­—ç¬¦ä¸² list ä¸­çš„å•è¯æ’åºï¼ˆå‡åºï¼‰ï¼Œä¼šè¿”å›æ’åºåçš„å­—ç¬¦ä¸²ã€‚å¦å¤–sortå‡½æ•°ä¼šå»æ‰ list  ä¸­ç›¸åŒçš„å•è¯ã€‚å¦å¤–å¯ä»¥çœ‹å‡º vmlinux-deps ä¾èµ– vmlinux-dirsã€‚</p>
<h3 id="4-3-vmlinux-dirså˜é‡"><a href="#4-3-vmlinux-dirså˜é‡" class="headerlink" title="4.3Â vmlinux-dirså˜é‡"></a><font size=3>4.3Â vmlinux-dirså˜é‡</font></h3><p>vmlinux-dirs ä¹Ÿå®šä¹‰åœ¨é¡¶å±‚ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L965">Makefile - <em>vmlinux-dirs</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vmlinux-dirs	:= <span class="variable">$(<span class="built_in">patsubst</span> %/,%,$(<span class="built_in">filter</span> %/, $(init-y)</span> $(init-m) \</span><br><span class="line">		     $(core-y) $(core-m) $(drivers-y) $(drivers-m) \</span><br><span class="line">		     $(net-y) $(net-m) $(libs-y) $(libs-m) $(virt-y)))</span><br><span class="line">		     </span><br><span class="line"><span class="comment"># ......</span></span><br><span class="line"><span class="comment"># Build samples along the rest of the kernel. This needs headers_install.</span></span><br><span class="line"><span class="keyword">ifdef</span> CONFIG_SAMPLES</span><br><span class="line">vmlinux-dirs += samples</span><br><span class="line"><span class="section">samples: headers_install</span></span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p>vmlinux-dirs çœ‹åå­—å°±çŸ¥é“å’Œç›®å½•æœ‰å…³ï¼Œæ­¤å˜é‡ä¿å­˜ç€ç”Ÿæˆ vmlinux æ‰€éœ€æºç æ–‡ä»¶çš„ç›®å½•ã€‚è¿™é‡Œä¸åˆ†æäº†ï¼Œç›´æ¥æ·»åŠ æ‰“å°ä¿¡æ¯å§ï¼Œè¿˜æ˜¯åœ¨è¿™ä¸ªvmlinuxç›®æ ‡è¿™é‡ŒåŠ ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">vmlinux: scripts/link-vmlinux.sh autoksyms_recursive $(vmlinux-deps) FORCE</span></span><br><span class="line">	@echo <span class="string">&quot;vmlinux-dirs=$(vmlinux-dirs)&quot;</span></span><br><span class="line"><span class="keyword">ifdef</span> CONFIG_HEADERS_CHECK</span><br><span class="line">	<span class="variable">$(Q)</span><span class="variable">$(MAKE)</span> -f <span class="variable">$(srctree)</span>/Makefile headers_check</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"><span class="keyword">ifdef</span> CONFIG_GDB_SCRIPTS</span><br><span class="line">	<span class="variable">$(Q)</span>ln -fsn <span class="variable">$(<span class="built_in">abspath</span> <span class="variable">$(srctree)</span>/scripts/gdb/vmlinux-gdb.py)</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line">	+<span class="variable">$(<span class="built_in">call</span> if_changed,link-vmlinux)</span></span><br></pre></td></tr></table></figure>

<p>å’Œå‰é¢ä¸€æ ·ï¼Œæˆ‘ä»¬ç¼–è¯‘ä¸€éï¼Œä¼šå¾—åˆ°å¦‚ä¸‹æ‰“å°ä¿¡æ¯ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmlinux-dirs=init usr arch/arm/vfp arch/arm/vdso arch/arm/kernel arch/arm/mm arch/arm/common arch/arm/probes arch/arm/net arch/arm/crypto arch/arm/firmware arch/arm/mach-imx kernel certs mm fs ipc security crypto block drivers sound firmware net arch/arm/lib lib virt</span><br></pre></td></tr></table></figure>

<h3 id="4-4-vmlinux-dirsçš„ä¾èµ–"><a href="#4-4-vmlinux-dirsçš„ä¾èµ–" class="headerlink" title="4.4Â vmlinux-dirsçš„ä¾èµ–"></a><font size=3>4.4Â vmlinux-dirsçš„ä¾èµ–</font></h3><h4 id="4-4-1-è§„åˆ™å±•å¼€"><a href="#4-4-1-è§„åˆ™å±•å¼€" class="headerlink" title="4.4.1 è§„åˆ™å±•å¼€"></a><font size=3>4.4.1 è§„åˆ™å±•å¼€</font></h4><p>æˆ‘ä»¬ç»§ç»­å¾€åçœ‹ï¼Œä¼šçœ‹åˆ°vmlinux-dirsä¹Ÿæ˜¯æœ‰ä¾èµ–çš„ï¼Œå®ƒå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L1045">Makefile - <em>vmlinux-dirs</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Handle descending into subdirectories listed in $(vmlinux-dirs)</span></span><br><span class="line"><span class="comment"># Preset locale variables to speed up the build process. Limit locale</span></span><br><span class="line"><span class="comment"># tweaks to this spot to avoid wrong language settings when running</span></span><br><span class="line"><span class="comment"># make menuconfig etc.</span></span><br><span class="line"><span class="comment"># Error messages still appears in the original language</span></span><br><span class="line"></span><br><span class="line">PHONY += $(vmlinux-dirs)</span><br><span class="line"><span class="section">$(vmlinux-dirs): prepare scripts</span></span><br><span class="line">	<span class="variable">$(Q)</span><span class="variable">$(MAKE)</span> <span class="variable">$(build)</span>=<span class="variable">$@</span> need-builtin=1</span><br></pre></td></tr></table></figure>

<p>ç›®æ ‡ vmlinux-dirs ä¾èµ– prepare å’Œ scripts ã€‚è¿™ä¸¤ä¸ªä¾èµ–å°±æš‚æ—¶ä¸å»è¯¦ç»†äº†è§£äº†ã€‚æˆ‘ä»¬é‡ç‚¹çœ‹ä¸€ä¸‹ç¬¬9è¡Œçš„å‘½ä»¤ã€‚buildå‰é¢å·²ç»è¯´è¿‡äº†ï¼Œå®ƒå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Kbuild.include#L184">Kbuild.include - scripts&#x2F;Kbuild.include - <em>build</em></a>ï¼Œå€¼ä¸ºâ€ -f .&#x2F;scripts&#x2F;Makefile.build obj â€œï¼Œæ‰€ä»¥è¿™ä¸€è¡Œå‘½ä»¤å±•å¼€å°±æ˜¯ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@make -f ./scripts/Makefile.build obj=<span class="variable">$@</span> need-builtin=1</span><br></pre></td></tr></table></figure>

<p><code>$@</code>è¡¨ç¤ºç›®æ ‡æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯ vmlinux-dirs çš„å€¼ï¼Œå°† vmlinux-dirs ä¸­çš„è¿™äº›ç›®å½•å…¨éƒ¨å¸¦å…¥åˆ°å‘½ä»¤ä¸­ï¼Œç»“æœå¦‚ä¸‹ï¼š  </p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">@make -f ./scripts/Makefile.build obj=init need-builtin=1</span><br><span class="line">@make -f ./scripts/Makefile.build obj=usr need-builtin=1</span><br><span class="line">@make -f ./scripts/Makefile.build obj=arch/arm/vfp need-builtin=1</span><br><span class="line">@make -f ./scripts/Makefile.build obj=arch/arm/vdso need-builtin=1</span><br><span class="line">@make -f ./scripts/Makefile.build obj=arch/arm/kernel need-builtin=1</span><br><span class="line">@make -f ./scripts/Makefile.build obj=arch/arm/mm need-builtin=1</span><br><span class="line">@make -f ./scripts/Makefile.build obj=arch/arm/common need-builtin=1</span><br><span class="line">@make -f ./scripts/Makefile.build obj=arch/arm/probes need-builtin=1</span><br><span class="line">@make -f ./scripts/Makefile.build obj=arch/arm/net need-builtin=1</span><br><span class="line">@make -f ./scripts/Makefile.build obj=arch/arm/crypto need-builtin=1</span><br><span class="line">@make -f ./scripts/Makefile.build obj=arch/arm/firmware need-builtin=1</span><br><span class="line">@make -f ./scripts/Makefile.build obj=arch/arm/mach-imx need-builtin=1</span><br><span class="line">@make -f ./scripts/Makefile.build obj=kernel need-builtin=1</span><br><span class="line">@make -f ./scripts/Makefile.build obj=certs need-builtin=1</span><br><span class="line">@make -f ./scripts/Makefile.build obj=mm need-builtin=1</span><br><span class="line">@make -f ./scripts/Makefile.build obj=fs need-builtin=1</span><br><span class="line">@make -f ./scripts/Makefile.build obj=ipc need-builtin=1</span><br><span class="line">@make -f ./scripts/Makefile.build obj=security need-builtin=1</span><br><span class="line">@make -f ./scripts/Makefile.build obj=crypto need-builtin=1</span><br><span class="line">@make -f ./scripts/Makefile.build obj=block need-builtin=1</span><br><span class="line">@make -f ./scripts/Makefile.build obj=drivers need-builtin=1</span><br><span class="line">@make -f ./scripts/Makefile.build obj=sound need-builtin=1</span><br><span class="line">@make -f ./scripts/Makefile.build obj=firmware need-builtin=1</span><br><span class="line">@make -f ./scripts/Makefile.build obj=net need-builtin=1</span><br><span class="line">@make -f ./scripts/Makefile.build obj=arch/arm/lib need-builtin=1</span><br><span class="line">@make -f ./scripts/Makefile.build obj=lib need-builtin=1</span><br><span class="line">@make -f ./scripts/Makefile.build obj=virt need-builtin=1</span><br></pre></td></tr></table></figure>

<p>è¿™äº›å‘½ä»¤è¿è¡Œè¿‡ç¨‹å…¶å®éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬å°±ä»¥â€œ@ make -f .&#x2F;scripts&#x2F;Makefile.build obj&#x3D;init need-builtin&#x3D;1â€è¿™ä¸ªå‘½ä»¤ä¸ºä¾‹ æ¥åˆ†æä¸€ä¸‹ã€‚</p>
<h4 id="4-4-2-å‘½ä»¤åˆ†æ"><a href="#4-4-2-å‘½ä»¤åˆ†æ" class="headerlink" title="4.4.2 å‘½ä»¤åˆ†æ"></a><font size=3>4.4.2 å‘½ä»¤åˆ†æ</font></h4><p>æˆ‘ä»¬å…ˆçœ‹è¿™ä¸ª <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L80">Makefile.build - scripts&#x2F;Makefile.build</a>ä¸­çš„é»˜è®¤ç›®æ ‡__buildï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">__build: $(if <span class="variable">$(KBUILD_BUILTIN)</span>,$(builtin-target) $(lib-target) $(extra-y)) \</span></span><br><span class="line">	 <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(KBUILD_MODULES)</span>,$(obj-m)</span> $(modorder-target)) \</span><br><span class="line">	 $(subdir-ym) <span class="variable">$(always)</span></span><br><span class="line">	@:</span><br></pre></td></tr></table></figure>

<p>å½“åªç¼–è¯‘ Linux å†…æ ¸é•œåƒæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨â€œ make zImage â€ ç¼–è¯‘çš„æ—¶å€™ï¼ŒKBUILD_BUILTIN&#x3D;1ï¼Œ KBUILD_MODULES ä¸ºç©ºã€‚â€œmakeâ€å‘½ä»¤æ˜¯ä¼šç¼–è¯‘æ‰€æœ‰çš„ä¸œè¥¿ï¼ŒåŒ…æ‹¬ Linux å†…æ ¸é•œåƒæ–‡ä»¶å’Œä¸€äº›æ¨¡å—æ–‡ä»¶ã€‚æˆ‘ä»¬è¿™é‡Œç®€å•ä¸€ç‚¹ï¼Œå¦‚æœåªç¼–è¯‘ Linux å†…æ ¸é•œåƒçš„è¯ï¼Œ __build ç›®æ ‡ç®€åŒ–ä¸ºï¼š  </p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">__build: $(builtin-target) $(lib-target) $(extra-y)) $(subdir-ym) <span class="variable">$(always)</span></span></span><br><span class="line">	@:</span><br></pre></td></tr></table></figure>

<p>é‡ç‚¹æ¥çœ‹ä¸€ä¸‹ builtin-target è¿™ä¸ªä¾èµ–ï¼Œ builtin-target åŒæ ·å®šä¹‰åœ¨æ–‡ä»¶ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L72">Makefile.build - scripts&#x2F;Makefile.build - <em>builtin-target</em></a> ä¸­  ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ifneq</span> (<span class="variable">$(<span class="built_in">strip</span> $(real-obj-y)</span> $(need-builtin)),)</span><br><span class="line">builtin-target := <span class="variable">$(obj)</span>/built-in.a</span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p>ç¬¬2è¡Œå°±æ˜¯ builtin-target å˜é‡çš„å€¼ï¼Œä¸º<code>$(obj)/built-in.a</code>ï¼Œè¿™å°±æ˜¯è¿™äº› built-in.a çš„æ¥æºäº†ã€‚è¦ç”Ÿæˆ built-in.aï¼Œè¦æ±‚real-obj-y å’Œneed-builtin å˜é‡ä¸èƒ½å…¨éƒ¨ä¸ºç©ºã€‚æˆ‘ä»¬ä»¥è¿™æ¡å‘½ä»¤ä¸ºä¾‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@make -f ./scripts/Makefile.build obj=init need-builtin=1</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œobj&#x3D;initï¼Œneed-builtin&#x3D;1ï¼Œæ‰€ä»¥ä¸Šé¢çš„builtin-targetå¯ä»¥å±•å¼€ä¸€ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ifneq</span> (<span class="variable">$(<span class="built_in">strip</span> $(real-obj-y)</span> 1),)</span><br><span class="line">builtin-target := init/built-in.a</span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p>é‚£ built-in.a æ˜¯æ€ä¹ˆç”Ÿæˆçš„ï¼Ÿæˆ‘ä»¬ç»§ç»­çœ‹è¿™ä¸ªbuiltin-targetï¼Œåœ¨æ–‡ä»¶ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L445">Makefile.build - scripts&#x2F;Makefile.build</a> ä¸­æœ‰å¦‚ä¸‹ä»£ç ï¼š  </p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Rule to compile a set of .o files into one .o file</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="keyword">ifdef</span> builtin-target</span><br><span class="line"></span><br><span class="line"><span class="comment"># built-in.a archives are made with no symbol table or index which</span></span><br><span class="line"><span class="comment"># makes them small and fast, but unable to be used by the linker.</span></span><br><span class="line"><span class="comment"># scripts/link-vmlinux.sh builds an aggregate built-in.a with a symbol</span></span><br><span class="line"><span class="comment"># table and index.</span></span><br><span class="line">quiet_cmd_ar_builtin = AR      <span class="variable">$@</span></span><br><span class="line">      cmd_ar_builtin = rm -f <span class="variable">$@</span>; \</span><br><span class="line">                     <span class="variable">$(AR)</span> rcSTP<span class="variable">$(KBUILD_ARFLAGS)</span> <span class="variable">$@</span> <span class="variable">$(<span class="built_in">filter</span> $(real-obj-y)</span>, <span class="variable">$^</span>)</span><br><span class="line"></span><br><span class="line"><span class="section">$(builtin-target): $(real-obj-y) FORCE</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> if_changed,ar_builtin)</span></span><br><span class="line"></span><br><span class="line">targets += $(builtin-target)</span><br><span class="line"><span class="keyword">endif</span> <span class="comment"># builtin-target</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ç¬¬14è¡Œï¼Œç›®æ ‡å°±æ˜¯ builtin-targetï¼Œä¾èµ–ä¸º real-obj-yï¼Œå‘½ä»¤ä¸ºâ€œ<code>$(call if_changed,ar_builtin)</code>â€ï¼Œå‰é¢æˆ‘ä»¬åˆ†æè¿‡è¿™ä¸ªif_changedå‡½æ•°ï¼Œè¿™é‡Œå‚æ•°ä¸º ar_builtinï¼Œå…¶è¿”å›å€¼å°±æ˜¯å…·ä½“çš„å‘½ä»¤ã€‚ æˆ‘ä»¬å¯ä»¥æ”¾åˆ°è¿™é‡Œå†çœ‹ä¸€ä¸‹ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Kbuild.include#L259">Kbuild.include - scripts&#x2F;Kbuild.include - <em>if_changed</em></a> ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Execute command if command has changed or prerequisite(s) are updated.</span></span><br><span class="line">if_changed = <span class="variable">$(<span class="built_in">if</span> $(<span class="built_in">strip</span> $(any-prereq)</span> $(arg-check)),                       \</span><br><span class="line">	@set -e;                                                             \</span><br><span class="line">	$(echo-cmd) $(cmd_$(1));                                             \</span><br><span class="line">	printf &#x27;%s\n&#x27; &#x27;cmd_<span class="variable">$@</span> := $(make-cmd)&#x27; &gt; $(dot-target).cmd, @:)</span><br></pre></td></tr></table></figure>

<p>å®ƒä¼šè°ƒç”¨ <code>cmd_$(1)</code>æ‰€å¯¹åº”çš„å‘½ä»¤(<code>$(1)</code>å°±æ˜¯å‡½æ•°çš„ç¬¬ 1 ä¸ªå‚æ•°)ï¼Œåœ¨è¿™é‡Œå°±æ˜¯è°ƒç”¨ cmd_ar_builtin æ‰€å¯¹åº”çš„å‘½ä»¤ã€‚è¿™é‡Œé¢çš„å‘½ä»¤å°±æ˜¯ä½¿ç”¨ARå·¥å…·ç”Ÿæˆ<code>.a</code>æ–‡ä»¶</p>
<h3 id="4-5-æ‰“å°ä¿¡æ¯"><a href="#4-5-æ‰“å°ä¿¡æ¯" class="headerlink" title="4.5 æ‰“å°ä¿¡æ¯"></a><font size=3>4.5 æ‰“å°ä¿¡æ¯</font></h3><p>æˆ‘ä»¬åœ¨ç»ˆç«¯æ‰§è¡Œï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">make V=0 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- distclean</span><br><span class="line">make V=0 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- imx_v6_v7_defconfig</span><br><span class="line">make V=1 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- all -j16</span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬ä¼šçœ‹åˆ°ä»¥ä¸‹æ‰“å°ä¿¡æ¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -f init/built-in.a; arm-linux-gnueabihf-ar rcSTPD init/built-in.a init/main.o init/version.o init/do_mounts.o init/do_mounts_rd.o init/do_mounts_initrd.o init/initramfs.o init/calibrate.o init/init_task.o</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå°±æ˜¯æœ€åå°†ç›¸å…³çš„.oé“¾æ¥åœ¨ä¸€èµ·ç”Ÿæˆçš„init&#x2F;built-in.aæ–‡ä»¶çš„æ‰“å°ä¿¡æ¯ã€‚å‘½ä»¤ <code>arm-linux-gnueabihf-ar rcSTPD</code> ä¸­ï¼Œ<code>rcSTPD</code> æ˜¯ä¸€ç³»åˆ—é€‰é¡¹çš„ç»„åˆï¼Œç”¨äºæŒ‡å®š <code>arm-linux-gnueabihf-ar</code> å·¥å…·çš„æ“ä½œæ¨¡å¼ã€‚ä¸‹é¢æ˜¯æ¯ä¸ªé€‰é¡¹çš„å«ä¹‰ï¼š</p>
<ul>
<li><code>r</code>ï¼šæ›¿æ¢ã€‚å¦‚æœæŒ‡å®šçš„åº“æ–‡ä»¶ä¸­å·²ç»å­˜åœ¨è¦æ·»åŠ çš„æ–‡ä»¶ï¼Œåˆ™æ›¿æ¢å®ƒã€‚</li>
<li><code>c</code>ï¼šåˆ›å»ºã€‚åˆ›å»ºä¸€ä¸ªæ–°çš„åº“æ–‡ä»¶ã€‚å¦‚æœæŒ‡å®šçš„åº“æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºå®ƒï¼›å¦‚æœå·²å­˜åœ¨ï¼Œåˆ™æ ¹æ®å…¶ä»–é€‰é¡¹ï¼ˆå¦‚ <code>r</code>ï¼‰æ›´æ–°å®ƒã€‚</li>
<li><code>S</code>ï¼šåˆ›å»ºç´¢å¼•ã€‚ä¸ºåº“æ–‡ä»¶åˆ›å»ºä¸€ä¸ªç›®æ ‡æ–‡ä»¶ç´¢å¼•ï¼Œè¿™å¯ä»¥åŠ å¿«ä¹‹åé“¾æ¥æ—¶åº“æ–‡ä»¶çš„æœç´¢é€Ÿåº¦ã€‚</li>
<li><code>T</code>ï¼šä½¿ç”¨ç»™å®šçš„æ–‡ä»¶åä½œä¸ºåº“æ–‡ä»¶çš„ä¸´æ—¶ç´¢å¼•æ–‡ä»¶ã€‚é€šå¸¸ï¼Œè¿™ä¸ªé€‰é¡¹åé¢ä¼šè·Ÿç€ä¸€ä¸ªæ–‡ä»¶åã€‚ä½†åœ¨ä½ æä¾›çš„å‘½ä»¤ä¸­ï¼Œ<code>T</code> åé¢æ²¡æœ‰ç›´æ¥è·Ÿéšæ–‡ä»¶åï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªé”™è¯¯æˆ–è€…é—æ¼ï¼Œæˆ–è€…æ˜¯åœ¨ç‰¹å®šä¸Šä¸‹æ–‡ä¸­æœ‰ç‰¹æ®Šç”¨æ³•ã€‚</li>
<li><code>P</code>ï¼šä¿ç•™è·¯å¾„ã€‚åœ¨å°†æ–‡ä»¶æ·»åŠ åˆ°åº“ä¸­æ—¶ï¼Œä¿ç•™æ–‡ä»¶çš„è·¯å¾„ä¿¡æ¯ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>ar</code> å·¥å…·ä¼šå°†æ–‡ä»¶è·¯å¾„å‰¥ç¦»ï¼Œåªä¿ç•™æ–‡ä»¶åã€‚ä½¿ç”¨ <code>P</code> é€‰é¡¹å¯ä»¥ä¿ç•™å®Œæ•´çš„è·¯å¾„ã€‚</li>
<li><code>D</code>ï¼šé€šå¸¸ <code>D</code> é€‰é¡¹ç”¨äºåˆ é™¤åº“ä¸­çš„æ–‡ä»¶ã€‚è¿™é‡ŒæåŠæ˜¯ä¸ºäº†å®Œæ•´æ€§ï¼Œå› ä¸º <code>D</code> æ˜¯ <code>ar</code> å·¥å…·çš„ä¸€ä¸ªå¸¸ç”¨é€‰é¡¹ã€‚</li>
</ul>
<h1 id="å››ã€make-zImage"><a href="#å››ã€make-zImage" class="headerlink" title="å››ã€make zImage"></a><font size=3>å››ã€make zImage</font></h1><h2 id="1-vmlinuxã€-Imageï¼Œ-zImageã€-uImage-çš„åŒºåˆ«"><a href="#1-vmlinuxã€-Imageï¼Œ-zImageã€-uImage-çš„åŒºåˆ«" class="headerlink" title="1.Â vmlinuxã€ Imageï¼Œ zImageã€ uImage çš„åŒºåˆ«  "></a><font size=3>1.Â vmlinuxã€ Imageï¼Œ zImageã€ uImage çš„åŒºåˆ«  </font></h2><p>å…¶å®å‰é¢å·²ç»å¤§æ¦‚äº†è§£è¿‡äº†ï¼š</p>
<ul>
<li>vmlinux æ˜¯ç¼–è¯‘å‡ºæ¥çš„æœ€åŸå§‹çš„ ELFæ ¼å¼å†…æ ¸æ–‡ä»¶ï¼Œæ˜¯æœªå‹ç¼©çš„ã€‚</li>
<li>Image æ˜¯ Linux å†…æ ¸é•œåƒæ–‡ä»¶ï¼Œä½†æ˜¯ Image ä»…åŒ…å«å¯æ‰§è¡Œçš„äºŒè¿›åˆ¶æ•°æ®ã€‚ Image å°±æ˜¯ä½¿ç”¨ objcopy å–æ¶ˆæ‰ vmlinux ä¸­çš„ä¸€äº›å…¶ä»–ä¿¡æ¯ï¼Œæ¯”å¦‚ç¬¦å·è¡¨ä»€ä¹ˆçš„ã€‚ä½†æ˜¯ Image æ˜¯æ²¡æœ‰å‹ç¼©è¿‡çš„ï¼Œ Image ä¿å­˜åœ¨ arch&#x2F;arm&#x2F;boot ç›®å½•ä¸‹ ã€‚</li>
<li>zImage æ˜¯ç»è¿‡ gzip å‹ç¼©åçš„ Image ã€‚</li>
<li>uImage æ˜¯è€ç‰ˆæœ¬ uboot ä¸“ç”¨çš„é•œåƒæ–‡ä»¶ï¼Œ uImag æ˜¯åœ¨ zImage å‰é¢åŠ äº†ä¸€ä¸ªé•¿åº¦ä¸º 64å­—èŠ‚çš„â€œå¤´â€ï¼Œè¿™ä¸ªå¤´ä¿¡æ¯æè¿°äº†è¯¥é•œåƒæ–‡ä»¶çš„ç±»å‹ã€åŠ è½½ä½ç½®ã€ç”Ÿæˆæ—¶é—´ã€å¤§å°ç­‰ä¿¡æ¯ã€‚ä½†æ˜¯æ–°çš„ uboot å·²ç»æ”¯æŒäº† zImage å¯åŠ¨ï¼æ‰€ä»¥å·²ç»å¾ˆå°‘ç”¨åˆ° uImage äº†ï¼Œé™¤éæˆ‘ä»¬ç”¨çš„å¾ˆå¤è€çš„ ubootã€‚</li>
</ul>
<p>æ‰€ä»¥ä¸€èˆ¬æˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨zImageè¿™ä¸ªé•œåƒæ–‡ä»¶ã€‚</p>
<h2 id="2-zImage"><a href="#2-zImage" class="headerlink" title="2. zImage"></a><font size=3>2. zImage</font></h2><p>ä½¿ç”¨â€œ makeâ€ã€â€œ make allâ€ã€â€œ make zImageâ€è¿™äº›å‘½ä»¤éƒ½å¯ä»¥ç¼–è¯‘å‡º zImage é•œåƒï¼Œ  æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ BOOT_TARGETS  å˜é‡ï¼Œå®ƒå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/arch/arm/Makefile#L327">Makefile - arch&#x2F;arm&#x2F;Makefile - <em>BOOT_TARGETS</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">BOOT_TARGETS	= zImage Image xipImage bootpImage uImage</span><br><span class="line">INSTALL_TARGETS	= zinstall uinstall install</span><br><span class="line"></span><br><span class="line">PHONY += bzImage <span class="variable">$(BOOT_TARGETS)</span> <span class="variable">$(INSTALL_TARGETS)</span></span><br><span class="line"></span><br><span class="line">bootpImage uImage: zImage</span><br><span class="line"><span class="section">zImage: Image</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$(BOOT_TARGETS)</span>: vmlinux</span><br><span class="line">	<span class="variable">$(Q)</span><span class="variable">$(MAKE)</span> <span class="variable">$(build)</span>=<span class="variable">$(boot)</span> MACHINE=<span class="variable">$(MACHINE)</span> <span class="variable">$(boot)</span>/<span class="variable">$@</span></span><br><span class="line">	@<span class="variable">$(kecho)</span> &#x27;  Kernel: <span class="variable">$(boot)</span>/<span class="variable">$@</span> is ready&#x27;</span><br></pre></td></tr></table></figure>

<p>ç¬¬ 1 è¡Œã€‚å˜é‡ BOOT_TARGETS åŒ…å« zImageï¼Œ Imageï¼Œ xipImage ç­‰é•œåƒæ–‡ä»¶ã€‚</p>
<p>ç¬¬ 9 è¡Œï¼Œ BOOT_TARGETS ä¾èµ– vmlinuxï¼Œå› æ­¤å¦‚æœä½¿ç”¨â€œmake zImageâ€ç¼–è¯‘çš„ Linux å†…æ ¸çš„è¯ï¼Œé¦–å…ˆè‚¯å®šè¦å…ˆç¼–è¯‘å‡º vmlinuxã€‚  </p>
<p>ç¬¬ 10 è¡Œï¼Œå…·ä½“çš„å‘½ä»¤ï¼Œæ¯”å¦‚è¦ç¼–è¯‘ zImageï¼Œé‚£ä¹ˆå‘½ä»¤å±•å¼€ä»¥åå¦‚ä¸‹æ‰€ç¤ºï¼š  </p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@ make -f ./scripts/Makefile.build obj=arch/arm/boot MACHINE=arch/arm/boot/zImage</span><br></pre></td></tr></table></figure>

<p>å’Œå‰é¢ä¸€æ ·ï¼Œéƒ½æ˜¯ä½¿ç”¨scripts&#x2F;Makefile.buildå®Œæˆvmlinuxåˆ°zImageçš„è½¬æ¢ã€‚</p>

    </div>

    
    
    

    <footer class="post-footer">




    <div>
        
            <div style="text-align:center;color: #ccc;font-size:14px;">
            ----------æœ¬æ–‡ç»“æŸ
            <i class="fas fa-fan fa-spin" style="color: #FF1493; font-size: 1rem"></i>
            æ„Ÿè°¢æ‚¨çš„é˜…è¯»----------
            </div>
        
    </div>





  
  <div class="my_post_copyright"> 
    <p><span>æ–‡ç« æ ‡é¢˜:</span><a href="/post/2aa70834.html">LV05-03-Kernel-03-01-é¡¶å±‚MakefileåŸºç¡€è§£æ</a></p>
    <p><span>æ–‡ç« ä½œè€…:</span><a href="/" title="æ¬¢è¿è®¿é—® ã€Šè‹æœ¨ã€‹ çš„å­¦ä¹ ç¬”è®°">è‹æœ¨</a></p>
    <p><span>å‘å¸ƒæ—¶é—´:</span>2024å¹´11æœˆ27æ—¥ - 07:53</p>
    <p><span>æœ€åæ›´æ–°:</span>2025å¹´06æœˆ14æ—¥ - 00:25</p>
    <p><span>åŸå§‹é“¾æ¥:</span><a href="/post/2aa70834.html" title="LV05-03-Kernel-03-01-é¡¶å±‚MakefileåŸºç¡€è§£æ">https://sumumm.github.io/post/2aa70834.html</a></p>
    <p><span>è®¸å¯åè®®:</span><i class="fab fa-creative-commons"></i> <a rel="license" href= "https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç¦æ­¢æ¼”ç» 4.0 å›½é™…</a> è½¬è½½è¯·ä¿ç•™åŸæ–‡é“¾æ¥åŠä½œè€…ã€‚</p>  
  </div>
  


          <div class="post-tags">
              <a href="/tags/LV05-%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F/" rel="tag"><i class="fa fa-tag"></i> LV05-ç³»ç»Ÿé•œåƒ</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/post/5d81934f.html" rel="prev" title="LV05-03-Kernel-03-02-make-single-module">
                  <i class="fa fa-angle-left"></i> LV05-03-Kernel-03-02-make-single-module
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/post/620e325b.html" rel="next" title="LV06-02-å†…æ ¸æ¨¡å—-08-å†…æ ¸æ¨¡å—ç¬¦å·å¯¼å‡º">
                  LV06-02-å†…æ ¸æ¨¡å—-08-å†…æ ¸æ¨¡å—ç¬¦å·å¯¼å‡º <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2017 â€“ 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">è‹æœ¨</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>ç«™ç‚¹æ€»å­—æ•°ï¼š</span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">3.7m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>ç«™ç‚¹é˜…è¯»æ—¶é•¿ &asymp;</span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">225:26</span>
  </span>
</div>




    <span id="sitetime"></span>
    <script defer language=javascript>
        function siteTime()
        {
            window.setTimeout("siteTime()", 1000);
            var seconds = 1000;
            var minutes = seconds * 60;
            var hours = minutes * 60;
            var days = hours * 24;
            var years = days * 365;
            var today = new Date();
            var todayYear = today.getFullYear();
            var todayMonth = today.getMonth()+1;
            var todayDate = today.getDate();
            var todayHour = today.getHours();
            var todayMinute = today.getMinutes();
            var todaySecond = today.getSeconds();
            /*==================================================
            Date.UTC() -- è¿”å›dateå¯¹è±¡è·ä¸–ç•Œæ ‡å‡†æ—¶é—´(UTC)1970å¹´1æœˆ1æ—¥åˆå¤œä¹‹é—´çš„æ¯«ç§’æ•°(æ—¶é—´æˆ³)
            year        - ä½œä¸ºdateå¯¹è±¡çš„å¹´ä»½ï¼Œä¸º4ä½å¹´ä»½å€¼
            month       - 0-11ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„æœˆä»½
            day         - 1-31ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„å¤©æ•°
            hours       - 0(åˆå¤œ24ç‚¹)-23ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„å°æ—¶æ•°
            minutes     - 0-59ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„åˆ†é’Ÿæ•°
            seconds     - 0-59ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„ç§’æ•°
            microseconds - 0-999ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„æ¯«ç§’æ•°
            ==================================================*/
            var t1 = Date.UTC(2017, 
                              5, 
                              19, 
                              0, 
                              0, 
                              0); //åŒ—äº¬æ—¶é—´
            var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond);
            var diff = t2-t1;
            var diffYears = Math.floor(diff/years);
            var diffDays = Math.floor((diff/days)-diffYears*365);
            var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours);
            var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes);
            var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds);
            document.getElementById("sitetime").innerHTML="å·²åœ¨è¿™é‡Œ "+diffYears+" å¹´ "+diffDays+" å¤© "+diffHours+" å°æ—¶ "+diffMinutes+" åˆ†é’Ÿ "+diffSeconds+" ç§’";
        }
        siteTime();
    </script>



    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.umd.js" integrity="sha256-ytMJGN3toR+a84u7g7NuHm91VIR06Q41kMWDr2pq7Zo=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>


  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


 
        <div id="click-show-text"
            data-mobile = false
            data-text = å¯Œå¼º,æ°‘ä¸»,æ–‡æ˜,å’Œè°,è‡ªç”±,å¹³ç­‰,å…¬æ­£,æ³•åˆ¶,çˆ±å›½,æ•¬ä¸š,è¯šä¿¡,å‹å–„
            data-fontsize = 15px
            data-random= false>
        </div>
       

      
        <script async src=https://cdn.jsdelivr.net/npm/hexo-next-mouse-effect@latest/click/showText.js></script>
      

      
    




    <script async src="/js/fancybox_param.js"></script>





<!-- APlayeræœ¬ä½“ -->



</body>
</html>
