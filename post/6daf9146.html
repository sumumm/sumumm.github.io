<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha256-wiz7ZSCn/btzhjKDQBms9Hx4sSeUYsDrTLg7roPstac=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.css" integrity="sha256-6cQIC71/iBIYXFK+0RHAvwmjwWzkWd+r7v/BX3/vZDc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/green/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"sumumm.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.19.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":300},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="æœ¬æ–‡ä¸»è¦æ˜¯è®¾å¤‡æ ‘åŸºç¡€çŸ¥è¯†çš„ç›¸å…³ç¬”è®°ï¼Œè‹¥ç¬”è®°ä¸­æœ‰é”™è¯¯æˆ–è€…ä¸åˆé€‚çš„åœ°æ–¹ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ğŸ˜ƒã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="LV10-08-è®¾å¤‡æ ‘-01-è®¾å¤‡æ ‘åŸºç¡€çŸ¥è¯†">
<meta property="og:url" content="https://sumumm.github.io/post/6daf9146.html">
<meta property="og:site_name" content="è‹æœ¨">
<meta property="og:description" content="æœ¬æ–‡ä¸»è¦æ˜¯è®¾å¤‡æ ‘åŸºç¡€çŸ¥è¯†çš„ç›¸å…³ç¬”è®°ï¼Œè‹¥ç¬”è®°ä¸­æœ‰é”™è¯¯æˆ–è€…ä¸åˆé€‚çš„åœ°æ–¹ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ğŸ˜ƒã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/01HQ%E8%AF%BE%E7%A8%8B%E4%BD%93%E7%B3%BB/LV10-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV10-08-%E8%AE%BE%E5%A4%87%E6%A0%91-01-%E8%AE%BE%E5%A4%87%E6%A0%91%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/img/image-20220901181151039.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/01HQ%E8%AF%BE%E7%A8%8B%E4%BD%93%E7%B3%BB/LV10-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV10-08-%E8%AE%BE%E5%A4%87%E6%A0%91-01-%E8%AE%BE%E5%A4%87%E6%A0%91%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/img/image-20220902082931968.png">
<meta property="article:published_time" content="2023-07-08T10:58:30.000Z">
<meta property="article:modified_time" content="2025-06-13T16:25:57.004Z">
<meta property="article:author" content="è‹æœ¨">
<meta property="article:tag" content="LV10-é©±åŠ¨å¼€å‘">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/01HQ%E8%AF%BE%E7%A8%8B%E4%BD%93%E7%B3%BB/LV10-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV10-08-%E8%AE%BE%E5%A4%87%E6%A0%91-01-%E8%AE%BE%E5%A4%87%E6%A0%91%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/img/image-20220901181151039.png">


<link rel="canonical" href="https://sumumm.github.io/post/6daf9146.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://sumumm.github.io/post/6daf9146.html","path":"post/6daf9146.html","title":"LV10-08-è®¾å¤‡æ ‘-01-è®¾å¤‡æ ‘åŸºç¡€çŸ¥è¯†"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>LV10-08-è®¾å¤‡æ ‘-01-è®¾å¤‡æ ‘åŸºç¡€çŸ¥è¯† | è‹æœ¨</title>
  








    <script src="/js/browser_tools_disable.js"></script>

  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start --><link rel="stylesheet" href="https://unpkg.com/hexo-next-tags-plus@latest/lib/tag_plus.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">è‹æœ¨</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">æˆ‘çš„å­¦ä¹ ä¹‹è·¯</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>è‹æœ¨çš„å®¶</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»é¡µ<span class="badge">42</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£é¡µ<span class="badge">673</span></a></li><li class="menu-item menu-item-flink"><a href="/flink/" rel="section"><i class="fa fa-link fa-fw"></i>å‹äººå¸</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äºæˆ‘</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E8%AE%BE%E5%A4%87%E6%A0%91%E7%AE%80%E4%BB%8B"><span class="nav-text">ä¸€ã€è®¾å¤‡æ ‘ç®€ä»‹</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AF%E8%AE%BE%E5%A4%87%E6%A0%91"><span class="nav-text">1. ä»€ä¹ˆæ˜¯è®¾å¤‡æ ‘</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-dts%E3%80%81dtb%E5%92%8Cdtsi"><span class="nav-text">2.Â dtsã€dtbå’Œdtsi</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%9C%A8%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84%E4%BD%93%E7%8E%B0"><span class="nav-text">3. åœ¨ç³»ç»Ÿä¸­çš„ä½“ç°</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="nav-text">äºŒã€åŸºæœ¬è¯­æ³•</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-dtsi%E5%A4%B4%E6%96%87%E4%BB%B6"><span class="nav-text">1.Â dtsiå¤´æ–‡ä»¶</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E8%AE%BE%E5%A4%87%E8%8A%82%E7%82%B9"><span class="nav-text">2. è®¾å¤‡èŠ‚ç‚¹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E6%A0%B9%E8%8A%82%E7%82%B9"><span class="nav-text">2.1 æ ¹èŠ‚ç‚¹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E7%89%B9%E6%AE%8A%E8%8A%82%E7%82%B9"><span class="nav-text">2.2 ç‰¹æ®ŠèŠ‚ç‚¹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1-memory"><span class="nav-text">2.2.1Â &#x2F;memory</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-chosen"><span class="nav-text">2.2.2Â &#x2F;chosen</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-3-cpus"><span class="nav-text">2.2.3Â &#x2F;cpus</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-4-aliases"><span class="nav-text">2.2.4Â aliases </span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E8%8A%82%E7%82%B9%E8%AF%AD%E6%B3%95"><span class="nav-text">2.3 èŠ‚ç‚¹è¯­æ³•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-%E8%8A%82%E7%82%B9%E5%B1%9E%E6%80%A7%E8%AF%AD%E6%B3%95"><span class="nav-text">2.4 èŠ‚ç‚¹å±æ€§è¯­æ³•</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-text">3. æ•°æ®ç±»å‹</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E6%A0%87%E5%87%86%E5%B1%9E%E6%80%A7"><span class="nav-text">ä¸‰ã€æ ‡å‡†å±æ€§</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-compatible"><span class="nav-text">1.Â compatible </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-model"><span class="nav-text">2.Â model</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-status"><span class="nav-text">3.Â status</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E5%AD%90%E8%8A%82%E7%82%B9%E5%9C%B0%E5%9D%80%E4%BF%A1%E6%81%AF"><span class="nav-text">4. å­èŠ‚ç‚¹åœ°å€ä¿¡æ¯</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-address-cells"><span class="nav-text">4.1Â #address-cells </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-size-cells"><span class="nav-text">4.2Â #size-cells </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-reg"><span class="nav-text">4.3Â reg</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-%E4%BD%BF%E7%94%A8%E5%AE%9E%E4%BE%8B"><span class="nav-text">4.4 ä½¿ç”¨å®ä¾‹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-1-%E5%AE%9E%E4%BE%8B1"><span class="nav-text">4.4.1 å®ä¾‹1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-2-%E5%AE%9E%E4%BE%8B2"><span class="nav-text">4.4.2 å®ä¾‹2</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-ranges"><span class="nav-text">5.Â ranges</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-name"><span class="nav-text">6.Â name</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-device-type"><span class="nav-text">7.Â device_type</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7"><span class="nav-text">å››ã€å¸¸ç”¨å±æ€§</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-phandle"><span class="nav-text">1.Â phandle</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-reg"><span class="nav-text">2.Â reg</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-compatible"><span class="nav-text">3.Â compatible</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E4%B8%AD%E6%96%AD%E7%9B%B8%E5%85%B3%E5%B1%9E%E6%80%A7"><span class="nav-text">4. ä¸­æ–­ç›¸å…³å±æ€§</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E4%B8%AD%E6%96%AD%E6%8E%A7%E5%88%B6%E5%99%A8%E8%8A%82%E7%82%B9"><span class="nav-text">4.1 ä¸­æ–­æ§åˆ¶å™¨èŠ‚ç‚¹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E4%B8%AD%E6%96%AD%E6%BA%90%E8%AE%BE%E5%A4%87%E8%8A%82%E7%82%B9"><span class="nav-text">4.2 ä¸­æ–­æºè®¾å¤‡èŠ‚ç‚¹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-%E4%BD%BF%E7%94%A8%E5%AE%9E%E4%BE%8B"><span class="nav-text">4.3 ä½¿ç”¨å®ä¾‹</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-gpio%E7%9B%B8%E5%85%B3%E5%B1%9E%E6%80%A7"><span class="nav-text">5.Â gpioç›¸å…³å±æ€§</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-GPIO%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="nav-text">5.1Â GPIOæ§åˆ¶å™¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-GPIO%E4%BD%BF%E7%94%A8%E8%80%85%E8%8A%82%E7%82%B9"><span class="nav-text">5.2Â GPIOä½¿ç”¨è€…èŠ‚ç‚¹</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E5%B8%B8%E7%94%A8%E6%8E%A5%E5%8F%A3"><span class="nav-text">äº”ã€å¸¸ç”¨æ¥å£</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E4%B8%89%E4%B8%AA%E7%BB%93%E6%9E%84%E4%BD%93"><span class="nav-text">1. ä¸‰ä¸ªç»“æ„ä½“</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-struct-device-node"><span class="nav-text">1.1Â struct device_node</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-struct-property"><span class="nav-text">1.2Â struct property </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-struct-resource"><span class="nav-text">1.3Â struct resource  </span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%9F%A5%E6%89%BE%E8%8A%82%E7%82%B9%E7%9A%84%E5%87%BD%E6%95%B0"><span class="nav-text">2. æŸ¥æ‰¾èŠ‚ç‚¹çš„å‡½æ•°</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-of-find-node-by-name"><span class="nav-text">2.1Â of_find_node_by_name() </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-of-find-node-by-type"><span class="nav-text">2.2Â of_find_node_by_type () </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-of-find-compatible-node"><span class="nav-text">2.3Â of_find_compatible_node () </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-of-find-matching-node-and-match"><span class="nav-text">2.4Â of_find_matching_node_and_match() </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-of-find-node-by-path"><span class="nav-text">2.5Â of_find_node_by_path() </span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E6%9F%A5%E6%89%BE%E7%88%B6%E5%AD%90%E8%8A%82%E7%82%B9%E7%9A%84%E5%87%BD%E6%95%B0"><span class="nav-text">3. æŸ¥æ‰¾çˆ¶å­èŠ‚ç‚¹çš„å‡½æ•°</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-of-get-parent"><span class="nav-text">3.1Â of_get_parent() </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-of-get-next-child"><span class="nav-text">3.2Â of_get_next_child() </span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E6%8F%90%E5%8F%96%E5%B1%9E%E6%80%A7%E7%9A%84%E5%87%BD%E6%95%B0"><span class="nav-text">4. æå–å±æ€§çš„å‡½æ•°</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-of-find-property"><span class="nav-text">4.1Â of_find_property()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-of-property-count-elems-of-size"><span class="nav-text">4.2Â of_property_count_elems_of_size() </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-of-property-read-u32-index"><span class="nav-text">4.3Â of_property_read_u32_index() </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-%E8%8E%B7%E5%8F%96%E5%B1%9E%E6%80%A7%E6%95%B0%E7%BB%84%E6%95%B0%E6%8D%AE"><span class="nav-text">4.4 è·å–å±æ€§æ•°ç»„æ•°æ®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-%E8%8E%B7%E5%8F%96%E5%B1%9E%E6%80%A7%E6%95%B0%E5%80%BC"><span class="nav-text">4.5 è·å–å±æ€§æ•°å€¼</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-6-%E8%8E%B7%E5%8F%96%E5%B1%9E%E6%80%A7%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%80%BC"><span class="nav-text">4.6 è·å–å±æ€§å­—ç¬¦ä¸²å€¼</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-6-1-of-property-read-string"><span class="nav-text">4.6.1Â of_property_read_string()</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-7-of-n-addr-cells"><span class="nav-text">4.7Â of_n_addr_cells()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-8-of-n-size-cells"><span class="nav-text">4.8Â of_n_size_cells()</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E5%85%B6%E4%BB%96%E5%B8%B8%E7%94%A8of%E5%87%BD%E6%95%B0"><span class="nav-text">5. å…¶ä»–å¸¸ç”¨ofå‡½æ•°</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-of-device-is-compatible"><span class="nav-text">5.1Â of_device_is_compatible()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-of-get-address"><span class="nav-text">5.2Â of_get_address()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-of-translate-address"><span class="nav-text">5.3Â of_translate_address()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4-of-property-read-bool"><span class="nav-text">5.4Â of_property_read_bool()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-5-of-address-to-resource"><span class="nav-text">5.5Â of_address_to_resource()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-6-of-iomap"><span class="nav-text">5.6Â of_iomap()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-7-of-get-named-gpio"><span class="nav-text">5.7Â of_get_named_gpio()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-8-irq-of-parse-and-map"><span class="nav-text">5.8Â irq_of_parse_and_map()</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="è‹æœ¨"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">è‹æœ¨</p>
  <div class="site-description" itemprop="description">è«é“æ¡‘æ¦†æ™šï¼Œä¸ºéœå°šæ»¡å¤©</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">673</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">42</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">æ ‡ç­¾</span>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/sumumm" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;sumumm" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sumumm.github.io/post/6daf9146.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="è‹æœ¨">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è‹æœ¨">
      <meta itemprop="description" content="è«é“æ¡‘æ¦†æ™šï¼Œä¸ºéœå°šæ»¡å¤©">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="LV10-08-è®¾å¤‡æ ‘-01-è®¾å¤‡æ ‘åŸºç¡€çŸ¥è¯† | è‹æœ¨">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          LV10-08-è®¾å¤‡æ ‘-01-è®¾å¤‡æ ‘åŸºç¡€çŸ¥è¯†
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-07-08 18:58:30" itemprop="dateCreated datePublished" datetime="2023-07-08T18:58:30+08:00">2023-07-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">åµŒå…¥å¼å¼€å‘</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/01HQ%E8%AF%BE%E7%A8%8B%E4%BD%93%E7%B3%BB/" itemprop="url" rel="index"><span itemprop="name">01HQè¯¾ç¨‹ä½“ç³»</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/01HQ%E8%AF%BE%E7%A8%8B%E4%BD%93%E7%B3%BB/LV10-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">LV10-é©±åŠ¨å¼€å‘</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>11k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>38 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>æœ¬æ–‡ä¸»è¦æ˜¯è®¾å¤‡æ ‘åŸºç¡€çŸ¥è¯†çš„ç›¸å…³ç¬”è®°ï¼Œè‹¥ç¬”è®°ä¸­æœ‰é”™è¯¯æˆ–è€…ä¸åˆé€‚çš„åœ°æ–¹ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ğŸ˜ƒã€‚</p>
<span id="more"></span>

<!-- Photo: https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/01HQ%E8%AF%BE%E7%A8%8B%E4%BD%93%E7%B3%BB/LV10-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV10-08-%E8%AE%BE%E5%A4%87%E6%A0%91-01-%E8%AE%BE%E5%A4%87%E6%A0%91%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/img/ -->

<details class="folding-tag" blue><summary> ç‚¹å‡»æŸ¥çœ‹ä½¿ç”¨å·¥å…·åŠç‰ˆæœ¬ </summary>
              <div class='content'>
              <table>    <tr>        <td align="center" width=150px>Windows</td>        <td align="left">windows11</td>    </tr>    <tr>        <td align="center">Ubuntu</td>        <td align="left">Ubuntu16.04çš„64ä½ç‰ˆæœ¬</td>      </tr>    <tr>        <td align="center">VMwareÂ® Workstation 16 Pro</td>        <td align="left">16.2.3 build-19376536</td>      </tr>    <tr>        <td align="center">SecureCRT</td>        <td align="left">Version 8.7.2 (x64 build 2214)   -   æ­£å¼ç‰ˆ-2020å¹´5æœˆ14æ—¥</td>      </tr>    <tr>        <td align="center" width=150>Linuxå¼€å‘æ¿</td>        <td align="left">åæ¸…è¿œè§ åº•æ¿: FS4412_DEV_V5 æ ¸å¿ƒæ¿: FS4412 V2</td>      </tr>    <tr>        <td align="center" width=150>u-boot</td>        <td align="left">2013.01</td>      </tr></table>
              </div>
            </details>

<details class="folding-tag" blue><summary> ç‚¹å‡»æŸ¥çœ‹æœ¬æ–‡å‚è€ƒèµ„æ–™ </summary>
              <div class='content'>
              <table>    <tr><td align="center">å‚è€ƒæ–¹å‘  </td><td align="center">å‚è€ƒåŸæ–‡</td></tr>    <tr><td align="left">---</td><td align="left"><a href="" target="_blank">--- <i class="fa fa-external-link-alt"></i> </a></td></tr></table>
              </div>
            </details>

<details class="folding-tag" blue><summary> ç‚¹å‡»æŸ¥çœ‹ç›¸å…³æ–‡ä»¶ä¸‹è½½ </summary>
              <div class='content'>
              <table>    <tr><td align="center">æ–‡ä»¶</td><td align="center">ä¸‹è½½é“¾æ¥</td></tr>    <tr><td align="left">---</td><td align="left"><a href="https://wwz.lanzouy.com/iH1vO09jxavi" target="_blank">--- <i class="fa fa-external-link-alt"></i> </a></td></tr></table>
              </div>
            </details>



<h1 id="ä¸€ã€è®¾å¤‡æ ‘ç®€ä»‹"><a href="#ä¸€ã€è®¾å¤‡æ ‘ç®€ä»‹" class="headerlink" title="ä¸€ã€è®¾å¤‡æ ‘ç®€ä»‹"></a><font size=3>ä¸€ã€è®¾å¤‡æ ‘ç®€ä»‹</font></h1><h2 id="1-ä»€ä¹ˆæ˜¯è®¾å¤‡æ ‘"><a href="#1-ä»€ä¹ˆæ˜¯è®¾å¤‡æ ‘" class="headerlink" title="1. ä»€ä¹ˆæ˜¯è®¾å¤‡æ ‘"></a><font size=3>1. ä»€ä¹ˆæ˜¯è®¾å¤‡æ ‘</font></h2><p>å…ˆæ¥çœ‹ä¸€å¼ å›¾ï¼Œè‡ªå·±ç…§ç€ç½‘ä¸Šç”»çš„ï¼Œæ¯”è¾ƒä¸‘å“ˆï¼Œè‡ªå·±å‡‘æ´»çœ‹ã€‚</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/01HQ%E8%AF%BE%E7%A8%8B%E4%BD%93%E7%B3%BB/LV10-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV10-08-%E8%AE%BE%E5%A4%87%E6%A0%91-01-%E8%AE%BE%E5%A4%87%E6%A0%91%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/img/image-20220901181151039.png" alt="image-20220901181151039" style="zoom: 33%;" />

<p>è®¾å¤‡æ ‘æ˜¯ä¸€ç§æè¿°ç¡¬ä»¶ä¿¡æ¯çš„æ•°æ®ç»“æ„ï¼Œ<code>Linux</code>å†…æ ¸è¿è¡Œæ—¶å¯ä»¥é€šè¿‡è®¾å¤‡æ ‘å°†ç¡¬ä»¶ä¿¡æ¯ç›´æ¥ä¼ é€’ç»™<code>Linux</code>å†…æ ¸ï¼Œè€Œä¸å†éœ€è¦åœ¨<code>Linux</code>å†…æ ¸ä¸­åŒ…å«å¤§é‡çš„å†—ä½™ç¼–ç ã€‚</p>
<p>è®¾å¤‡æ ‘(<code>Device Tree</code>)ï¼Œå°†è¿™ä¸ªè¯åˆ†å¼€å°±æ˜¯â€œè®¾å¤‡â€å’Œâ€œæ ‘â€ï¼Œæè¿°è®¾å¤‡æ ‘çš„æ–‡ä»¶å«åš <code>DTS</code>(<code>DeviceTree Source</code>)ï¼Œè¿™ä¸ª<code>DTS</code>æ–‡ä»¶é‡‡ç”¨æ ‘å½¢ç»“æ„æè¿°æ¿çº§è®¾å¤‡ï¼Œä¹Ÿå°±æ˜¯å¼€å‘æ¿ä¸Šçš„è®¾å¤‡ä¿¡æ¯ï¼Œæ¯”å¦‚<code>CPU</code> æ•°é‡ã€ å†…å­˜åŸºåœ°å€ã€ <code>IIC</code> æ¥å£ä¸Šæ¥äº†å“ªäº›è®¾å¤‡ã€ <code>SPI</code> æ¥å£ä¸Šæ¥äº†å“ªäº›è®¾å¤‡ç­‰ç­‰ã€‚</p>
<h2 id="2-dtsã€dtbå’Œdtsi"><a href="#2-dtsã€dtbå’Œdtsi" class="headerlink" title="2.Â dtsã€dtbå’Œdtsi"></a><font size=3>2.Â <code>dts</code>ã€<code>dtb</code>å’Œ<code>dtsi</code></font></h2><p>ä¸è®¾å¤‡æ ‘ç›¸å…³çš„æ–‡ä»¶æœ‰ä¸‰ç§ï¼š</p>
<ul>
<li><code>dts</code>ï¼š<code>device tree source</code>ï¼Œè®¾å¤‡æ ‘æºæ–‡ä»¶ã€‚</li>
<li><code>dtsi</code>ï¼š<code>device tree source include</code>ï¼Œç±»ä¼¼äºå¤´æ–‡ä»¶ï¼ŒåŒ…å«ä¸€äº›å…¬å…±çš„ä¿¡æ¯ï¼Œå¯è¢«å…¶å®ƒè®¾å¤‡æ ‘æ–‡ä»¶å¼•ç”¨ï¼ˆå°±æ˜¯å¯ä»¥è¢«<code>dts</code>æ–‡ä»¶åŒ…å«ç”¨ï¼‰ã€‚</li>
<li><code>dtb</code> ï¼š <code>device tree binary</code>ï¼Œæ˜¯å°†<code>dts</code>è®¾å¤‡æ ‘æºæ–‡ä»¶ ç¼–è¯‘ä»¥åå¾—åˆ°çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</li>
</ul>
<p>æˆ‘ä»¬çŸ¥é“å°†<code>.c</code> æ–‡ä»¶ç¼–è¯‘ä¸º<code>.o</code> éœ€è¦ç”¨åˆ° <code>gcc</code> ç¼–è¯‘å™¨ï¼Œé‚£ä¹ˆå°†<code>.dts</code> ç¼–è¯‘ä¸º<code>.dtb</code>éœ€è¦ä»€ä¹ˆå·¥å…·å‘¢ï¼Ÿéœ€è¦ç”¨åˆ°<code>DTC</code>å·¥å…·ã€‚<code> DTC</code> å·¥å…·æºç åœ¨ <code>Linux</code> å†…æ ¸çš„<code>scripts/dtc</code> ç›®å½•ä¸‹ ã€‚</p>
<h2 id="3-åœ¨ç³»ç»Ÿä¸­çš„ä½“ç°"><a href="#3-åœ¨ç³»ç»Ÿä¸­çš„ä½“ç°" class="headerlink" title="3. åœ¨ç³»ç»Ÿä¸­çš„ä½“ç°"></a><font size=3>3. åœ¨ç³»ç»Ÿä¸­çš„ä½“ç°</font></h2><p><code>Linux</code> å†…æ ¸å¯åŠ¨çš„æ—¶å€™ä¼šè§£æè®¾å¤‡æ ‘ä¸­å„ä¸ªèŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œå¹¶ä¸”åœ¨æ ¹æ–‡ä»¶ç³»ç»Ÿçš„<code>/proc/device-tree</code>ç›®å½•ä¸‹æ ¹æ®èŠ‚ç‚¹åå­—åˆ›å»ºä¸åŒç›®å½•ï¼Œä¾‹å¦‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">[root@farsight]#</span><span class="language-bash"><span class="built_in">cd</span> /proc/device-tree/</span></span><br><span class="line"><span class="meta prompt_">[root@farsightdevice-tree]#</span><span class="language-bash"><span class="built_in">ls</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">address-cells                 keypad@100A0000</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">size-cells                    lcd0-power-domain@10023C80</span></span><br><span class="line">aliases                        mct@10050000</span><br><span class="line">amba                           memory</span><br><span class="line">cam-power-domain@10023C00      mfc-power-domain@10023C40</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">... ... åè¾¹çš„çœç•¥äº†</span></span><br></pre></td></tr></table></figure>

<p><code>/proc/device-tree</code>å°±æ˜¯æ ¹èŠ‚ç‚¹<code>/</code>ä¸‹çš„æ‰€æœ‰å±æ€§äº†å­èŠ‚ç‚¹ï¼Œæˆ‘ä»¬å†è¿›å…¥<code>chosen</code>èŠ‚ç‚¹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">[root@farsightdevice-tree]#</span><span class="language-bash"><span class="built_in">cd</span> chosen/</span></span><br><span class="line"><span class="meta prompt_">[root@farsightchosen]#</span><span class="language-bash"><span class="built_in">ls</span></span></span><br><span class="line">bootargs  name</span><br><span class="line"><span class="meta prompt_">[root@farsightchosen]#</span><span class="language-bash"><span class="built_in">ls</span> -lh</span></span><br><span class="line">total 0</span><br><span class="line">-r--r--r--    1 0        0            116 Jan  1 00:10 bootargs</span><br><span class="line">-r--r--r--    1 0        0              7 Jan  1 00:10 name</span><br><span class="line"><span class="meta prompt_">[root@farsightchosen]#</span><span class="language-bash"><span class="built_in">cat</span> bootargs</span> </span><br><span class="line">root=/dev/nfs nfsroot=192.168.10.101:/home/hk/4nfs/rootfs rw console=ttySAC2,115200 init=/linuxrc ip=192.168.10.102</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å†æ‰“å¼€ä¸‹è¾¹è¿™ä¸ªæ–‡ä»¶ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">linux<span class="number">-3.14</span>/arch/arm/boot/dts/exynos4412-origen.dts</span><br></pre></td></tr></table></figure>

<p>æ‰¾åˆ°<code>memory</code>èŠ‚ç‚¹ï¼Œä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chosen &#123;</span><br><span class="line">    bootargs =<span class="string">&quot;console=ttySAC2,115200&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="äºŒã€åŸºæœ¬è¯­æ³•"><a href="#äºŒã€åŸºæœ¬è¯­æ³•" class="headerlink" title="äºŒã€åŸºæœ¬è¯­æ³•"></a><font size=3>äºŒã€åŸºæœ¬è¯­æ³•</font></h1><h2 id="1-dtsiå¤´æ–‡ä»¶"><a href="#1-dtsiå¤´æ–‡ä»¶" class="headerlink" title="1.Â dtsiå¤´æ–‡ä»¶"></a><font size=3>1.Â <code>dtsi</code>å¤´æ–‡ä»¶</font></h2><p>å’Œ <code>C</code> è¯­è¨€ä¸€æ ·ï¼Œè®¾å¤‡æ ‘ä¹Ÿæ”¯æŒå¤´æ–‡ä»¶ï¼Œè®¾å¤‡æ ‘çš„å¤´æ–‡ä»¶æ‰©å±•åä¸º<code>.dtsi</code>ï¼Œä¸€ä¸ª<code>  dts</code>æ–‡ä»¶åŒ…å«å…¶ä»–<code>dtsi</code>æ–‡ä»¶çš„ä¸€èˆ¬æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;DeviceTree_name.dtsi&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>ä¸€èˆ¬<code>.dtsi</code> æ–‡ä»¶ç”¨äºæè¿° <code>SOC</code> çš„å†…éƒ¨å¤–è®¾ä¿¡æ¯ï¼Œæ¯”å¦‚ <code>CPU</code> æ¶æ„ã€ä¸»é¢‘ã€å¤–è®¾å¯„å­˜å™¨åœ°å€èŒƒå›´ï¼Œæ¯”å¦‚ <code>UART</code>ã€ <code>IIC</code> ç­‰ç­‰ã€‚</p>
<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong>åœ¨<code>.dts</code> è®¾å¤‡æ ‘æ–‡ä»¶ä¸­ï¼Œå¯ä»¥é€šè¿‡<code>#include</code>æ¥å¼•ç”¨<code>.h</code>ã€<code>.dtsi</code> å’Œ<code>.dts</code> æ–‡ä»¶ã€‚åªæ˜¯ï¼Œæˆ‘ä»¬åœ¨ç¼–å†™è®¾å¤‡æ ‘å¤´æ–‡ä»¶çš„æ—¶å€™æœ€å¥½é€‰æ‹©<code>.dtsi</code>åç¼€ã€‚  </p>
<h2 id="2-è®¾å¤‡èŠ‚ç‚¹"><a href="#2-è®¾å¤‡èŠ‚ç‚¹" class="headerlink" title="2. è®¾å¤‡èŠ‚ç‚¹"></a><font size=3>2. è®¾å¤‡èŠ‚ç‚¹</font></h2><h3 id="2-1-æ ¹èŠ‚ç‚¹"><a href="#2-1-æ ¹èŠ‚ç‚¹" class="headerlink" title="2.1 æ ¹èŠ‚ç‚¹"></a><font size=3>2.1 æ ¹èŠ‚ç‚¹</font></h3><p>è®¾å¤‡æ ‘æ˜¯é‡‡ç”¨æ ‘å½¢ç»“æ„æ¥æè¿°æ¿å­ä¸Šçš„è®¾å¤‡ä¿¡æ¯çš„æ–‡ä»¶ï¼Œæ¯ä¸ªè®¾å¤‡éƒ½æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå«åšè®¾å¤‡èŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½é€šè¿‡ä¸€äº›å±æ€§ä¿¡æ¯æ¥æè¿°èŠ‚ç‚¹ä¿¡æ¯ï¼Œå±æ€§å°±æ˜¯é”®â€”å€¼å¯¹ã€‚ä¾‹å¦‚ï¼Œ  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* èŠ‚é€‰è‡ªï¼šlinux-3.14/arch/arm/boot/dts/exynos4412-origen.dts */</span></span><br><span class="line">/ &#123;</span><br><span class="line">	model = <span class="string">&quot;Insignal Origen evaluation board based on Exynos4412&quot;</span>;</span><br><span class="line">	compatible = <span class="string">&quot;insignal,origen4412&quot;</span>, <span class="string">&quot;samsung,exynos4412&quot;</span>;</span><br><span class="line"></span><br><span class="line">	memory &#123;</span><br><span class="line">		reg = &lt;<span class="number">0x40000000</span> <span class="number">0x40000000</span>&gt;;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	chosen &#123;</span><br><span class="line">		bootargs =<span class="string">&quot;console=ttySAC2,115200&quot;</span>;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	firmware@<span class="number">0203F</span>000 &#123;</span><br><span class="line">		compatible = <span class="string">&quot;samsung,secure-firmware&quot;</span>;</span><br><span class="line">		reg = &lt;<span class="number">0x0203F000</span> <span class="number">0x1000</span>&gt;;</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="comment">/* ... ... */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>/</code>ï¼šæ˜¯æ ¹èŠ‚ç‚¹ï¼Œ<strong>æ¯ä¸ªè®¾å¤‡æ ‘æ–‡ä»¶åªæœ‰ä¸€ä¸ªæ ¹èŠ‚ç‚¹</strong>ã€‚ä¸€èˆ¬æ¥è¯´<code>.dtsi</code>å’Œ <code>.dts</code>æ–‡ä»¶éƒ½ä¼šæœ‰ä¸€ä¸ª<code>/</code>æ ¹èŠ‚ç‚¹ï¼Œå› ä¸ºè¿™ä¸¤ä¸ª<code>/</code>æ ¹èŠ‚ç‚¹çš„å†…å®¹ä¼šåˆå¹¶æˆä¸€ä¸ªæ ¹èŠ‚ç‚¹ã€‚</li>
</ul>
<h3 id="2-2-ç‰¹æ®ŠèŠ‚ç‚¹"><a href="#2-2-ç‰¹æ®ŠèŠ‚ç‚¹" class="headerlink" title="2.2 ç‰¹æ®ŠèŠ‚ç‚¹"></a><font size=3>2.2 ç‰¹æ®ŠèŠ‚ç‚¹</font></h3><h4 id="2-2-1-memory"><a href="#2-2-1-memory" class="headerlink" title="2.2.1Â /memory"></a><font size=3>2.2.1Â <code>/memory</code></font></h4><p>æ‰€æœ‰è®¾å¤‡æ ‘æ–‡ä»¶çš„å¿…éœ€èŠ‚ç‚¹ï¼Œå®ƒå®šä¹‰äº†ç³»ç»Ÿç‰©ç†å†…å­˜çš„<code>layout</code>ï¼Œä¾‹å¦‚ï¼Œ</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">memory &#123;</span><br><span class="line">	reg = &lt;<span class="number">0x40000000</span> <span class="number">0x40000000</span>&gt;; <span class="comment">/* ç”¨æ¥æŒ‡å®šå†…å­˜çš„åœ°å€ã€å¤§å° */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-2-chosen"><a href="#2-2-2-chosen" class="headerlink" title="2.2.2Â /chosen"></a><font size=3>2.2.2Â <code>/chosen</code></font></h4><p>è¯¥èŠ‚ç‚¹å¹¶ä¸æ˜¯ä¸€ä¸ªçœŸå®çš„è®¾å¤‡ï¼Œä¸»è¦æ˜¯ç”¨äºä¼ é€’å†…æ ¸å¯åŠ¨æ—¶ä½¿ç”¨çš„å‚æ•°<code>parameter</code>ï¼Œä¾‹å¦‚ï¼Œ</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chosen &#123;</span><br><span class="line">	bootargs =<span class="string">&quot;console=ttySAC2,115200&quot;</span>;<span class="comment">/* å­—ç¬¦ä¸²ï¼Œå†…æ ¸å¯åŠ¨å‚æ•°, è·Ÿu-bootä¸­è®¾ç½®çš„bootargsä½œç”¨ä¸€æ · */</span> </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>å‰è¾¹æˆ‘ä»¬å·²å°†æŸ¥çœ‹è¿‡è®¾å¤‡æ ‘çš„è¿™ä¸ªèŠ‚ç‚¹åœ¨ç³»ç»Ÿä¸­çš„ä½“ç°äº†ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">[root@farsightproc]#</span><span class="language-bash"><span class="built_in">ls</span> -lh /proc/device-tree/chosen/</span></span><br><span class="line">total 0</span><br><span class="line">-r--r--r--    1 0        0            116 Jan  1 00:16 bootargs</span><br><span class="line">-r--r--r--    1 0        0              7 Jan  1 00:16 name</span><br><span class="line"><span class="meta prompt_">[root@farsightproc]#</span><span class="language-bash"><span class="built_in">cat</span> /proc/device-tree/chosen/bootargs</span> </span><br><span class="line">root=/dev/nfs nfsroot=192.168.10.101:/home/hk/4nfs/rootfs rw console=ttySAC2,115200 init=/linuxrc ip=192.168.10.102</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯æˆ‘ä»¬ä¼šå‘ç°ï¼Œè®¾å¤‡æ ‘æ–‡ä»¶ä¸­çš„å‚æ•°æ˜¯å¾ˆå°‘çš„ï¼Œåªæœ‰<code>&quot;console=ttySAC2,115200&quot;</code>ï¼Œé‚£ä¹ˆå…¶ä»–çš„æ˜¯å“ªé‡Œæ¥çš„å‘¢ï¼Ÿ</p>
<p>å­¦ä¹ <code>uboot</code> çš„æ—¶å€™æˆ‘ä»¬çŸ¥é“ï¼Œ <code>uboot</code> åœ¨å¯åŠ¨ <code>Linux </code>å†…æ ¸çš„æ—¶å€™ä¼šå°† <code>bootargs</code> çš„å€¼ä¼ é€’ç»™ <code>Linux</code>å†…æ ¸ï¼Œ <code>bootargs</code> ä¼šä½œä¸º <code>Linux</code> å†…æ ¸çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œ <code>Linux</code> å†…æ ¸å¯åŠ¨çš„æ—¶å€™ä¼šæ‰“å°å‡ºå‘½ä»¤è¡Œå‚æ•°(ä¹Ÿå°±æ˜¯ <code>uboot</code> ä¼ é€’è¿›æ¥çš„ <code>bootargs</code> çš„å€¼)ã€‚é‚£ä¹ˆè¿™ä¸¤è€…æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬åœ¨<code>uboot</code>çš„æŸ¥æ‰¾<code>chosen  </code>è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œä¼šæ‰¾åˆ°<code>common/fdt_support.c</code>æ–‡ä»¶ä¸­æœ‰è¿™ä¹ˆä¸€ä¸ªå‡½æ•°ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">fdt_chosen</span><span class="params">(<span class="type">void</span> *fdt, <span class="type">int</span> force)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// ... ...</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Find the &quot;chosen&quot; node.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	nodeoffset = fdt_path_offset (fdt, <span class="string">&quot;/chosen&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * If there is no &quot;chosen&quot; node in the blob, create it.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (nodeoffset &lt; <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Create a new node &quot;/chosen&quot; (offset 0 is root level)</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		nodeoffset = fdt_add_subnode(fdt, <span class="number">0</span>, <span class="string">&quot;chosen&quot;</span>);</span><br><span class="line">		<span class="keyword">if</span> (nodeoffset &lt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;WARNING: could not create /chosen %s.\n&quot;</span>,</span><br><span class="line">				fdt_strerror(nodeoffset));</span><br><span class="line">			<span class="keyword">return</span> nodeoffset;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Create /chosen properites that don&#x27;t exist in the fdt.</span></span><br><span class="line"><span class="comment">	 * If the property exists, update it only if the &quot;force&quot; parameter</span></span><br><span class="line"><span class="comment">	 * is true.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	str = getenv(<span class="string">&quot;bootargs&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span> (str != <span class="literal">NULL</span>) &#123;</span><br><span class="line">		path = fdt_getprop(fdt, nodeoffset, <span class="string">&quot;bootargs&quot;</span>, <span class="literal">NULL</span>);</span><br><span class="line">		<span class="keyword">if</span> ((path == <span class="literal">NULL</span>) || force) &#123;</span><br><span class="line">			err = fdt_setprop(fdt, nodeoffset,</span><br><span class="line">				<span class="string">&quot;bootargs&quot;</span>, str, <span class="built_in">strlen</span>(str)+<span class="number">1</span>);</span><br><span class="line">			<span class="keyword">if</span> (err &lt; <span class="number">0</span>)</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;WARNING: could not set bootargs %s.\n&quot;</span>,</span><br><span class="line">					fdt_strerror(err));</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// ... ...</span></span><br><span class="line">	<span class="keyword">return</span> err;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥å®é™…ä¸Šå°±æ˜¯åœ¨<code>uboot</code>ä¸­çš„ç›¸å…³å‡½æ•°ä¿®æ”¹äº†è®¾å¤‡æ ‘çš„è¿™ä¸ªèŠ‚ç‚¹ï¼Œå®é™…çš„æµç¨‹æ˜¯è¿™æ ·çš„ï¼ˆå¼•ç”¨çš„æ­£ç‚¹åŸå­é©±åŠ¨å¼€å‘æ‰‹å†Œä¸­çš„ä¸€å¼ å›¾ï¼‰ï¼š</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/01HQ%E8%AF%BE%E7%A8%8B%E4%BD%93%E7%B3%BB/LV10-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/LV10-08-%E8%AE%BE%E5%A4%87%E6%A0%91-01-%E8%AE%BE%E5%A4%87%E6%A0%91%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/img/image-20220902082931968.png" alt="image-20220902082931968" style="zoom: 50%;" />



<h4 id="2-2-3-cpus"><a href="#2-2-3-cpus" class="headerlink" title="2.2.3Â /cpus"></a><font size=3>2.2.3Â <code>/cpus</code></font></h4><p>å¤šæ ¸<code>CPU</code>æ”¯æŒï¼Œ<code>/cpus</code>èŠ‚ç‚¹ä¸‹æœ‰<code>1</code>ä¸ªæˆ–å¤šä¸ª<code>cpu</code>å­èŠ‚ç‚¹,<code>cpu</code>å­èŠ‚ç‚¹ä¸­ç”¨<code>reg</code>å±æ€§ç”¨æ¥æ ‡æ˜è‡ªå·±æ˜¯å“ªä¸€ä¸ª<code>cpu</code>ï¼Œæ‰€ä»¥ <code>/cpus</code> ä¸­æœ‰ä»¥ä¸‹<code>2</code>ä¸ªå±æ€§:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#address-cells   <span class="comment">/* åœ¨å®ƒçš„å­èŠ‚ç‚¹çš„regå±æ€§ä¸­, ä½¿ç”¨å¤šå°‘ä¸ªu32æ•´æ•°æ¥æè¿°åœ°å€(address) */</span></span></span><br><span class="line"><span class="meta">#size-cells      <span class="comment">/* åœ¨å®ƒçš„å­èŠ‚ç‚¹çš„regå±æ€§ä¸­, ä½¿ç”¨å¤šå°‘ä¸ªu32æ•´æ•°æ¥æè¿°å¤§å°(size) å¿…é¡»è®¾ç½®ä¸º0 */</span></span></span><br></pre></td></tr></table></figure>

<h4 id="2-2-4-aliases"><a href="#2-2-4-aliases" class="headerlink" title="2.2.4Â aliases "></a><font size=3>2.2.4Â <code>aliases </code></font></h4><p><code>aliases</code> çš„æ„æ€æ˜¯â€œåˆ«åâ€ï¼Œå› æ­¤ <code>aliases</code> èŠ‚ç‚¹çš„ä¸»è¦åŠŸèƒ½å°±æ˜¯å®šä¹‰åˆ«åï¼Œå®šä¹‰åˆ«åçš„ç›®çš„å°±æ˜¯ä¸ºäº†æ–¹ä¾¿è®¿é—®èŠ‚ç‚¹ã€‚ä¸è¿‡æˆ‘ä»¬ä¸€èˆ¬ä¼šåœ¨èŠ‚ç‚¹å‘½åçš„æ—¶å€™ä¼šåŠ ä¸Š<code>label</code>ï¼Œç„¶åé€šè¿‡<code>&amp;label</code>æ¥è®¿é—®èŠ‚ç‚¹ï¼Œè¿™æ ·ä¹Ÿå¾ˆæ–¹ä¾¿ã€‚</p>
<h3 id="2-3-èŠ‚ç‚¹è¯­æ³•"><a href="#2-3-èŠ‚ç‚¹è¯­æ³•" class="headerlink" title="2.3 èŠ‚ç‚¹è¯­æ³•"></a><font size=3>2.3 èŠ‚ç‚¹è¯­æ³•</font></h3><p>èŠ‚ç‚¹çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[label:] node-name[@unit-address] &#123;    </span><br><span class="line">	[properties definitions];    </span><br><span class="line">	[child nodes];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>label</code>ï¼šå¯é€‰é¡¹ï¼ŒèŠ‚ç‚¹åˆ«åï¼Œä¸ºäº†ç¼©çŸ­èŠ‚ç‚¹è®¿é—®è·¯å¾„ï¼Œåç»­èŠ‚ç‚¹ä¸­å¯ä»¥ä½¿ç”¨ <code>&amp;label</code>æ¥è¡¨ç¤ºå¼•ç”¨æŒ‡å®šèŠ‚ç‚¹ã€‚</li>
<li><code>node-name</code>ï¼šèŠ‚ç‚¹çš„åå­—ã€‚</li>
<li><code>unit-address</code>ï¼šè®¾å¤‡åœ°å€ï¼Œä¸€èˆ¬å¡«å†™è¯¥è®¾å¤‡å¯„å­˜å™¨ç»„æˆ–å†…å­˜å—çš„é¦–åœ°å€ã€‚</li>
<li><code>properties definitions</code>ï¼šå±æ€§å®šä¹‰ã€‚</li>
<li><code>child nodes</code>ï¼šå­èŠ‚ç‚¹ã€‚</li>
</ul>
<h3 id="2-4-èŠ‚ç‚¹å±æ€§è¯­æ³•"><a href="#2-4-èŠ‚ç‚¹å±æ€§è¯­æ³•" class="headerlink" title="2.4 èŠ‚ç‚¹å±æ€§è¯­æ³•"></a><font size=3>2.4 èŠ‚ç‚¹å±æ€§è¯­æ³•</font></h3><p>èŠ‚ç‚¹ä¸­å„ä¸ªå±æ€§çš„åŸºæœ¬è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[label:] property-name = value;</span><br><span class="line">[label:] property-name;</span><br></pre></td></tr></table></figure>

<p>å±æ€§å¯ä»¥æ— å€¼ï¼Œå¯¹äºæœ‰å€¼çš„å±æ€§ï¼Œå¯ä»¥æœ‰ä¸‰ç§å–å€¼ï¼š</p>
<ul>
<li><code>arrays of cells</code>ï¼Œ<code>1</code>ä¸ªæˆ–å¤šä¸ª<code>32</code>ä½æ•°æ®ï¼Œ<code> 64</code>ä½æ•°æ®ä½¿ç”¨<code>2</code>ä¸ª<code>32</code>ä½æ•°æ®è¡¨ç¤ºï¼Œæ•°æ®ä¹‹é—´ç”¨ç©ºæ ¼åˆ†éš”ï¼Œç”¨å°–æ‹¬å·è¡¨ç¤º(<code>&lt; &gt;</code>)ã€‚</li>
<li><code>string</code>ï¼Œå°±æ˜¯å­—ç¬¦ä¸²ï¼Œ ç”¨åŒå¼•å·è¡¨ç¤º(<code>&quot; &quot;</code>)ã€‚</li>
<li><code>bytestring</code>ï¼Œ<code>1</code>ä¸ªæˆ–å¤šä¸ªå­—èŠ‚ï¼Œé€šè¿‡ç©ºæ ¼åˆ†éš”,ç”¨æ–¹æ‹¬å·è¡¨ç¤º(<code>[]</code>)ã€‚</li>
<li>ç”¨<code>,</code>åˆ†éš”çš„å¤šå€¼ã€‚</li>
</ul>
<h2 id="3-æ•°æ®ç±»å‹"><a href="#3-æ•°æ®ç±»å‹" class="headerlink" title="3. æ•°æ®ç±»å‹"></a><font size=3>3. æ•°æ®ç±»å‹</font></h2><p>åœ¨è®¾å¤‡æ ‘çš„æºç ä¸­å¸¸ç”¨çš„å‡ ç§æ•°æ®ç±»å‹æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li>å­—ç¬¦ä¸²</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compatible = <span class="string">&quot;arm,cortex-a7&quot;</span>; <span class="comment">/* è®¾ç½® compatible å±æ€§çš„å€¼ä¸ºå­—ç¬¦ä¸²&quot;arm,cortex-a7&quot; */</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>32</code>ä½æ— ç¬¦å·æ•´æ•°</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reg = &lt;<span class="number">0</span>&gt;;               <span class="comment">/* è®¾ç½® reg å±æ€§çš„å€¼ä¸º 0 */</span></span><br><span class="line">reg = &lt;<span class="number">0</span> <span class="number">0x123456</span> <span class="number">100</span>&gt;;  <span class="comment">/* reg çš„å€¼ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºä¸€ç»„å€¼ */</span></span><br></pre></td></tr></table></figure>

<ul>
<li>å­—ç¬¦ä¸²åˆ—è¡¨</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compatible = <span class="string">&quot;insignal,origen4412&quot;</span>, <span class="string">&quot;samsung,exynos4412&quot;</span>;</span><br></pre></td></tr></table></figure>

<h1 id="ä¸‰ã€æ ‡å‡†å±æ€§"><a href="#ä¸‰ã€æ ‡å‡†å±æ€§" class="headerlink" title="ä¸‰ã€æ ‡å‡†å±æ€§"></a><font size=3>ä¸‰ã€æ ‡å‡†å±æ€§</font></h1><p>èŠ‚ç‚¹æ˜¯ç”±ä¸€å †çš„å±æ€§ç»„æˆï¼ŒèŠ‚ç‚¹éƒ½æ˜¯å…·ä½“çš„è®¾å¤‡ï¼Œä¸åŒçš„è®¾å¤‡éœ€è¦çš„å±æ€§ä¸åŒï¼Œç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰å±æ€§ã€‚é™¤äº†ç”¨æˆ·è‡ªå®šä¹‰å±æ€§ï¼Œæœ‰å¾ˆå¤šå±æ€§æ˜¯æ ‡å‡†å±æ€§ï¼Œ <code>Linux</code> ä¸‹çš„å¾ˆå¤šå¤–è®¾é©±åŠ¨éƒ½ä¼šä½¿ç”¨è¿™äº›æ ‡å‡†å±æ€§ã€‚  </p>
<h2 id="1-compatible"><a href="#1-compatible" class="headerlink" title="1.Â compatible "></a><font size=3>1.Â <code>compatible </code></font></h2><p><code>compatible</code> å±æ€§ä¹Ÿå«åšâ€œå…¼å®¹æ€§â€å±æ€§ï¼Œè¿™æ˜¯éå¸¸é‡è¦çš„ä¸€ä¸ªå±æ€§ã€‚<code>compatible</code> å±æ€§çš„å€¼æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œ è¯¥å±æ€§ç”¨äºå°†è®¾å¤‡å’Œé©±åŠ¨ç»‘å®šèµ·æ¥ã€‚å­—ç¬¦ä¸²åˆ—è¡¨ç”¨äºé€‰æ‹©è®¾å¤‡æ‰€è¦ä½¿ç”¨çš„é©±åŠ¨ç¨‹åºï¼Œ <code>compatible</code> å±æ€§çš„å€¼æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compatible = <span class="string">&quot;manufacturer,model&quot;</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>manufacturer</code> ï¼šè¡¨ç¤ºå‚å•†ã€‚</li>
<li><code> model</code> ï¼šä¸€èˆ¬æ˜¯æ¨¡å—å¯¹åº”çš„é©±åŠ¨åå­—ã€‚</li>
</ul>
<p>ä¸€èˆ¬é©±åŠ¨ç¨‹åºæ–‡ä»¶éƒ½ä¼šæœ‰ä¸€ä¸ª <code>OF</code> åŒ¹é…è¡¨ï¼Œæ­¤ <code>OF</code> åŒ¹é…è¡¨ä¿å­˜ç€ä¸€äº› <code>compatible</code> å€¼ï¼Œå¦‚æœè®¾å¤‡èŠ‚ç‚¹çš„ <code>compatible</code> å±æ€§å€¼å’Œ <code>OF</code> åŒ¹é…è¡¨ä¸­çš„ä»»ä½•ä¸€ä¸ªå€¼ç›¸ç­‰ï¼Œé‚£ä¹ˆå°±è¡¨ç¤ºè®¾å¤‡å¯ä»¥ä½¿ç”¨è¿™ä¸ªé©±åŠ¨ã€‚  </p>
<p>æ ¹èŠ‚ç‚¹ä¸‹çš„<code>compatible</code>å±æ€§ï¼Œç”¨æ¥æŒ‡å®šå†…æ ¸ä¸­å“ªä¸ª<code>machine_desc</code>å¯ä»¥æ”¯æŒæœ¬è®¾å¤‡ï¼Œå³æè¿°å…¶å…¼å®¹å“ªäº›å¹³å° ã€‚lä¾‹å¦‚ï¼Œ</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compatible = <span class="string">&quot;insignal,origen4412&quot;</span>, <span class="string">&quot;samsung,exynos4412&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æ ¹èŠ‚ç‚¹çš„ <code>compatible</code>å±æ€§å¯ä»¥çŸ¥é“æˆ‘ä»¬æ‰€ä½¿ç”¨çš„è®¾å¤‡ï¼Œä¸€èˆ¬ç¬¬ä¸€ä¸ªå€¼æè¿°äº†æ‰€ä½¿ç”¨çš„ç¡¬ä»¶è®¾å¤‡åå­—ï¼Œæ¯”å¦‚è¿™é‡Œä½¿ç”¨æ˜¯<code>origen4412</code>è¿™ä¸ªè®¾å¤‡ï¼Œç¬¬äºŒä¸ªå€¼æè¿°äº†è®¾å¤‡æ‰€ä½¿ç”¨çš„<code>SOC</code>ï¼Œæ¯”å¦‚è¿™é‡Œä½¿ç”¨çš„æ˜¯<code>exynos4412</code>è¿™é¢— <code>SOC</code>ã€‚ <code>Linux</code> å†…æ ¸ä¼šé€šè¿‡æ ¹èŠ‚ç‚¹çš„ <code>compoatible</code> å±æ€§æŸ¥çœ‹æ˜¯å¦æ”¯æŒæ­¤è®¾å¤‡ï¼Œå¦‚æœæ”¯æŒçš„è¯è®¾å¤‡å°±ä¼šå¯åŠ¨<code>Linux</code>å†…æ ¸ã€‚  </p>
<h2 id="2-model"><a href="#2-model" class="headerlink" title="2.Â model"></a><font size=3>2.Â <code>model</code></font></h2><p><code>model</code> å±æ€§å€¼ä¹Ÿæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¸€èˆ¬ <code>model</code> å±æ€§æè¿°è®¾å¤‡æ¨¡å—ä¿¡æ¯ï¼Œæ¯”å¦‚åå­— ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model = <span class="string">&quot;Insignal Origen evaluation board based on Exynos4412&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>æ ¹èŠ‚ç‚¹ä¸‹çš„<code>model</code>å¯ä»¥ç”¨äºåŒºåˆ†ä¸åŒçš„æ¿å­ï¼Œæ¯”å¦‚æœ‰<code>2</code>æ¬¾æ¿å­é…ç½®åŸºæœ¬ä¸€è‡´, å®ƒä»¬çš„<code>compatible</code>æ˜¯ä¸€æ ·çš„ï¼Œé‚£ä¹ˆå°±é€šè¿‡<code>model</code>æ¥åˆ†è¾¨è¿™<code>2</code>æ¬¾æ¿å­ã€‚</p>
<h2 id="3-status"><a href="#3-status" class="headerlink" title="3.Â status"></a><font size=3>3.Â <code>status</code></font></h2><p><code>status</code> å±æ€§çœ‹åå­—å°±çŸ¥é“æ˜¯å’Œè®¾å¤‡çŠ¶æ€æœ‰å…³çš„ï¼Œ<code>status</code> å±æ€§å€¼ä¹Ÿæ˜¯å­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²æ˜¯è®¾å¤‡çš„çŠ¶æ€ä¿¡æ¯ï¼Œå¯é€‰çš„çŠ¶æ€å¦‚ä¸‹è¡¨ï¼š</p>
<table>
    <tr><td align="center">å€¼</td><td align="center">æè¿°</td></tr>
    <tr><td align="left">"okay"</td><td align="left">è¡¨æ˜è®¾å¤‡æ˜¯å¯æ“ä½œçš„ã€‚</td></tr>
    <tr><td align="left">"disabled" </td><td align="left">è¡¨æ˜è®¾å¤‡å½“å‰æ˜¯ä¸å¯æ“ä½œçš„ï¼Œä½†æ˜¯åœ¨æœªæ¥å¯ä»¥å˜ä¸ºå¯æ“ä½œçš„ï¼Œæ¯”å¦‚çƒ­æ’æ‹”è®¾å¤‡æ’å…¥ä»¥åã€‚ è‡³äº disabled çš„å…·ä½“å«ä¹‰è¿˜è¦çœ‹è®¾å¤‡çš„ç»‘å®šæ–‡æ¡£ã€‚</td></tr>
    <tr><td align="left">"fail"</td><td align="left">è¡¨æ˜è®¾å¤‡ä¸å¯æ“ä½œï¼Œè®¾å¤‡æ£€æµ‹åˆ°äº†ä¸€ç³»åˆ—çš„é”™è¯¯ï¼Œè€Œä¸”è®¾å¤‡ä¹Ÿä¸å¤§å¯èƒ½å˜å¾—å¯æ“ä½œã€‚</td></tr>
    <tr><td align="left">"fail-sss" </td><td align="left">å«ä¹‰å’Œ"fail"ç›¸åŒï¼Œåé¢çš„ sss éƒ¨åˆ†æ˜¯æ£€æµ‹åˆ°çš„é”™è¯¯å†…å®¹ã€‚</td></tr>
</table>


<h2 id="4-å­èŠ‚ç‚¹åœ°å€ä¿¡æ¯"><a href="#4-å­èŠ‚ç‚¹åœ°å€ä¿¡æ¯" class="headerlink" title="4. å­èŠ‚ç‚¹åœ°å€ä¿¡æ¯"></a><font size=3>4. å­èŠ‚ç‚¹åœ°å€ä¿¡æ¯</font></h2><h3 id="4-1-address-cells"><a href="#4-1-address-cells" class="headerlink" title="4.1Â #address-cells "></a><font size=3>4.1Â <code>#address-cells</code> </font></h3><p>è¯¥å±æ€§çš„å€¼ä¸ºæ— ç¬¦å·<code>32</code>ä½æ•´æ•°ï¼Œå¯ä»¥ç”¨åœ¨ä»»ä½•æ‹¥æœ‰å­èŠ‚ç‚¹çš„è®¾å¤‡ä¸­ï¼Œç”¨äºæè¿°å­èŠ‚ç‚¹çš„åœ°å€ä¿¡æ¯ã€‚è¯¥å±æ€§çš„å€¼å†³å®šäº†å­èŠ‚ç‚¹ <code>reg</code> å±æ€§ä¸­åœ°å€ä¿¡æ¯æ‰€å ç”¨çš„å­—é•¿(<code>32</code> ä½)ï¼Œæ„æ€å°±æ˜¯åœ¨å­èŠ‚ç‚¹çš„<code>reg</code>å±æ€§ä¸­, ä½¿ç”¨å¤šå°‘ä¸ª<code>u32</code>æ•´æ•°æ¥æè¿°åœ°å€(<code>address</code>)  ã€‚ä¸€èˆ¬ä½¿ç”¨æ ¼å¼ä¸ºï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#address-cells = <span class="string">&lt;æ•°å­—&gt;</span>;</span></span><br></pre></td></tr></table></figure>



<h3 id="4-2-size-cells"><a href="#4-2-size-cells" class="headerlink" title="4.2Â #size-cells "></a><font size=3>4.2Â <code>#size-cells </code></font></h3><p>è¯¥å±æ€§çš„å€¼ä¹Ÿä¸ºæ— ç¬¦å·<code>32</code>ä½æ•´æ•°ï¼Œå¯ä»¥ç”¨åœ¨ä»»ä½•æ‹¥æœ‰å­èŠ‚ç‚¹çš„è®¾å¤‡ä¸­ï¼Œç”¨äºæè¿°å­èŠ‚ç‚¹çš„åœ°å€ä¿¡æ¯ã€‚è¯¥å±æ€§çš„å€¼å†³å®šäº†å­èŠ‚ç‚¹ <code>reg</code> å±æ€§ä¸­é•¿åº¦ä¿¡æ¯æ‰€å çš„å­—é•¿(<code>32</code> ä½)ï¼Œæ„æ€å°±æ˜¯åœ¨å­èŠ‚ç‚¹çš„<code>reg</code>å±æ€§ä¸­, ä½¿ç”¨å¤šå°‘ä¸ª<code>u32</code>æ•´æ•°æ¥æè¿°å¤§å°(<code>size</code>)  ã€‚ä¸€èˆ¬ä½¿ç”¨æ ¼å¼ä¸ºï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#size-cells = <span class="string">&lt;æ•°å­—&gt;</span>;</span></span><br></pre></td></tr></table></figure>



<h3 id="4-3-reg"><a href="#4-3-reg" class="headerlink" title="4.3Â reg"></a><font size=3>4.3Â <code>reg</code></font></h3><p><code>reg</code>å±æ€§æ˜¯ç”¨æ¥æè¿°å­ç»“ç‚¹çš„åœ°å€ä¿¡æ¯çš„ï¼Œä¸€èˆ¬æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg = &lt;address1 length1 [address2 length2] [address3 length3] [... ...]&gt;;</span><br></pre></td></tr></table></figure>

<p>æ¯ä¸ª<code>address length</code>ç»„åˆè¡¨ç¤ºä¸€ä¸ªåœ°å€èŒƒå›´ï¼Œå…¶ä¸­<code>address</code>æ˜¯èµ·å§‹åœ°å€ï¼Œ <code>length</code> æ˜¯åœ°å€é•¿åº¦ï¼Œ <code>#address-cells</code> è¡¨æ˜ <code>address</code> è¿™ä¸ªæ•°æ®æ‰€å ç”¨çš„å­—é•¿ï¼Œ <code>#size-cells</code> è¡¨æ˜ <code>length</code> è¿™ä¸ªæ•°æ®æ‰€å ç”¨çš„å­—é•¿ã€‚</p>
<h3 id="4-4-ä½¿ç”¨å®ä¾‹"><a href="#4-4-ä½¿ç”¨å®ä¾‹" class="headerlink" title="4.4 ä½¿ç”¨å®ä¾‹"></a><font size=3>4.4 ä½¿ç”¨å®ä¾‹</font></h3><h4 id="4-4-1-å®ä¾‹1"><a href="#4-4-1-å®ä¾‹1" class="headerlink" title="4.4.1 å®ä¾‹1"></a><font size=3>4.4.1 å®ä¾‹1</font></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">spi4 &#123;</span><br><span class="line">	compatible = <span class="string">&quot;spi-gpio&quot;</span>;</span><br><span class="line">	<span class="meta">#address-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">	<span class="meta">#size-cells = <span class="string">&lt;0&gt;</span>;</span></span><br><span class="line"></span><br><span class="line">	gpio_spi: gpio_spi@<span class="number">0</span> &#123;</span><br><span class="line">		compatible = <span class="string">&quot;fairchild,74hc595&quot;</span>;</span><br><span class="line">		reg = &lt;<span class="number">0</span>&gt;;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>#address-cells = &lt;1&gt;;</code></li>
</ul>
<p>è¿™ä¸€å¥è¡¨ç¤º<code>spi4</code> çš„å­èŠ‚ç‚¹<code>reg</code>å±æ€§ä¸­èµ·å§‹åœ°å€æ‰€å ç”¨çš„å­—é•¿ä¸º<code>1 </code>ã€‚</p>
<ul>
<li><code>#size-cells = &lt;0&gt;;</code></li>
</ul>
<p>è¿™ä¸€å¥è¡¨ç¤º<code>spi4</code> çš„å­èŠ‚ç‚¹<code>reg</code>å±æ€§ä¸­åœ°å€é•¿åº¦æ‰€å ç”¨çš„å­—é•¿ä¸º <code>0</code>ã€‚</p>
<ul>
<li><code>reg = &lt;0&gt;;</code></li>
</ul>
<p>å­èŠ‚ç‚¹ <code>gpio_spi: gpio_spi@0</code> çš„ <code>reg</code> å±æ€§å€¼ä¸º <code>&lt;0&gt;</code>ï¼Œå› ä¸ºçˆ¶èŠ‚ç‚¹è®¾ç½®äº†<code>#addresscells = &lt;1&gt;</code>å’Œ<code>#size-cells = &lt;0&gt;</code>ï¼Œå› æ­¤ <code>addres=0</code>ï¼Œæ²¡æœ‰ <code>length</code> çš„å€¼ï¼Œç›¸å½“äºè®¾ç½®äº†èµ·å§‹åœ°å€ï¼Œè€Œæ²¡æœ‰è®¾ç½®åœ°å€é•¿åº¦ã€‚  </p>
<h4 id="4-4-2-å®ä¾‹2"><a href="#4-4-2-å®ä¾‹2" class="headerlink" title="4.4.2 å®ä¾‹2"></a><font size=3>4.4.2 å®ä¾‹2</font></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">aips3: aips-bus@<span class="number">02200000</span> &#123;</span><br><span class="line">	compatible = <span class="string">&quot;fsl,aips-bus&quot;</span>, <span class="string">&quot;simple-bus&quot;</span>;</span><br><span class="line">	<span class="meta">#address-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line">	<span class="meta">#size-cells = <span class="string">&lt;1&gt;</span>;</span></span><br><span class="line"></span><br><span class="line">	dcp: dcp@<span class="number">02280000</span> &#123;</span><br><span class="line">		compatible = <span class="string">&quot;fsl,imx6sl-dcp&quot;</span>;</span><br><span class="line">		reg = &lt;<span class="number">0x02280000</span> <span class="number">0x4000</span>&gt;;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>#address-cells = &lt;1&gt;;</code></li>
</ul>
<p>è¿™ä¸€å¥è¡¨ç¤º<code>aips3</code> çš„å­èŠ‚ç‚¹<code>reg</code>å±æ€§ä¸­èµ·å§‹åœ°å€æ‰€å ç”¨çš„å­—é•¿ä¸º<code>1 </code>ã€‚</p>
<ul>
<li><code>#size-cells = &lt;1&gt;;</code></li>
</ul>
<p>è¿™ä¸€å¥è¡¨ç¤º<code>aips3</code> çš„å­èŠ‚ç‚¹<code>reg</code>å±æ€§ä¸­åœ°å€é•¿åº¦æ‰€å ç”¨çš„å­—é•¿ä¸º <code>1</code>ã€‚</p>
<ul>
<li><code>reg = &lt;0x02280000 0x4000&gt;;</code></li>
</ul>
<p>å­èŠ‚ç‚¹<code>dcp: dcp@02280000</code>çš„<code>reg</code>å±æ€§å€¼ä¸º<code>&lt;0x02280000 0x4000&gt;</code>ï¼Œå› ä¸ºçˆ¶èŠ‚ç‚¹è®¾ç½®äº†<code>#address-cells = &lt;1&gt;</code>ï¼Œ <code>#size-cells = &lt;1&gt;</code>ï¼Œ <code>address= 0x02280000</code>ï¼Œ<code>length= 0x4000</code>ï¼Œç›¸å½“äºè®¾ç½®äº†èµ·å§‹åœ°å€ä¸º<code>0x02280000</code>ï¼Œåœ°å€é•¿åº¦ä¸º<code>0x40000</code>ã€‚  </p>
<h2 id="5-ranges"><a href="#5-ranges" class="headerlink" title="5.Â ranges"></a><font size=3>5.Â <code>ranges</code></font></h2><p><code>ranges</code>å±æ€§å€¼å¯ä»¥ä¸ºç©ºæˆ–è€…æŒ‰ç…§(<code>child-bus-address,parent-bus-address</code>ï¼Œ<code>length</code>)æ ¼å¼ç¼–å†™çš„æ•°å­—çŸ©é˜µï¼Œ <code>ranges</code> æ˜¯ä¸€ä¸ªåœ°å€æ˜ å°„&#x2F;è½¬æ¢è¡¨ï¼Œ <code>ranges</code> å±æ€§æ¯ä¸ªé¡¹ç›®ç”±å­åœ°å€ã€çˆ¶åœ°å€å’Œåœ°å€ç©ºé—´é•¿åº¦è¿™ä¸‰éƒ¨åˆ†ç»„æˆï¼š  </p>
<ul>
<li><code>child-bus-address</code></li>
</ul>
<p>å­æ€»çº¿åœ°å€ç©ºé—´çš„ç‰©ç†åœ°å€ï¼Œç”±çˆ¶èŠ‚ç‚¹çš„<code>#address-cells </code>ç¡®å®šæ­¤ç‰©ç†åœ°å€æ‰€å ç”¨çš„å­—é•¿ã€‚</p>
<ul>
<li><code>parent-bus-address</code></li>
</ul>
<p>çˆ¶æ€»çº¿åœ°å€ç©ºé—´çš„ç‰©ç†åœ°å€ï¼ŒåŒæ ·ç”±çˆ¶èŠ‚ç‚¹çš„<code>#address-cells</code> ç¡®å®šæ­¤ç‰©ç†åœ°å€æ‰€å ç”¨çš„å­—é•¿ã€‚</p>
<ul>
<li><code>length</code></li>
</ul>
<p>å­åœ°å€ç©ºé—´çš„é•¿åº¦ï¼Œç”±çˆ¶èŠ‚ç‚¹çš„<code>#size-cells</code> ç¡®å®šæ­¤åœ°å€é•¿åº¦æ‰€å ç”¨çš„å­—é•¿ã€‚</p>
<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong>å¦‚æœ<code> ranges</code>å±æ€§å€¼ä¸ºç©ºå€¼ï¼Œè¯´æ˜å­åœ°å€ç©ºé—´å’Œçˆ¶åœ°å€ç©ºé—´å®Œå…¨ç›¸åŒï¼Œä¸éœ€è¦è¿›è¡Œåœ°å€è½¬æ¢ã€‚</p>
<h2 id="6-name"><a href="#6-name" class="headerlink" title="6.Â name"></a><font size=3>6.Â <code>name</code></font></h2><p><code>name</code> å±æ€§å€¼ä¸ºå­—ç¬¦ä¸²ï¼Œ <code>name</code> å±æ€§ç”¨äºè®°å½•èŠ‚ç‚¹åå­—ï¼Œ <code>name</code> å±æ€§å·²ç»è¢«å¼ƒç”¨ï¼Œä¸æ¨èä½¿ç”¨<code>name</code>å±æ€§ï¼Œä¸€äº›è€çš„è®¾å¤‡æ ‘æ–‡ä»¶å¯èƒ½ä¼šä½¿ç”¨æ­¤å±æ€§ã€‚  </p>
<h2 id="7-device-type"><a href="#7-device-type" class="headerlink" title="7.Â device_type"></a><font size=3>7.Â <code>device_type</code></font></h2><p><code>device_type</code> å±æ€§å€¼ä¸ºå­—ç¬¦ä¸²ï¼Œ <code>IEEE 1275</code> ä¼šç”¨åˆ°æ­¤å±æ€§ï¼Œç”¨äºæè¿°è®¾å¤‡çš„ <code>FCode</code>ï¼Œä½†æ˜¯è®¾å¤‡æ ‘æ²¡æœ‰ <code>FCode</code>ï¼Œæ‰€ä»¥æ­¤å±æ€§ä¹Ÿè¢«æŠ›å¼ƒäº†ã€‚æ­¤å±æ€§åªèƒ½ç”¨äº <code>cpu</code> èŠ‚ç‚¹æˆ–è€… <code>memory</code> èŠ‚ç‚¹ã€‚  </p>
<h1 id="å››ã€å¸¸ç”¨å±æ€§"><a href="#å››ã€å¸¸ç”¨å±æ€§" class="headerlink" title="å››ã€å¸¸ç”¨å±æ€§"></a><font size=3>å››ã€å¸¸ç”¨å±æ€§</font></h1><h2 id="1-phandle"><a href="#1-phandle" class="headerlink" title="1.Â phandle"></a><font size=3>1.Â <code>phandle</code></font></h2><p>æ•°å­—å½¢å¼çš„èŠ‚ç‚¹æ ‡è¯†ï¼Œåœ¨åç»­èŠ‚ç‚¹ä¸­å±æ€§å€¼æ€§è´¨è¡¨ç¤ºæŸèŠ‚ç‚¹æ—¶ï¼Œå¯ä»¥å¼•ç”¨å¯¹åº”èŠ‚ç‚¹ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pic@<span class="number">10000000</span> &#123;    </span><br><span class="line">	phandle = &lt;<span class="number">1</span>&gt;;    </span><br><span class="line">	interrupt-controller;</span><br><span class="line">&#125;;</span><br><span class="line">another-device-node &#123;    </span><br><span class="line">	interrupt-parent = &lt;<span class="number">1</span>&gt;;   <span class="comment">/* ä½¿ç”¨phandleå€¼ä¸º1æ¥å¼•ç”¨ä¸Šè¿°èŠ‚ç‚¹ */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="2-reg"><a href="#2-reg" class="headerlink" title="2.Â reg"></a><font size=3>2.Â <code>reg</code></font></h2><p><code>reg</code>å±æ€§ï¼šè¡¨ç¤ºå†…å­˜åŒºåŸŸ<code>region</code>ï¼Œä¸€èˆ¬æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg = &lt;address1 length1 [address2 length2] [address3 length3]&gt;;</span><br></pre></td></tr></table></figure>

<p><code>#address-cells</code>ï¼š<code>reg</code>å±æ€§ä¸­, ä½¿ç”¨å¤šå°‘ä¸ª<code>u32</code>æ•´æ•°æ¥æè¿°åœ°å€(<code>address</code>)ï¼Œä¸€èˆ¬æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#address-cells = <span class="string">&lt;æ•°å­—&gt;</span>;</span></span><br></pre></td></tr></table></figure>

<p><code>#size-cells</code>ï¼š<code>reg</code>å±æ€§ä¸­, ä½¿ç”¨å¤šå°‘ä¸ª<code>u32</code>æ•´æ•°æ¥æè¿°å¤§å°(<code>size</code>)ï¼Œä¸€èˆ¬æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#size-cells = <span class="string">&lt;æ•°å­—&gt;</span>;</span></span><br></pre></td></tr></table></figure>

<h2 id="3-compatible"><a href="#3-compatible" class="headerlink" title="3.Â compatible"></a><font size=3>3.Â <code>compatible</code></font></h2><p>é©±åŠ¨å’Œè®¾å¤‡ï¼ˆè®¾å¤‡èŠ‚ç‚¹ï¼‰çš„åŒ¹é…ä¾æ®ï¼Œ<code>compatible</code>ï¼ˆå…¼å®¹æ€§ï¼‰çš„å€¼å¯ä»¥æœ‰ä¸æ­¢ä¸€ä¸ªå­—ç¬¦ä¸²ä»¥æ»¡è¶³ä¸åŒçš„éœ€æ±‚ï¼Œä¸€èˆ¬æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compatible = &quot;å­—ç¬¦ä¸²1&quot;,&quot;å­—ç¬¦ä¸²2&quot;,...;</span><br></pre></td></tr></table></figure>

<h2 id="4-ä¸­æ–­ç›¸å…³å±æ€§"><a href="#4-ä¸­æ–­ç›¸å…³å±æ€§" class="headerlink" title="4. ä¸­æ–­ç›¸å…³å±æ€§"></a><font size=3>4. ä¸­æ–­ç›¸å…³å±æ€§</font></h2><h3 id="4-1-ä¸­æ–­æ§åˆ¶å™¨èŠ‚ç‚¹"><a href="#4-1-ä¸­æ–­æ§åˆ¶å™¨èŠ‚ç‚¹" class="headerlink" title="4.1 ä¸­æ–­æ§åˆ¶å™¨èŠ‚ç‚¹"></a><font size=3>4.1 ä¸­æ–­æ§åˆ¶å™¨èŠ‚ç‚¹</font></h3><ul>
<li><code>interrupt-controller </code></li>
</ul>
<p>ä¸€ä¸ªæ— å€¼ç©ºå±æ€§ï¼Œç”¨æ¥å£°æ˜è¿™ä¸ª<code>node</code>æ¥æ”¶ä¸­æ–­ä¿¡å·ï¼Œè¡¨ç¤ºè¯¥èŠ‚ç‚¹æ˜¯ä¸€ä¸ªä¸­æ–­æ§åˆ¶å™¨ã€‚</p>
<ul>
<li><code>#interrupt-cells</code></li>
</ul>
<p>è¿™æ˜¯ä¸­æ–­æ§åˆ¶å™¨èŠ‚ç‚¹çš„å±æ€§ï¼Œç”¨æ¥æ ‡è¯†è¿™ä¸ªæ§åˆ¶å™¨éœ€è¦å‡ ä¸ªå•ä½åšä¸­æ–­æè¿°ç¬¦ã€‚ç”¨æ¥æè¿°å­èŠ‚ç‚¹ä¸­<code>interrupts</code>å±æ€§ä½¿ç”¨äº†çˆ¶èŠ‚ç‚¹ä¸­çš„<code>interrupts</code>å±æ€§çš„å…·ä½“çš„å“ªä¸ªå€¼ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">interrupts = &lt;ä¸­æ–­åŸŸ ä¸­æ–­å· è§¦å‘æ–¹å¼&gt;   <span class="comment">/* çˆ¶èŠ‚ç‚¹çš„ #interrupt-cells å±æ€§çš„å€¼æ˜¯3 */</span></span><br><span class="line">interrupts = &lt;ä¸­æ–­å· è§¦å‘æ–¹å¼&gt;         <span class="comment">/* çˆ¶èŠ‚ç‚¹çš„ #interrupt-cells å±æ€§æ˜¯2 */</span></span><br></pre></td></tr></table></figure>



<h3 id="4-2-ä¸­æ–­æºè®¾å¤‡èŠ‚ç‚¹"><a href="#4-2-ä¸­æ–­æºè®¾å¤‡èŠ‚ç‚¹" class="headerlink" title="4.2 ä¸­æ–­æºè®¾å¤‡èŠ‚ç‚¹"></a><font size=3>4.2 ä¸­æ–­æºè®¾å¤‡èŠ‚ç‚¹</font></h3><ul>
<li><code>interrupt-parent</code></li>
</ul>
<p>æ ‡è¯†æ­¤è®¾å¤‡èŠ‚ç‚¹å±äºå“ªä¸€ä¸ªä¸­æ–­æ§åˆ¶å™¨ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®è¿™ä¸ªå±æ€§ï¼Œä¼šè‡ªåŠ¨ä¾é™„çˆ¶èŠ‚ç‚¹çš„ï¼Œä¸€èˆ¬æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">interrupt-parent = &lt;å¼•ç”¨æŸä¸­æ–­æ§åˆ¶å™¨èŠ‚ç‚¹&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>interrupts</code></li>
</ul>
<p>ä¸€ä¸ªä¸­æ–­æ ‡è¯†ç¬¦åˆ—è¡¨ï¼Œè¡¨ç¤ºæ¯ä¸€ä¸ªä¸­æ–­è¾“å‡ºä¿¡å·ï¼Œä¸€èˆ¬æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">interrupts = &lt;ä¸­æ–­åŸŸ ä¸­æ–­å· è§¦å‘æ–¹å¼&gt;   <span class="comment">/* çˆ¶èŠ‚ç‚¹çš„ #interrupt-cells å±æ€§çš„å€¼æ˜¯3  */</span></span><br><span class="line">interrupts = &lt;ä¸­æ–­å· è§¦å‘æ–¹å¼&gt;         <span class="comment">/* çˆ¶èŠ‚ç‚¹çš„ #interrupt-cells å±æ€§æ˜¯ 2 */</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„ä¸­æ–­å·æŒ‡çš„æ˜¯ç»„å†…ä¸­æ–­å·ï¼Œè§¦å‘æ–¹å¼å¯¹åº”æ•°å­—å®šä¹‰åœ¨<code>linux</code>å†…æ ¸æºç çš„è¿™ä¸ªæ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include/dt-bindings/interrupt-controller/irq.h</span><br></pre></td></tr></table></figure>

<p>å®å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> IRQ_TYPE_NONE           0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRQ_TYPE_EDGE_RISING    1  <span class="comment">/* low-to-highï¼Œä¸Šå‡æ²¿è§¦å‘ */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRQ_TYPE_EDGE_FALLING   2  <span class="comment">/* high-to-lowï¼Œä¸‹é™æ²¿è§¦å‘ */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRQ_TYPE_EDGE_BOTH      (IRQ_TYPE_EDGE_FALLING | IRQ_TYPE_EDGE_RISING) <span class="comment">/* 3, ä¸Šå‡æ²¿ä¸‹é™æ²¿å‡è§¦å‘ */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRQ_TYPE_LEVEL_HIGH     4  <span class="comment">/* high levelï¼Œé«˜ç”µå¹³è§¦å‘ */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRQ_TYPE_LEVEL_LOW      8  <span class="comment">/* low levelï¼Œä½ç”µå¹³è§¦å‘ */</span></span></span><br></pre></td></tr></table></figure>

<h3 id="4-3-ä½¿ç”¨å®ä¾‹"><a href="#4-3-ä½¿ç”¨å®ä¾‹" class="headerlink" title="4.3 ä½¿ç”¨å®ä¾‹"></a><font size=3>4.3 ä½¿ç”¨å®ä¾‹</font></h3><p>æˆ‘ä»¬å¯ä»¥æ‰“å¼€<code>linux</code>å†…æ ¸æºç ä¸­çš„è¿™ä¸ªæ–‡ä»¶ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arch/arm/boot/dts/exynos4.dtsi</span><br></pre></td></tr></table></figure>

<p>è¯¥æ–‡ä»¶ä¸­å¯¹<code>exynos4412</code>çš„ä¸­æ–­æ§åˆ¶å™¨(<code>GIC</code>)èŠ‚ç‚¹æè¿°å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gic: interrupt-controller@<span class="number">10490000</span> &#123;</span><br><span class="line">	compatible = <span class="string">&quot;arm,cortex-a9-gic&quot;</span>;</span><br><span class="line">	<span class="meta">#interrupt-cells = <span class="string">&lt;3&gt;</span>; <span class="comment">/* è¿™é‡Œæ„å‘³ç€ï¼Œåè¾¹ä½¿ç”¨gicçš„å­èŠ‚ç‚¹çš„interruptå±æ€§éœ€è¦å†™ä¸­æ–­åŸŸ ä¸­æ–­å· è§¦å‘æ–¹å¼*/</span></span></span><br><span class="line">	interrupt-controller;</span><br><span class="line">	reg = &lt;<span class="number">0x10490000</span> <span class="number">0x1000</span>&gt;, &lt;<span class="number">0x10480000</span> <span class="number">0x100</span>&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥å†æ‰¾ä¸€ä¸ªå¼•ç”¨äº†ä¸­æ–­æ§åˆ¶å™¨èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ï¼Œæˆ‘ä»¬æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arch/arm/boot/dts/exynos4x12-pinctrl.dtsi</span><br></pre></td></tr></table></figure>

<p>è¯¥æ–‡ä»¶ä¸­æœ‰ä»€ä¹ˆä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œè¿™é‡Œè¾¹å°±åŒ…å«äº†ä¸€äº›ä¸­æ–­å·ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">gpx0: gpx0 &#123;</span><br><span class="line">    gpio-controller;</span><br><span class="line">    <span class="meta">#gpio-cells = <span class="string">&lt;2&gt;</span>;</span></span><br><span class="line"></span><br><span class="line">    interrupt-controller;</span><br><span class="line">    interrupt-parent = &lt;&amp;gic&gt;;</span><br><span class="line">    interrupts = &lt;<span class="number">0</span> <span class="number">16</span> <span class="number">0</span>&gt;, &lt;<span class="number">0</span> <span class="number">17</span> <span class="number">0</span>&gt;, &lt;<span class="number">0</span> <span class="number">18</span> <span class="number">0</span>&gt;, &lt;<span class="number">0</span> <span class="number">19</span> <span class="number">0</span>&gt;,</span><br><span class="line">    &lt;<span class="number">0</span> <span class="number">20</span> <span class="number">0</span>&gt;, &lt;<span class="number">0</span> <span class="number">21</span> <span class="number">0</span>&gt;, &lt;<span class="number">0</span> <span class="number">22</span> <span class="number">0</span>&gt;, &lt;<span class="number">0</span> <span class="number">23</span> <span class="number">0</span>&gt;;</span><br><span class="line">    <span class="meta">#interrupt-cells = <span class="string">&lt;2&gt;</span>; <span class="comment">/* è¿™é‡Œæ„å‘³ç€ï¼Œåè¾¹ä½¿ç”¨GPXå¼•è„šä½œä¸ºä¸­æ–­çš„è¯ï¼Œå­èŠ‚ç‚¹çš„interruptå±æ€§åªéœ€è¦å†™ä¸­æ–­å·å’Œè§¦å‘æ–¹å¼å³å¯*/</span></span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="5-gpioç›¸å…³å±æ€§"><a href="#5-gpioç›¸å…³å±æ€§" class="headerlink" title="5.Â gpioç›¸å…³å±æ€§"></a><font size=3>5.Â <code>gpio</code>ç›¸å…³å±æ€§</font></h2><h3 id="5-1-GPIOæ§åˆ¶å™¨"><a href="#5-1-GPIOæ§åˆ¶å™¨" class="headerlink" title="5.1Â GPIOæ§åˆ¶å™¨"></a><font size=3>5.1Â <code>GPIO</code>æ§åˆ¶å™¨</font></h3><ul>
<li><code>gpio-controller</code></li>
</ul>
<p>æ— å€¼ç©ºå±æ€§ï¼Œç”¨æ¥è¯´æ˜è¯¥èŠ‚ç‚¹æè¿°çš„æ˜¯ä¸€ä¸ª<code>gpio</code>æ§åˆ¶å™¨ã€‚</p>
<ul>
<li><code>#gpio-cells</code></li>
</ul>
<p>ç”¨æ¥è¡¨ç¤ºè¦ç”¨å‡ ä¸ª<code>cell</code>æè¿°ä¸€ä¸ª<code>GPIO</code>å¼•è„šã€‚</p>
<h3 id="5-2-GPIOä½¿ç”¨è€…èŠ‚ç‚¹"><a href="#5-2-GPIOä½¿ç”¨è€…èŠ‚ç‚¹" class="headerlink" title="5.2Â GPIOä½¿ç”¨è€…èŠ‚ç‚¹"></a><font size=3>5.2Â <code>GPIO</code>ä½¿ç”¨è€…èŠ‚ç‚¹</font></h3><p>ä¸€èˆ¬è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xxx-gpio = &lt;&amp;å¼•ç”¨GPIOæ§åˆ¶å™¨ GPIOæ ‡å· å·¥ä½œæ¨¡å¼&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>å·¥ä½œæ¨¡å¼ï¼š</li>
</ul>
<p><code>1</code>ï¼Œä½ç”µå¹³æœ‰æ•ˆ<code>GPIO_ACTIVE_HIGH</code>ã€‚</p>
<p><code>0</code>ï¼Œé«˜ç”µå¹³æœ‰æ•ˆ<code>GPIO_ACTIVE_LOWã€‚</code></p>
<h1 id="äº”ã€å¸¸ç”¨æ¥å£"><a href="#äº”ã€å¸¸ç”¨æ¥å£" class="headerlink" title="äº”ã€å¸¸ç”¨æ¥å£"></a><font size=3>äº”ã€å¸¸ç”¨æ¥å£</font></h1><p>è®¾å¤‡æ ‘æè¿°äº†è®¾å¤‡çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯åŒ…æ‹¬æ•°å­—ç±»å‹çš„ã€å­—ç¬¦ä¸²ç±»å‹çš„ã€æ•°ç»„ç±»å‹çš„ï¼Œæˆ‘ä»¬åœ¨ç¼–å†™é©±åŠ¨çš„æ—¶å€™éœ€è¦è·å–åˆ°è¿™äº›ä¿¡æ¯ã€‚</p>
<p>æ¯”å¦‚è®¾å¤‡æ ‘ä½¿ç”¨<code>reg</code>å±æ€§æè¿°äº†æŸä¸ªå¤–è®¾çš„å¯„å­˜å™¨åœ°å€ä¸º<code>0X02005482</code>ï¼Œé•¿åº¦ä¸º <code>0X400</code>ï¼Œæˆ‘ä»¬åœ¨ç¼–å†™é©±åŠ¨çš„æ—¶å€™éœ€è¦è·å–åˆ° <code>reg</code> å±æ€§çš„<code>0X02005482</code>å’Œ<code>0X400</code>è¿™ä¸¤ä¸ªå€¼ï¼Œç„¶ååˆå§‹åŒ–å¤–è®¾ã€‚ </p>
<p><code>Linux</code> å†…æ ¸ç»™æˆ‘ä»¬æä¾›äº†ä¸€ç³»åˆ—çš„å‡½æ•°æ¥è·å–è®¾å¤‡æ ‘ä¸­çš„èŠ‚ç‚¹æˆ–è€…å±æ€§ä¿¡æ¯ï¼Œè¿™ä¸€ç³»åˆ—çš„å‡½æ•°éƒ½æœ‰ä¸€ä¸ªç»Ÿä¸€çš„å‰ç¼€<code>of_</code>ï¼Œæ‰€ä»¥åœ¨å¾ˆå¤šèµ„æ–™é‡Œé¢ä¹Ÿè¢«å«åš<code>OF</code>å‡½æ•°ã€‚è¿™äº›<code>OF</code>å‡½æ•°åŸå‹éƒ½å®šä¹‰åœ¨<code>linux</code>å†…æ ¸æºç çš„è¯¥æ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include/linux/of.h</span><br></pre></td></tr></table></figure>

<h2 id="1-ä¸‰ä¸ªç»“æ„ä½“"><a href="#1-ä¸‰ä¸ªç»“æ„ä½“" class="headerlink" title="1. ä¸‰ä¸ªç»“æ„ä½“"></a><font size=3>1. ä¸‰ä¸ªç»“æ„ä½“</font></h2><h3 id="1-1-struct-device-node"><a href="#1-1-struct-device-node" class="headerlink" title="1.1Â struct device_node"></a><font size=3>1.1Â <code>struct device_node</code></font></h3><p>è¿™ä¸ªç»“æ„ä½“å®šä¹‰åœ¨<code>include/linux/of.h  </code>æ–‡ä»¶ä¸­ï¼Œç»“æ„ä½“æˆå‘˜å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">device_node</span> &#123;</span></span><br><span class="line">        <span class="type">const</span> <span class="type">char</span> *name;       <span class="comment">/* èŠ‚ç‚¹åå­— */</span></span><br><span class="line">        <span class="type">const</span> <span class="type">char</span> *type;       <span class="comment">/* è®¾å¤‡ç±»å‹ */</span></span><br><span class="line">        phandle phandle;</span><br><span class="line">        <span class="type">const</span> <span class="type">char</span> *full_name;  <span class="comment">/* èŠ‚ç‚¹å…¨å */</span></span><br><span class="line"></span><br><span class="line">        <span class="class"><span class="keyword">struct</span>  <span class="title">property</span> *<span class="title">properties</span>;</span>   <span class="comment">/* å±æ€§ */</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span>  <span class="title">property</span> *<span class="title">deadprops</span>;</span>    <span class="comment">/* removed properties, removed å±æ€§ */</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span>  <span class="title">device_node</span> *<span class="title">parent</span>;</span>    <span class="comment">/* çˆ¶èŠ‚ç‚¹ */</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span>  <span class="title">device_node</span> *<span class="title">child</span>;</span>     <span class="comment">/* å­èŠ‚ç‚¹ */</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span>  <span class="title">device_node</span> *<span class="title">sibling</span>;</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span>  <span class="title">device_node</span> *<span class="title">next</span>;</span>      <span class="comment">/* next device of same type */</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span>  <span class="title">device_node</span> *<span class="title">allnext</span>;</span>   <span class="comment">/* next in list of all nodes */</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span>  <span class="title">proc_dir_entry</span> *<span class="title">pde</span>;</span>    <span class="comment">/* this node&#x27;s proc directory */</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span>  <span class="title">kref</span> <span class="title">kref</span>;</span></span><br><span class="line">        <span class="type">unsigned</span> <span class="type">long</span> _flags;</span><br><span class="line">        <span class="type">void</span>    *data;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(CONFIG_SPARC)</span></span><br><span class="line">        <span class="type">const</span> <span class="type">char</span> *path_component_name;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">int</span> unique_id;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">of_irq_controller</span> *<span class="title">irq_trans</span>;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="1-2-struct-property"><a href="#1-2-struct-property" class="headerlink" title="1.2Â struct property "></a><font size=3>1.2Â <code>struct property </code></font></h3><p>èŠ‚ç‚¹çš„å±æ€§ä¿¡æ¯é‡Œé¢ä¿å­˜äº†é©±åŠ¨æ‰€éœ€è¦çš„å†…å®¹ï¼Œ <code>Linux</code> å†…æ ¸ä¸­ä½¿ç”¨ç»“æ„ä½“ <code>property</code> è¡¨ç¤ºå±æ€§ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">property</span>&#123;</span></span><br><span class="line">	<span class="type">char</span>    *name;         <span class="comment">/* å±æ€§åå­— */</span></span><br><span class="line">	<span class="type">int</span>     length;        <span class="comment">/* å±æ€§é•¿åº¦ */</span> </span><br><span class="line">	<span class="type">void</span>    *value;        <span class="comment">/* å±æ€§å€¼ */</span>   </span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">property</span> *<span class="title">next</span>;</span> <span class="comment">/* ä¸‹ä¸€ä¸ªå±æ€§ */</span></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> _flags;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> unique_id;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="1-3-struct-resource"><a href="#1-3-struct-resource" class="headerlink" title="1.3Â struct resource  "></a><font size=3>1.3Â <code>struct resource  </code></font></h3><p><code>IIC</code>ã€ <code>SPI</code>ã€ <code>GPIO</code> ç­‰è¿™äº›å¤–è®¾éƒ½æœ‰å¯¹åº”çš„å¯„å­˜å™¨ï¼Œè¿™äº›å¯„å­˜å™¨å…¶å®å°±æ˜¯ä¸€ç»„å†…å­˜ç©ºé—´ï¼Œ <code>Linux</code>å†…æ ¸ä½¿ç”¨ <code>resource</code> ç»“æ„ä½“æ¥æè¿°ä¸€æ®µå†…å­˜ç©ºé—´ï¼Œ<code>resource</code>ç¿»è¯‘å‡ºæ¥å°±æ˜¯èµ„æºï¼Œå› æ­¤ç”¨<code>resource</code>ç»“æ„ä½“æè¿°çš„éƒ½æ˜¯è®¾å¤‡èµ„æºä¿¡æ¯ï¼Œ<code>resource</code>ç»“æ„ä½“å®šä¹‰åœ¨<code>linux</code>å†…æ ¸æºç çš„æ–‡ä»¶<code>include/linux/ioport.h</code> ä¸­ï¼Œå®šä¹‰å¦‚ä¸‹ ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Resources are tree-like, allowing</span></span><br><span class="line"><span class="comment"> * nesting etc..</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">resource</span> &#123;</span></span><br><span class="line">        <span class="type">resource_size_t</span> start;</span><br><span class="line">        <span class="type">resource_size_t</span> end;</span><br><span class="line">        <span class="type">const</span> <span class="type">char</span> *name;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">long</span> flags;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">resource</span> *<span class="title">parent</span>, *<span class="title">sibling</span>, *<span class="title">child</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>ã€æˆå‘˜è¯´æ˜ã€‘</strong></p>
<p>å¯¹äº <code>32</code> ä½çš„ <code>SOC </code>æ¥è¯´ï¼Œ <code>resource_size_t</code> æ˜¯ <code>u32</code> ç±»å‹çš„ã€‚</p>
<ul>
<li><code>start</code> ï¼šè¡¨ç¤ºå¼€å§‹åœ°å€ã€‚</li>
<li><code>end</code> ï¼šè¡¨ç¤ºç»“æŸåœ°å€ã€‚</li>
<li><code>name</code> ï¼šæ˜¯è¿™ä¸ªèµ„æºçš„åå­—ã€‚</li>
<li><code>flags</code>ï¼š æ˜¯èµ„æºæ ‡å¿—ä½ï¼Œä¸€èˆ¬è¡¨ç¤ºèµ„æºç±»å‹ï¼Œå¯é€‰çš„èµ„æºæ ‡å¿—å®šä¹‰åœ¨æ–‡ä»¶<code>include/linux/ioport.h</code>ä¸­ã€‚ä¸€èˆ¬æ¥è¯´å¸¸è§çš„èµ„æºæ ‡å¿—å°±æ˜¯<code>IORESOURCE_MEM</code>ã€ <code>IORESOURCE_REG</code>å’Œ<code>IORESOURCE_IRQ</code>ç­‰ã€‚</li>
</ul>
<h2 id="2-æŸ¥æ‰¾èŠ‚ç‚¹çš„å‡½æ•°"><a href="#2-æŸ¥æ‰¾èŠ‚ç‚¹çš„å‡½æ•°" class="headerlink" title="2. æŸ¥æ‰¾èŠ‚ç‚¹çš„å‡½æ•°"></a><font size=3>2. æŸ¥æ‰¾èŠ‚ç‚¹çš„å‡½æ•°</font></h2><h3 id="2-1-of-find-node-by-name"><a href="#2-1-of-find-node-by-name" class="headerlink" title="2.1Â of_find_node_by_name() "></a><font size=3>2.1Â <code>of_find_node_by_name() </code></font></h3><p>æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢ä¸€ä¸‹å‡½æ•°æ‰€åœ¨å¤´æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep of_find_node_by_name -r -n ~/5linux/linux-3.14/include</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* éœ€åŒ…å«çš„å¤´æ–‡ä»¶ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å‡½æ•°å£°æ˜ */</span></span><br><span class="line"><span class="keyword">struct</span> device_node *<span class="title function_">of_find_node_by_name</span><span class="params">(<span class="keyword">struct</span> device_node *from, <span class="type">const</span> <span class="type">char</span> *name)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ã€å‡½æ•°è¯´æ˜ã€‘</strong>è¯¥å‡½æ•°é€šè¿‡èŠ‚ç‚¹åå­—æŸ¥æ‰¾æŒ‡å®šçš„èŠ‚ç‚¹ã€‚</p>
<p><strong>ã€å‡½æ•°å‚æ•°ã€‘</strong></p>
<ul>
<li><code>from</code>ï¼š<code>struct device_node *</code>ç±»å‹ï¼Œå¼€å§‹æŸ¥æ‰¾çš„èŠ‚ç‚¹ï¼Œå¦‚æœä¸º<code>NULL</code>è¡¨ç¤ºä»æ ¹èŠ‚ç‚¹å¼€å§‹æŸ¥æ‰¾æ•´ä¸ªè®¾å¤‡æ ‘ã€‚</li>
<li><code>name</code>ï¼š<code>char *</code>ç±»å‹ï¼Œè¦æŸ¥æ‰¾çš„èŠ‚ç‚¹åå­—ã€‚</li>
</ul>
<p><strong>ã€è¿”å›å€¼ã€‘</strong><code>struct device_node *</code>ç±»å‹ï¼ŒæˆåŠŸè¿”å›æ‰¾åˆ°çš„èŠ‚ç‚¹ï¼Œå¦‚æœä¸º<code>NULL</code>è¡¨ç¤ºæŸ¥æ‰¾å¤±è´¥  ã€‚</p>
<p><strong>ã€ä½¿ç”¨æ ¼å¼ã€‘</strong><code>none</code></p>
<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong><code>none</code></p>
<h3 id="2-2-of-find-node-by-type"><a href="#2-2-of-find-node-by-type" class="headerlink" title="2.2Â of_find_node_by_type () "></a><font size=3>2.2Â <code>of_find_node_by_type () </code></font></h3><p>æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢ä¸€ä¸‹å‡½æ•°æ‰€åœ¨å¤´æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep of_find_node_by_type -r -n ~/5linux/linux-3.14/include</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* éœ€åŒ…å«çš„å¤´æ–‡ä»¶ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å‡½æ•°å£°æ˜ */</span></span><br><span class="line"><span class="keyword">struct</span> device_node *<span class="title function_">of_find_node_by_type</span><span class="params">(<span class="keyword">struct</span> device_node *from, <span class="type">const</span> <span class="type">char</span> *type)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ã€å‡½æ•°è¯´æ˜ã€‘</strong>è¯¥å‡½æ•°é€šè¿‡<code>device_type</code>å±æ€§æŸ¥æ‰¾æŒ‡å®šçš„èŠ‚ç‚¹ ã€‚</p>
<p><strong>ã€å‡½æ•°å‚æ•°ã€‘</strong></p>
<ul>
<li><code>from</code>ï¼š<code>struct device_node *</code>ç±»å‹ï¼Œå¼€å§‹æŸ¥æ‰¾çš„èŠ‚ç‚¹ï¼Œå¦‚æœä¸º<code>NULL</code>è¡¨ç¤ºä»æ ¹èŠ‚ç‚¹å¼€å§‹æŸ¥æ‰¾æ•´ä¸ªè®¾å¤‡æ ‘ã€‚</li>
<li><code>name</code>ï¼š<code>char *</code>ç±»å‹ï¼Œè¦æŸ¥æ‰¾çš„èŠ‚ç‚¹å¯¹åº”çš„<code>type</code>å­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯<code>device_type</code>å±æ€§å€¼ã€‚</li>
</ul>
<p><strong>ã€è¿”å›å€¼ã€‘</strong><code>struct device_node *</code>ç±»å‹ï¼ŒæˆåŠŸè¿”å›æ‰¾åˆ°çš„èŠ‚ç‚¹ï¼Œå¦‚æœä¸º<code>NULL</code>è¡¨ç¤ºæŸ¥æ‰¾å¤±è´¥  ã€‚</p>
<p><strong>ã€ä½¿ç”¨æ ¼å¼ã€‘</strong><code>none</code></p>
<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong><code>none</code></p>
<h3 id="2-3-of-find-compatible-node"><a href="#2-3-of-find-compatible-node" class="headerlink" title="2.3Â of_find_compatible_node () "></a><font size=3>2.3Â <code>of_find_compatible_node () </code></font></h3><p>æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢ä¸€ä¸‹å‡½æ•°æ‰€åœ¨å¤´æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep of_find_compatible_node -r -n ~/5linux/linux-3.14/include</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* éœ€åŒ…å«çš„å¤´æ–‡ä»¶ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å‡½æ•°å£°æ˜ */</span></span><br><span class="line"><span class="keyword">struct</span> device_node *<span class="title function_">of_find_compatible_node</span><span class="params">(<span class="keyword">struct</span> device_node *from,</span></span><br><span class="line"><span class="params">											<span class="type">const</span> <span class="type">char</span> *type,</span></span><br><span class="line"><span class="params">											<span class="type">const</span> <span class="type">char</span> *compatible)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ã€å‡½æ•°è¯´æ˜ã€‘</strong>è¯¥å‡½æ•°æ ¹æ®<code>device_type</code>å’Œ<code>compatible</code>è¿™ä¸¤ä¸ªå±æ€§æŸ¥æ‰¾æŒ‡å®šçš„èŠ‚ç‚¹ã€‚</p>
<p><strong>ã€å‡½æ•°å‚æ•°ã€‘</strong></p>
<ul>
<li><code>from</code>ï¼š<code>struct device_node *</code>ç±»å‹ï¼Œå¼€å§‹æŸ¥æ‰¾çš„èŠ‚ç‚¹ï¼Œå¦‚æœä¸º<code>NULL</code>è¡¨ç¤ºä»æ ¹èŠ‚ç‚¹å¼€å§‹æŸ¥æ‰¾æ•´ä¸ªè®¾å¤‡æ ‘ ã€‚</li>
<li><code>name</code>ï¼š<code>char *</code>ç±»å‹ï¼Œè¦æŸ¥æ‰¾çš„èŠ‚ç‚¹å¯¹åº”çš„<code>type</code>å­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯<code>device_type</code>å±æ€§å€¼ï¼Œå¯ä»¥ä¸º <code>NULL</code>ï¼Œè¡¨ç¤ºå¿½ç•¥æ‰ <code>device_type</code> å±æ€§  ã€‚</li>
<li><code>compatible</code>ï¼š<code>char *</code>ç±»å‹ï¼Œè¦æŸ¥æ‰¾çš„èŠ‚ç‚¹æ‰€å¯¹åº”çš„<code>compatible</code>å±æ€§åˆ—è¡¨ã€‚</li>
</ul>
<p><strong>ã€è¿”å›å€¼ã€‘</strong><code>struct device_node *</code>ç±»å‹ï¼ŒæˆåŠŸè¿”å›æ‰¾åˆ°çš„èŠ‚ç‚¹ï¼Œå¦‚æœä¸º<code>NULL</code>è¡¨ç¤ºæŸ¥æ‰¾å¤±è´¥  ã€‚</p>
<p><strong>ã€ä½¿ç”¨æ ¼å¼ã€‘</strong><code>none</code></p>
<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong><code>none</code></p>
<h3 id="2-4-of-find-matching-node-and-match"><a href="#2-4-of-find-matching-node-and-match" class="headerlink" title="2.4Â of_find_matching_node_and_match() "></a><font size=3>2.4Â <code>of_find_matching_node_and_match() </code></font></h3><p>æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢ä¸€ä¸‹å‡½æ•°æ‰€åœ¨å¤´æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep of_find_matching_node_and_match -r -n ~/5linux/linux-3.14/include</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* éœ€åŒ…å«çš„å¤´æ–‡ä»¶ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å‡½æ•°å£°æ˜ */</span></span><br><span class="line"><span class="keyword">struct</span> device_node *<span class="title function_">of_find_matching_node_and_match</span><span class="params">(<span class="keyword">struct</span> device_node *from,</span></span><br><span class="line"><span class="params">													<span class="type">const</span> <span class="keyword">struct</span> of_device_id *matches,</span></span><br><span class="line"><span class="params">													<span class="type">const</span> <span class="keyword">struct</span> of_device_id **match)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ã€å‡½æ•°è¯´æ˜ã€‘</strong>è¯¥å‡½æ•°é€šè¿‡<code>of_device_id</code>åŒ¹é…è¡¨æ¥æŸ¥æ‰¾æŒ‡å®šçš„èŠ‚ç‚¹ã€‚</p>
<p><strong>ã€å‡½æ•°å‚æ•°ã€‘</strong></p>
<ul>
<li><code>from</code>ï¼š<code>struct device_node *</code>ç±»å‹ï¼Œå¼€å§‹æŸ¥æ‰¾çš„èŠ‚ç‚¹ï¼Œå¦‚æœä¸º<code>NULL</code>è¡¨ç¤ºä»æ ¹èŠ‚ç‚¹å¼€å§‹æŸ¥æ‰¾æ•´ä¸ªè®¾å¤‡æ ‘ã€‚</li>
<li><code>matches</code>ï¼š<code>struct of_device_id *</code>ç±»å‹ï¼Œof_device_id åŒ¹é…è¡¨ï¼Œä¹Ÿå°±æ˜¯åœ¨æ­¤åŒ¹é…è¡¨é‡Œé¢æŸ¥æ‰¾èŠ‚ç‚¹ã€‚  </li>
<li><code>match</code>ï¼š<code>struct of_device_id *</code>ç±»å‹ï¼Œæ‰¾åˆ°çš„åŒ¹é…çš„<code>of_device_id</code>ã€‚</li>
</ul>
<p><strong>ã€è¿”å›å€¼ã€‘</strong><code>struct device_node *</code>ç±»å‹ï¼ŒæˆåŠŸè¿”å›æ‰¾åˆ°çš„èŠ‚ç‚¹ï¼Œå¦‚æœä¸º<code>NULL</code>è¡¨ç¤ºæŸ¥æ‰¾å¤±è´¥  ã€‚</p>
<p><strong>ã€ä½¿ç”¨æ ¼å¼ã€‘</strong><code>none</code></p>
<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong><code>none</code></p>
<h3 id="2-5-of-find-node-by-path"><a href="#2-5-of-find-node-by-path" class="headerlink" title="2.5Â of_find_node_by_path() "></a><font size=3>2.5Â <code>of_find_node_by_path() </code></font></h3><p>æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢ä¸€ä¸‹å‡½æ•°æ‰€åœ¨å¤´æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep of_find_node_by_path -r -n ~/5linux/linux-3.14/include</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* éœ€åŒ…å«çš„å¤´æ–‡ä»¶ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å‡½æ•°å£°æ˜ */</span></span><br><span class="line"><span class="keyword">inline</span> <span class="keyword">struct</span> device_node *<span class="title function_">of_find_node_by_path</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *path)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ã€å‡½æ•°è¯´æ˜ã€‘</strong>è¯¥å‡½æ•°é€šè¿‡è·¯å¾„æ¥æŸ¥æ‰¾æŒ‡å®šçš„èŠ‚ç‚¹ã€‚</p>
<p><strong>ã€å‡½æ•°å‚æ•°ã€‘</strong></p>
<ul>
<li><code>path</code>ï¼š<code>char *</code>ç±»å‹ï¼Œå¸¦æœ‰å…¨è·¯å¾„çš„èŠ‚ç‚¹åï¼Œå¯ä»¥ä½¿ç”¨èŠ‚ç‚¹çš„åˆ«åï¼Œæ¯”å¦‚<code>/backlight</code>å°±æ˜¯<code>backlight</code>è¿™ä¸ªèŠ‚ç‚¹çš„å…¨è·¯å¾„ã€‚</li>
</ul>
<p><strong>ã€è¿”å›å€¼ã€‘</strong><code>struct device_node *</code>ç±»å‹ï¼ŒæˆåŠŸè¿”å›æ‰¾åˆ°çš„èŠ‚ç‚¹ï¼Œå¦‚æœä¸º<code>NULL</code>è¡¨ç¤ºæŸ¥æ‰¾å¤±è´¥  ã€‚</p>
<p><strong>ã€ä½¿ç”¨æ ¼å¼ã€‘</strong><code>none</code></p>
<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong><code>none</code></p>
<h2 id="3-æŸ¥æ‰¾çˆ¶å­èŠ‚ç‚¹çš„å‡½æ•°"><a href="#3-æŸ¥æ‰¾çˆ¶å­èŠ‚ç‚¹çš„å‡½æ•°" class="headerlink" title="3. æŸ¥æ‰¾çˆ¶å­èŠ‚ç‚¹çš„å‡½æ•°"></a><font size=3>3. æŸ¥æ‰¾çˆ¶å­èŠ‚ç‚¹çš„å‡½æ•°</font></h2><h3 id="3-1-of-get-parent"><a href="#3-1-of-get-parent" class="headerlink" title="3.1Â of_get_parent() "></a><font size=3>3.1Â <code>of_get_parent() </code></font></h3><p>æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢ä¸€ä¸‹å‡½æ•°æ‰€åœ¨å¤´æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep of_get_parent -r -n ~/5linux/linux-3.14/include</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* éœ€åŒ…å«çš„å¤´æ–‡ä»¶ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å‡½æ•°å£°æ˜ */</span></span><br><span class="line"><span class="keyword">struct</span> device_node *<span class="title function_">of_get_parent</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *node)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ã€å‡½æ•°è¯´æ˜ã€‘</strong>è¯¥å‡½æ•°è·å–æŒ‡å®šèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹(å¦‚æœæœ‰çˆ¶èŠ‚ç‚¹çš„è¯)  ã€‚</p>
<p><strong>ã€å‡½æ•°å‚æ•°ã€‘</strong></p>
<ul>
<li><code>node</code>ï¼š<code>struct device_node *</code>ç±»å‹ï¼Œè¦æŸ¥æ‰¾çš„çˆ¶èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚</li>
</ul>
<p><strong>ã€è¿”å›å€¼ã€‘</strong><code>struct device_node *</code>ç±»å‹ï¼ŒæˆåŠŸè¿”å›æ‰¾åˆ°çš„çˆ¶èŠ‚ç‚¹ï¼Œå¦‚æœä¸º<code>NULL</code>è¡¨ç¤ºæŸ¥æ‰¾å¤±è´¥  ã€‚</p>
<p><strong>ã€ä½¿ç”¨æ ¼å¼ã€‘</strong><code>none</code></p>
<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong><code>none</code></p>
<h3 id="3-2-of-get-next-child"><a href="#3-2-of-get-next-child" class="headerlink" title="3.2Â of_get_next_child() "></a><font size=3>3.2Â <code>of_get_next_child() </code></font></h3><p>æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢ä¸€ä¸‹å‡½æ•°æ‰€åœ¨å¤´æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep of_get_next_child -r -n ~/5linux/linux-3.14/include</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* éœ€åŒ…å«çš„å¤´æ–‡ä»¶ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å‡½æ•°å£°æ˜ */</span></span><br><span class="line"><span class="keyword">struct</span> device_node *<span class="title function_">of_get_next_child</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *node,</span></span><br><span class="line"><span class="params">                                      <span class="keyword">struct</span> device_node *prev)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ã€å‡½æ•°è¯´æ˜ã€‘</strong>è¯¥å‡½æ•°ç”¨è¿­ä»£çš„æ–¹å¼æŸ¥æ‰¾å­èŠ‚ç‚¹ã€‚</p>
<p><strong>ã€å‡½æ•°å‚æ•°ã€‘</strong></p>
<ul>
<li><code>node</code>ï¼š<code>struct device_node *</code>ç±»å‹ï¼Œçˆ¶èŠ‚ç‚¹ã€‚</li>
<li><code>prev</code>ï¼š<code>struct device_node *</code>ç±»å‹ï¼Œå‰ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ä»å“ªä¸€ä¸ªå­èŠ‚ç‚¹å¼€å§‹è¿­ä»£åœ°æŸ¥æ‰¾ä¸‹ä¸€ä¸ªå­èŠ‚ç‚¹ã€‚å¯ä»¥è®¾ç½®ä¸º<br><code>NULL</code>ï¼Œè¡¨ç¤ºä»ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹å¼€å§‹ã€‚</li>
</ul>
<p><strong>ã€è¿”å›å€¼ã€‘</strong><code>struct device_node *</code>ç±»å‹ï¼ŒæˆåŠŸè¿”å›æ‰¾åˆ°çš„ä¸‹ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œå¦‚æœä¸º<code>NULL</code>è¡¨ç¤ºæŸ¥æ‰¾å¤±è´¥  ã€‚</p>
<p><strong>ã€ä½¿ç”¨æ ¼å¼ã€‘</strong><code>none</code></p>
<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong><code>none</code></p>
<h2 id="4-æå–å±æ€§çš„å‡½æ•°"><a href="#4-æå–å±æ€§çš„å‡½æ•°" class="headerlink" title="4. æå–å±æ€§çš„å‡½æ•°"></a><font size=3>4. æå–å±æ€§çš„å‡½æ•°</font></h2><h3 id="4-1-of-find-property"><a href="#4-1-of-find-property" class="headerlink" title="4.1Â of_find_property()"></a><font size=3>4.1Â <code>of_find_property()</code></font></h3><p>æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢ä¸€ä¸‹å‡½æ•°æ‰€åœ¨å¤´æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep of_find_property -r -n ~/5linux/linux-3.14/include</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* éœ€åŒ…å«çš„å¤´æ–‡ä»¶ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å‡½æ•°å£°æ˜ */</span></span><br><span class="line"><span class="keyword">struct</span> property *<span class="title function_">of_find_property</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *np, <span class="type">const</span> <span class="type">char</span> *name, <span class="type">int</span> *lenp)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ã€å‡½æ•°è¯´æ˜ã€‘</strong>è¯¥å‡½æ•°æå–æŒ‡å®šå±æ€§çš„å€¼ ã€‚</p>
<p><strong>ã€å‡½æ•°å‚æ•°ã€‘</strong></p>
<ul>
<li><code>np</code>ï¼š<code>struct device_node *</code>ç±»å‹ï¼Œè®¾å¤‡èŠ‚ç‚¹æŒ‡é’ˆã€‚</li>
<li><code>name</code>ï¼š<code>char *</code>ç±»å‹ï¼Œå±æ€§åå­—ã€‚  </li>
<li><code>lenp</code>ï¼š<code>int *</code>ç±»å‹ï¼Œå±æ€§å€¼çš„å­—èŠ‚æ•°ã€‚</li>
</ul>
<p><strong>ã€è¿”å›å€¼ã€‘</strong><code>struct property *</code>ç±»å‹ï¼ŒæˆåŠŸè¿”å›å±æ€§å€¼çš„é¦–åœ°å€ï¼Œå¤±è´¥è¿”å›<code>NULL</code> ã€‚</p>
<p><strong>ã€ä½¿ç”¨æ ¼å¼ã€‘</strong><code>none</code></p>
<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong><code>none</code></p>
<h3 id="4-2-of-property-count-elems-of-size"><a href="#4-2-of-property-count-elems-of-size" class="headerlink" title="4.2Â of_property_count_elems_of_size() "></a><font size=3>4.2Â <code>of_property_count_elems_of_size() </code></font></h3><p>æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢ä¸€ä¸‹å‡½æ•°æ‰€åœ¨å¤´æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep of_property_count_elems_of_size -r -n ~/5linux/linux-3.14/include</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* éœ€åŒ…å«çš„å¤´æ–‡ä»¶ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å‡½æ•°å£°æ˜ */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">of_property_count_elems_of_size</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *np,</span></span><br><span class="line"><span class="params">                                    <span class="type">const</span> <span class="type">char</span> *propname,</span></span><br><span class="line"><span class="params">                                    <span class="type">int</span> elem_size)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ã€å‡½æ•°è¯´æ˜ã€‘</strong>è¯¥å‡½æ•°ç”¨äºè·å–å±æ€§ä¸­å…ƒç´ çš„æ•°é‡ï¼Œæ¯”å¦‚<code>reg</code>å±æ€§å€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆä½¿ç”¨æ­¤å‡½æ•°å¯ä»¥è·å–åˆ°è¿™ä¸ªæ•°ç»„çš„å¤§å°ã€‚</p>
<p><strong>ã€å‡½æ•°å‚æ•°ã€‘</strong></p>
<ul>
<li><code>node</code>ï¼š<code>struct device_node *</code>ç±»å‹ï¼Œè®¾å¤‡èŠ‚ç‚¹ã€‚  </li>
<li><code>propname</code>ï¼š<code>char *</code>ç±»å‹ï¼Œéœ€è¦ç»Ÿè®¡å…ƒç´ æ•°é‡çš„å±æ€§åå­—ã€‚  </li>
<li><code>elem_size</code>ï¼š<code>int</code>ç±»å‹ï¼Œå…ƒç´ é•¿åº¦ã€‚</li>
</ul>
<p><strong>ã€è¿”å›å€¼ã€‘</strong><code>int</code>ç±»å‹ï¼Œå¾—åˆ°çš„å±æ€§å…ƒç´ æ•°é‡ã€‚</p>
<p><strong>ã€ä½¿ç”¨æ ¼å¼ã€‘</strong><code>none</code></p>
<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong><code>none</code></p>
<h3 id="4-3-of-property-read-u32-index"><a href="#4-3-of-property-read-u32-index" class="headerlink" title="4.3Â of_property_read_u32_index() "></a><font size=3>4.3Â <code>of_property_read_u32_index() </code></font></h3><p>æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢ä¸€ä¸‹å‡½æ•°æ‰€åœ¨å¤´æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep of_property_read_u32_index -r -n ~/5linux/linux-3.14/include</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* éœ€åŒ…å«çš„å¤´æ–‡ä»¶ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å‡½æ•°å£°æ˜ */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">of_property_read_u32_index</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *np,</span></span><br><span class="line"><span class="params">                               <span class="type">const</span> <span class="type">char</span> *propname,</span></span><br><span class="line"><span class="params">                               u32 index,</span></span><br><span class="line"><span class="params">                               u32 *out_value)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ã€å‡½æ•°è¯´æ˜ã€‘</strong>è¯¥å‡½æ•°ç”¨äºä»å±æ€§ä¸­è·å–æŒ‡å®šæ ‡å·çš„<code>u32</code>ç±»å‹æ•°æ®å€¼(æ— ç¬¦å·<code>32</code>ä½)ï¼Œæ¯”å¦‚æŸä¸ªå±æ€§æœ‰å¤šä¸ª<code>u32</code>ç±»å‹çš„å€¼ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨æ­¤å‡½æ•°æ¥è·å–æŒ‡å®šæ ‡å·çš„æ•°æ®å€¼ã€‚</p>
<p><strong>ã€å‡½æ•°å‚æ•°ã€‘</strong></p>
<ul>
<li><code>node</code>ï¼š<code>struct device_node *</code>ç±»å‹ï¼Œè®¾å¤‡èŠ‚ç‚¹ã€‚  </li>
<li><code>propname</code>ï¼š<code>char *</code>ç±»å‹ï¼Œè¦è¯»å–çš„å±æ€§åå­—ã€‚</li>
<li><code>index</code>ï¼š<code>u32</code>ç±»å‹ï¼Œè¦è¯»å–çš„å€¼æ ‡å·ã€‚  </li>
<li><code>out_value</code>ï¼š<code>u32</code>ç±»å‹ï¼Œè¯»å–åˆ°çš„å€¼ã€‚</li>
</ul>
<p><strong>ã€è¿”å›å€¼ã€‘</strong><code>int</code>ç±»å‹ï¼Œå¾—åˆ°çš„å±æ€§å…ƒç´ æ•°é‡ã€‚</p>
<p><strong>ã€ä½¿ç”¨æ ¼å¼ã€‘</strong><code>none</code></p>
<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong><code>none</code></p>
<h3 id="4-4-è·å–å±æ€§æ•°ç»„æ•°æ®"><a href="#4-4-è·å–å±æ€§æ•°ç»„æ•°æ®" class="headerlink" title="4.4 è·å–å±æ€§æ•°ç»„æ•°æ®"></a><font size=3>4.4 è·å–å±æ€§æ•°ç»„æ•°æ®</font></h3><p>æœ‰å››ä¸ªå‡½æ•°åˆ†åˆ«ç”¨äºè·å–<code>u8</code>ã€ <code>u16</code>ã€ <code>u32</code> å’Œ <code>u64</code> ç±»å‹çš„æ•°ç»„æ•°æ®ï¼š  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* éœ€åŒ…å«çš„å¤´æ–‡ä»¶ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å‡½æ•°å£°æ˜ */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">of_property_read_u8_array</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *np,</span></span><br><span class="line"><span class="params">                              <span class="type">const</span> <span class="type">char</span> *propname,</span></span><br><span class="line"><span class="params">                              u8 *out_values,</span></span><br><span class="line"><span class="params">                              <span class="type">size_t</span> sz)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">of_property_read_u16_array</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *np,</span></span><br><span class="line"><span class="params">                               <span class="type">const</span> <span class="type">char</span> *propname,</span></span><br><span class="line"><span class="params">                               u16 *out_values,</span></span><br><span class="line"><span class="params">                               <span class="type">size_t</span> sz)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">of_property_read_u32_array</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *np,</span></span><br><span class="line"><span class="params">                               <span class="type">const</span> <span class="type">char</span> *propname,</span></span><br><span class="line"><span class="params">                               u32 *out_values,</span></span><br><span class="line"><span class="params">                               <span class="type">size_t</span> sz)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">of_property_read_u64_array</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *np,</span></span><br><span class="line"><span class="params">                               <span class="type">const</span> <span class="type">char</span> *propname,</span></span><br><span class="line"><span class="params">                               u64 *out_values,</span></span><br><span class="line"><span class="params">                               <span class="type">size_t</span> sz)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ã€å‡½æ•°è¯´æ˜ã€‘</strong>è¿™ <code>4</code> ä¸ªå‡½æ•°åˆ†åˆ«æ˜¯è¯»å–å±æ€§ä¸­<code>u8</code>ã€<code>u16</code>ã€<code>u32</code>å’Œ<code>u64</code>ç±»å‹çš„æ•°ç»„æ•°æ®ï¼Œæ¯”å¦‚å¤§å¤šæ•°çš„<code>reg</code>å±æ€§éƒ½æ˜¯æ•°ç»„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨è¿™ <code>4</code> ä¸ªå‡½æ•°ä¸€æ¬¡è¯»å–å‡º<code>reg</code>å±æ€§ä¸­çš„æ‰€æœ‰æ•°æ®ã€‚  </p>
<p><strong>ã€å‡½æ•°å‚æ•°ã€‘</strong></p>
<ul>
<li><code>np</code>ï¼š<code>struct device_node *</code>ç±»å‹ï¼Œè®¾å¤‡èŠ‚ç‚¹ã€‚  </li>
<li><code>propname</code>ï¼š<code>char *</code>ç±»å‹ï¼Œè¦è¯»å–çš„å±æ€§åå­—ã€‚</li>
<li><code>out_values</code>ï¼šè¡¨ç¤ºè¯»å–åˆ°çš„æ•°ç»„å€¼ ï¼Œåˆ†åˆ«ä¸º<code>u8</code>ã€<code>u16</code>ã€<code>u32</code> å’Œ <code>u64</code>ã€‚</li>
<li><code>sz</code>ï¼š<code>size_t</code>ç±»å‹ï¼Œè¦è¯»å–çš„æ•°ç»„å…ƒç´ æ•°é‡ã€‚</li>
</ul>
<p><strong>ã€è¿”å›å€¼ã€‘</strong><code>int</code>ç±»å‹ã€‚è¯»å–æˆåŠŸè¿”å›<code>0</code>ï¼Œè¯»å–å¤±è´¥è¿”å›ä¸€ä¸ªè´Ÿå€¼ã€‚ <code>-EINVAL</code>è¡¨ç¤ºå±æ€§ä¸å­˜åœ¨ï¼Œ <code>-ENODATA </code>è¡¨ç¤ºæ²¡æœ‰è¦è¯»å–çš„æ•°æ®ï¼Œ <code>-EOVERFLOW</code>è¡¨ç¤ºå±æ€§å€¼åˆ—è¡¨å¤ªå°ã€‚  </p>
<p><strong>ã€ä½¿ç”¨æ ¼å¼ã€‘</strong><code>none</code></p>
<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong><code>none</code></p>
<h3 id="4-5-è·å–å±æ€§æ•°å€¼"><a href="#4-5-è·å–å±æ€§æ•°å€¼" class="headerlink" title="4.5 è·å–å±æ€§æ•°å€¼"></a><font size=3>4.5 è·å–å±æ€§æ•°å€¼</font></h3><p>æœ‰å››ä¸ªå‡½æ•°åˆ†åˆ«ç”¨äºè·å–<code>u8</code>ã€ <code>u16</code>ã€ <code>u32</code> å’Œ <code>u64</code> ç±»å‹çš„æ•°å€¼æ•°æ®ï¼š  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* éœ€åŒ…å«çš„å¤´æ–‡ä»¶ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å‡½æ•°å£°æ˜ */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">of_property_read_u8</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *np,</span></span><br><span class="line"><span class="params">                        <span class="type">const</span> <span class="type">char</span> *propname,</span></span><br><span class="line"><span class="params">                        u8 *out_value)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">of_property_read_u16</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *np,</span></span><br><span class="line"><span class="params">                         <span class="type">const</span> <span class="type">char</span> *propname,</span></span><br><span class="line"><span class="params">                         u16 *out_value)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">of_property_read_u32</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *np,</span></span><br><span class="line"><span class="params">                         <span class="type">const</span> <span class="type">char</span> *propname,</span></span><br><span class="line"><span class="params">                         u32 *out_value)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">of_property_read_u64</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *np,</span></span><br><span class="line"><span class="params">                         <span class="type">const</span> <span class="type">char</span> *propname,</span></span><br><span class="line"><span class="params">                         u64 *out_value)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ã€å‡½æ•°è¯´æ˜ã€‘</strong>è¿™ <code>4</code> ä¸ªå‡½æ•°åˆ†åˆ«æ˜¯è¯»å–å±æ€§ä¸­<code>u8</code>ã€<code>u16</code>ã€<code>u32</code>å’Œ<code>u64</code>ç±»å‹çš„æ•°å€¼æ•°æ®ã€‚  </p>
<p><strong>ã€å‡½æ•°å‚æ•°ã€‘</strong></p>
<ul>
<li><code>np</code>ï¼š<code>struct device_node *</code>ç±»å‹ï¼Œè®¾å¤‡èŠ‚ç‚¹ã€‚  </li>
<li><code>propname</code>ï¼š<code>char *</code>ç±»å‹ï¼Œè¦è¯»å–çš„å±æ€§åå­—ã€‚</li>
<li><code>out_values</code>ï¼šè¡¨ç¤ºè¯»å–åˆ°çš„æ•°å€¼ ï¼Œåˆ†åˆ«ä¸º<code>u8</code>ã€<code>u16</code>ã€<code>u32</code> å’Œ <code>u64</code>ã€‚</li>
</ul>
<p><strong>ã€è¿”å›å€¼ã€‘</strong><code>int</code>ç±»å‹ã€‚è¯»å–æˆåŠŸè¿”å›<code>0</code>ï¼Œè¯»å–å¤±è´¥è¿”å›ä¸€ä¸ªè´Ÿå€¼ã€‚  </p>
<p><strong>ã€ä½¿ç”¨æ ¼å¼ã€‘</strong><code>none</code></p>
<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong><code>none</code></p>
<h3 id="4-6-è·å–å±æ€§å­—ç¬¦ä¸²å€¼"><a href="#4-6-è·å–å±æ€§å­—ç¬¦ä¸²å€¼" class="headerlink" title="4.6 è·å–å±æ€§å­—ç¬¦ä¸²å€¼"></a><font size=3>4.6 è·å–å±æ€§å­—ç¬¦ä¸²å€¼</font></h3><h4 id="4-6-1-of-property-read-string"><a href="#4-6-1-of-property-read-string" class="headerlink" title="4.6.1Â of_property_read_string()"></a><font size=3>4.6.1Â <code>of_property_read_string()</code></font></h4><p>æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢ä¸€ä¸‹å‡½æ•°æ‰€åœ¨å¤´æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep of_property_read_string -r -n ~/5linux/linux-3.14/include</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* éœ€åŒ…å«çš„å¤´æ–‡ä»¶ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å‡½æ•°å£°æ˜ */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">of_property_read_string</span><span class="params">(<span class="keyword">struct</span> device_node *np,</span></span><br><span class="line"><span class="params">                            <span class="type">const</span> <span class="type">char</span> *propname,</span></span><br><span class="line"><span class="params">                            <span class="type">const</span> <span class="type">char</span> **out_string)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ã€å‡½æ•°è¯´æ˜ã€‘</strong>è¯¥å‡½æ•°ç”¨äºè¯»å–å±æ€§ä¸­å­—ç¬¦ä¸²å€¼ã€‚</p>
<p><strong>ã€å‡½æ•°å‚æ•°ã€‘</strong></p>
<ul>
<li><code>np</code>ï¼š<code>struct device_node *</code>ç±»å‹ï¼Œè®¾å¤‡èŠ‚ç‚¹æŒ‡é’ˆã€‚</li>
<li><code>propname</code>ï¼š<code>char *</code>ç±»å‹ï¼Œè¦è¯»å–çš„å±æ€§åå­—ã€‚  </li>
<li><code>out_string</code>ï¼š<code>char **</code>ç±»å‹ï¼Œè¯»å–åˆ°çš„å­—ç¬¦ä¸²å€¼ã€‚</li>
</ul>
<p><strong>ã€è¿”å›å€¼ã€‘</strong><code>int</code>ç±»å‹ï¼ŒæˆåŠŸè¿”å›<code>0</code>ï¼Œå¤±è´¥è¿”å›è´Ÿæ•°ï¼Œè´Ÿæ•°çš„ç»å¯¹å€¼æ˜¯é”™è¯¯ç  ã€‚</p>
<p><strong>ã€ä½¿ç”¨æ ¼å¼ã€‘</strong>è¿™é‡Œå†™ä¸€ä¸ªç®€å•å®ä¾‹ï¼Œä¸»è¦æ˜¯è¯´æ˜ç¬¬ä¸‰ä¸ªå‚æ•°çš„å®šä¹‰ä½¿ç”¨æ–¹å¼ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* è®¾å¤‡æ ‘èŠ‚ç‚¹ */</span></span><br><span class="line">fs4412-hello-dt&#123;</span><br><span class="line">    compatible = <span class="string">&quot;fs4412,hello-dt&quot;</span>;</span><br><span class="line">    my-name = <span class="string">&quot;my-hello-dt&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* éœ€è¦åŒ…å«çš„å¤´æ–‡ä»¶ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of.h&gt;</span></span></span><br><span class="line"><span class="comment">/* è‡³å°‘åº”è¯¥æœ‰çš„è¯­å¥ */</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *str = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">if</span>(of_property_read_string(pnode, <span class="string">&quot;my-name&quot;</span>, &amp;str) &lt; <span class="number">0</span>)</span><br><span class="line">    printk(<span class="string">&quot;of_property_read_string failed!\n&quot;</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    printk(<span class="string">&quot;name=%s\n&quot;</span>, str);</span><br></pre></td></tr></table></figure>



<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong><code>none</code></p>
<h3 id="4-7-of-n-addr-cells"><a href="#4-7-of-n-addr-cells" class="headerlink" title="4.7Â of_n_addr_cells()"></a><font size=3>4.7Â <code>of_n_addr_cells()</code></font></h3><p>æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢ä¸€ä¸‹å‡½æ•°æ‰€åœ¨å¤´æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep of_n_addr_cells -r -n ~/5linux/linux-3.14/include</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* éœ€åŒ…å«çš„å¤´æ–‡ä»¶ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å‡½æ•°å£°æ˜ */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">of_n_addr_cells</span><span class="params">(<span class="keyword">struct</span> device_node *np)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ã€å‡½æ•°è¯´æ˜ã€‘</strong>è¯¥å‡½æ•°ç”¨äºè·å–<code>#address-cells</code>å±æ€§å€¼ã€‚</p>
<p><strong>ã€å‡½æ•°å‚æ•°ã€‘</strong></p>
<ul>
<li><code>np</code>ï¼š<code>struct device_node *</code>ç±»å‹ï¼Œè®¾å¤‡èŠ‚ç‚¹æŒ‡é’ˆã€‚</li>
</ul>
<p><strong>ã€è¿”å›å€¼ã€‘</strong><code>int</code>ç±»å‹ï¼Œè·å–åˆ°çš„<code>#address-cells</code>å±æ€§å€¼ã€‚</p>
<p><strong>ã€ä½¿ç”¨æ ¼å¼ã€‘</strong><code>none</code></p>
<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong><code>none</code></p>
<h3 id="4-8-of-n-size-cells"><a href="#4-8-of-n-size-cells" class="headerlink" title="4.8Â of_n_size_cells()"></a><font size=3>4.8Â <code>of_n_size_cells()</code></font></h3><p>æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢ä¸€ä¸‹å‡½æ•°æ‰€åœ¨å¤´æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep of_n_size_cells -r -n ~/5linux/linux-3.14/include</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* éœ€åŒ…å«çš„å¤´æ–‡ä»¶ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å‡½æ•°å£°æ˜ */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">of_n_size_cells</span><span class="params">(<span class="keyword">struct</span> device_node *np)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ã€å‡½æ•°è¯´æ˜ã€‘</strong>è¯¥å‡½æ•°ç”¨äºè·å–<code>#size-cells </code>å±æ€§å€¼ã€‚</p>
<p><strong>ã€å‡½æ•°å‚æ•°ã€‘</strong></p>
<ul>
<li><code>np</code>ï¼š<code>struct device_node *</code>ç±»å‹ï¼Œè®¾å¤‡èŠ‚ç‚¹æŒ‡é’ˆã€‚</li>
</ul>
<p><strong>ã€è¿”å›å€¼ã€‘</strong><code>int</code>ç±»å‹ï¼Œè·å–åˆ°çš„<code>#size-cells   </code>å±æ€§å€¼ã€‚</p>
<p><strong>ã€ä½¿ç”¨æ ¼å¼ã€‘</strong><code>none</code></p>
<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong><code>none</code></p>
<h2 id="5-å…¶ä»–å¸¸ç”¨ofå‡½æ•°"><a href="#5-å…¶ä»–å¸¸ç”¨ofå‡½æ•°" class="headerlink" title="5. å…¶ä»–å¸¸ç”¨ofå‡½æ•°"></a><font size=3>5. å…¶ä»–å¸¸ç”¨<code>of</code>å‡½æ•°</font></h2><h3 id="5-1-of-device-is-compatible"><a href="#5-1-of-device-is-compatible" class="headerlink" title="5.1Â of_device_is_compatible()"></a><font size=3>5.1Â <code>of_device_is_compatible()</code></font></h3><p>æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢ä¸€ä¸‹å‡½æ•°æ‰€åœ¨å¤´æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep of_device_is_compatible -r -n ~/5linux/linux-3.14/include</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* éœ€åŒ…å«çš„å¤´æ–‡ä»¶ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å‡½æ•°å£°æ˜ */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">of_device_is_compatible</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *device,</span></span><br><span class="line"><span class="params">                            <span class="type">const</span> <span class="type">char</span> *compat)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ã€å‡½æ•°è¯´æ˜ã€‘</strong>è¯¥å‡½æ•°ç”¨äºæŸ¥çœ‹èŠ‚ç‚¹çš„<code>compatible</code>å±æ€§æ˜¯å¦æœ‰åŒ…å«<code>compat</code>æŒ‡å®šçš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯æ£€æŸ¥è®¾å¤‡èŠ‚ç‚¹çš„å…¼å®¹æ€§ã€‚</p>
<p><strong>ã€å‡½æ•°å‚æ•°ã€‘</strong></p>
<ul>
<li><code>device</code>ï¼š<code>struct device_node *</code>ç±»å‹ï¼Œè®¾å¤‡èŠ‚ç‚¹æŒ‡é’ˆã€‚</li>
<li><code>compat</code>ï¼š<code>char *</code>ç±»å‹ï¼Œè¦æŸ¥çœ‹çš„å­—ç¬¦ä¸²ã€‚</li>
</ul>
<p><strong>ã€è¿”å›å€¼ã€‘</strong><code>int</code>ç±»å‹ï¼Œè¿”å›<code>0</code>è¡¨ç¤ºèŠ‚ç‚¹çš„<code>compatible</code>å±æ€§ä¸­ä¸åŒ…å« <code>compat</code> æŒ‡å®šçš„å­—ç¬¦ä¸²ï¼› è¿”å›ä¸€ä¸ªæ­£æ•°è¡¨ç¤ºèŠ‚ç‚¹çš„<code>compatible</code><br>å±æ€§ä¸­åŒ…å« <code>compat</code> æŒ‡å®šçš„å­—ç¬¦ä¸²ã€‚  </p>
<p><strong>ã€ä½¿ç”¨æ ¼å¼ã€‘</strong><code>none</code></p>
<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong><code>none</code></p>
<h3 id="5-2-of-get-address"><a href="#5-2-of-get-address" class="headerlink" title="5.2Â of_get_address()"></a><font size=3>5.2Â <code>of_get_address()</code></font></h3><p>æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢ä¸€ä¸‹å‡½æ•°æ‰€åœ¨å¤´æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep of_get_address -r -n ~/5linux/linux-3.14/include</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* éœ€åŒ…å«çš„å¤´æ–‡ä»¶ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å‡½æ•°å£°æ˜ */</span></span><br><span class="line"><span class="type">const</span> __be32 *<span class="title function_">of_get_address</span><span class="params">(<span class="keyword">struct</span> device_node *dev,</span></span><br><span class="line"><span class="params">                             <span class="type">int</span> index,</span></span><br><span class="line"><span class="params">                             u64 *size,</span></span><br><span class="line"><span class="params">                             <span class="type">unsigned</span> <span class="type">int</span> *flags)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ã€å‡½æ•°è¯´æ˜ã€‘</strong>è¯¥å‡½æ•°ç”¨äºè·å–åœ°å€ç›¸å…³å±æ€§ï¼Œä¸»è¦æ˜¯<code>reg</code>æˆ–è€…<code>assigned-addresses</code>å±æ€§å€¼ã€‚</p>
<p><strong>ã€å‡½æ•°å‚æ•°ã€‘</strong></p>
<ul>
<li><code>dev</code>ï¼š<code>struct device_node *</code>ç±»å‹ï¼Œè®¾å¤‡èŠ‚ç‚¹æŒ‡é’ˆã€‚</li>
<li><code>index</code>ï¼š<code>int</code>ç±»å‹ï¼Œè¦è¯»å–çš„åœ°å€æ ‡å·ã€‚  </li>
<li><code>size</code>ï¼š<code>u64 *</code>ç±»å‹ï¼Œåœ°å€é•¿åº¦  ã€‚</li>
<li><code>flags</code>ï¼š<code>unsigned int *</code>ç±»å‹ï¼Œå‚æ•°ï¼Œæ¯”å¦‚<code>IORESOURCE_IO</code>ã€ <code>IORESOURCE_MEM</code>ç­‰ã€‚</li>
</ul>
<p><strong>ã€è¿”å›å€¼ã€‘</strong><code>__be32 *</code>ç±»å‹ï¼ŒæˆåŠŸè¿”å›è¯»å–åˆ°çš„åœ°å€æ•°æ®é¦–åœ°å€ï¼Œè¯»å–å¤±è´¥è¿”å›<code>NULL</code>ã€‚  </p>
<p><strong>ã€ä½¿ç”¨æ ¼å¼ã€‘</strong><code>none</code></p>
<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong><code>none</code></p>
<h3 id="5-3-of-translate-address"><a href="#5-3-of-translate-address" class="headerlink" title="5.3Â of_translate_address()"></a><font size=3>5.3Â <code>of_translate_address()</code></font></h3><p>æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢ä¸€ä¸‹å‡½æ•°æ‰€åœ¨å¤´æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep of_translate_address -r -n ~/5linux/linux-3.14/include</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* éœ€åŒ…å«çš„å¤´æ–‡ä»¶ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å‡½æ•°å£°æ˜ */</span></span><br><span class="line">u64 <span class="title function_">of_translate_address</span><span class="params">(<span class="keyword">struct</span> device_node *dev</span></span><br><span class="line"><span class="params">                         <span class="type">const</span> __be32 *in_addr)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ã€å‡½æ•°è¯´æ˜ã€‘</strong>è¯¥å‡½æ•°ç”¨äºå°†ä»è®¾å¤‡æ ‘è¯»å–åˆ°çš„åœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€ã€‚</p>
<p><strong>ã€å‡½æ•°å‚æ•°ã€‘</strong></p>
<ul>
<li><code>dev</code>ï¼š<code>struct device_node *</code>ç±»å‹ï¼Œè®¾å¤‡èŠ‚ç‚¹æŒ‡é’ˆã€‚</li>
<li><code>in_addr</code>ï¼š<code>__be32 *</code>ç±»å‹ï¼Œè¦è½¬æ¢çš„åœ°å€ã€‚</li>
</ul>
<p><strong>ã€è¿”å›å€¼ã€‘</strong><code>u64</code>ç±»å‹ï¼Œå¾—åˆ°çš„ç‰©ç†åœ°å€ï¼Œå¦‚æœä¸º<code>OF_BAD_ADDR</code>çš„è¯è¡¨ç¤ºè½¬æ¢å¤±è´¥ã€‚  </p>
<p><strong>ã€ä½¿ç”¨æ ¼å¼ã€‘</strong><code>none</code></p>
<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong><code>none</code></p>
<h3 id="5-4-of-property-read-bool"><a href="#5-4-of-property-read-bool" class="headerlink" title="5.4Â of_property_read_bool()"></a><font size=3>5.4Â <code>of_property_read_bool()</code></font></h3><p>æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢ä¸€ä¸‹å‡½æ•°æ‰€åœ¨å¤´æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep of_property_read_bool -r -n ~/5linux/linux-3.14/include</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* éœ€åŒ…å«çš„å¤´æ–‡ä»¶ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å‡½æ•°å£°æ˜ */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">of_property_read_bool</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> device_node *np,</span></span><br><span class="line"><span class="params">                          <span class="type">const</span> <span class="type">char</span> *propname)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ã€å‡½æ•°è¯´æ˜ã€‘</strong>è¯¥å‡½æ•°ç”¨äºåˆ¤æ–­æŒ‡å®šçš„å±æ€§æ˜¯å¦å­˜åœ¨ã€‚</p>
<p><strong>ã€å‡½æ•°å‚æ•°ã€‘</strong></p>
<ul>
<li><code>dev</code>ï¼š<code>struct device_node *</code>ç±»å‹ï¼Œè®¾å¤‡èŠ‚ç‚¹æŒ‡é’ˆã€‚</li>
<li><code>propname</code>ï¼š<code>char *</code>ç±»å‹ï¼Œè¦åˆ¤æ–­æ˜¯å¦å­˜åœ¨çš„çš„å±æ€§åç§°ã€‚</li>
</ul>
<p><strong>ã€è¿”å›å€¼ã€‘</strong><code>int</code>ç±»å‹ï¼Œè‹¥å±æ€§å­˜åœ¨åˆ™è¿”å›<code>true</code>ï¼Œä¸å­˜åœ¨åˆ™è¿”å›<code>false</code>ã€‚  </p>
<p><strong>ã€ä½¿ç”¨æ ¼å¼ã€‘</strong><code>none</code></p>
<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong><code>none</code></p>
<h3 id="5-5-of-address-to-resource"><a href="#5-5-of-address-to-resource" class="headerlink" title="5.5Â of_address_to_resource()"></a><font size=3>5.5Â <code>of_address_to_resource()</code></font></h3><p>æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢ä¸€ä¸‹å‡½æ•°æ‰€åœ¨å¤´æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep of_address_to_resource -r -n ~/5linux/linux-3.14/include</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* éœ€åŒ…å«çš„å¤´æ–‡ä»¶ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å‡½æ•°å£°æ˜ */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">of_address_to_resource</span><span class="params">(<span class="keyword">struct</span> device_node *dev,</span></span><br><span class="line"><span class="params">                           <span class="type">int</span> index,</span></span><br><span class="line"><span class="params">                           <span class="keyword">struct</span> resource *r)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ã€å‡½æ•°è¯´æ˜ã€‘</strong>å‰è¾¹å·²ç»ä»‹ç»è¿‡<code>struct resource</code>ç»“æ„ä½“äº†ï¼Œå‡½æ•°çœ‹åå­—åƒæ˜¯ä»è®¾å¤‡æ ‘é‡Œé¢æå–èµ„æºå€¼ï¼Œä½†æ˜¯æœ¬è´¨ä¸Šå°±æ˜¯å°† <code>reg</code> å±æ€§å€¼ï¼Œç„¶åå°†å…¶è½¬æ¢ä¸º <code>resource</code> ç»“æ„ä½“ç±»å‹ã€‚</p>
<p><strong>ã€å‡½æ•°å‚æ•°ã€‘</strong></p>
<ul>
<li><code>dev</code>ï¼š<code>struct device_node *</code>ç±»å‹ï¼Œè®¾å¤‡èŠ‚ç‚¹æŒ‡é’ˆã€‚</li>
<li><code>index</code>ï¼š<code>int</code>ç±»å‹ï¼Œåœ°å€èµ„æºæ ‡å·ã€‚  </li>
<li><code>r</code>ï¼š<code>struct resource *</code>ç±»å‹ï¼ˆå‰è¾¹æœ‰ä»‹ç»ï¼‰ï¼Œå¾—åˆ°çš„ <code>resource</code> ç±»å‹çš„èµ„æºå€¼ã€‚</li>
</ul>
<p><strong>ã€è¿”å›å€¼ã€‘</strong><code>int</code>ç±»å‹ï¼ŒæˆåŠŸè¿”å›<code>0</code>ï¼Œå¤±è´¥è¿”å›ä¸€ä¸ªè´Ÿæ•°ã€‚  </p>
<p><strong>ã€ä½¿ç”¨æ ¼å¼ã€‘</strong><code>none</code></p>
<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong><code>none</code></p>
<h3 id="5-6-of-iomap"><a href="#5-6-of-iomap" class="headerlink" title="5.6Â of_iomap()"></a><font size=3>5.6Â <code>of_iomap()</code></font></h3><p>æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢ä¸€ä¸‹å‡½æ•°æ‰€åœ¨å¤´æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep of_iomap -r -n ~/5linux/linux-3.14/include</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* éœ€åŒ…å«çš„å¤´æ–‡ä»¶ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å‡½æ•°å£°æ˜ */</span></span><br><span class="line"><span class="type">void</span> __iomem *<span class="title function_">of_iomap</span><span class="params">(<span class="keyword">struct</span> device_node *np,</span></span><br><span class="line"><span class="params">                       <span class="type">int</span> index)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ã€å‡½æ•°è¯´æ˜ã€‘</strong>è¯¥å‡½æ•°ç”¨äºç›´æ¥å†…å­˜æ˜ å°„ã€‚ä¸ä½¿ç”¨è®¾å¤‡æ ‘çš„è¯ï¼Œä¼šä½¿ç”¨<code>ioremap()</code> å‡½æ•°æ¥å®Œæˆç‰©ç†åœ°å€åˆ°è™šæ‹Ÿåœ°å€çš„æ˜ å°„ï¼Œé‡‡ç”¨è®¾å¤‡æ ‘ä»¥åå°±å¯ä»¥ç›´æ¥é€šè¿‡<code>of_iomap</code>å‡½æ•°æ¥è·å–å†…å­˜åœ°å€æ‰€å¯¹åº”çš„è™šæ‹Ÿåœ°å€ï¼Œä¸éœ€è¦ä½¿ç”¨<code>ioremap</code>å‡½æ•°äº†ã€‚å½“ç„¶äº†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨<code>ioremap()</code> å‡½æ•°æ¥å®Œæˆç‰©ç†åœ°å€åˆ°è™šæ‹Ÿåœ°å€çš„å†…å­˜æ˜ å°„ï¼Œåªæ˜¯åœ¨é‡‡ç”¨è®¾å¤‡æ ‘ä»¥åï¼Œå¤§éƒ¨åˆ†çš„é©±åŠ¨éƒ½ä½¿ç”¨<code>of_iomap</code>å‡½æ•°äº†ã€‚ <code>of_iomap </code>å‡½æ•°æœ¬è´¨ä¸Šä¹Ÿæ˜¯å°† <code>reg</code> å±æ€§ä¸­åœ°å€ä¿¡æ¯è½¬æ¢ä¸ºè™šæ‹Ÿåœ°å€ï¼Œå¦‚æœ <code>reg</code> å±æ€§æœ‰å¤šæ®µçš„è¯ï¼Œå¯ä»¥é€šè¿‡ <code>index</code> å‚æ•°æŒ‡å®šè¦å®Œæˆå†…å­˜æ˜ å°„çš„æ˜¯å“ªä¸€æ®µ ã€‚</p>
<p><strong>ã€å‡½æ•°å‚æ•°ã€‘</strong></p>
<ul>
<li><code>np</code>ï¼š<code>struct device_node *</code>ç±»å‹ï¼Œè®¾å¤‡èŠ‚ç‚¹æŒ‡é’ˆã€‚</li>
<li><code>index</code>ï¼š<code>int</code>ç±»å‹ï¼Œ<code>reg</code> å±æ€§ä¸­è¦å®Œæˆå†…å­˜æ˜ å°„çš„æ®µï¼Œå¦‚æœ <code>reg</code> å±æ€§åªæœ‰ä¸€æ®µçš„è¯ <code>index</code> å°±è®¾ç½®ä¸º <code>0</code>ã€‚</li>
</ul>
<p><strong>ã€è¿”å›å€¼ã€‘</strong><code>void __iomem *</code>ç±»å‹ï¼ŒæˆåŠŸæ˜ å°„çš„è¯è¿”å›ç»è¿‡å†…å­˜æ˜ å°„åçš„è™šæ‹Ÿå†…å­˜é¦–åœ°å€ï¼Œå†…å­˜æ˜ å°„å¤±è´¥è¿”å›<code>NULL</code>ã€‚  </p>
<p><strong>ã€ä½¿ç”¨æ ¼å¼ã€‘</strong><code>none</code></p>
<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong><code>none</code></p>
<h3 id="5-7-of-get-named-gpio"><a href="#5-7-of-get-named-gpio" class="headerlink" title="5.7Â of_get_named_gpio()"></a><font size=3>5.7Â <code>of_get_named_gpio()</code></font></h3><p>æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢ä¸€ä¸‹å‡½æ•°æ‰€åœ¨å¤´æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep of_get_named_gpio -r -n ~/5linux/linux-3.14/include</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* éœ€åŒ…å«çš„å¤´æ–‡ä»¶ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of_gpio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å‡½æ•°å£°æ˜ */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * of_get_named_gpio() - Get a GPIO number to use with GPIO API</span></span><br><span class="line"><span class="comment"> * @np:         device node to get GPIO from</span></span><br><span class="line"><span class="comment"> * @propname:   Name of property containing gpio specifier(s)</span></span><br><span class="line"><span class="comment"> * @index:      index of the GPIO</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Returns GPIO number to use with Linux generic GPIO API, or one of the errno</span></span><br><span class="line"><span class="comment"> * value on the error condition.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">int</span> <span class="title function_">of_get_named_gpio</span><span class="params">(<span class="keyword">struct</span> device_node *np,</span></span><br><span class="line"><span class="params">                                   <span class="type">const</span> <span class="type">char</span> *propname, <span class="type">int</span> index)</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="keyword">return</span> of_get_named_gpio_flags(np, propname, index, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ã€å‡½æ•°è¯´æ˜ã€‘</strong>è¯¥å‡½æ•°ä»è®¾å¤‡æ ‘ä¸­æå–<code>gpio</code>å£ã€‚</p>
<p><strong>ã€å‡½æ•°å‚æ•°ã€‘</strong></p>
<ul>
<li><code>np</code>ï¼š<code>struct device_node *</code>ç±»å‹ï¼Œè®¾å¤‡èŠ‚ç‚¹æŒ‡é’ˆã€‚</li>
<li><code>propname</code>ï¼š<code>char *</code>ç±»å‹ï¼ŒåŒ…å«è¦è·å– <code>GPIO</code> ä¿¡æ¯çš„å±æ€§åã€‚</li>
<li><code>index</code>ï¼š<code>int</code>ç±»å‹ï¼Œ <code>GPIO</code> ç´¢å¼•ï¼Œå› ä¸ºä¸€ä¸ªå±æ€§é‡Œé¢å¯èƒ½åŒ…å«å¤šä¸ª <code>GPIO</code>ï¼Œæ­¤å‚æ•°æŒ‡å®šè¦è·å–å“ªä¸ª <code>GPIO</code>çš„ç¼–å·ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ª <code>GPIO</code> ä¿¡æ¯çš„è¯æ­¤å‚æ•°ä¸º<code> 0</code>ã€‚</li>
</ul>
<p><strong>ã€è¿”å›å€¼ã€‘</strong><code>int</code>ç±»å‹ï¼Œè¿”å›ä¸€ä¸ªæ­£æ•°è¡¨ç¤ºè·å–åˆ°äº†<code>GPIO</code>ç¼–å·ï¼Œè·å–å¤±è´¥è¿”å›ä¸€ä¸ªè´Ÿæ•°ã€‚  </p>
<p><strong>ã€ä½¿ç”¨æ ¼å¼ã€‘</strong><code>none</code></p>
<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong><code>none</code></p>
<h3 id="5-8-irq-of-parse-and-map"><a href="#5-8-irq-of-parse-and-map" class="headerlink" title="5.8Â irq_of_parse_and_map()"></a><font size=3>5.8Â <code>irq_of_parse_and_map()</code></font></h3><p>æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢ä¸€ä¸‹å‡½æ•°æ‰€åœ¨å¤´æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep irq_of_parse_and_map -r -n ~/5linux/linux-3.14/include</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* éœ€åŒ…å«çš„å¤´æ–‡ä»¶ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of_irq.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å‡½æ•°å£°æ˜ */</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> <span class="title function_">irq_of_parse_and_map</span><span class="params">(<span class="keyword">struct</span> device_node *node, </span></span><br><span class="line"><span class="params">                                  <span class="type">int</span> index)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ã€å‡½æ•°è¯´æ˜ã€‘</strong>è¯¥å‡½æ•°è·å¾—è®¾å¤‡æ ‘ä¸­çš„ä¸­æ–­å·å¹¶è¿›è¡Œæ˜ å°„ã€‚</p>
<p><strong>ã€å‡½æ•°å‚æ•°ã€‘</strong></p>
<ul>
<li><code>node</code>ï¼š<code>struct device_node *</code>ç±»å‹ï¼Œè®¾å¤‡èŠ‚ç‚¹æŒ‡é’ˆã€‚</li>
<li><code>index</code>ï¼š<code>int</code>ç±»å‹ï¼Œ <code>GPIO</code> ç´¢å¼•ï¼Œå› ä¸ºä¸€ä¸ªå±æ€§é‡Œé¢å¯èƒ½åŒ…å«å¤šä¸ª <code>GPIO</code>ï¼Œæ­¤å‚æ•°æŒ‡å®šè¦è·å–å“ªä¸ª <code>GPIO</code>çš„ç¼–å·ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ª <code>GPIO</code> ä¿¡æ¯çš„è¯æ­¤å‚æ•°ä¸º<code> 0</code>ã€‚</li>
</ul>
<p><strong>ã€è¿”å›å€¼ã€‘</strong><code>int</code>ç±»å‹ï¼ŒæˆåŠŸè¿”å›ä¸­æ–­å·ï¼Œå¤±è´¥è¿”å›ä¸€ä¸ªè´Ÿæ•°ï¼Œç»å¯¹å€¼è¡¨ç¤ºé”™è¯¯ç ã€‚  </p>
<p><strong>ã€ä½¿ç”¨æ ¼å¼ã€‘</strong><code>none</code></p>
<p><strong>ã€æ³¨æ„äº‹é¡¹ã€‘</strong><code>none</code></p>

    </div>

    
    
    

    <footer class="post-footer">




    <div>
        
            <div style="text-align:center;color: #ccc;font-size:14px;">
            ----------æœ¬æ–‡ç»“æŸ
            <i class="fas fa-fan fa-spin" style="color: #FF1493; font-size: 1rem"></i>
            æ„Ÿè°¢æ‚¨çš„é˜…è¯»----------
            </div>
        
    </div>





  
  <div class="my_post_copyright"> 
    <p><span>æ–‡ç« æ ‡é¢˜:</span><a href="/post/6daf9146.html">LV10-08-è®¾å¤‡æ ‘-01-è®¾å¤‡æ ‘åŸºç¡€çŸ¥è¯†</a></p>
    <p><span>æ–‡ç« ä½œè€…:</span><a href="/" title="æ¬¢è¿è®¿é—® ã€Šè‹æœ¨ã€‹ çš„å­¦ä¹ ç¬”è®°">è‹æœ¨</a></p>
    <p><span>å‘å¸ƒæ—¶é—´:</span>2023å¹´07æœˆ08æ—¥ - 18:58</p>
    <p><span>æœ€åæ›´æ–°:</span>2025å¹´06æœˆ14æ—¥ - 00:25</p>
    <p><span>åŸå§‹é“¾æ¥:</span><a href="/post/6daf9146.html" title="LV10-08-è®¾å¤‡æ ‘-01-è®¾å¤‡æ ‘åŸºç¡€çŸ¥è¯†">https://sumumm.github.io/post/6daf9146.html</a></p>
    <p><span>è®¸å¯åè®®:</span><i class="fab fa-creative-commons"></i> <a rel="license" href= "https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç¦æ­¢æ¼”ç» 4.0 å›½é™…</a> è½¬è½½è¯·ä¿ç•™åŸæ–‡é“¾æ¥åŠä½œè€…ã€‚</p>  
  </div>
  


          <div class="post-tags">
              <a href="/tags/LV10-%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/" rel="tag"><i class="fa fa-tag"></i> LV10-é©±åŠ¨å¼€å‘</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/post/2a3d5ad0.html" rel="prev" title="LV10-09-sysfs-01-sysfsç®€ä»‹">
                  <i class="fa fa-angle-left"></i> LV10-09-sysfs-01-sysfsç®€ä»‹
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/post/abc4e840.html" rel="next" title="LV10-07-ä¸­æ–­-01-ä¸­æ–­å¤„ç†åŸºç¡€">
                  LV10-07-ä¸­æ–­-01-ä¸­æ–­å¤„ç†åŸºç¡€ <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2017 â€“ 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">è‹æœ¨</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>ç«™ç‚¹æ€»å­—æ•°ï¼š</span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">3.7m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>ç«™ç‚¹é˜…è¯»æ—¶é•¿ &asymp;</span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">225:26</span>
  </span>
</div>




    <span id="sitetime"></span>
    <script defer language=javascript>
        function siteTime()
        {
            window.setTimeout("siteTime()", 1000);
            var seconds = 1000;
            var minutes = seconds * 60;
            var hours = minutes * 60;
            var days = hours * 24;
            var years = days * 365;
            var today = new Date();
            var todayYear = today.getFullYear();
            var todayMonth = today.getMonth()+1;
            var todayDate = today.getDate();
            var todayHour = today.getHours();
            var todayMinute = today.getMinutes();
            var todaySecond = today.getSeconds();
            /*==================================================
            Date.UTC() -- è¿”å›dateå¯¹è±¡è·ä¸–ç•Œæ ‡å‡†æ—¶é—´(UTC)1970å¹´1æœˆ1æ—¥åˆå¤œä¹‹é—´çš„æ¯«ç§’æ•°(æ—¶é—´æˆ³)
            year        - ä½œä¸ºdateå¯¹è±¡çš„å¹´ä»½ï¼Œä¸º4ä½å¹´ä»½å€¼
            month       - 0-11ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„æœˆä»½
            day         - 1-31ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„å¤©æ•°
            hours       - 0(åˆå¤œ24ç‚¹)-23ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„å°æ—¶æ•°
            minutes     - 0-59ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„åˆ†é’Ÿæ•°
            seconds     - 0-59ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„ç§’æ•°
            microseconds - 0-999ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„æ¯«ç§’æ•°
            ==================================================*/
            var t1 = Date.UTC(2017, 
                              5, 
                              19, 
                              0, 
                              0, 
                              0); //åŒ—äº¬æ—¶é—´
            var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond);
            var diff = t2-t1;
            var diffYears = Math.floor(diff/years);
            var diffDays = Math.floor((diff/days)-diffYears*365);
            var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours);
            var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes);
            var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds);
            document.getElementById("sitetime").innerHTML="å·²åœ¨è¿™é‡Œ "+diffYears+" å¹´ "+diffDays+" å¤© "+diffHours+" å°æ—¶ "+diffMinutes+" åˆ†é’Ÿ "+diffSeconds+" ç§’";
        }
        siteTime();
    </script>



    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.umd.js" integrity="sha256-ytMJGN3toR+a84u7g7NuHm91VIR06Q41kMWDr2pq7Zo=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>


  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


 
        <div id="click-show-text"
            data-mobile = false
            data-text = å¯Œå¼º,æ°‘ä¸»,æ–‡æ˜,å’Œè°,è‡ªç”±,å¹³ç­‰,å…¬æ­£,æ³•åˆ¶,çˆ±å›½,æ•¬ä¸š,è¯šä¿¡,å‹å–„
            data-fontsize = 15px
            data-random= false>
        </div>
       

      
        <script async src=https://cdn.jsdelivr.net/npm/hexo-next-mouse-effect@latest/click/showText.js></script>
      

      
    




    <script async src="/js/fancybox_param.js"></script>





<!-- APlayeræœ¬ä½“ -->



</body>
</html>
