<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha256-wiz7ZSCn/btzhjKDQBms9Hx4sSeUYsDrTLg7roPstac=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.css" integrity="sha256-6cQIC71/iBIYXFK+0RHAvwmjwWzkWd+r7v/BX3/vZDc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/green/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"sumumm.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.19.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":300},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="æœ¬æ–‡ä¸»è¦æ˜¯kernelâ€”â€”ç¼–è¯‘å•ä¸ªå†…æ ¸æ¨¡å—çš„æµç¨‹çš„ç›¸å…³ç¬”è®°ï¼Œè‹¥ç¬”è®°ä¸­æœ‰é”™è¯¯æˆ–è€…ä¸åˆé€‚çš„åœ°æ–¹ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ğŸ˜ƒã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="LV05-03-Kernel-03-02-make-single-module">
<meta property="og:url" content="https://sumumm.github.io/post/5d81934f.html">
<meta property="og:site_name" content="è‹æœ¨">
<meta property="og:description" content="æœ¬æ–‡ä¸»è¦æ˜¯kernelâ€”â€”ç¼–è¯‘å•ä¸ªå†…æ ¸æ¨¡å—çš„æµç¨‹çš„ç›¸å…³ç¬”è®°ï¼Œè‹¥ç¬”è®°ä¸­æœ‰é”™è¯¯æˆ–è€…ä¸åˆé€‚çš„åœ°æ–¹ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ğŸ˜ƒã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV05-%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F/LV05-03-Kernel-03-02-make-single-module/img/image-20241129000124387.png">
<meta property="og:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV05-%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F/LV05-03-Kernel-03-02-make-single-module/img/image-20241129001133528.png">
<meta property="article:published_time" content="2024-11-29T02:27:21.000Z">
<meta property="article:modified_time" content="2025-06-13T16:25:57.045Z">
<meta property="article:author" content="è‹æœ¨">
<meta property="article:tag" content="LV05-ç³»ç»Ÿé•œåƒ">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV05-%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F/LV05-03-Kernel-03-02-make-single-module/img/image-20241129000124387.png">


<link rel="canonical" href="https://sumumm.github.io/post/5d81934f.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":"","permalink":"https://sumumm.github.io/post/5d81934f.html","path":"post/5d81934f.html","title":"LV05-03-Kernel-03-02-make-single-module"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>LV05-03-Kernel-03-02-make-single-module | è‹æœ¨</title>
  








    <script src="/js/browser_tools_disable.js"></script>

  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start --><link rel="stylesheet" href="https://unpkg.com/hexo-next-tags-plus@latest/lib/tag_plus.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">è‹æœ¨</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">æˆ‘çš„å­¦ä¹ ä¹‹è·¯</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>è‹æœ¨çš„å®¶</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»é¡µ<span class="badge">42</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£é¡µ<span class="badge">673</span></a></li><li class="menu-item menu-item-flink"><a href="/flink/" rel="section"><i class="fa fa-link fa-fw"></i>å‹äººå¸</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äºæˆ‘</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E6%A6%82%E8%BF%B0"><span class="nav-text">ä¸€ã€æ¦‚è¿°</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%B8%AE%E5%8A%A9%E4%BF%A1%E6%81%AF"><span class="nav-text">1. å¸®åŠ©ä¿¡æ¯</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%A8%A1%E5%9D%97%E7%BC%96%E8%AF%91%E5%91%BD%E4%BB%A4"><span class="nav-text">2. æ¨¡å—ç¼–è¯‘å‘½ä»¤</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%87%BD%E6%95%B0%E8%AF%B4%E6%98%8E"><span class="nav-text">äºŒã€å‡½æ•°è¯´æ˜</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-cmd%E5%87%BD%E6%95%B0"><span class="nav-text">1. cmdå‡½æ•°</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-echo-cmd"><span class="nav-text">1.1 $(echo-cmd)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-1-escsq"><span class="nav-text">1.1.1 escsq</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-2-echo-why"><span class="nav-text">1.1.2Â echo-why</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-3-%E6%80%BB%E7%BB%93"><span class="nav-text">1.1.3 æ€»ç»“</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-cmd-1"><span class="nav-text">1.2 $(cmd_$(1))</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-cmd%E5%88%B0%E5%BA%95%E5%9C%A8%E5%81%9A%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="nav-text">1.3Â cmdåˆ°åº•åœ¨åšä»€ä¹ˆï¼Ÿ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-wanring%E5%87%BD%E6%95%B0"><span class="nav-text">2. wanringå‡½æ•°</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%89%E3%80%81make-dir-file-ko"><span class="nav-text">ä¸‰ã€makeÂ dir&#x2F;file.ko</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-ko%E7%9B%AE%E6%A0%87"><span class="nav-text">1.Â %.koç›®æ ‡</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-cmd-crmodverdir"><span class="nav-text">1.1Â cmd_crmodverdir</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-KBUILD-MODULES"><span class="nav-text">1.2Â KBUILD_MODULES</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-build%E3%80%81build-dir"><span class="nav-text">1.3Â buildã€build-dir</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-1-build"><span class="nav-text">1.3.1Â build</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-2-build-dir"><span class="nav-text">1.3.2Â build-dir</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-3-ko-o"><span class="nav-text">1.3.3 $(@:.ko&#x3D;.o)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-4-%E5%91%BD%E4%BB%A4%E5%B1%95%E5%BC%80"><span class="nav-text">1.3.4 å‘½ä»¤å±•å¼€</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-ko%E8%A7%84%E5%88%99%E5%B1%95%E5%BC%80"><span class="nav-text">1.4 %.koè§„åˆ™å±•å¼€</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Makefile-build"><span class="nav-text">2.Â Makefile.build </span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-obj%E4%B8%8Esrc"><span class="nav-text">2.1 objä¸src</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-obj-o%E7%9B%AE%E6%A0%87"><span class="nav-text">2.2 $(obj)&#x2F;%.oç›®æ ‡</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1-%E5%8C%B9%E9%85%8D%E5%93%AA%E4%B8%80%E4%B8%AA%E7%9B%AE%E6%A0%87%EF%BC%9F"><span class="nav-text">2.2.1 åŒ¹é…å“ªä¸€ä¸ªç›®æ ‡ï¼Ÿ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-call-cmd-force-checksrc"><span class="nav-text">2.2.2 $(call cmd,force_checksrc)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-3-call-if-changed-rule-cc-o-c"><span class="nav-text">2.2.3 $(call if_changed_rule,cc_o_c)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-3-1-any-prereq"><span class="nav-text">2.2.3.1Â any-prereq</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-3-2-arg-check"><span class="nav-text">2.2.3.2Â arg-check</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-3-3-rule-1"><span class="nav-text">2.2.3.3 $(rule_$(1))</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-rule-cc-o-c%E5%87%BD%E6%95%B0"><span class="nav-text">3.Â rule_cc_o_cå‡½æ•°</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-checksrc"><span class="nav-text">3.1Â checksrc</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-1-cmd-checksrc"><span class="nav-text">3.1.1 $(cmd_checksrc)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-2-call-echo-cmd-checksrc"><span class="nav-text">3.1.2 $(call echo-cmd,checksrc)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-3-%E6%80%BB%E7%BB%93"><span class="nav-text">3.1.3 æ€»ç»“</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-call-cmd-and-fixdep-cc-o-c"><span class="nav-text">3.2 $(call cmd_and_fixdep,cc_o_c)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-1-echo-cmd"><span class="nav-text">3.2.1Â $(echo-cmd)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-2-cmd-cc-o-c"><span class="nav-text">3.2.2 $(cmd_cc_o_c)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-3-echo-cmd-cmd-1-%E5%81%9A%E4%BA%86%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="nav-text">3.2.3 $(echo-cmd) $(cmd_$(1))åšäº†ä»€ä¹ˆï¼Ÿ</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-cmd-checkdoc"><span class="nav-text">3.3 $(cmd_checkdoc)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-objtool"><span class="nav-text">3.4 objtool</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-1-cmd-objtool"><span class="nav-text">3.4.1 $(cmd_objtool)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-2-call-echo-cmd-objtool"><span class="nav-text">3.4.2 $(call echo-cmd,objtool)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-3-%E6%80%BB%E7%BB%93"><span class="nav-text">3.4.3 æ€»ç»“</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-cmd-modversions-c"><span class="nav-text">3.5 $(cmd_modversions_c)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-6-record-mcount"><span class="nav-text">3.6Â record_mcount</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-6-1-cmd-record-mcount"><span class="nav-text">3.6.1 $(cmd_record_mcount)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-6-2-call-echo-cmd-record-mcount"><span class="nav-text">3.6.2 $(call echo-cmd,record_mcount)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-6-3-%E6%80%BB%E7%BB%93"><span class="nav-text">3.6.3 æ€»ç»“</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-7-rule-cc-o-c%E6%80%BB%E7%BB%93"><span class="nav-text">3.7 rule_cc_o_cæ€»ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-Makefile-modpost"><span class="nav-text">4.Â Makefile.modpost</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="nav-text">4.1 æ–‡ä»¶ç»“æ„</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-1-Step-1"><span class="nav-text">4.1.1Â Step 1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-2-Step-2-3-4"><span class="nav-text">4.1.2Â Step 2&#x2F;3&#x2F;4</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-3-Step-5"><span class="nav-text">4.1.3Â Step 5</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-4-%E6%89%80%E6%9C%89%E5%87%BA%E7%8E%B0%E7%9A%84%E7%9B%AE%E6%A0%87"><span class="nav-text">4.1.4 æ‰€æœ‰å‡ºç°çš„ç›®æ ‡</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-modpost%E7%9B%AE%E6%A0%87"><span class="nav-text">4.2Â _modpostç›®æ ‡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-modpost%E7%9B%AE%E6%A0%87"><span class="nav-text">4.3Â __modpostç›®æ ‡</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-1-call-cmd-modpost"><span class="nav-text">4.3.1 $(call cmd,modpost)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-2-wildcard-vmlinux"><span class="nav-text">4.3.2 $(wildcard vmlinux)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-3-modules-ko-o"><span class="nav-text">4.3.3Â $(modules:.ko&#x3D;.o)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-4-%E6%80%BB%E7%BB%93"><span class="nav-text">4.3.4 æ€»ç»“</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-modpost%E7%9B%AE%E6%A0%87"><span class="nav-text">4.4Â _modpostç›®æ ‡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-modules-%E7%9B%AE%E6%A0%87"><span class="nav-text">4.5 $(modules)ç›®æ ‡</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-5-1-if-changed%E5%87%BD%E6%95%B0"><span class="nav-text">4.5.1Â if_changedå‡½æ•°</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-5-2-cmd-ld-ko-o"><span class="nav-text">4.5.2 cmd_ld_ko_o</span></a></li></ol></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="è‹æœ¨"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">è‹æœ¨</p>
  <div class="site-description" itemprop="description">è«é“æ¡‘æ¦†æ™šï¼Œä¸ºéœå°šæ»¡å¤©</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">673</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">42</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">æ ‡ç­¾</span>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/sumumm" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;sumumm" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sumumm.github.io/post/5d81934f.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="è‹æœ¨">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è‹æœ¨">
      <meta itemprop="description" content="è«é“æ¡‘æ¦†æ™šï¼Œä¸ºéœå°šæ»¡å¤©">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="LV05-03-Kernel-03-02-make-single-module | è‹æœ¨">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          LV05-03-Kernel-03-02-make-single-module
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2024-11-29 10:27:21" itemprop="dateCreated datePublished" datetime="2024-11-29T10:27:21+08:00">2024-11-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">åµŒå…¥å¼å¼€å‘</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/" itemprop="url" rel="index"><span itemprop="name">02IMX6ULLå¹³å°</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV05-%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F/" itemprop="url" rel="index"><span itemprop="name">LV05-ç³»ç»Ÿé•œåƒ</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>11k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>41 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>æœ¬æ–‡ä¸»è¦æ˜¯kernelâ€”â€”ç¼–è¯‘å•ä¸ªå†…æ ¸æ¨¡å—çš„æµç¨‹çš„ç›¸å…³ç¬”è®°ï¼Œè‹¥ç¬”è®°ä¸­æœ‰é”™è¯¯æˆ–è€…ä¸åˆé€‚çš„åœ°æ–¹ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ğŸ˜ƒã€‚</p>
<span id="more"></span>

<!-- Photo: https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV05-%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F/LV05-03-Kernel-03-02-make-single-module/img/ -->

<details class="folding-tag" blue><summary> ç‚¹å‡»æŸ¥çœ‹ä½¿ç”¨å·¥å…·åŠç‰ˆæœ¬ </summary>
              <div class='content'>
              <table>    <tr>        <td align="center" rowspan="5">PCç«¯å¼€å‘ç¯å¢ƒ</td>        <td align="center" width=150px>Windows</td>        <td align="left">Windows11</td>    </tr>    <tr>        <td align="center">Ubuntu</td>        <td align="left">Ubuntu20.04.2çš„64ä½ç‰ˆæœ¬</td>      </tr>    <tr>        <td align="center">VMwareÂ® Workstation 17 Pro</td>        <td align="left">17.6.0 build-24238078</td>      </tr>    <tr>        <td align="center">ç»ˆç«¯è½¯ä»¶</td>        <td align="left">MobaXterm(Professional Edition v23.0 Build 5042 (license))</td>    </tr>    <tr>        <td align="center">Win32DiskImager</td>        <td align="left">Win32DiskImager v1.0</td>      </tr>    <tr>        <td align="center" rowspan="3">Linuxå¼€å‘æ¿ç¯å¢ƒ</td>        <td align="center">Linuxå¼€å‘æ¿</td>        <td align="left">æ­£ç‚¹åŸå­ i.MX6ULL Linux é˜¿å°”æ³•å¼€å‘æ¿</td>      </tr>    <tr>        <td align="center">uboot</td>        <td align="left">NXPå®˜æ–¹æä¾›çš„ubootï¼Œä½¿ç”¨çš„ubootç‰ˆæœ¬ä¸ºU-Boot 2019.04</td>      </tr>    <tr>        <td align="center">linuxå†…æ ¸</td>        <td align="left">linux-4.19.71(NXPå®˜æ–¹æä¾›)</td>      </tr></table>
              </div>
            </details>

<details class="folding-tag" blue><summary> ç‚¹å‡»æŸ¥çœ‹æœ¬æ–‡å‚è€ƒèµ„æ–™ </summary>
              <div class='content'>
              <table>    <tr>        <td align="center">åˆ†ç±»</td>        <td align="center">ç½‘å€</td>        <td align="center">è¯´æ˜</td>    </tr>    <tr>        <td align="center" rowspan="5">å®˜æ–¹ç½‘ç«™</td>        <td align="left"><a href="https://www.arm.com/" target="_blank">https://www.arm.com/</a></td>        <td align="left">ARMå®˜æ–¹ç½‘ç«™ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°Cotex-Mxä»¥åŠARMVxçš„ä¸€äº›æ–‡æ¡£</td>    </tr>    <tr>        <td align="left"><a href="https://www.nxp.com.cn/" target="_blank">https://www.nxp.com.cn/ </a></td>        <td align="left">NXPå®˜æ–¹ç½‘ç«™</td>    </tr>    <tr>        <td align="left"><a href="https://www.nxpic.org.cn/" target="_blank">https://www.nxpic.org.cn/</a></td><td align="left">NXP å®˜æ–¹ç¤¾åŒº</td>    </tr>    <tr>        <td align="left"><a href="https://u-boot.readthedocs.io/en/latest/" target="_blank">https://u-boot.readthedocs.io/en/latest/</a></td><td align="left">u-bootå®˜ç½‘</td>    </tr>    <tr>        <td align="left"><a href="https://www.kernel.org/" target="_blank">https://www.kernel.org/</a></td><td align="left">linuxå†…æ ¸å®˜ç½‘</td>    </tr></table>
              </div>
            </details>

<details class="folding-tag" blue><summary> ç‚¹å‡»æŸ¥çœ‹ç›¸å…³æ–‡ä»¶ä¸‹è½½ </summary>
              <div class='content'>
              <table>    <tr>        <td align="center">åˆ†ç±»</td>        <td align="center">ç½‘å€</td>        <td align="center">è¯´æ˜</td>    </tr>    <tr>        <td align="center" rowspan="3">NXP</td>        <td align="left"><a href="https://github.com/nxp-imx" target="_blank">https://github.com/nxp-imx</a></td>        <td align="left">NXP imxå¼€å‘èµ„æºGitHubç»„ç»‡ï¼Œé‡Œè¾¹ä¼šæœ‰u-bootå’Œlinuxå†…æ ¸çš„ä»“åº“</td>    </tr>    <tr>        <td align="left"><a href="https://github.com/nxp-imx/linux-imx/releases/tag/v4.19.71" target="_blank">nxp-imx/linux-imx/releases/tag/v4.19.71</a></td>        <td align="left">NXP linuxå†…æ ¸ä»“åº“tagsä¸­çš„v4.19.71</td>    </tr>    <tr>        <td align="left"><a href="https://github.com/nxp-imx/uboot-imx/releases/tag/rel_imx_4.19.35_1.1.0" target="_blank">nxp-imx/uboot-imx/releases/tag/rel_imx_4.19.35_1.1.0</a></td>        <td align="left">NXP u-bootä»“åº“tagsä¸­çš„rel_imx_4.19.35_1.1.0</td>    </tr>    <tr>        <td align="center" rowspan="2">I.MX6ULL</td>        <td align="left"><a href="https://www.nxp.com.cn/docs/en/data-sheet/IMX6ULLIEC.pdf" target="_blank">i.MX 6ULL Applications Processors for Industrial Products</a></td>        <td align="left">I.MX6ULL èŠ¯ç‰‡æ‰‹å†Œï¼ˆdatasheetï¼Œå¯ä»¥åœ¨çº¿æŸ¥çœ‹ï¼‰</td>    </tr>    <tr>        <td align="left"><a href="https://www.nxp.com.cn/webapp/Download?colCode=IMX6ULLRM&lang_cd=zh" target="_blank">i.MX 6ULL Applications ProcessorReference Manual</a></td>        <td align="left">I.MX6ULL å‚è€ƒæ‰‹å†Œï¼ˆä¸‹è½½åæ‰èƒ½æŸ¥çœ‹ï¼Œéœ€è¦ç™»å½•NXPå®˜ç½‘ï¼‰</td>    </tr>    <tr>        <td align="center" rowspan="2">Source Code</td>        <td align="left"><a href="https://elixir.bootlin.com/linux/latest/source" target="_blank">https://elixir.bootlin.com/linux/latest/source</a></td>        <td align="left">linux kernelæºç </td>    </tr>    <tr>        <td align="left"><a href="https://elixir.bootlin.com/u-boot/latest/source" target="_blank">https://elixir.bootlin.com/u-boot/latest/source</a></td>        <td align="left">ubootæºç </td>    </tr></table>
              </div>
            </details>

<h1 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a><font size=3>ä¸€ã€æ¦‚è¿°</font></h1><h2 id="1-å¸®åŠ©ä¿¡æ¯"><a href="#1-å¸®åŠ©ä¿¡æ¯" class="headerlink" title="1. å¸®åŠ©ä¿¡æ¯"></a><font size=3>1. å¸®åŠ©ä¿¡æ¯</font></h2><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L1370">Makefile - <em>help</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PHONY += help</span><br><span class="line"><span class="section">help:</span></span><br><span class="line"><span class="comment">#......</span></span><br><span class="line">	@echo  &#x27;* modules	  - Build all modules&#x27;</span><br><span class="line">	@echo  &#x27;  modules_install - Install all modules to INSTALL_MOD_PATH (default: /)&#x27;</span><br><span class="line"><span class="comment">#......</span></span><br><span class="line">	@echo  &#x27;  dir/file.ko     - Build module including final link&#x27;</span><br><span class="line">	@echo  &#x27;  modules_prepare - Set up for building external modules&#x27;</span><br><span class="line"><span class="comment"># ......</span></span><br></pre></td></tr></table></figure>

<h2 id="2-æ¨¡å—ç¼–è¯‘å‘½ä»¤"><a href="#2-æ¨¡å—ç¼–è¯‘å‘½ä»¤" class="headerlink" title="2. æ¨¡å—ç¼–è¯‘å‘½ä»¤"></a><font size=3>2. æ¨¡å—ç¼–è¯‘å‘½ä»¤</font></h2><p>ä»å¸®åŠ©ä¿¡æ¯ä¸­å¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡modulesç­‰ç›¸å…³å‘½ä»¤ç¼–è¯‘æ¨¡å—ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make V=1 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- modules -j16     <span class="comment"># ç¼–è¯‘æ‰€æœ‰çš„æ¨¡å—</span></span><br><span class="line">make V=1 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- dir/file.ko -j16 <span class="comment"># ç¼–è¯‘æŒ‡å®šæ¨¡å—</span></span><br></pre></td></tr></table></figure>

<h1 id="äºŒã€å‡½æ•°è¯´æ˜"><a href="#äºŒã€å‡½æ•°è¯´æ˜" class="headerlink" title="äºŒã€å‡½æ•°è¯´æ˜"></a><font size=3>äºŒã€å‡½æ•°è¯´æ˜</font></h1><p>è¿™é‡Œå…ˆæ¥äº†è§£å‡ ä¸ªå‡½æ•°ï¼Œåé¢ä¼šç»å¸¸ç”¨åˆ°ã€‚</p>
<h2 id="1-cmdå‡½æ•°"><a href="#1-cmdå‡½æ•°" class="headerlink" title="1. cmdå‡½æ•°"></a><font size=3>1. cmdå‡½æ•°</font></h2><p>cmdå‡½æ•°å®šä¹‰åœ¨ï¼š<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Kbuild.include#L224">Kbuild.include - scripts&#x2F;Kbuild.include - <em>cmd</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo command.</span></span><br><span class="line"><span class="comment"># Short version is used, if $(quiet) equals `quiet_&#x27;, otherwise full one.</span></span><br><span class="line">echo-cmd = <span class="variable">$(<span class="built_in">if</span> $(<span class="variable">$(quiet)</span>cmd_$(1)</span>),\</span><br><span class="line">	echo &#x27;  <span class="variable">$(<span class="built_in">call</span> escsq,$(<span class="variable">$(quiet)</span>cmd_$(1)</span>))$(echo-why)&#x27;;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># printing commands</span></span><br><span class="line">cmd = @$(echo-cmd) $(cmd_$(1))</span><br></pre></td></tr></table></figure>

<p>ä¸»è¦æ˜¯å®ƒåŒ…å«äº†<code>echo-cmd</code>ï¼Œåé¢ä¼šç»å¸¸çœ‹åˆ°ï¼Œè¿™é‡Œå°±å•ç‹¬åˆ†æä¸€ä¸‹å§ã€‚quietå°±æ˜¯ä¸€ä¸ªå‰ç¼€ï¼Œ<code>make V=1</code>çš„è¯ï¼Œquietä¸ºç©ºï¼Œ<code>make V=0</code>ï¼Œquiet&#x3D;@ã€‚</p>
<h3 id="1-1-echo-cmd"><a href="#1-1-echo-cmd" class="headerlink" title="1.1 $(echo-cmd)"></a><font size=3>1.1 <code>$(echo-cmd)</code></font></h3><p>å…ˆçœ‹è¿™ä¸ªecho-cmdï¼Œä»å­—é¢ç†è§£ï¼Œåº”è¯¥æ˜¯å›æ˜¾å‘½ä»¤ï¼Œè€Œä¸”åˆçœ‹ä¹Ÿæ˜¯æ‰“å°å‘½ä»¤åˆ°ç»ˆç«¯ã€‚</p>
<h4 id="1-1-1-escsq"><a href="#1-1-1-escsq" class="headerlink" title="1.1.1 escsq"></a><font size=3>1.1.1 escsq</font></h4><p>å…ˆæ¥çœ‹ä¸€ä¸‹escsqå‡½æ•°ï¼Œå®ƒå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Kbuild.include#L32">Kbuild.include - scripts&#x2F;Kbuild.include - <em>escsq</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###</span></span><br><span class="line"><span class="comment"># Escape single quote for use in echo statements</span></span><br><span class="line">escsq = <span class="variable">$(<span class="built_in">subst</span> <span class="variable">$(squote)</span>,&#x27;\<span class="variable">$(squote)</span>&#x27;,$1)</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªsubstå‡½æ•°æ˜¯å­—ç¬¦ä¸²æ›¿æ¢å‡½æ•°ï¼ŒåŒ…å«ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¢«æ›¿æ¢å­—ä¸²ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ›¿æ¢å­—ä¸²ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯æ›¿æ¢æ“ä½œç”¨çš„å­—ä¸²ã€‚ç”¨æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">subst</span> &lt;from&gt;,&lt;to&gt;,&lt;text&gt;)</span></span><br></pre></td></tr></table></figure>

<p>ä½œç”¨å°±æ˜¯åœ¨textä¸­å°†fromæ›¿æ¢æˆtoã€‚æ‰€ä»¥è¿™é‡Œçš„å«ä¹‰å°±æ˜¯åœ¨ä¼ å…¥çš„å‚æ•°<code>$1</code>ä¸­å°†<code>$(squote)</code>æ›¿æ¢æˆ<code>\$(squote)</code>ï¼Œè¿™ä¸ªsquoteå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Kbuild.include#L7">Kbuild.include - scripts&#x2F;Kbuild.include - <em>squote</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">squote  := &#x27;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥å°†escsqå±•å¼€å°±æ˜¯ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">escsq = <span class="variable">$(<span class="built_in">subst</span> &#x27;,&#x27;\&#x27;&#x27;,$1)</span></span><br></pre></td></tr></table></figure>

<p>å°±æ˜¯å°†<code>$1</code>ä¸­çš„<code>&#39;</code>æ›¿æ¢æˆ<code>\&#39;</code>ã€‚</p>
<h4 id="1-1-2-echo-why"><a href="#1-1-2-echo-why" class="headerlink" title="1.1.2Â echo-why"></a><font size=3>1.1.2Â echo-why</font></h4><p>å†æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªecho-whyï¼Œå®ƒå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Kbuild.include#L348">Kbuild.include - scripts&#x2F;Kbuild.include - <em>echo-why</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###</span></span><br><span class="line"><span class="comment"># why - tell why a target got built</span></span><br><span class="line"><span class="comment">#       enabled by make V=2</span></span><br><span class="line"><span class="comment">#       Output (listed in the order they are checked):</span></span><br><span class="line"><span class="comment">#          (1) - due to target is PHONY</span></span><br><span class="line"><span class="comment">#          (2) - due to target missing</span></span><br><span class="line"><span class="comment">#          (3) - due to: file1.h file2.h</span></span><br><span class="line"><span class="comment">#          (4) - due to command line change</span></span><br><span class="line"><span class="comment">#          (5) - due to missing .cmd file</span></span><br><span class="line"><span class="comment">#          (6) - due to target not in $(targets)</span></span><br><span class="line"><span class="comment"># (1) PHONY targets are always build</span></span><br><span class="line"><span class="comment"># (2) No target, so we better build it</span></span><br><span class="line"><span class="comment"># (3) Prerequisite is newer than target</span></span><br><span class="line"><span class="comment"># (4) The command line stored in the file named dir/.target.cmd</span></span><br><span class="line"><span class="comment">#     differed from actual command line. This happens when compiler</span></span><br><span class="line"><span class="comment">#     options changes</span></span><br><span class="line"><span class="comment"># (5) No dir/.target.cmd file (used to store command line)</span></span><br><span class="line"><span class="comment"># (6) No dir/.target.cmd file and target not listed in $(targets)</span></span><br><span class="line"><span class="comment">#     This is a good hint that there is a bug in the kbuild file</span></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(KBUILD_VERBOSE)</span>,2)</span><br><span class="line">why =                                                                        \</span><br><span class="line">    <span class="variable">$(<span class="built_in">if</span> $(<span class="built_in">filter</span> <span class="variable">$@</span>, <span class="variable">$(PHONY)</span>)</span>,- due to target is PHONY,                    \</span><br><span class="line">        <span class="variable">$(<span class="built_in">if</span> $(<span class="built_in">wildcard</span> <span class="variable">$@</span>)</span>,                                                 \</span><br><span class="line">            <span class="variable">$(<span class="built_in">if</span> $(<span class="built_in">strip</span> $(any-prereq)</span>),- due to: $(any-prereq),             \</span><br><span class="line">                <span class="variable">$(<span class="built_in">if</span> $(arg-check)</span>,                                           \</span><br><span class="line">                    <span class="variable">$(<span class="built_in">if</span> $(cmd_<span class="variable">$@</span>)</span>,- due to command line change,             \</span><br><span class="line">                        <span class="variable">$(<span class="built_in">if</span> $(<span class="built_in">filter</span> <span class="variable">$@</span>, <span class="variable">$(targets)</span>)</span>,                       \</span><br><span class="line">                            - due to missing .cmd file,                      \</span><br><span class="line">                            - due to <span class="variable">$(<span class="built_in">notdir</span> <span class="variable">$@</span>)</span> not in $<span class="variable">$(targets)</span>         \</span><br><span class="line">                         )                                                   \</span><br><span class="line">                     )                                                       \</span><br><span class="line">                 )                                                           \</span><br><span class="line">             ),                                                              \</span><br><span class="line">             - due to target missing                                         \</span><br><span class="line">         )                                                                   \</span><br><span class="line">     )</span><br><span class="line"></span><br><span class="line">echo-why = <span class="variable">$(<span class="built_in">call</span> escsq, $(<span class="built_in">strip</span> <span class="variable">$(why)</span>)</span>)</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªè¿˜æŒºå¤æ‚çš„ï¼Œä½†æ˜¯æœ€å¼€å§‹æœ‰æ³¨é‡Šï¼Œ<code>enabled by make V=2</code>ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ç›´æ¥å¿½ç•¥ï¼Œä»¥åç”¨åˆ°å†è¯´å§ã€‚</p>
<h4 id="1-1-3-æ€»ç»“"><a href="#1-1-3-æ€»ç»“" class="headerlink" title="1.1.3 æ€»ç»“"></a><font size=3>1.1.3 æ€»ç»“</font></h4><p>æˆ‘ä»¬ç®€åŒ–ä¸€ä¸‹echo-cmdï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo command.</span></span><br><span class="line"><span class="comment"># Short version is used, if $(quiet) equals `quiet_&#x27;, otherwise full one.</span></span><br><span class="line">echo-cmd = <span class="variable">$(<span class="built_in">if</span> $(<span class="variable">$(quiet)</span>cmd_$(1)</span>),\</span><br><span class="line">	echo &#x27;  <span class="variable">$(<span class="built_in">call</span> escsq,$(<span class="variable">$(quiet)</span>cmd_$(1)</span>))&#x27;;)</span><br></pre></td></tr></table></figure>

<p>å…¶å®å°±åªæ˜¯æŠŠecho-whyå»æ‰ã€‚</p>
<h3 id="1-2-cmd-1"><a href="#1-2-cmd-1" class="headerlink" title="1.2 $(cmd_$(1))"></a><font size=3>1.2 <code>$(cmd_$(1))</code></font></h3><p>è¿™ä¸ªå…¶å®æ²¡ä»€ä¹ˆè¯´çš„ï¼Œ<code>$(1)</code>å°±æ˜¯ä¼ å…¥çš„å‚æ•°ï¼Œæ›¿æ¢åå°±æ˜¯ä¸€ä¸ªå˜é‡ã€‚ä¾‹å¦‚<code>$(call cmd,param)</code>ï¼Œè¿™é‡ŒÂ·<code>$(1)</code>&#x3D;paramï¼Œæ‰€ä»¥å°±æ˜¯<code>$(cmd_param)</code>ï¼Œéšåæ‰¾åˆ°cmd_paramå˜é‡å³å¯ã€‚</p>
<h3 id="1-3-cmdåˆ°åº•åœ¨åšä»€ä¹ˆï¼Ÿ"><a href="#1-3-cmdåˆ°åº•åœ¨åšä»€ä¹ˆï¼Ÿ" class="headerlink" title="1.3Â cmdåˆ°åº•åœ¨åšä»€ä¹ˆï¼Ÿ"></a><font size=3>1.3Â cmdåˆ°åº•åœ¨åšä»€ä¹ˆï¼Ÿ</font></h3><p>å‰é¢å¤§æ¦‚åˆ†æäº†ä¸¤ä¸ªå˜é‡ï¼Œè¿™é‡Œæˆ‘ä»¬å†™ä¸€ä¸ªdemoæ¥æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">squote  := &#x27;</span><br><span class="line">quiet   :=</span><br><span class="line"></span><br><span class="line">escsq       = <span class="variable">$(<span class="built_in">subst</span> <span class="variable">$(squote)</span>,&#x27;\<span class="variable">$(squote)</span>&#x27;,$1)</span></span><br><span class="line">echo-cmd    = <span class="variable">$(echo &#x27;  $(<span class="built_in">call</span> escsq,ls)</span>&#x27;;)</span><br><span class="line">cmd_sumucmd = ls</span><br><span class="line"></span><br><span class="line"><span class="comment"># echo command.</span></span><br><span class="line"><span class="comment"># Short version is used, if $(quiet) equals `quiet_&#x27;, otherwise full one.</span></span><br><span class="line">echo-cmd = <span class="variable">$(<span class="built_in">if</span> $(<span class="variable">$(quiet)</span>cmd_$(1)</span>),\</span><br><span class="line">	echo &#x27;  <span class="variable">$(<span class="built_in">call</span> escsq,$(<span class="variable">$(quiet)</span>cmd_$(1)</span>))&#x27;;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># printing commands</span></span><br><span class="line">cmd = @$(echo-cmd) $(cmd_$(1))</span><br><span class="line"></span><br><span class="line"><span class="section">test: FORCE</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> cmd,sumucmd)</span></span><br><span class="line">	$(echo-cmd) pwd</span><br><span class="line"></span><br><span class="line">PHONY+=FORCE</span><br><span class="line"><span class="section">FORCE:</span></span><br><span class="line"></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: $(PHONY)</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åæ‰§è¡Œï¼Œå°±ä¼šå‘ç°ï¼Œ<code>$(echo-cmd)</code>éƒ¨åˆ†è´Ÿè´£æ˜¾ç¤ºå‘½ä»¤ï¼Œ<code>$(cmd_$(1))</code>è´Ÿè´£æ‰§è¡Œå‘½ä»¤ï¼š</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV05-%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F/LV05-03-Kernel-03-02-make-single-module/img/image-20241129000124387.png" alt="image-20241129000124387" />



<h2 id="2-wanringå‡½æ•°"><a href="#2-wanringå‡½æ•°" class="headerlink" title="2. wanringå‡½æ•°"></a><font size=3>2. wanringå‡½æ•°</font></h2><p>æ¥ä¸‹æ¥çœ‹ä¸€ä¸ªmakefileçš„æ§åˆ¶å‡½æ•°ï¼Œwarningï¼Œä¼šæ‰“å°å½“å‰è¡Œå·å’Œè‡ªå®šä¹‰æ–‡æœ¬ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">warning</span> TEXT...)</span></span><br></pre></td></tr></table></figure>

<p>ä¸èƒ½ç›´æ¥ç”¨echoå—ï¼Ÿå½“ç„¶ä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯echoåªèƒ½åœ¨targetï¼šåé¢çš„è¯­å¥ä¸­ä½¿ç”¨ï¼Œä¸”å‰é¢æ˜¯ä¸ªTABã€‚è¿™ä¸ªçš„è¯ï¼Œå°±å“ªé‡Œéƒ½èƒ½ç”¨ã€‚è¿™ä¸ªwarningå‘½ä»¤ä¹Ÿå¯ä»¥æ‰“å°å˜é‡ï¼Œå’Œechoä¸€æ ·ã€‚</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">warning</span> &quot;a=$a&quot;)</span></span><br></pre></td></tr></table></figure>

<h1 id="ä¸‰ã€make-dir-file-ko"><a href="#ä¸‰ã€make-dir-file-ko" class="headerlink" title="ä¸‰ã€makeÂ dir&#x2F;file.ko"></a><font size=3>ä¸‰ã€makeÂ dir&#x2F;file.ko</font></h1><p>æˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹ç¼–è¯‘æŒ‡å®šæ¨¡å—ï¼Œå…ˆä»ç®€å•çš„æ¥ã€‚è¿™é‡Œä»¥å†…æ ¸ä¸­çš„ drivers&#x2F;media&#x2F;i2c&#x2F;ov5640.ko è¿™ä¸ªæ¨¡å—ä¸ºä¾‹ã€‚</p>
<h2 id="1-koç›®æ ‡"><a href="#1-koç›®æ ‡" class="headerlink" title="1.Â %.koç›®æ ‡"></a><font size=3>1.Â %.koç›®æ ‡</font></h2><p>æˆ‘ä»¬ä»æ‰§è¡Œçš„å‘½ä»¤ make dir&#x2F;file.ko ä¸­æ¨æµ‹ï¼Œåœ¨é¡¶å±‚makefileä¸­åº”è¯¥å­˜åœ¨å¯¹åº”çš„ç›®æ ‡ï¼Œæˆ‘ä»¬å»æœä¸€ä¸‹ï¼Œä¼šçœ‹åˆ°è¿™ä¸ªç›®æ ‡ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L1695">Makefile - <em>%ko</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">%.ko: prepare scripts FORCE</span></span><br><span class="line">	<span class="variable">$(cmd_crmodverdir)</span></span><br><span class="line">	<span class="variable">$(Q)</span><span class="variable">$(MAKE)</span> KBUILD_MODULES=<span class="variable">$(<span class="built_in">if</span> <span class="variable">$(CONFIG_MODULES)</span>,1)</span>   \</span><br><span class="line">	<span class="variable">$(build)</span>=$(build-dir) $(@:.ko=.o)</span><br><span class="line">	<span class="variable">$(Q)</span><span class="variable">$(MAKE)</span> -f <span class="variable">$(srctree)</span>/scripts/Makefile.modpost</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ç¼–è¯‘çš„å‘½ä»¤ä¸ºï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make V=1 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- drivers/media/i2c/ov5640.ko -j16</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥è¿™é‡Œçš„<code>%.ko</code>åŒ¹é…çš„å°±æ˜¯drivers&#x2F;media&#x2F;i2c&#x2F;ov5640.koã€‚</p>
<h3 id="1-1-cmd-crmodverdir"><a href="#1-1-cmd-crmodverdir" class="headerlink" title="1.1Â cmd_crmodverdir"></a><font size=3>1.1Â cmd_crmodverdir</font></h3><p>cmd_crmodverdirå®šä¹‰åœ¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L1717">Makefile - <em>cmd_crmodverdir</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create temporary dir for module support files</span></span><br><span class="line"><span class="comment"># clean it up only when building all modules</span></span><br><span class="line">cmd_crmodverdir = <span class="variable">$(Q)</span>mkdir -p <span class="variable">$(MODVERDIR)</span> \</span><br><span class="line">                  <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(KBUILD_MODULES)</span>,; rm -f <span class="variable">$(MODVERDIR)</span>/*)</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå°±ä¸è¯¦ç»†å»æ‰¾å®šä¹‰åœ¨å“ªé‡Œäº†ï¼Œç›´æ¥åœ¨%.koç›®æ ‡çš„è§„åˆ™ä¸­åŠ ç‚¹æ‰“å°ä¿¡æ¯çœ‹ä¸€ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">%.ko: prepare scripts FORCE</span></span><br><span class="line">	echo <span class="string">&quot;MODVERDIR=<span class="variable">$(MODVERDIR)</span> KBUILD_MODULES=<span class="variable">$(KBUILD_MODULES)</span>&quot;</span></span><br><span class="line">	<span class="variable">$(cmd_crmodverdir)</span></span><br><span class="line">	<span class="variable">$(Q)</span><span class="variable">$(MAKE)</span> KBUILD_MODULES=<span class="variable">$(<span class="built_in">if</span> <span class="variable">$(CONFIG_MODULES)</span>,1)</span>   \</span><br><span class="line">	<span class="variable">$(build)</span>=$(build-dir) $(@:.ko=.o)</span><br><span class="line">	<span class="variable">$(Q)</span><span class="variable">$(MAKE)</span> -f <span class="variable">$(srctree)</span>/scripts/Makefile.modpost</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">make V=0 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- distclean</span><br><span class="line">make V=0 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- imx_v6_v7_defconfig</span><br><span class="line">make V=1 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- drivers/media/i2c/ov5640.ko -j16 <span class="comment"># ç¼–è¯‘æŒ‡å®šæ¨¡å—</span></span><br></pre></td></tr></table></figure>

<p>ä¼šçœ‹åˆ°ä»¥ä¸‹æ‰“å°ä¿¡æ¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;MODVERDIR=.tmp_versions KBUILD_MODULES=&quot;</span><br><span class="line">MODVERDIR=.tmp_versions KBUILD_MODULES=</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥cmd_crmodverdirå±•å¼€å°±æ˜¯ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cmd_crmodverdir = <span class="variable">$(Q)</span>mkdir -p .tmp_versions \</span><br><span class="line">                  <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(KBUILD_MODULES)</span>,; rm -f .tmp_versions/*)</span></span><br></pre></td></tr></table></figure>

<p>ifå‡½æ•°çš„ç”¨æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">if</span> CONDITION,THEN-PART[,ELSE-PART])</span></span><br></pre></td></tr></table></figure>

<p>if å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•° CONDITIONè¡¨ç¤ºæ¡ä»¶åˆ¤æ–­ï¼Œå±•å¼€åå¦‚æœéç©ºï¼Œåˆ™æ¡ä»¶ä¸ºçœŸï¼Œæ‰§è¡Œ THEN-PARTéƒ¨åˆ†ï¼›å¦åˆ™ï¼Œå¦‚æœæœ‰ELSE-PARTéƒ¨åˆ†ï¼Œåˆ™æ‰§è¡ŒELSE-PARTéƒ¨åˆ†ã€‚</p>
<p>è¿™é‡Œå› ä¸ºKBUILD_MODULESä¸ºç©ºï¼Œæ‰€ä»¥è¿™é‡Œåº”è¯¥æ‰§è¡ŒELSE-PARTéƒ¨åˆ†ï¼Œä½†æ˜¯å‘½ä»¤ä¸­æ— ELSE-PARTéƒ¨åˆ†ï¼Œæ‰€ä»¥è¿™é‡Œå°±æ²¡æœ‰å†…å®¹äº†ï¼Œæ‰€ä»¥æœ€å </p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd_crmodverdir = <span class="variable">$(Q)</span>mkdir -p .tmp_versions</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå˜é‡æœ€åå°±æ˜¯åœ¨åˆ›å»º.tmp_versionsç›®å½•äº†ã€‚</p>
<h3 id="1-2-KBUILD-MODULES"><a href="#1-2-KBUILD-MODULES" class="headerlink" title="1.2Â KBUILD_MODULES"></a><font size=3>1.2Â KBUILD_MODULES</font></h3><p>æˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹KBUILD_MODULESï¼Œå®ƒçš„å€¼ç”±CONFIG_MODULESå†³å®šï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(Q)</span><span class="variable">$(MAKE)</span> KBUILD_MODULES=<span class="variable">$(<span class="built_in">if</span> <span class="variable">$(CONFIG_MODULES)</span>,1)</span> \</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åœ¨é…ç½®åçš„linuxå†…æ ¸æºç ä¸­æœç´¢ä¸€ä¸‹ï¼Œä¼šåœ¨é¡¶å±‚æºç ç›®å½•ä¸­ç”Ÿæˆçš„.configæ–‡ä»¶ä¸­æˆ–è€…<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/arch/arm/configs/imx_v6_v7_defconfig#L15">imx_v6_v7_defconfig - arch&#x2F;arm&#x2F;configs&#x2F;imx_v6_v7_defconfig - <em>CONFIG_MODULES</em></a>ä¸­çœ‹åˆ°ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CONFIG_MODULES=y</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥KBUILD_MODULES&#x3D;1ã€‚</p>
<h3 id="1-3-buildã€build-dir"><a href="#1-3-buildã€build-dir" class="headerlink" title="1.3Â buildã€build-dir"></a><font size=3>1.3Â buildã€build-dir</font></h3><p>æˆ‘ä»¬å†çœ‹ä¸€ä¸‹è¿™ä¸ªbuildè¿™ä¸€è¡Œï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(build)</span>=$(build-dir) $(@:.ko=.o)</span><br></pre></td></tr></table></figure>

<h4 id="1-3-1-build"><a href="#1-3-1-build" class="headerlink" title="1.3.1Â build"></a><font size=3>1.3.1Â build</font></h4><p>buildå®šä¹‰åœ¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Kbuild.include#L184">Kbuild.include - scripts&#x2F;Kbuild.include - <em>build</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###</span></span><br><span class="line"><span class="comment"># Shorthand for $(Q)$(MAKE) -f scripts/Makefile.build obj=</span></span><br><span class="line"><span class="comment"># Usage:</span></span><br><span class="line"><span class="comment"># $(Q)$(MAKE) $(build)=dir</span></span><br><span class="line">build := -f <span class="variable">$(srctree)</span>/scripts/Makefile.build obj</span><br></pre></td></tr></table></figure>

<h4 id="1-3-2-build-dir"><a href="#1-3-2-build-dir" class="headerlink" title="1.3.2Â build-dir"></a><font size=3>1.3.2Â build-dir</font></h4><p>build-dirå®šä¹‰åœ¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L1656">Makefile - <em>build-dir</em></a></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Single targets are compatible with:</span></span><br><span class="line"><span class="comment"># - build with mixed source and output</span></span><br><span class="line"><span class="comment"># - build with separate output dir &#x27;make O=...&#x27;</span></span><br><span class="line"><span class="comment"># - external modules</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  target-dir =&gt; where to store outputfile</span></span><br><span class="line"><span class="comment">#  build-dir  =&gt; directory in kernel source tree to use</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(KBUILD_EXTMOD)</span>,)</span><br><span class="line">        build-dir  = <span class="variable">$(<span class="built_in">patsubst</span> %/,%,$(<span class="built_in">dir</span> <span class="variable">$@</span>)</span>)</span><br><span class="line">        target-dir = <span class="variable">$(<span class="built_in">dir</span> <span class="variable">$@</span>)</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        zap-slash=<span class="variable">$(<span class="built_in">filter</span>-out .,$(<span class="built_in">patsubst</span> %/,%,$(<span class="built_in">dir</span> <span class="variable">$@</span>)</span>))</span><br><span class="line">        build-dir  = <span class="variable">$(KBUILD_EXTMOD)</span><span class="variable">$(<span class="built_in">if</span> $(zap-slash)</span>,/$(zap-slash))</span><br><span class="line">        target-dir = <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(KBUILD_EXTMOD)</span>,$(<span class="built_in">dir</span> <span class="variable">$&lt;</span>)</span>,<span class="variable">$(<span class="built_in">dir</span> <span class="variable">$@</span>)</span>)</span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°è¿˜æœ‰ä¸ªå˜é‡KBUILD_EXTMODï¼Œå®ƒå®šä¹‰åœ¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L179">Makefile - <em>KBUILD_EXTMOD</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ifdef</span> SUBDIRS</span><br><span class="line">  KBUILD_EXTMOD ?= <span class="variable">$(SUBDIRS)</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="string">&quot;$(origin M)&quot;</span>, <span class="string">&quot;command line&quot;</span>)</span><br><span class="line">  KBUILD_EXTMOD := <span class="variable">$(M)</span></span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p>SUBDIRSæ˜¯æ²¡æœ‰å®šä¹‰çš„ï¼Œæ‰€ä»¥KBUILD_EXTMODçš„å€¼æ¥è‡ªäºå‘½ä»¤è¡Œçš„Må‚æ•°ï¼Œè€Œå‰é¢æˆ‘ä»¬ç¼–è¯‘å•ç‹¬æ¨¡å—çš„æ—¶å€™æ²¡æœ‰Må‚æ•°ï¼Œæ‰€ä»¥è¿™é‡ŒKBUILD_EXTMODä¸ºç©ºã€‚æ‰€ä»¥build-dirå€¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">build-dir  = <span class="variable">$(<span class="built_in">patsubst</span> %/,%,$(<span class="built_in">dir</span> <span class="variable">$@</span>)</span>)</span><br></pre></td></tr></table></figure>

<p><code>$@</code>å°±æ˜¯ç›®æ ‡ï¼Œå°±æ˜¯å‰é¢çš„<code>%.ko</code>ï¼Œæ ¹æ®ç¼–è¯‘å‘½ä»¤ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make V=1 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- drivers/media/i2c/ov5640.ko -j16</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬çŸ¥é“<code>$@</code>&#x3D;drivers&#x2F;media&#x2F;i2c&#x2F;ov5640.koã€‚æ‰€ä»¥æœ‰ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">build-dir  = <span class="variable">$(<span class="built_in">patsubst</span> %/,%,$(<span class="built_in">dir</span> drivers/media/i2c/ov5640.ko)</span>)</span><br></pre></td></tr></table></figure>

<p>dirå‡½æ•°çš„åŠŸèƒ½æ˜¯ä»æ–‡ä»¶ååºåˆ— names ä¸­å–å‡ºç›®å½•éƒ¨åˆ†ï¼Œå¦‚æœnames ä¸­æ²¡æœ‰ &#x2F; ï¼Œå–å‡ºçš„å€¼ä¸º .&#x2F; ã€‚è¿”å›å€¼ä¸ºç›®å½•éƒ¨åˆ†ï¼ŒæŒ‡çš„æ˜¯æœ€åä¸€ä¸ªåæ–œæ ä¹‹å‰çš„éƒ¨åˆ†ã€‚å¦‚æœæ²¡æœ‰åæ–œæ å°†è¿”å› .&#x2F;ã€‚æ‰€ä»¥æˆ‘ä»¬å–æ¶ˆdirå‡½æ•°ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">build-dir  = <span class="variable">$(<span class="built_in">patsubst</span> %/,%,drivers/media/i2c/)</span></span><br></pre></td></tr></table></figure>

<p>patsubstå‡½æ•°ç”¨æ³•ä¸ºï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">patsubst</span> pattern,replacement,text)</span></span><br></pre></td></tr></table></figure>

<p><code>pattern</code>ï¼šè¦åŒ¹é…çš„æ¨¡å¼ã€‚<code>replacement</code>ï¼šæ›¿æ¢åçš„å­—ç¬¦ä¸²ã€‚<code>text</code>ï¼šè¦è¿›è¡Œæ¨¡å¼æ›¿æ¢çš„æ–‡æœ¬ã€‚æ‰€ä»¥è¿™é‡Œæœ€åçš„ç»“æœæ˜¯ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">build-dir  = drivers/media/i2c</span><br></pre></td></tr></table></figure>

<h4 id="1-3-3-ko-o"><a href="#1-3-3-ko-o" class="headerlink" title="1.3.3 $(@:.ko=.o)"></a><font size=3>1.3.3 <code>$(@:.ko=.o)</code></font></h4><p><code>$(@:.ko=.o)</code>æ˜¯æ˜¯ Makefile ä¸­çš„ä¸€ä¸ªå˜é‡æ›¿æ¢è¯­æ³•ï¼Œç”¨äºå°†ç›®æ ‡æ–‡ä»¶ä¸­çš„åç¼€ <code>.ko</code> æ›¿æ¢ä¸º <code>.o</code>ã€‚å‰é¢æˆ‘ä»¬çŸ¥é“<code>$@</code>&#x3D;drivers&#x2F;media&#x2F;i2c&#x2F;ov5640.koï¼Œæ‰€ä»¥è¿™é‡Œå°±æ˜¯ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">$(drivers/media/i2c/ov5640.ko:.ko=.o)</span></span><br></pre></td></tr></table></figure>

<p>æ›¿æ¢åå°±æ˜¯ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drivers/media/i2c/ov5640.o</span><br></pre></td></tr></table></figure>

<h4 id="1-3-4-å‘½ä»¤å±•å¼€"><a href="#1-3-4-å‘½ä»¤å±•å¼€" class="headerlink" title="1.3.4 å‘½ä»¤å±•å¼€"></a><font size=3>1.3.4 å‘½ä»¤å±•å¼€</font></h4><p>æˆ‘ä»¬å·²ç»åˆ†æäº†æ¯ä¸€ä¸ªå˜é‡ï¼Œè¿™é‡Œè¿™æ¡å‘½ä»¤ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(build)</span>=$(build-dir) $(@:.ko=.o)</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å±•å¼€å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-f <span class="variable">$(srctree)</span>/scripts/Makefile.build obj=drivers/media/i2c drivers/media/i2c/ov5640.o</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå…¶å®æ˜¯åŠå¥ï¼Œå…¶å®å’Œå‰é¢çš„KBUILD_MODULESåŠ åœ¨ä¸€èµ·æ‰æ˜¯ä¸€æ¡å®Œæ•´å‘½ä»¤ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(Q)</span><span class="variable">$(MAKE)</span> KBUILD_MODULES=<span class="variable">$(<span class="built_in">if</span> <span class="variable">$(CONFIG_MODULES)</span>,1)</span>   \</span><br><span class="line"><span class="variable">$(build)</span>=$(build-dir) $(@:.ko=.o)</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¸€èµ·å±•å¼€ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@make KBUILD_MODULES=1 -f <span class="variable">$(srctree)</span>/scripts/Makefile.build obj=drivers/media/i2c drivers/media/i2c/ov5640.o</span><br></pre></td></tr></table></figure>

<h3 id="1-4-koè§„åˆ™å±•å¼€"><a href="#1-4-koè§„åˆ™å±•å¼€" class="headerlink" title="1.4 %.koè§„åˆ™å±•å¼€"></a><font size=3>1.4 %.koè§„åˆ™å±•å¼€</font></h3><p>ä¸Šé¢æˆ‘ä»¬å¯¹æ¯ä¸€éƒ¨åˆ†è¿›è¡Œäº†åˆ†æï¼Œæˆ‘ä»¬æ¥å±•å¼€ä¸€ä¸‹<code>%.ko</code>çš„è§„åˆ™ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">%.ko: prepare scripts FORCE</span></span><br><span class="line">	<span class="variable">$(cmd_crmodverdir)</span></span><br><span class="line">	<span class="variable">$(Q)</span><span class="variable">$(MAKE)</span> KBUILD_MODULES=<span class="variable">$(<span class="built_in">if</span> <span class="variable">$(CONFIG_MODULES)</span>,1)</span>   \</span><br><span class="line">	<span class="variable">$(build)</span>=$(build-dir) $(@:.ko=.o)</span><br><span class="line">	<span class="variable">$(Q)</span><span class="variable">$(MAKE)</span> -f <span class="variable">$(srctree)</span>/scripts/Makefile.modpost</span><br></pre></td></tr></table></figure>

<p>å±•å¼€åä¸ºï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">drivers/media/i2c/ov5640.ko: prepare scripts FORCE</span></span><br><span class="line">	<span class="variable">$(Q)</span>mkdir -p .tmp_versions</span><br><span class="line">	<span class="variable">$(Q)</span>make KBUILD_MODULES=1 -f <span class="variable">$(srctree)</span>/scripts/Makefile.build obj=drivers/media/i2c drivers/media/i2c/ov5640.o</span><br><span class="line">	<span class="variable">$(Q)</span>make -f <span class="variable">$(srctree)</span>/scripts/Makefile.modpost</span><br></pre></td></tr></table></figure>

<p>srctreeè¿™ä¸ªå€¼ä¸º<code>.</code>ï¼Œå®šä¹‰åœ¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L190">Makefile - <em>srctree</em></a></p>
<h2 id="2-Makefile-build"><a href="#2-Makefile-build" class="headerlink" title="2.Â Makefile.build "></a><font size=3>2.Â Makefile.build </font></h2><p>ä¸Šé¢å·²ç»æŠŠ<code>%.ko</code>ç›®æ ‡å±•å¼€äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥åˆ†æè¿™ä¸ªå‘½ä»¤ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(Q)</span>make KBUILD_MODULES=1 -f ./scripts/Makefile.build obj=drivers/media/i2c drivers/media/i2c/ov5640.o</span><br></pre></td></tr></table></figure>

<p><code>make -f</code> å‘½ä»¤ç”¨äºæŒ‡å®š Makefile æ–‡ä»¶çš„åç§°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>make</code> ä¼šæŸ¥æ‰¾åä¸º <code>Makefile</code> æˆ– <code>makefile</code> çš„æ–‡ä»¶ã€‚é¡¹ç›®ä¸­ä½¿ç”¨äº†ä¸åŒçš„æ–‡ä»¶åï¼Œå¯ä»¥é€šè¿‡ <code>-f</code> é€‰é¡¹æ¥æŒ‡å®šã€‚æ‰€ä»¥è¿™é‡Œï¼Œå¾ˆæ˜¾ç„¶ï¼Œå°±æ˜¯æŒ‡å®šmakeå‘½ä»¤ä½¿ç”¨çš„æ–‡ä»¶ä¸ºMakefile.buildã€‚</p>
<p>è¿™ä¸ªå‘½ä»¤ä¼ å…¥KBUILD_MODULESå’Œobjå‚æ•°ã€‚å¹¶ä¸”æŒ‡å®šäº†ç›®æ ‡ä¸ºdrivers&#x2F;media&#x2F;i2c&#x2F;ov5640.oã€‚</p>
<h3 id="2-1-objä¸src"><a href="#2-1-objä¸src" class="headerlink" title="2.1 objä¸src"></a><font size=3>2.1 objä¸src</font></h3><p>å…ˆæ¥çœ‹ä¸¤ä¸ªå˜é‡objå’Œsrcï¼Œè¿™ä¸ªobjæ˜¯è°ƒç”¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L6">Makefile.build - scripts&#x2F;Makefile.build</a>æ–‡ä»¶çš„æ—¶å€™ä¼ è¿›æ¥çš„ï¼Œsrcå®šä¹‰åœ¨ï¼š<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L6">Makefile.build - scripts&#x2F;Makefile.build - <em>src</em></a></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">src := <span class="variable">$(obj)</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°å…¶å®srcå’Œobjæ˜¯ç›¸ç­‰çš„ã€‚</p>
<h3 id="2-2-obj-oç›®æ ‡"><a href="#2-2-obj-oç›®æ ‡" class="headerlink" title="2.2 $(obj)/%.oç›®æ ‡"></a><font size=3>2.2 <code>$(obj)/%.o</code>ç›®æ ‡</font></h3><h4 id="2-2-1-åŒ¹é…å“ªä¸€ä¸ªç›®æ ‡ï¼Ÿ"><a href="#2-2-1-åŒ¹é…å“ªä¸€ä¸ªç›®æ ‡ï¼Ÿ" class="headerlink" title="2.2.1 åŒ¹é…å“ªä¸€ä¸ªç›®æ ‡ï¼Ÿ"></a><font size=3>2.2.1 åŒ¹é…å“ªä¸€ä¸ªç›®æ ‡ï¼Ÿ</font></h4><p><code>$(obj)/%.o</code>è¿™ä¸ªç›®æ ‡åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build">Makefile.build - scripts&#x2F;Makefile.build</a>æ–‡ä»¶ä¸­æœ‰ä¸‰å¤„å®šä¹‰ï¼š</p>
<ul>
<li>ï¼ˆ1ï¼‰<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L302">Makefile.build - scripts&#x2F;Makefile.build - <em><code>$(obj)/%.o</code></em></a>ï¼š</li>
</ul>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Built-in and composite module parts</span></span><br><span class="line"><span class="variable">$(obj)</span>/%.o: <span class="variable">$(src)</span>/%.c <span class="variable">$(recordmcount_source)</span> <span class="variable">$(objtool_dep)</span> FORCE</span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> cmd,force_checksrc)</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> if_changed_rule,cc_o_c)</span></span><br></pre></td></tr></table></figure>

<ul>
<li>ï¼ˆ2ï¼‰<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L308">Makefile.build - scripts&#x2F;Makefile.build -  <em><code>$(single-used-m): $(obj)/%.o</code></em></a></li>
</ul>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Single-part modules are special since we need to mark them in $(MODVERDIR)</span></span><br><span class="line"></span><br><span class="line"><span class="section">$(single-used-m): <span class="variable">$(obj)</span>/%.o: <span class="variable">$(src)</span>/%.c <span class="variable">$(recordmcount_source)</span> <span class="variable">$(objtool_dep)</span> FORCE</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> cmd,force_checksrc)</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> if_changed_rule,cc_o_c)</span></span><br><span class="line">	@&#123; echo $(@:.o=.ko); echo <span class="variable">$@</span>; \</span><br><span class="line">	   <span class="variable">$(cmd_undef_syms)</span>; &#125; &gt; <span class="variable">$(MODVERDIR)</span>/$(@F:.o=.mod)</span><br></pre></td></tr></table></figure>

<ul>
<li>ï¼ˆ3ï¼‰<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L402">Makefile.build - scripts&#x2F;Makefile.build -  <em><code>$(obj)/%.o</code></em></a></li>
</ul>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(obj)</span>/%.o: <span class="variable">$(src)</span>/%.S <span class="variable">$(objtool_dep)</span> FORCE</span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> if_changed_rule,as_o_S)</span></span><br></pre></td></tr></table></figure>

<p>é‚£æˆ‘ä»¬ä½¿ç”¨çš„è¿™ä¸ªç¼–è¯‘å‘½ä»¤ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make V=1 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- drivers/media/i2c/ov5640.ko -j16</span><br></pre></td></tr></table></figure>

<p>åˆ°åº•åŒ¹é…çš„å“ªä¸ªå“ªä¸ªç›®æ ‡ï¼Ÿæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ˆ3ï¼‰è¿™ä¸ªå…¶å®æ˜¯è·Ÿæ±‡ç¼–æ–‡ä»¶ç›¸å…³çš„ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/drivers/media/i2c">i2c - drivers&#x2F;media&#x2F;i2c</a> è¿™ä¸ªç›®å½•ä¸‹ï¼Œå…¶å®æ˜¯æ²¡æœ‰æ±‡ç¼–æ–‡ä»¶çš„ï¼Œæ‰€ä»¥è¿˜æ˜¯åŒ¹é…çš„ä¸Šé¢.cç›¸å…³çš„è§„åˆ™ã€‚è¿˜æ˜¯åœ¨ï¼ˆ1ï¼‰å’Œï¼ˆ2ï¼‰ä¸­ï¼Œé‚£æ˜¯å“ªä¸ªï¼Ÿå…ˆçœ‹ä¸€ä¸‹è¿™ä¸ªsingle-used-mï¼Œå®ƒæ˜¯å®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.lib#L48">Makefile.lib - scripts&#x2F;Makefile.lib - <em>single-used-m</em></a>ï¼Œè¿™ä¸ªæ–‡ä»¶åœ¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L54">Makefile.build - scripts&#x2F;Makefile.build</a> æ–‡ä»¶ä¸­è¢«è°ƒç”¨ã€‚å…·ä½“æ˜¯ä»€ä¹ˆï¼Œè¿™é‡Œå°±æš‚æ—¶å…ˆä¸æ·±å…¥å»è¿½äº†ã€‚ç›´æ¥åŠ æ‰“å°ä¿¡æ¯å§ï¼Œä¸¤ä¸ªä½ç½®éƒ½åŠ ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Built-in and composite module parts</span></span><br><span class="line"><span class="variable">$(obj)</span>/%.o: <span class="variable">$(src)</span>/%.c <span class="variable">$(recordmcount_source)</span> <span class="variable">$(objtool_dep)</span> FORCE</span><br><span class="line">	echo <span class="string">&quot;info(1) obj=<span class="variable">$(obj)</span> src=<span class="variable">$(src)</span> <span class="variable">$@</span> <span class="variable">$&lt;</span>&quot;</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> cmd,force_checksrc)</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> if_changed_rule,cc_o_c)</span></span><br><span class="line">	</span><br><span class="line"><span class="comment"># ......</span></span><br><span class="line"></span><br><span class="line"><span class="section">$(single-used-m): <span class="variable">$(obj)</span>/%.o: <span class="variable">$(src)</span>/%.c <span class="variable">$(recordmcount_source)</span> <span class="variable">$(objtool_dep)</span> FORCE</span></span><br><span class="line">	echo <span class="string">&quot;info(2) single-used-m=$(single-used-m) obj=<span class="variable">$(obj)</span> src=<span class="variable">$(src)</span> <span class="variable">$@</span> <span class="variable">$&lt;</span>&quot;</span>	</span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> cmd,force_checksrc)</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> if_changed_rule,cc_o_c)</span></span><br><span class="line">	@&#123; echo $(@:.o=.ko); echo <span class="variable">$@</span>; \</span><br><span class="line">	   <span class="variable">$(cmd_undef_syms)</span>; &#125; &gt; <span class="variable">$(MODVERDIR)</span>/$(@F:.o=.mod)</span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬æ‰§è¡Œï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">make V=0 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- distclean</span><br><span class="line">make V=0 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- imx_v6_v7_defconfig</span><br><span class="line">make V=1 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- drivers/media/i2c/ov5640.ko -j16 <span class="comment"># ç¼–è¯‘æŒ‡å®šæ¨¡å—</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°æœ‰ä»¥ä¸‹æ‰“å°ä¿¡æ¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;info(1) obj=scripts/mod src=scripts/mod scripts/mod/empty.o scripts/mod/empty.c&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">......</span></span><br><span class="line">info(1) obj=scripts/mod src=scripts/mod scripts/mod/empty.o scripts/mod/empty.c</span><br><span class="line"></span><br><span class="line">mkdir -p .tmp_versions</span><br><span class="line">make KBUILD_MODULES=1   \</span><br><span class="line">-f ./scripts/Makefile.build obj=drivers/media/i2c drivers/media/i2c/ov5640.o</span><br><span class="line">echo &quot;info(2) single-used-m=drivers/media/i2c/adv7180.o drivers/media/i2c/ov5640.o obj=drivers/media/i2c src=drivers/media/i2c drivers/media/i2c/ov5640.o drivers/media/i2c/ov5640.c&quot;</span><br><span class="line">info(2) single-used-m=drivers/media/i2c/adv7180.o drivers/media/i2c/ov5640.o obj=drivers/media/i2c src=drivers/media/i2c drivers/media/i2c/ov5640.o drivers/media/i2c/ov5640.c</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥è¿™é‡Œå…¶å®ä¸¤ä¸ªåœ°æ–¹éƒ½ç”¨çš„åˆ°äº†ï¼Œä½†æ˜¯å®Œæˆov5640.cæ–‡ä»¶ç¼–è¯‘çš„ç›®æ ‡å…¶å®æ˜¯ï¼ˆ2ï¼‰ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Single-part modules are special since we need to mark them in $(MODVERDIR)</span></span><br><span class="line"></span><br><span class="line"><span class="section">$(single-used-m): <span class="variable">$(obj)</span>/%.o: <span class="variable">$(src)</span>/%.c <span class="variable">$(recordmcount_source)</span> <span class="variable">$(objtool_dep)</span> FORCE</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> cmd,force_checksrc)</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> if_changed_rule,cc_o_c)</span></span><br><span class="line">	@&#123; echo $(@:.o=.ko); echo <span class="variable">$@</span>; \</span><br><span class="line">	   <span class="variable">$(cmd_undef_syms)</span>; &#125; &gt; <span class="variable">$(MODVERDIR)</span>/$(@F:.o=.mod)</span><br></pre></td></tr></table></figure>

<h4 id="2-2-2-call-cmd-force-checksrc"><a href="#2-2-2-call-cmd-force-checksrc" class="headerlink" title="2.2.2 $(call cmd,force_checksrc)"></a><font size=3>2.2.2 <code>$(call cmd,force_checksrc)</code></font></h4><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹è¿™ä¸ªå‘½ä»¤ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">call</span> cmd,force_checksrc)</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå…¶å®åº”è¯¥å¾ˆç†Ÿæ‚‰äº†ï¼Œcmdå‡½æ•°å®šä¹‰åœ¨ï¼š<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Kbuild.include#L224">Kbuild.include - scripts&#x2F;Kbuild.include - <em>cmd</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo command.</span></span><br><span class="line"><span class="comment"># Short version is used, if $(quiet) equals `quiet_&#x27;, otherwise full one.</span></span><br><span class="line">echo-cmd = <span class="variable">$(<span class="built_in">if</span> $(<span class="variable">$(quiet)</span>cmd_$(1)</span>),\</span><br><span class="line">	echo &#x27;  <span class="variable">$(<span class="built_in">call</span> escsq,$(<span class="variable">$(quiet)</span>cmd_$(1)</span>))$(echo-why)&#x27;;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># printing commands</span></span><br><span class="line">cmd = @$(echo-cmd) $(cmd_$(1))</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥çœ‹<code>$(cmd_$(1))</code>å§ï¼Œè¿™ä¸ª<code>$(1)</code>&#x3D;force_checksrcï¼Œæ‰€ä»¥è¿™é‡Œå…¶å®è°ƒç”¨çš„å°±æ˜¯cmd_force_checksrcï¼Œå®ƒå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L85">Makefile.build - scripts&#x2F;Makefile.build - <em>cmd_force_checksrc</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Linus&#x27; kernel sanity checking tool</span></span><br><span class="line"><span class="keyword">ifneq</span> (<span class="variable">$(KBUILD_CHECKSRC)</span>,0)</span><br><span class="line">  <span class="keyword">ifeq</span> (<span class="variable">$(KBUILD_CHECKSRC)</span>,2)</span><br><span class="line">    quiet_cmd_force_checksrc = CHECK   <span class="variable">$&lt;</span></span><br><span class="line">          cmd_force_checksrc = <span class="variable">$(CHECK)</span> <span class="variable">$(CHECKFLAGS)</span> <span class="variable">$(c_flags)</span> <span class="variable">$&lt;</span> ;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">      quiet_cmd_checksrc     = CHECK   <span class="variable">$&lt;</span></span><br><span class="line">            cmd_checksrc     = <span class="variable">$(CHECK)</span> <span class="variable">$(CHECKFLAGS)</span> <span class="variable">$(c_flags)</span> <span class="variable">$&lt;</span> ;</span><br><span class="line">  <span class="keyword">endif</span></span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p>KBUILD_CHECKSRCå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L162">Makefile - <em>KBUILD_CHECKSRC</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Call a source code checker (by default, &quot;sparse&quot;) as part of the</span></span><br><span class="line"><span class="comment"># C compilation.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Use &#x27;make C=1&#x27; to enable checking of only re-compiled files.</span></span><br><span class="line"><span class="comment"># Use &#x27;make C=2&#x27; to enable checking of *all* source files, regardless</span></span><br><span class="line"><span class="comment"># of whether they are re-compiled or not.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># See the file &quot;Documentation/dev-tools/sparse.rst&quot; for more details,</span></span><br><span class="line"><span class="comment"># including where to get the &quot;sparse&quot; utility.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="string">&quot;$(origin C)&quot;</span>, <span class="string">&quot;command line&quot;</span>)</span><br><span class="line">  KBUILD_CHECKSRC = <span class="variable">$(C)</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"><span class="keyword">ifndef</span> KBUILD_CHECKSRC</span><br><span class="line">  KBUILD_CHECKSRC = 0</span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå…¶å®å°±æ˜¯ä»£ç æ£€æŸ¥ï¼Œç”±äºæˆ‘ä»¬æ²¡æœ‰ä¼ å…¥Cå‚æ•°ï¼ˆæ³¨æ„è¿™é‡Œçš„Cå’Œ-Cæ˜¯ä¸ä¸€æ ·çš„å«ä¹‰ï¼Œè¿™é‡ŒCä¸ºå˜é‡åï¼Œæ˜¯è¦èµ‹å€¼çš„ï¼Œ-Cæ˜¯æŒ‡å®šä¸€ä¸ªæºç ç›®å½•ï¼Œä¸ä¸€æ ·çš„ï¼‰ï¼Œå°±æ²¡æœ‰å®šä¹‰KBUILD_CHECKSRCï¼Œè¿™é‡Œçš„KBUILD_CHECKSRCå°±æ˜¯0ï¼Œæ‰€ä»¥cmd_force_checksrcå°±ä¸ºç©ºã€‚</p>
<h4 id="2-2-3-call-if-changed-rule-cc-o-c"><a href="#2-2-3-call-if-changed-rule-cc-o-c" class="headerlink" title="2.2.3 $(call if_changed_rule,cc_o_c)"></a><font size=3>2.2.3 <code>$(call if_changed_rule,cc_o_c)</code></font></h4><p>if_changed_ruleå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Kbuild.include#L304">Kbuild.include - scripts&#x2F;Kbuild.include - <em>if_changed_rule</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Usage: $(call if_changed_rule,foo)</span></span><br><span class="line"><span class="comment"># Will check if $(cmd_foo) or any of the prerequisites changed,</span></span><br><span class="line"><span class="comment"># and if so will execute $(rule_foo).</span></span><br><span class="line">if_changed_rule = <span class="variable">$(<span class="built_in">if</span> $(<span class="built_in">strip</span> $(any-prereq)</span> $(arg-check) ),                 \</span><br><span class="line">	@set -e;                                                             \</span><br><span class="line">	$(rule_$(1)), @:)</span><br></pre></td></tr></table></figure>

<p><code>set -e</code> æ˜¯ä¸€ä¸ªåœ¨ shell è„šæœ¬ä¸­å¸¸ç”¨çš„å‘½ä»¤ï¼Œç”¨äºåœ¨è„šæœ¬ä¸­å¯ç”¨â€œé‡åˆ°é”™è¯¯å³é€€å‡ºâ€çš„è¡Œä¸ºã€‚å…·ä½“æ¥è¯´ï¼Œå½“è„šæœ¬ä¸­çš„ä»»ä½•å‘½ä»¤è¿”å›éé›¶çŠ¶æ€æ—¶ï¼Œè„šæœ¬ä¼šç«‹å³ç»ˆæ­¢æ‰§è¡Œã€‚</p>
<p>stripå‡½æ•°æ˜¯å»æ‰å˜é‡å€¼ä¸¤ç«¯çš„ç©ºç™½å­—ç¬¦ï¼ˆç©ºæ ¼å’Œåˆ¶è¡¨ç¬¦ï¼‰ï¼Œifæ˜¯åˆ¤æ–­åé¢å»æ‰ç©ºç™½å­—ç¬¦çš„å˜é‡å€¼æ˜¯å¦ä¸ºç©ºï¼Œå½“any-prereqå’Œarg-checkæœ‰ä¸€ä¸ªéç©ºï¼Œifå°±æˆç«‹ï¼Œå°±æ‰§è¡Œ<code>$(rule_$(1))</code>ã€‚å¦åˆ™å°±æ‰§è¡Œ<code>@:</code>ï¼Œåœ¨shellä¸­<code>:</code>æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å‘½ä»¤ï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªå†…å»ºå‘½ä»¤ï¼Œç”¨äºæ‰§è¡Œç©ºæ“ä½œã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬ç¬¬ä¸€æ¬¡ç¼–è¯‘çš„æ—¶å€™any-prereqå’Œarg-checkè‚¯å®šè‡³å°‘æœ‰ä¸€ä¸ªéç©ºï¼Œè¿™ä¸¤ä¸ªå˜é‡å°±ä¸å¤šäº†è§£äº†ï¼Œä¸»è¦åé¢çœ‹æ‰§è¡Œçš„<code>$(rule_$(1))</code>ã€‚</p>
<h5 id="2-2-3-1-any-prereq"><a href="#2-2-3-1-any-prereq" class="headerlink" title="2.2.3.1Â any-prereq"></a><font size=3>2.2.3.1Â any-prereq</font></h5><p>any-prereqå®šä¹‰åœ¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Kbuild.include#L256">Kbuild.include - scripts&#x2F;Kbuild.include - <em>any-prereq</em></a></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Find any prerequisites that is newer than target or that does not exist.</span></span><br><span class="line"><span class="comment"># PHONY targets skipped in both cases.</span></span><br><span class="line">any-prereq = <span class="variable">$(<span class="built_in">filter</span>-out <span class="variable">$(PHONY)</span>,<span class="variable">$?</span>)</span> <span class="variable">$(<span class="built_in">filter</span>-out <span class="variable">$(PHONY)</span> $(<span class="built_in">wildcard</span> <span class="variable">$^</span>)</span>,<span class="variable">$^</span>)</span><br></pre></td></tr></table></figure>

<h5 id="2-2-3-2-arg-check"><a href="#2-2-3-2-arg-check" class="headerlink" title="2.2.3.2Â arg-check"></a><font size=3>2.2.3.2Â arg-check</font></h5><p>arg-checkå®šä¹‰åœ¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Kbuild.include#L238">Kbuild.include - scripts&#x2F;Kbuild.include - <em>arg-check</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ifneq</span> (<span class="variable">$(KBUILD_NOCMDDEP)</span>,1)</span><br><span class="line"><span class="comment"># Check if both arguments are the same including their order. Result is empty</span></span><br><span class="line"><span class="comment"># string if equal. User may override this check using make KBUILD_NOCMDDEP=1</span></span><br><span class="line">arg-check = <span class="variable">$(<span class="built_in">filter</span>-out $(<span class="built_in">subst</span> <span class="variable">$(space)</span>,<span class="variable">$(space_escape)</span>,$(<span class="built_in">strip</span> $(cmd_<span class="variable">$@</span>)</span>)), \</span><br><span class="line">                         <span class="variable">$(<span class="built_in">subst</span> <span class="variable">$(space)</span>,<span class="variable">$(space_escape)</span>,$(<span class="built_in">strip</span> $(cmd_$1)</span>)))</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">arg-check = <span class="variable">$(<span class="built_in">if</span> $(<span class="built_in">strip</span> $(cmd_<span class="variable">$@</span>)</span>),,1)</span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<h5 id="2-2-3-3-rule-1"><a href="#2-2-3-3-rule-1" class="headerlink" title="2.2.3.3 $(rule_$(1))"></a><font size=3>2.2.3.3 <code>$(rule_$(1))</code></font></h5><p><code>$(1)</code>å°±æ˜¯cc_o_cï¼Œæ‰€ä»¥è¿™é‡Œå±•å¼€å°±æ˜¯ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(rule_$(1)) = <span class="variable">$(rule_cc_o_c)</span></span><br></pre></td></tr></table></figure>

<p>rule_cc_o_cå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L279">Makefile.build - scripts&#x2F;Makefile.build - <em>rule_cc_o_c</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">define</span> rule_cc_o_c</span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> echo-cmd,checksrc)</span> <span class="variable">$(cmd_checksrc)</span>			  \</span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> cmd_and_fixdep,cc_o_c)</span>					  \</span><br><span class="line">	<span class="variable">$(cmd_checkdoc)</span>							  \</span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> echo-cmd,objtool)</span> <span class="variable">$(cmd_objtool)</span>				  \</span><br><span class="line">	<span class="variable">$(cmd_modversions_c)</span>						  \</span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> echo-cmd,record_mcount)</span> <span class="variable">$(cmd_record_mcount)</span></span><br><span class="line"><span class="keyword">endef</span></span><br></pre></td></tr></table></figure>

<p>å…¶å®åˆ°è¿™é‡Œï¼Œ<code>$(obj)/%.o</code>ç›®æ ‡çš„è§„åˆ™å°±å±•å¼€åŸºæœ¬ç»“æŸäº†ã€‚æˆ‘ä»¬åé¢ç»§ç»­æ·±å…¥è¿™ä¸ªrule_cc_o_cã€‚</p>
<h2 id="3-rule-cc-o-cå‡½æ•°"><a href="#3-rule-cc-o-cå‡½æ•°" class="headerlink" title="3.Â rule_cc_o_cå‡½æ•°"></a><font size=3>3.Â rule_cc_o_cå‡½æ•°</font></h2><p>ä¸ºä»€ä¹ˆå•ç‹¬å†™å‘¢ï¼Ÿå› ä¸ºæ ‡é¢˜åµŒå¥—å¤ªæ·±å•¦ï¼Œå“ˆå“ˆå“ˆã€‚è¿™é‡Œæˆ‘ä»¬è¯¦ç»†å†æŠŠè¿™ä¸ªrule_cc_o_cåˆ†æä¸€ä¸‹ã€‚è¿™ä¸ªrule_cc_o_cï¼Œå‰é¢å·²ç»æ‰¾åˆ°å®ƒå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L279">Makefile.build - scripts&#x2F;Makefile.build - <em>rule_cc_o_c</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">define</span> rule_cc_o_c</span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> echo-cmd,checksrc)</span> <span class="variable">$(cmd_checksrc)</span>			  \</span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> cmd_and_fixdep,cc_o_c)</span>					  \</span><br><span class="line">	<span class="variable">$(cmd_checkdoc)</span>							  \</span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> echo-cmd,objtool)</span> <span class="variable">$(cmd_objtool)</span>				  \</span><br><span class="line">	<span class="variable">$(cmd_modversions_c)</span>						  \</span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> echo-cmd,record_mcount)</span> <span class="variable">$(cmd_record_mcount)</span></span><br><span class="line"><span class="keyword">endef</span></span><br></pre></td></tr></table></figure>

<h3 id="3-1-checksrc"><a href="#3-1-checksrc" class="headerlink" title="3.1Â checksrc"></a><font size=3>3.1Â checksrc</font></h3><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸€è¡Œ<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L280">Makefile.build - scripts&#x2F;Makefile.build </a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">call</span> echo-cmd,checksrc)</span> <span class="variable">$(cmd_checksrc)</span></span><br></pre></td></tr></table></figure>

<h4 id="3-1-1-cmd-checksrc"><a href="#3-1-1-cmd-checksrc" class="headerlink" title="3.1.1 $(cmd_checksrc)"></a><font size=3>3.1.1 <code>$(cmd_checksrc)</code></font></h4><p>å…ˆçœ‹è¿™ä¸ªcmd_checksrcï¼Œå®ƒå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L91">Makefile.build - scripts&#x2F;Makefile.build - <em>cmd_checksrc</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Linus&#x27; kernel sanity checking tool</span></span><br><span class="line"><span class="keyword">ifneq</span> (<span class="variable">$(KBUILD_CHECKSRC)</span>,0)</span><br><span class="line">  <span class="keyword">ifeq</span> (<span class="variable">$(KBUILD_CHECKSRC)</span>,2)</span><br><span class="line">    quiet_cmd_force_checksrc = CHECK   <span class="variable">$&lt;</span></span><br><span class="line">          cmd_force_checksrc = <span class="variable">$(CHECK)</span> <span class="variable">$(CHECKFLAGS)</span> <span class="variable">$(c_flags)</span> <span class="variable">$&lt;</span> ;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">      quiet_cmd_checksrc     = CHECK   <span class="variable">$&lt;</span></span><br><span class="line">            cmd_checksrc     = <span class="variable">$(CHECK)</span> <span class="variable">$(CHECKFLAGS)</span> <span class="variable">$(c_flags)</span> <span class="variable">$&lt;</span> ;</span><br><span class="line">  <span class="keyword">endif</span></span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p>ä¼šå‘ç°ï¼Œè¿™é‡Œå…¶å®å’Œæˆ‘ä»¬åˆ†æçš„ äºŒã€make dir&#x2F;file.koè¿™ä¸€èŠ‚ä¸­çš„2.2.2 <code>$(call cmd,force_checksrc)</code>è¿™éƒ¨åˆ†é€»è¾‘ä¸€æ ·çš„ï¼Œå–å†³äºKBUILD_CHECKSRCçš„å€¼ï¼Œæˆ‘ä»¬å‰é¢åˆ†æäº†ï¼Œä½¿ç”¨make C&#x3D;2è¿™æ ·çš„å‘½ä»¤è¿™é‡Œæ‰ä¼šæœ‰å®šä¹‰ï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿæ˜¯ä¸ºç©ºã€‚</p>
<h4 id="3-1-2-call-echo-cmd-checksrc"><a href="#3-1-2-call-echo-cmd-checksrc" class="headerlink" title="3.1.2 $(call echo-cmd,checksrc)"></a><font size=3>3.1.2 <code>$(call echo-cmd,checksrc)</code></font></h4><p>echo-cmdå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Kbuild.include#L220">Kbuild.include - scripts&#x2F;Kbuild.include - <em>echo-cmd</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo command.</span></span><br><span class="line"><span class="comment"># Short version is used, if $(quiet) equals `quiet_&#x27;, otherwise full one.</span></span><br><span class="line">echo-cmd = <span class="variable">$(<span class="built_in">if</span> $(<span class="variable">$(quiet)</span>cmd_$(1)</span>),\</span><br><span class="line">	echo &#x27;  <span class="variable">$(<span class="built_in">call</span> escsq,$(<span class="variable">$(quiet)</span>cmd_$(1)</span>))$(echo-why)&#x27;;)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„<code>$(1)</code>&#x3D;checksrcï¼Œquietå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L81">Makefile - <em>quiet</em></a>ï¼Œåˆ†æä¸€ä¸‹å°±å¯ä»¥çŸ¥é“ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œ<code>make V=1</code>çš„æ—¶å€™ï¼Œè¿™é‡Œquietä¸ºç©ºï¼Œå½“æ‰§è¡Œ<code>make V=0</code>çš„æ—¶å€™ï¼Œquiet&#x3D;quiet_ã€‚æ‰€ä»¥è¿™é‡Œå±•å¼€æ˜¯ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo-cmd = <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(cmd_checksrc)</span>,\</span></span><br><span class="line"><span class="variable">	echo &#x27;  $(<span class="built_in">call</span> escsq,$(<span class="variable">$(quiet)</span>cmd_$(1)</span>))$(echo-why)&#x27;;)</span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">echo-cmd = <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(quiet_cmd_checksrc)</span>,\</span></span><br><span class="line"><span class="variable">	echo &#x27;  $(<span class="built_in">call</span> escsq,$(<span class="variable">$(quiet)</span>cmd_$(1)</span>))$(echo-why)&#x27;;)</span><br></pre></td></tr></table></figure>

<p>cmd_checkå’Œquiet_cmd_checksrcéƒ½å®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L92">Makefile.build - <em>cmd_check</em></a>è¿™é‡Œï¼Œè¿˜æ˜¯å’ŒäºŒã€make dir&#x2F;file.koè¿™ä¸€èŠ‚ä¸­çš„2.2.2 <code>$(call cmd,force_checksrc)</code>ä¸€æ ·ï¼Œç”±äºæˆ‘ä»¬æ²¡æœ‰ä¼ å…¥Cå‚æ•°çš„å€¼ï¼Œè¿™é‡Œéƒ½æ˜¯ç©ºçš„ã€‚</p>
<h4 id="3-1-3-æ€»ç»“"><a href="#3-1-3-æ€»ç»“" class="headerlink" title="3.1.3 æ€»ç»“"></a><font size=3>3.1.3 æ€»ç»“</font></h4><p>ç”±äºæ²¡æœ‰ä¼ å…¥make C&#x3D;2å…¶ä»–å€¼ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰å¼€å¯ä»£ç æ£€æŸ¥ã€‚æ‰€ä»¥<code>$(call echo-cmd,checksrc) </code>å’Œ<code>$(cmd_checksrc)</code>éƒ½ä¸ºç©ºã€‚</p>
<h3 id="3-2-call-cmd-and-fixdep-cc-o-c"><a href="#3-2-call-cmd-and-fixdep-cc-o-c" class="headerlink" title="3.2 $(call cmd_and_fixdep,cc_o_c)"></a><font size=3>3.2 <code>$(call cmd_and_fixdep,cc_o_c)</code></font></h3><p>æ¥ä¸‹æ¥æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªå‘½ä»¤ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">call</span> cmd_and_fixdep,cc_o_c)</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‘½ä»¤æ˜¯è°ƒç”¨å‡½æ•°cmd_and_fixdepï¼Œä¼ å…¥å‚æ•°ä¸ºcc_o_cã€‚</p>
<p>cmd_and_fixdepå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Kbuild.include#L271">Kbuild.include - scripts&#x2F;Kbuild.include - <em>cmd_and_fixdep</em></a>ï¼Œå®ƒæœ‰ä¸¤ä¸ªå®šä¹‰ï¼Œé€šè¿‡CONFIG_TRIM_UNUSED_KSYMSé€‰æ‹©ä¸åŒçš„å‘½ä»¤ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ifndef</span> CONFIG_TRIM_UNUSED_KSYMS</span><br><span class="line"><span class="comment"># (1)</span></span><br><span class="line">cmd_and_fixdep =                                                             \</span><br><span class="line"><span class="comment">#......</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="comment">#......</span></span><br><span class="line"><span class="comment"># (2)</span></span><br><span class="line">cmd_and_fixdep =                                                             \</span><br><span class="line"><span class="comment"># ......</span></span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æœä¸€ä¸‹è¿™ä¸ªCONFIG_TRIM_UNUSED_KSYMSé…ç½®é¡¹ï¼Œä¼šå‘ç°æ˜¯æ²¡æœ‰çš„ï¼Œæ‰€ä»¥è¿™é‡Œæ‰§è¡Œï¼ˆ1ï¼‰çš„å‘½ä»¤ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cmd_and_fixdep =                                                             \</span><br><span class="line">	$(echo-cmd) $(cmd_$(1));                                             \</span><br><span class="line">	scripts/basic/fixdep <span class="variable">$(depfile)</span> <span class="variable">$@</span> &#x27;$(make-cmd)&#x27; &gt; $(dot-target).tmp;\</span><br><span class="line">	rm -f <span class="variable">$(depfile)</span>;                                                    \</span><br><span class="line">	mv -f $(dot-target).tmp $(dot-target).cmd;</span><br></pre></td></tr></table></figure>

<p><code>$(1)</code>&#x3D;cc_o_c,æ‰€ä»¥è¿™é‡Œæ˜¯ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cmd_and_fixdep =                                                             \</span><br><span class="line">	$(echo-cmd) <span class="variable">$(cmd_cc_o_c)</span>;                                             \</span><br><span class="line">	scripts/basic/fixdep <span class="variable">$(depfile)</span> <span class="variable">$@</span> &#x27;$(make-cmd)&#x27; &gt; $(dot-target).tmp;\</span><br><span class="line">	rm -f <span class="variable">$(depfile)</span>;                                                    \</span><br><span class="line">	mv -f $(dot-target).tmp $(dot-target).cmd;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-1-echo-cmd"><a href="#3-2-1-echo-cmd" class="headerlink" title="3.2.1Â $(echo-cmd)"></a><font size=3>3.2.1Â <code>$(echo-cmd)</code></font></h4><p>echo-cmdå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Kbuild.include#L220">Kbuild.include - <em>echo-cmd</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo command.</span></span><br><span class="line"><span class="comment"># Short version is used, if $(quiet) equals `quiet_&#x27;, otherwise full one.</span></span><br><span class="line">echo-cmd = <span class="variable">$(<span class="built_in">if</span> $(<span class="variable">$(quiet)</span>cmd_$(1)</span>),\</span><br><span class="line">	echo &#x27;  <span class="variable">$(<span class="built_in">call</span> escsq,$(<span class="variable">$(quiet)</span>cmd_$(1)</span>))$(echo-why)&#x27;;)</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®å‰é¢åˆ†æçš„è¿™é‡Œå°±æ˜¯ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo-cmd = <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(cmd_cc_o_c)</span>,\</span></span><br><span class="line"><span class="variable">	echo &#x27;  $(<span class="built_in">call</span> escsq,$(<span class="variable">$(quiet)</span>cmd_$(1)</span>))$(echo-why)&#x27;;)</span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">echo-cmd = <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(quiet_cmd_cc_o_c)</span>,\</span></span><br><span class="line"><span class="variable">	echo &#x27;  $(<span class="built_in">call</span> escsq,$(<span class="variable">$(quiet)</span>cmd_$(1)</span>))$(echo-why)&#x27;;)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡ŒæŒ‰<code>make V=1</code>çš„ç»“æœè¿›è¡Œçš„åˆ†æï¼Œé‚£æˆ‘ä»¬è¦æ‰¾çš„å°±æ˜¯cmd_cc_o_cï¼Œå…¶å®æœ€ç»ˆä»–ä»¬æ‰§è¡Œçš„éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡å°±æ˜¯æ‰“å°ä¿¡æ¯çš„åŒºåˆ«ã€‚cmd_cc_o_cå®šä¹‰åœ¨è¿™ä¸ªä½ç½®ï¼š<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L164">Makefile.build - scripts&#x2F;Makefile.build - <em>cmd_cc_o_c</em></a></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># C (.c) files</span></span><br><span class="line"><span class="comment"># The C file is compiled and updated dependency information is generated.</span></span><br><span class="line"><span class="comment"># (See cmd_cc_o_c + relevant part of rule_cc_o_c)</span></span><br><span class="line"></span><br><span class="line">quiet_cmd_cc_o_c = CC <span class="variable">$(quiet_modtag)</span>  <span class="variable">$@</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ifndef</span> CONFIG_MODVERSIONS</span><br><span class="line">cmd_cc_o_c = <span class="variable">$(CC)</span> <span class="variable">$(c_flags)</span> -c -o <span class="variable">$@</span> <span class="variable">$&lt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="comment">#......</span></span><br><span class="line">cmd_cc_o_c = <span class="variable">$(CC)</span> <span class="variable">$(c_flags)</span> -c -o $(@D)/.tmp_$(@F) <span class="variable">$&lt;</span></span><br><span class="line"><span class="comment"># ......</span></span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æœç´¢ä¸€ä¸‹CONFIG_MODVERSIONSï¼Œå‘ç°åœ¨imx_v6_v7_defconfigå’Œ.configä¸­æœ‰å®šä¹‰ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CONFIG_MODVERSIONS=y</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥è¿™é‡Œå°±æ˜¯ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd_cc_o_c = <span class="variable">$(CC)</span> <span class="variable">$(c_flags)</span> -c -o $(@D)/.tmp_$(@F) <span class="variable">$&lt;</span></span><br></pre></td></tr></table></figure>

<p>æ˜¾ç„¶æ˜¯éç©ºçš„ï¼Œè¿™é‡Œifæˆç«‹ï¼Œå°±æ˜¯ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo-cmd = echo &#x27;  <span class="variable">$(<span class="built_in">call</span> escsq,$(<span class="variable">$(quiet)</span>cmd_$(1)</span>))$(echo-why)&#x27;;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-2-cmd-cc-o-c"><a href="#3-2-2-cmd-cc-o-c" class="headerlink" title="3.2.2 $(cmd_cc_o_c)"></a><font size=3>3.2.2 <code>$(cmd_cc_o_c)</code></font></h4><p>ä¸Šä¸€å°èŠ‚å…¶å®å·²ç»åˆ†æå®Œäº†ï¼Œcmd_cc_o_cå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L164">Makefile.build - scripts&#x2F;Makefile.build - <em>cmd_cc_o_c</em></a>ï¼Œçš„å€¼ä¸º</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd_cc_o_c = <span class="variable">$(CC)</span> <span class="variable">$(c_flags)</span> -c -o $(@D)/.tmp_$(@F) <span class="variable">$&lt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>$(@D)</code>è¡¨ç¤ºâ€<code>$@</code>â€œçš„ç›®å½•éƒ¨åˆ†ï¼ˆä¸ä»¥æ–œæ ä½œä¸ºç»“å°¾ï¼‰ ï¼Œå¦‚æœâ€<code>$@</code>â€œå€¼æ˜¯â€dir&#x2F;foo.oâ€ï¼Œé‚£ä¹ˆâ€<code>$(@D)</code>â€œå°±æ˜¯â€dirâ€ï¼Œè€Œå¦‚æœâ€<code>$@</code>â€œä¸­æ²¡æœ‰åŒ…å«æ–œæ çš„è¯ï¼Œå…¶å€¼å°±æ˜¯â€.â€ï¼ˆå½“å‰ç›®å½•ï¼‰ ã€‚</p>
</li>
<li><p><code>$(@F)</code>è¡¨ç¤ºâ€<code>$@</code>â€œçš„æ–‡ä»¶éƒ¨åˆ†ï¼Œå¦‚æœâ€<code>$@</code>â€œå€¼æ˜¯â€dir&#x2F;foo.oâ€ï¼Œé‚£ä¹ˆâ€<code>$(@F</code>)â€å°±æ˜¯â€foo.oâ€ï¼Œâ€<code>$(@F)</code>â€œç›¸å½“äºå‡½æ•°â€<code>$(notdir $@)</code>â€œ</p>
</li>
</ul>
<p>æ‰€ä»¥è¿™é‡Œå…¶å®å°±æ˜¯æŠŠcæ–‡ä»¶ç¼–è¯‘æˆoçš„åœ°æ–¹ã€‚</p>
<h4 id="3-2-3-echo-cmd-cmd-1-åšäº†ä»€ä¹ˆï¼Ÿ"><a href="#3-2-3-echo-cmd-cmd-1-åšäº†ä»€ä¹ˆï¼Ÿ" class="headerlink" title="3.2.3 $(echo-cmd) $(cmd_$(1))åšäº†ä»€ä¹ˆï¼Ÿ"></a><font size=3>3.2.3 <code>$(echo-cmd) $(cmd_$(1))</code>åšäº†ä»€ä¹ˆï¼Ÿ</font></h4><p>ä¸Šé¢å·²ç»å•ç‹¬åˆ†æäº†è¿™ä¸¤ä¸ªå˜é‡ï¼Œä½†æ˜¯å¥½åƒä¹Ÿä¸æ¸…æ¥šå…·ä½“æ˜¯åšäº†ä»€ä¹ˆï¼Œé‡Œé¢æœ‰ä¸€äº›å˜é‡è¿˜æ˜¯æ²¡æœ‰åŠæ³•ç¡®å®šï¼Œå‰é¢ç®€å•å±•å¼€äº†<code>cmd_and_fixdep</code>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cmd_and_fixdep =                                                             \</span><br><span class="line">	$(echo-cmd) <span class="variable">$(cmd_cc_o_c)</span>;                                             \</span><br><span class="line">	scripts/basic/fixdep <span class="variable">$(depfile)</span> <span class="variable">$@</span> &#x27;$(make-cmd)&#x27; &gt; $(dot-target).tmp;\</span><br><span class="line">	rm -f <span class="variable">$(depfile)</span>;                                                    \</span><br><span class="line">	mv -f $(dot-target).tmp $(dot-target).cmd;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è¿™é‡Œå†ç»§ç»­å±•å¼€ä¸€ä¸‹ç¬¬2è¡Œï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cmd_and_fixdep =                                                             \</span><br><span class="line">	echo &#x27;  <span class="variable">$(<span class="built_in">call</span> escsq,$(<span class="variable">$(quiet)</span>cmd_$(1)</span>))$(echo-why)&#x27;; <span class="variable">$(CC)</span> <span class="variable">$(c_flags)</span> -c -o $(@D)/.tmp_$(@F) <span class="variable">$&lt;</span>;                                             \</span><br><span class="line">	scripts/basic/fixdep <span class="variable">$(depfile)</span> <span class="variable">$@</span> &#x27;$(make-cmd)&#x27; &gt; $(dot-target).tmp;\</span><br><span class="line">	rm -f <span class="variable">$(depfile)</span>;                                                    \</span><br><span class="line">	mv -f $(dot-target).tmp $(dot-target).cmd;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡ŒåŠ ä¸ªæ‰“å°ä¿¡æ¯å§<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Kbuild.include#L271">Kbuild.include - scripts&#x2F;Kbuild.include - <em>cmd_and_fixdep</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cmd_and_fixdep =                                                             \</span><br><span class="line">	echo <span class="string">&quot;cmd_and_fixdep info CC=<span class="variable">$(CC)</span> c_flags=<span class="variable">$(c_flags)</span> @D=$(@D) @F=$(@F) <span class="variable">$&lt;</span>&quot;</span>;\</span><br><span class="line">	$(echo-cmd) <span class="variable">$(cmd_cc_o_c)</span>;                                             \</span><br><span class="line">	scripts/basic/fixdep <span class="variable">$(depfile)</span> <span class="variable">$@</span> &#x27;$(make-cmd)&#x27; &gt; $(dot-target).tmp;\</span><br><span class="line">	rm -f <span class="variable">$(depfile)</span>;                                                    \</span><br><span class="line">	mv -f $(dot-target).tmp $(dot-target).cmd;</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">make V=0 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- distclean</span><br><span class="line">make V=0 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- imx_v6_v7_defconfig</span><br><span class="line">make V=1 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- drivers/media/i2c/ov5640.ko -j16</span><br></pre></td></tr></table></figure>

<p>å…¶å®cmd_and_fixdepå‘½ä»¤å°±æ˜¯ç”¨æ¥ç¼–è¯‘Cæ–‡ä»¶çš„ï¼Œæ‰€ä»¥è°ƒç”¨çš„åœ°æ–¹æœ‰å¾ˆå¤šï¼Œæˆ‘ä»¬åŠ çš„æ‰“å°ä¿¡æ¯ä¹Ÿä¼šå‡ºç°å¾ˆå¤šæ¬¡ï¼Œæˆ‘ä»¬æ‰¾è¿™ä¸ªï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p .tmp_versions</span><br><span class="line">make KBUILD_MODULES=1   \</span><br><span class="line">-f ./scripts/Makefile.build obj=drivers/media/i2c drivers/media/i2c/ov5640.o</span><br><span class="line">echo &quot;info(2) single-used-m=drivers/media/i2c/adv7180.o drivers/media/i2c/ov5640.o obj=drivers/media/i2c src=drivers/media/i2c drivers/media/i2c/ov5640.o drivers/media/i2c/ov5640.c&quot;</span><br><span class="line">info(2) single-used-m=drivers/media/i2c/adv7180.o drivers/media/i2c/ov5640.o obj=drivers/media/i2c src=drivers/media/i2c drivers/media/i2c/ov5640.o drivers/media/i2c/ov5640.c</span><br><span class="line">cmd_and_fixdep info CC=arm-linux-gnueabihf-gcc c_flags=-Wp,-MD,drivers/media/i2c/.ov5640.o.d  -nostdinc -isystem /opt/gcc-linaro-arm-linux-gnueabihf-4.9-2014.09_linux/bin/../lib/gcc/arm-linux-gnueabihf/4.9.2/include -I./arch/arm/include -I./arch/arm/include/generated  -I./include -I./arch/arm/include/uapi -I./arch/arm/include/generated/uapi -I./include/uapi -I./include/generated/uapi -include ./include/linux/kconfig.h -include ./include/linux/compiler_types.h -D__KERNEL__ -mlittle-endian -Wall -Wundef -Wstrict-prototypes -Wno-trigraphs -fno-strict-aliasing -fno-common -fshort-wchar -Werror-implicit-function-declaration -Wno-format-security -std=gnu89 -fno-PIE -fno-dwarf2-cfi-asm -fno-omit-frame-pointer -mapcs -mno-sched-prolog -fno-ipa-sra -mabi=aapcs-linux -mfpu=vfp -marm -Wa,-mno-warn-deprecated -D__LINUX_ARM_ARCH__=6 -march=armv6k -mtune=arm1136j-s -msoft-float -Uarm -fno-delete-null-pointer-checks -O2 --param=allow-store-data-races=0 -Wframe-larger-than=1024 -fstack-protector-strong -Wno-unused-but-set-variable -fno-omit-frame-pointer -fno-optimize-sibling-calls -fno-var-tracking-assignments -Wdeclaration-after-statement -Wno-pointer-sign -fno-strict-overflow -fno-merge-all-constants -fmerge-constants -fno-stack-check -fconserve-stack -Werror=implicit-int -Werror=strict-prototypes -Werror=date-time  -DMODULE  -DKBUILD_BASENAME=&#x27;ov5640&#x27; -DKBUILD_MODNAME=&#x27;ov5640&#x27; @D=drivers/media/i2c @F=ov5640.o drivers/media/i2c/ov5640.c</span><br></pre></td></tr></table></figure>

<p>info(2)è¿™é‡Œæ˜¯å‰é¢ äºŒã€make dir&#x2F;file.koéƒ¨åˆ†çš„2.2 <code>$(obj)/%.o</code>ç›®æ ‡ è¿™ä¸€ä¸ªå°èŠ‚æ·»åŠ çš„ï¼Œåˆšå¥½å¸®æˆ‘ä»¬å®šä½æˆ‘ä»¬æ‰€éœ€è¦çš„ cmd_and_fixdep infoï¼Œæ•´ç†ä¸€ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cmd_and_fixdep infoï¼š</span><br><span class="line">CC=arm-linux-gnueabihf-gcc </span><br><span class="line">c_flags=-Wp,-MD,drivers/media/i2c/.ov5640.o.d  -nostdinc -isystem /opt/gcc-linaro-arm-linux-gnueabihf-4.9-2014.09_linux/bin/../lib/gcc/arm-linux-gnueabihf/4.9.2/include -I./arch/arm/include -I./arch/arm/include/generated  -I./include -I./arch/arm/include/uapi -I./arch/arm/include/generated/uapi -I./include/uapi -I./include/generated/uapi -include ./include/linux/kconfig.h -include ./include/linux/compiler_types.h -D__KERNEL__ -mlittle-endian -Wall -Wundef -Wstrict-prototypes -Wno-trigraphs -fno-strict-aliasing -fno-common -fshort-wchar -Werror-implicit-function-declaration -Wno-format-security -std=gnu89 -fno-PIE -fno-dwarf2-cfi-asm -fno-omit-frame-pointer -mapcs -mno-sched-prolog -fno-ipa-sra -mabi=aapcs-linux -mfpu=vfp -marm -Wa,-mno-warn-deprecated -D__LINUX_ARM_ARCH__=6 -march=armv6k -mtune=arm1136j-s -msoft-float -Uarm -fno-delete-null-pointer-checks -O2 --param=allow-store-data-races=0 -Wframe-larger-than=1024 -fstack-protector-strong -Wno-unused-but-set-variable -fno-omit-frame-pointer -fno-optimize-sibling-calls -fno-var-tracking-assignments -Wdeclaration-after-statement -Wno-pointer-sign -fno-strict-overflow -fno-merge-all-constants -fmerge-constants -fno-stack-check -fconserve-stack -Werror=implicit-int -Werror=strict-prototypes -Werror=date-time  -DMODULE  -DKBUILD_BASENAME=&#x27;ov5640&#x27; -DKBUILD_MODNAME=&#x27;ov5640&#x27; </span><br><span class="line">@D=drivers/media/i2c </span><br><span class="line">@F=ov5640.o </span><br><span class="line">drivers/media/i2c/ov5640.c</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥æ€»çš„æ¥è¯´ï¼Œ<code>$(echo-cmd) $(cmd_$(1))</code>å®Œæˆäº†drivers&#x2F;media&#x2F;i2c&#x2F;ov5640.cåˆ°drivers&#x2F;media&#x2F;i2c&#x2F;ov5640.oçš„ç¼–è¯‘ã€‚</p>
<h3 id="3-3-cmd-checkdoc"><a href="#3-3-cmd-checkdoc" class="headerlink" title="3.3 $(cmd_checkdoc)"></a><font size=3>3.3 <code>$(cmd_checkdoc)</code></font></h3><p>æ¥ä¸‹æ¥çœ‹è¿™ä¸ªcmd_checkdocï¼Œå®ƒæ˜¯å®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L97">Makefile.build - scripts&#x2F;Makefile.build - <em>cmd_checkdoc</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ifneq</span> (<span class="variable">$(KBUILD_ENABLE_EXTRA_GCC_CHECKS)</span>,)</span><br><span class="line">  cmd_checkdoc = <span class="variable">$(srctree)</span>/scripts/kernel-doc -none <span class="variable">$&lt;</span> ;</span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æœç´¢ä¸€ä¸‹è¿™ä¸ªKBUILD_ENABLE_EXTRA_GCC_CHECKSï¼Œä¼šå‘ç°å®ƒå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.extrawarn#L17">Makefile.extrawarn - scripts&#x2F;Makefile.extrawarn - <em>KBUILD_ENABLE_EXTRA_GCC_CHECKS</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ifeq</span> (<span class="string">&quot;$(origin W)&quot;</span>, <span class="string">&quot;command line&quot;</span>)</span><br><span class="line">  <span class="keyword">export</span> KBUILD_ENABLE_EXTRA_GCC_CHECKS := <span class="variable">$(W)</span></span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œæ˜¯ä»å‘½ä»¤è¡Œè¯»å–Wå‚æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬ç¼–è¯‘çš„æ—¶å€™æ²¡æœ‰åŠ å…¥è¿™ä¸ªå‚æ•°ï¼Œæ‰€ä»¥è¿™é‡Œä¸ºç©ºã€‚</p>
<p><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.extrawarn#L17">Makefile.extrawarn - scripts&#x2F;Makefile.extrawarn</a>è¿™ä¸ªæ–‡ä»¶æ˜¯åœ¨é¡¶å±‚<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L842">Makefile</a>ä¸­è¢«åŒ…å«ã€‚è¿™é‡Œifneqå°±æ˜¯åˆ¤æ–­å‚æ•°æ˜¯å¦ä¸ç›¸ç­‰ï¼Œè¿™é‡Œåˆ¤æ–­çš„æ˜¯KBUILD_ENABLE_EXTRA_GCC_CHECKSä¸0æ˜¯å¦ä¸ç›¸ç­‰å«Œæ˜¾ç„¶è¿™é‡Œä¸æˆç«‹ï¼Œæ‰€ä»¥cmd_checkdocä¸ºç©ºã€‚è¿™æ¡å‘½ä»¤ç›¸å½“äºæ²¡æœ‰ã€‚</p>
<h3 id="3-4-objtool"><a href="#3-4-objtool" class="headerlink" title="3.4 objtool"></a><font size=3>3.4 objtool</font></h3><p>æˆ‘ä»¬ç»§ç»­çœ‹è¿™æ¡å‘½ä»¤<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L283">Makefile.build - scripts&#x2F;Makefile.build</a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">call</span> echo-cmd,objtool)</span> <span class="variable">$(cmd_objtool)</span></span><br></pre></td></tr></table></figure>

<h4 id="3-4-1-cmd-objtool"><a href="#3-4-1-cmd-objtool" class="headerlink" title="3.4.1 $(cmd_objtool)"></a><font size=3>3.4.1 <code>$(cmd_objtool)</code></font></h4><p>å…ˆçœ‹è¿™ä¸ªcmd_objtoolï¼Œå®ƒå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L264">Makefile.build - scripts&#x2F;Makefile.build - <em>cmd_objtool</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x27;OBJECT_FILES_NON_STANDARD := y&#x27;: skip objtool checking for a directory</span></span><br><span class="line"><span class="comment"># &#x27;OBJECT_FILES_NON_STANDARD_foo.o := &#x27;y&#x27;: skip objtool checking for a file</span></span><br><span class="line"><span class="comment"># &#x27;OBJECT_FILES_NON_STANDARD_foo.o := &#x27;n&#x27;: override directory skip for a file</span></span><br><span class="line">cmd_objtool = <span class="variable">$(<span class="built_in">if</span> $(<span class="built_in">patsubst</span> y%,, \</span></span><br><span class="line"><span class="variable">	$(OBJECT_FILES_NON_STANDARD_<span class="variable">$(basetarget)</span>.o)</span><span class="variable">$(OBJECT_FILES_NON_STANDARD)</span>n), \</span><br><span class="line">	<span class="variable">$(__objtool_obj)</span> <span class="variable">$(objtool_args)</span> <span class="string">&quot;<span class="variable">$(objtool_o)</span>&quot;</span>;)</span><br><span class="line">objtool_obj = <span class="variable">$(<span class="built_in">if</span> $(<span class="built_in">patsubst</span> y%,, \</span></span><br><span class="line"><span class="variable">	$(OBJECT_FILES_NON_STANDARD_<span class="variable">$(basetarget)</span>.o)</span><span class="variable">$(OBJECT_FILES_NON_STANDARD)</span>n), \</span><br><span class="line">	<span class="variable">$(__objtool_obj)</span>)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œç›´æ¥åŠ ä¸ªæ‰“å°ä¿¡æ¯çœ‹ä¸‹ç»“æœå§ï¼Œå°±åœ¨è¿™ä¸ªä½ç½®åŠ ï¼š<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L283">Makefile.build - scripts&#x2F;Makefile.build</a></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">define</span> rule_cc_o_c</span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> echo-cmd,checksrc)</span> <span class="variable">$(cmd_checksrc)</span>			  \</span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> cmd_and_fixdep,cc_o_c)</span>					  \</span><br><span class="line">	<span class="variable">$(cmd_checkdoc)</span>							  \</span><br><span class="line">	<span class="variable">$(<span class="built_in">warning</span> cmd_objtool=<span class="variable">$(cmd_objtool)</span>)</span> \</span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> echo-cmd,objtool)</span> <span class="variable">$(cmd_objtool)</span>				  \</span><br><span class="line">	<span class="variable">$(cmd_modversions_c)</span>						  \</span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> echo-cmd,record_mcount)</span> <span class="variable">$(cmd_record_mcount)</span></span><br><span class="line"><span class="keyword">endef</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œæˆ‘åŠ äº†<code>$(warning &lt;text&gt;)</code>å‡½æ•°ï¼Œå®ƒä¸ç”¨åƒechoä¸€æ ·æœ‰é™åˆ¶ï¼Œechoåªèƒ½åœ¨targetï¼šåé¢çš„è¯­å¥ä¸­ä½¿ç”¨ï¼Œä¸”å‰é¢æ˜¯ä¸ªTABã€‚ç”¨è¿™ä¸ªå‡½æ•°è¿˜å¯ä»¥æ‰“å°å‡ºè¡Œå·ï¼ˆä¸è¿‡è¿™ä¸ªè¡Œå·æ„Ÿè§‰å’Œæ–‡ä»¶ä¸­çš„æœ‰äº›åŒºåˆ«ï¼Œå› ä¸ºMakefileæ˜¯å…ˆæ›¿æ›¿æ¢å‡½æ•°å†…å®¹ç„¶åæ‰§è¡Œï¼Œæ‰€ä»¥å¯èƒ½æ„ä¹‰ä¹Ÿä¸å¤§ï¼‰ã€‚å€¼ç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">make V=0 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- distclean</span><br><span class="line">make V=0 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- imx_v6_v7_defconfig</span><br><span class="line">make V=1 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- drivers/media/i2c/ov5640.ko -j16 <span class="comment"># ç¼–è¯‘æŒ‡å®šæ¨¡å—</span></span><br></pre></td></tr></table></figure>

<p>ä¼šçœ‹åˆ°å¦‚ä¸‹æ‰“å°ä¿¡æ¯ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">scripts/Makefile.build:311: cmd_objtool=</span></span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥åœ¨å•ç‹¬ç¼–è¯‘è¿™ä¸ªæ¨¡å—çš„æ—¶å€™è¿™é‡Œä¸ºç©ºï¼Œå°±å…ˆä¸ç®¡äº†ã€‚</p>
<h4 id="3-4-2-call-echo-cmd-objtool"><a href="#3-4-2-call-echo-cmd-objtool" class="headerlink" title="3.4.2 $(call echo-cmd,objtool)"></a><font size=3>3.4.2 <code>$(call echo-cmd,objtool)</code></font></h4><p>å†æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªecho-cmdå‡½æ•°ï¼Œå‰é¢åˆ†æè¿‡çš„ï¼Œecho-cmdå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Kbuild.include#L220">Kbuild.include - scripts&#x2F;Kbuild.include - <em>echo-cmd</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo command.</span></span><br><span class="line"><span class="comment"># Short version is used, if $(quiet) equals `quiet_&#x27;, otherwise full one.</span></span><br><span class="line">echo-cmd = <span class="variable">$(<span class="built_in">if</span> $(<span class="variable">$(quiet)</span>cmd_$(1)</span>),\</span><br><span class="line">	echo &#x27;  <span class="variable">$(<span class="built_in">call</span> escsq,$(<span class="variable">$(quiet)</span>cmd_$(1)</span>))$(echo-why)&#x27;;)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„<code>$(1)</code>&#x3D;objtoolï¼Œquietå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L81">Makefile - <em>quiet</em></a>ï¼Œåˆ†æä¸€ä¸‹å°±å¯ä»¥çŸ¥é“ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œ<code>make V=1</code>çš„æ—¶å€™ï¼Œè¿™é‡Œquietä¸ºç©ºï¼Œå½“æ‰§è¡Œ<code>make V=0</code>çš„æ—¶å€™ï¼Œquiet&#x3D;quiet_ã€‚æ‰€ä»¥è¿™é‡Œå±•å¼€æ˜¯ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo-cmd = <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(cmd_objtool)</span>,\</span></span><br><span class="line"><span class="variable">	echo &#x27;  $(<span class="built_in">call</span> escsq,$(<span class="variable">$(quiet)</span>cmd_$(1)</span>))$(echo-why)&#x27;;)</span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">echo-cmd = <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(quiet_cmd_objtool)</span>,\</span></span><br><span class="line"><span class="variable">	echo &#x27;  $(<span class="built_in">call</span> escsq,$(<span class="variable">$(quiet)</span>cmd_$(1)</span>))$(echo-why)&#x27;;)</span><br></pre></td></tr></table></figure>

<p>å‰é¢å…¶å®åˆ†æè¿‡cmd_objtoolè¿™ä¸ªäº†ï¼Œå®ƒæ˜¯ä¸ºç©ºï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿä¸ä¼šæœ‰ä»€ä¹ˆä¿¡æ¯ã€‚</p>
<h4 id="3-4-3-æ€»ç»“"><a href="#3-4-3-æ€»ç»“" class="headerlink" title="3.4.3 æ€»ç»“"></a><font size=3>3.4.3 æ€»ç»“</font></h4><p>å‰é¢å·²ç»åˆ†æäº†<code>$(call echo-cmd,objtool)</code>å’Œ <code>$(cmd_objtool)</code>ï¼Œä»–ä»¬éƒ½æ˜¯ä¸ºç©ºï¼Œæ‰€ä»¥è¿™è¡Œå°±ä¸ç”¨ç®¡äº†ï¼Œæˆ‘ä»¬åœ¨æ‰“å°ä¿¡æ¯é‡Œå…¶å®ä¹Ÿä¼šå‘ç°ä¸ä¼šæœ‰ç›¸å…³çš„å†…å®¹å‡ºç°ã€‚</p>
<h3 id="3-5-cmd-modversions-c"><a href="#3-5-cmd-modversions-c" class="headerlink" title="3.5 $(cmd_modversions_c)"></a><font size=3>3.5 <code>$(cmd_modversions_c)</code></font></h3><p>æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªcmd_modversions_cï¼Œå®ƒå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L188">Makefile.build - scripts&#x2F;Makefile.build - <em>cmd_modversions_c</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cmd_modversions_c =								\</span><br><span class="line">	if <span class="variable">$(OBJDUMP)</span> -h $(@D)/.tmp_$(@F) | grep -q __ksymtab; then		\</span><br><span class="line">		<span class="variable">$(<span class="built_in">call</span> cmd_gensymtypes_c,<span class="variable">$(KBUILD_SYMTYPES)</span>,$(@:.o=.symtypes)</span>)	\</span><br><span class="line">		    &gt; $(@D)/.tmp_$(@F:.o=.ver);					\</span><br><span class="line">										\</span><br><span class="line">		<span class="variable">$(LD)</span> <span class="variable">$(KBUILD_LDFLAGS)</span> -r -o <span class="variable">$@</span> $(@D)/.tmp_$(@F) 		\</span><br><span class="line">			-T $(@D)/.tmp_$(@F:.o=.ver);				\</span><br><span class="line">		rm -f $(@D)/.tmp_$(@F) $(@D)/.tmp_$(@F:.o=.ver);		\</span><br><span class="line">	<span class="keyword">else</span>									\</span><br><span class="line">		mv -f $(@D)/.tmp_$(@F) <span class="variable">$@</span>;					\</span><br><span class="line">	fi;</span><br></pre></td></tr></table></figure>

<p>åˆæ˜¯ä¸€å †çš„å˜é‡ï¼Œè¿™é‡Œç›´æ¥æ¥æ‰“å°ä¿¡æ¯å§ï¼š<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L284">Makefile.build - scripts&#x2F;Makefile.build</a></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">define</span> rule_cc_o_c</span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> echo-cmd,checksrc)</span> <span class="variable">$(cmd_checksrc)</span>			  \</span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> cmd_and_fixdep,cc_o_c)</span>					  \</span><br><span class="line">	<span class="variable">$(cmd_checkdoc)</span>							  \</span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> echo-cmd,objtool)</span> <span class="variable">$(cmd_objtool)</span>				  \</span><br><span class="line">	<span class="variable">$(<span class="built_in">warning</span> cmd_modversions_c=<span class="variable">$(cmd_modversions_c)</span>)</span> \</span><br><span class="line">	<span class="variable">$(cmd_modversions_c)</span>						  \</span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> echo-cmd,record_mcount)</span> <span class="variable">$(cmd_record_mcount)</span></span><br><span class="line"><span class="keyword">endef</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åç»§ç»­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">make V=0 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- distclean</span><br><span class="line">make V=0 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- imx_v6_v7_defconfig</span><br><span class="line">make V=1 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- drivers/media/i2c/ov5640.ko -j16 # ç¼–è¯‘æŒ‡å®šæ¨¡å—</span><br></pre></td></tr></table></figure>

<p>ä¼šçœ‹åˆ°å¦‚ä¸‹æ‰“å°ä¿¡æ¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scripts/Makefile.build:311: cmd_modversions_c=if arm-linux-gnueabihf-objdump -h drivers/media/i2c/.tmp_ov5640.o | grep -q __ksymtab; then arm-linux-gnueabihf-gcc -E -D__GENKSYMS__ -Wp,-MD,drivers/media/i2c/.ov5640.o.d  -nostdinc -isystem /opt/gcc-linaro-arm-linux-gnueabihf-4.9-2014.09_linux/bin/../lib/gcc/arm-linux-gnueabihf/4.9.2/include -I./arch/arm/include -I./arch/arm/include/generated  -I./include -I./arch/arm/include/uapi -I./arch/arm/include/generated/uapi -I./include/uapi -I./include/generated/uapi -include ./include/linux/kconfig.h -include ./include/linux/compiler_types.h -D__KERNEL__ -mlittle-endian -Wall -Wundef -Wstrict-prototypes -Wno-trigraphs -fno-strict-aliasing -fno-common -fshort-wchar -Werror-implicit-function-declaration -Wno-format-security -std=gnu89 -fno-PIE -fno-dwarf2-cfi-asm -fno-omit-frame-pointer -mapcs -mno-sched-prolog -fno-ipa-sra -mabi=aapcs-linux -mfpu=vfp -marm -Wa,-mno-warn-deprecated -D__LINUX_ARM_ARCH__=6 -march=armv6k -mtune=arm1136j-s -msoft-float -Uarm -fno-delete-null-pointer-checks -O2 --param=allow-store-data-races=0 -Wframe-larger-than=1024 -fstack-protector-strong -Wno-unused-but-set-variable -fno-omit-frame-pointer -fno-optimize-sibling-calls -fno-var-tracking-assignments -Wdeclaration-after-statement -Wno-pointer-sign -fno-strict-overflow -fno-merge-all-constants -fmerge-constants -fno-stack-check -fconserve-stack -Werror=implicit-int -Werror=strict-prototypes -Werror=date-time  -DMODULE  -DKBUILD_BASENAME=&#x27;&quot;ov5640&quot;&#x27; -DKBUILD_MODNAME=&#x27;&quot;ov5640&quot;&#x27; drivers/media/i2c/ov5640.c | scripts/genksyms/genksyms    -r /dev/null &gt; drivers/media/i2c/.tmp_ov5640.ver; arm-linux-gnueabihf-ld  -EL -r -o drivers/media/i2c/ov5640.o drivers/media/i2c/.tmp_ov5640.o -T drivers/media/i2c/.tmp_ov5640.ver; rm -f drivers/media/i2c/.tmp_ov5640.o drivers/media/i2c/.tmp_ov5640.ver; else mv -f drivers/media/i2c/.tmp_ov5640.o drivers/media/i2c/ov5640.o; fi;</span><br></pre></td></tr></table></figure>

<p>æ•´ç†ä¸€ä¸‹å°±æ˜¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cmd_modversions_c=</span><br><span class="line">if arm-linux-gnueabihf-objdump -h drivers/media/i2c/.tmp_ov5640.o | grep -q __ksymtab; then </span><br><span class="line">	arm-linux-gnueabihf-gcc -E -D__GENKSYMS__ -Wp,-MD,drivers/media/i2c/.ov5640.o.d  -nostdinc -isystem /opt/gcc-linaro-arm-linux-gnueabihf-4.9-2014.09_linux/bin/../lib/gcc/arm-linux-gnueabihf/4.9.2/include -I./arch/arm/include -I./arch/arm/include/generated  -I./include -I./arch/arm/include/uapi -I./arch/arm/include/generated/uapi -I./include/uapi -I./include/generated/uapi -include ./include/linux/kconfig.h -include ./include/linux/compiler_types.h -D__KERNEL__ -mlittle-endian -Wall -Wundef -Wstrict-prototypes -Wno-trigraphs -fno-strict-aliasing -fno-common -fshort-wchar -Werror-implicit-function-declaration -Wno-format-security -std=gnu89 -fno-PIE -fno-dwarf2-cfi-asm -fno-omit-frame-pointer -mapcs -mno-sched-prolog -fno-ipa-sra -mabi=aapcs-linux -mfpu=vfp -marm -Wa,-mno-warn-deprecated -D__LINUX_ARM_ARCH__=6 -march=armv6k -mtune=arm1136j-s -msoft-float -Uarm -fno-delete-null-pointer-checks -O2 --param=allow-store-data-races=0 -Wframe-larger-than=1024 -fstack-protector-strong -Wno-unused-but-set-variable -fno-omit-frame-pointer -fno-optimize-sibling-calls -fno-var-tracking-assignments -Wdeclaration-after-statement -Wno-pointer-sign -fno-strict-overflow -fno-merge-all-constants -fmerge-constants -fno-stack-check -fconserve-stack -Werror=implicit-int -Werror=strict-prototypes -Werror=date-time  -DMODULE  -DKBUILD_BASENAME=&#x27;&quot;ov5640&quot;&#x27; -DKBUILD_MODNAME=&#x27;&quot;ov5640&quot;&#x27; drivers/media/i2c/ov5640.c | scripts/genksyms/genksyms    -r /dev/null &gt; drivers/media/i2c/.tmp_ov5640.ver; arm-linux-gnueabihf-ld  -EL -r -o drivers/media/i2c/ov5640.o drivers/media/i2c/.tmp_ov5640.o -T drivers/media/i2c/.tmp_ov5640.ver; </span><br><span class="line">	rm -f drivers/media/i2c/.tmp_ov5640.o drivers/media/i2c/.tmp_ov5640.ver; </span><br><span class="line">else </span><br><span class="line">	mv -f drivers/media/i2c/.tmp_ov5640.o drivers/media/i2c/ov5640.o; </span><br><span class="line">fi;</span><br></pre></td></tr></table></figure>

<h3 id="3-6-record-mcount"><a href="#3-6-record-mcount" class="headerlink" title="3.6Â record_mcount"></a><font size=3>3.6Â record_mcount</font></h3><p>æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹ rule_cc_o_c çš„æœ€åä¸€æ¡å‘½ä»¤ï¼š<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L285">Makefile.build - scripts&#x2F;Makefile.build</a></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">define</span> rule_cc_o_c</span><br><span class="line"><span class="comment">#......</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> echo-cmd,record_mcount)</span> <span class="variable">$(cmd_record_mcount)</span></span><br><span class="line"><span class="keyword">endef</span></span><br></pre></td></tr></table></figure>

<h4 id="3-6-1-cmd-record-mcount"><a href="#3-6-1-cmd-record-mcount" class="headerlink" title="3.6.1 $(cmd_record_mcount)"></a><font size=3>3.6.1 <code>$(cmd_record_mcount)</code></font></h4><p>cmd_record_mcountå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L227">Makefile.build - scripts&#x2F;Makefile.build - <em>cmd_record_mcount</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cmd_record_mcount =						\</span><br><span class="line">	if [ <span class="string">&quot;$(findstring <span class="variable">$(CC_FLAGS_FTRACE)</span>,<span class="variable">$(_c_flags)</span>)&quot;</span> =	\</span><br><span class="line">	     <span class="string">&quot;<span class="variable">$(CC_FLAGS_FTRACE)</span>&quot;</span> ]; then			\</span><br><span class="line">		<span class="variable">$(sub_cmd_record_mcount)</span>			\</span><br><span class="line">	fi;</span><br></pre></td></tr></table></figure>

<p>è¿˜æ˜¯çœç‚¹äº‹ï¼Œç›´æ¥åœ¨è¿™é‡ŒåŠ æ‰“å°ä¿¡æ¯ï¼š<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L285">Makefile.build - scripts&#x2F;Makefile.build</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">define rule_cc_o_c</span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">(call echo-cmd,checksrc) $(cmd_checksrc)			  \</span></span><br><span class="line"><span class="language-bash">	$(call cmd_and_fixdep,cc_o_c)					  \</span></span><br><span class="line"><span class="language-bash">	$(cmd_checkdoc)							  \</span></span><br><span class="line"><span class="language-bash">	$(call echo-cmd,objtool) $(cmd_objtool)				  \</span></span><br><span class="line"><span class="language-bash">	$(cmd_modversions_c)						  \</span></span><br><span class="line"><span class="language-bash">	$(warning record_mcount=$(record_mcount)) \</span></span><br><span class="line"><span class="language-bash">	$(call echo-cmd,record_mcount) $(cmd_record_mcount)</span></span><br><span class="line">endef</span><br></pre></td></tr></table></figure>

<p>ç„¶åè¿˜æ˜¯æ‰§è¡Œï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">make V=0 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- distclean</span><br><span class="line">make V=0 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- imx_v6_v7_defconfig</span><br><span class="line">make V=1 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- drivers/media/i2c/ov5640.ko -j16 # ç¼–è¯‘æŒ‡å®šæ¨¡å—</span><br></pre></td></tr></table></figure>

<p>ä¼šçœ‹åˆ°ä»¥ä¸‹æ‰“å°ä¿¡æ¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p .tmp_versions</span><br><span class="line">make KBUILD_MODULES=1   \</span><br><span class="line">-f ./scripts/Makefile.build obj=drivers/media/i2c drivers/media/i2c/ov5640.o</span><br><span class="line">scripts/Makefile.build:311: record_mcount=</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œè¿˜æ˜¯ä¸ºç©ºã€‚</p>
<h4 id="3-6-2-call-echo-cmd-record-mcount"><a href="#3-6-2-call-echo-cmd-record-mcount" class="headerlink" title="3.6.2 $(call echo-cmd,record_mcount)"></a><font size=3>3.6.2 <code>$(call echo-cmd,record_mcount)</code></font></h4><p>æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹<code>$(call echo-cmd,record_mcount)</code>,å†æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªecho-cmdå‡½æ•°ï¼Œå‰é¢åˆ†æè¿‡çš„ï¼Œecho-cmdå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Kbuild.include#L220">Kbuild.include - scripts&#x2F;Kbuild.include - <em>echo-cmd</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo command.</span></span><br><span class="line"><span class="comment"># Short version is used, if $(quiet) equals `quiet_&#x27;, otherwise full one.</span></span><br><span class="line">echo-cmd = <span class="variable">$(<span class="built_in">if</span> $(<span class="variable">$(quiet)</span>cmd_$(1)</span>),\</span><br><span class="line">	echo &#x27;  <span class="variable">$(<span class="built_in">call</span> escsq,$(<span class="variable">$(quiet)</span>cmd_$(1)</span>))$(echo-why)&#x27;;)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„<code>$(1)</code>&#x3D;record_mcountï¼Œquietå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/Makefile#L81">Makefile - <em>quiet</em></a>ï¼Œåˆ†æä¸€ä¸‹å°±å¯ä»¥çŸ¥é“ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œ<code>make V=1</code>çš„æ—¶å€™ï¼Œè¿™é‡Œquietä¸ºç©ºï¼Œå½“æ‰§è¡Œ<code>make V=0</code>çš„æ—¶å€™ï¼Œquiet&#x3D;quiet_ã€‚æ‰€ä»¥è¿™é‡Œå±•å¼€æ˜¯ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo-cmd = <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(cmd_record_mcount)</span>,\</span></span><br><span class="line"><span class="variable">	echo &#x27;  $(<span class="built_in">call</span> escsq,$(<span class="variable">$(quiet)</span>cmd_$(1)</span>))$(echo-why)&#x27;;)</span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">echo-cmd = <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(quiet_cmd_record_mcount)</span>,\</span></span><br><span class="line"><span class="variable">	echo &#x27;  $(<span class="built_in">call</span> escsq,$(<span class="variable">$(quiet)</span>cmd_$(1)</span>))$(echo-why)&#x27;;)</span><br></pre></td></tr></table></figure>

<p>å‰é¢å…¶å®åˆ†æè¿‡record_mcountè¿™ä¸ªäº†ï¼Œå®ƒæ˜¯ä¸ºç©ºï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿä¸ä¼šæœ‰ä»€ä¹ˆä¿¡æ¯ã€‚</p>
<h4 id="3-6-3-æ€»ç»“"><a href="#3-6-3-æ€»ç»“" class="headerlink" title="3.6.3 æ€»ç»“"></a><font size=3>3.6.3 æ€»ç»“</font></h4><p>ç»¼ä¸Šæ‰€è¿°ï¼Œè¿™é‡Œè¿™è¡Œå‘½ä»¤å…¶å®ä¹Ÿæ˜¯ç©ºã€‚</p>
<h3 id="3-7-rule-cc-o-cæ€»ç»“"><a href="#3-7-rule-cc-o-cæ€»ç»“" class="headerlink" title="3.7 rule_cc_o_cæ€»ç»“"></a><font size=3>3.7 rule_cc_o_cæ€»ç»“</font></h3><p>ç»è¿‡ä»¥ä¸Šåˆ†æï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªå‡½æ•°ï¼šMakefile.build - scripts&#x2F;Makefile.build - <em>rule_cc_o_c</em>](<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L279)%EF%BC%9A">https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.build#L279)ï¼š</a></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">define</span> rule_cc_o_c</span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> echo-cmd,checksrc)</span> <span class="variable">$(cmd_checksrc)</span>			  \</span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> cmd_and_fixdep,cc_o_c)</span>					  \</span><br><span class="line">	<span class="variable">$(cmd_checkdoc)</span>							  \</span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> echo-cmd,objtool)</span> <span class="variable">$(cmd_objtool)</span>				  \</span><br><span class="line">	<span class="variable">$(cmd_modversions_c)</span>						  \</span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> echo-cmd,record_mcount)</span> <span class="variable">$(cmd_record_mcount)</span></span><br><span class="line"><span class="keyword">endef</span></span><br></pre></td></tr></table></figure>

<p>åœ¨æˆ‘ä»¬å•ç‹¬ç¼–è¯‘drivers&#x2F;media&#x2F;i2c&#x2F;ov5640.koçš„æ—¶å€™ï¼Œè¿™ä¸ªå‡½æ•°é‡Œé¢å…¶å®å¯ä»¥ç®€åŒ–ä¸ºï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">define</span> rule_cc_o_c</span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> cmd_and_fixdep,cc_o_c)</span>					  \</span><br><span class="line"><span class="keyword">endef</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸€æ¡å‘½ä»¤å°±æ˜¯å°†drivers&#x2F;media&#x2F;i2c&#x2F;ov5640.cç¼–è¯‘æˆdrivers&#x2F;media&#x2F;i2c&#x2F;ov5640.oã€‚</p>
<h2 id="4-Makefile-modpost"><a href="#4-Makefile-modpost" class="headerlink" title="4.Â Makefile.modpost"></a><font size=3>4.Â Makefile.modpost</font></h2><h3 id="4-1-æ–‡ä»¶ç»“æ„"><a href="#4-1-æ–‡ä»¶ç»“æ„" class="headerlink" title="4.1 æ–‡ä»¶ç»“æ„"></a><font size=3>4.1 æ–‡ä»¶ç»“æ„</font></h3><p>æœ€åæˆ‘ä»¬æ¥çœ‹<code>%.ko</code>ç›®æ ‡çš„æœ€åä¸€æ¡å‘½ä»¤ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(Q)</span>make -f <span class="variable">$(srctree)</span>/scripts/Makefile.modpost</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„srctree&#x3D;<code>.</code>ï¼Œæ‰€ä»¥è¦åˆ†æçš„æ˜¯è¿™ä¸ªæ–‡ä»¶ï¼š<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.modpost">Makefile.modpost - scripts&#x2F;Makefile.modpost</a>ã€‚å…ˆæ¥çœ‹ä¸€ä¸‹æ–‡ä»¶å¼€å¤´çš„æ³¨é‡Šï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Stage one of module building created the following:</span></span><br><span class="line"><span class="comment"># a) The individual .o files used for the module</span></span><br><span class="line"><span class="comment"># b) A &lt;module&gt;.o file which is the .o files above linked together</span></span><br><span class="line"><span class="comment"># c) A &lt;module&gt;.mod file in $(MODVERDIR)/, listing the name of the the preliminary &lt;module&gt;.o file, plus all .o files</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Stage 2 is handled by this file and does the following</span></span><br><span class="line"><span class="comment"># 1) Find all modules from the files listed in $(MODVERDIR)/</span></span><br><span class="line"><span class="comment"># 2) modpost is then used to</span></span><br><span class="line"><span class="comment"># 3)  create one &lt;module&gt;.mod.c file pr. module</span></span><br><span class="line"><span class="comment"># 4)  create one Module.symvers file with CRC for all exported symbols</span></span><br><span class="line"><span class="comment"># 5) compile all &lt;module&gt;.mod.c files</span></span><br><span class="line"><span class="comment"># 6) final link of the module to a &lt;module.ko&gt; file</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 3 is used to place certain information in the module&#x27;s ELF section, including information such as:</span></span><br><span class="line"><span class="comment">#   Version magic (see include/linux/vermagic.h for full details)</span></span><br><span class="line"><span class="comment">#     - Kernel release</span></span><br><span class="line"><span class="comment">#     - SMP is CONFIG_SMP</span></span><br><span class="line"><span class="comment">#     - PREEMPT is CONFIG_PREEMPT</span></span><br><span class="line"><span class="comment">#     - GCC Version</span></span><br><span class="line"><span class="comment">#   Module info</span></span><br><span class="line"><span class="comment">#     - Module version (MODULE_VERSION)</span></span><br><span class="line"><span class="comment">#     - Module alias&#x27;es (MODULE_ALIAS)</span></span><br><span class="line"><span class="comment">#     - Module license (MODULE_LICENSE)</span></span><br><span class="line"><span class="comment">#     - See include/linux/module.h for more details</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 4 is solely used to allow module versioning in external modules, where the CRC of each module is retrieved from the Module.symvers file.</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå…¶å®å°±æ˜¯ä¸€ä¸ªæ„å»ºkoé©±åŠ¨æ–‡ä»¶çš„è¯´æ˜ï¼Œä¸»è¦åˆ†äº†4ä¸ªé˜¶æ®µã€‚æˆ‘ä»¬æ‰“å¼€æ–‡ä»¶å°±ä¼šå‘ç°ï¼Œæ–‡ä»¶ä¸­æœ‰ä¸€äº›æ³¨é‡Šæ¥å‘Šè¯‰æˆ‘ä»¬å“ªäº›æ˜¯ç¬¬ä¸€é˜¶æ®µï¼Œå“ªäº›æ˜¯ç¬¬äºŒé˜¶æ®µã€‚ä¸ºä»€ä¹ˆè¦å…ˆçœ‹è¿™ä¸ªï¼Ÿå› ä¸ºæˆ‘æ²¡æ‰¾åˆ°é»˜è®¤ç›®æ ‡ï¼Œå±äºå®Œå…¨æ²¡çœ‹æ‡‚çš„æ ·å­ï¼Œç„¶åå°±å‘ç°è¿™ä¸ªæ–‡ä»¶ä¸­æœ‰ä¸åŒé˜¶æ®µçš„æ³¨é‡Šï¼Œå…ˆæ¥çœ‹ä¸€çœ‹å§ã€‚</p>
<h4 id="4-1-1-Step-1"><a href="#4-1-1-Step-1" class="headerlink" title="4.1.1Â Step 1"></a><font size=3>4.1.1Â <em>Step 1</em></font></h4><p><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.modpost#L63">Makefile.modpost - scripts&#x2F;Makefile.modpost - <em>Step 1</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Step 1), find all modules listed in $(MODVERDIR)/</span></span><br><span class="line">MODLISTCMD := find <span class="variable">$(MODVERDIR)</span> -name &#x27;*.mod&#x27; | xargs -r grep -h &#x27;\.ko$$&#x27; | sort -u</span><br><span class="line">__modules := <span class="variable">$(<span class="built_in">shell</span> <span class="variable">$(MODLISTCMD)</span>)</span></span><br><span class="line">modules   := <span class="variable">$(<span class="built_in">patsubst</span> %.o,%.ko, $(<span class="built_in">wildcard</span> $(__modules:.ko=.o)</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Stop after building .o files if NOFINAL is set. Makes compile tests quicker</span></span><br><span class="line"><span class="section">_modpost: $(if <span class="variable">$(KBUILD_MODPOST_NOFINAL)</span>, $(modules:.ko:.o),<span class="variable">$(modules)</span>)</span></span><br></pre></td></tr></table></figure>

<h4 id="4-1-2-Step-2-3-4"><a href="#4-1-2-Step-2-3-4" class="headerlink" title="4.1.2Â Step 2&#x2F;3&#x2F;4"></a><font size=3>4.1.2Â <em>Step 2&#x2F;3&#x2F;4</em></font></h4><p><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.modpost#L71">Makefile.modpost - scripts&#x2F;Makefile.modpost - <em>Step 2&#x2F;3&#x2F;4</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Step 2), invoke modpost</span></span><br><span class="line"><span class="comment">#  Includes step 3,4</span></span><br><span class="line">modpost = scripts/mod/modpost                    \</span><br><span class="line"> <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(CONFIG_MODVERSIONS)</span>,-m)</span>                  \</span><br><span class="line"> <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(CONFIG_MODULE_SRCVERSION_ALL)</span>,-a,)</span>       \</span><br><span class="line"> <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(KBUILD_EXTMOD)</span>,-i,-o)</span> <span class="variable">$(kernelsymfile)</span>   \</span><br><span class="line"> <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(KBUILD_EXTMOD)</span>,-I <span class="variable">$(modulesymfile)</span>)</span>      \</span><br><span class="line"> <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(KBUILD_EXTMOD)</span>,$(<span class="built_in">addprefix</span> -e ,<span class="variable">$(KBUILD_EXTRA_SYMBOLS)</span>)</span>) \</span><br><span class="line"> <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(KBUILD_EXTMOD)</span>,-o <span class="variable">$(modulesymfile)</span>)</span>      \</span><br><span class="line"> <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(CONFIG_DEBUG_SECTION_MISMATCH)</span>,,-S)</span>      \</span><br><span class="line"> <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(CONFIG_SECTION_MISMATCH_WARN_ONLY)</span>,,-E)</span>  \</span><br><span class="line"> <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(KBUILD_EXTMOD)</span><span class="variable">$(KBUILD_MODPOST_WARN)</span>,-w)</span></span><br><span class="line"></span><br><span class="line">MODPOST_OPT=<span class="variable">$(<span class="built_in">subst</span> -i,-n,$(<span class="built_in">filter</span> -i,<span class="variable">$(MAKEFLAGS)</span>)</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># We can go over command line length here, so be careful.</span></span><br><span class="line">quiet_cmd_modpost = MODPOST <span class="variable">$(words $(<span class="built_in">filter</span>-out vmlinux FORCE, <span class="variable">$^</span>)</span>) modules</span><br><span class="line">      cmd_modpost = <span class="variable">$(MODLISTCMD)</span> | sed &#x27;s/\.ko$$/.o/&#x27; | <span class="variable">$(modpost)</span> <span class="variable">$(MODPOST_OPT)</span> -s -T -</span><br><span class="line"></span><br><span class="line">PHONY += __modpost</span><br><span class="line"><span class="section">__modpost: $(modules:.ko=.o) FORCE</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> cmd,modpost)</span> <span class="variable">$(<span class="built_in">wildcard</span> vmlinux)</span></span><br><span class="line"></span><br><span class="line">quiet_cmd_kernel-mod = MODPOST <span class="variable">$@</span></span><br><span class="line">      cmd_kernel-mod = <span class="variable">$(modpost)</span> <span class="variable">$@</span></span><br><span class="line"></span><br><span class="line"><span class="section">vmlinux.o: FORCE</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> cmd,kernel-mod)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Declare generated files as targets for modpost</span></span><br><span class="line"><span class="section">$(modules:.ko=.mod.c): __modpost ;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-1-3-Step-5"><a href="#4-1-3-Step-5" class="headerlink" title="4.1.3Â Step 5"></a><font size=3>4.1.3Â <em>Step 5</em></font></h4><p><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.modpost#L104">Makefile.modpost - scripts&#x2F;Makefile.modpost - <em>Step 5</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Step 5), compile all *.mod.c files</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># modname is set to make c_flags define KBUILD_MODNAME</span></span><br><span class="line">modname = <span class="variable">$(<span class="built_in">notdir</span> $(@:.mod.o=)</span>)</span><br><span class="line"></span><br><span class="line">quiet_cmd_cc_o_c = CC      <span class="variable">$@</span></span><br><span class="line">      cmd_cc_o_c = <span class="variable">$(CC)</span> <span class="variable">$(c_flags)</span> <span class="variable">$(KBUILD_CFLAGS_MODULE)</span> <span class="variable">$(CFLAGS_MODULE)</span> \</span><br><span class="line">		   -c -o <span class="variable">$@</span> <span class="variable">$&lt;</span></span><br><span class="line"></span><br><span class="line"><span class="section">$(modules:.ko=.mod.o): %.mod.o: %.mod.c FORCE</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> if_changed_dep,cc_o_c)</span></span><br><span class="line"></span><br><span class="line">targets += $(modules:.ko=.mod.o)</span><br><span class="line"></span><br><span class="line">ARCH_POSTLINK := <span class="variable">$(<span class="built_in">wildcard</span> <span class="variable">$(srctree)</span>/arch/<span class="variable">$(SRCARCH)</span>/Makefile.postlink)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 6), final link of the modules with optional arch pass after final link</span></span><br><span class="line">quiet_cmd_ld_ko_o = LD [M]  <span class="variable">$@</span></span><br><span class="line">      cmd_ld_ko_o =                                                     \</span><br><span class="line">	<span class="variable">$(LD)</span> -r <span class="variable">$(KBUILD_LDFLAGS)</span>                                      \</span><br><span class="line">                 <span class="variable">$(KBUILD_LDFLAGS_MODULE)</span> <span class="variable">$(LDFLAGS_MODULE)</span>             \</span><br><span class="line">                 -o <span class="variable">$@</span> <span class="variable">$(<span class="built_in">filter</span>-out FORCE,<span class="variable">$^</span>)</span> ;                         \</span><br><span class="line">	<span class="variable">$(<span class="built_in">if</span> <span class="variable">$(ARCH_POSTLINK)</span>, <span class="variable">$(MAKE)</span> -f <span class="variable">$(ARCH_POSTLINK)</span> <span class="variable">$@</span>, true)</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$(modules)</span>: %.ko :%.o %.mod.o FORCE</span><br><span class="line">	+<span class="variable">$(<span class="built_in">call</span> if_changed,ld_ko_o)</span></span><br><span class="line"></span><br><span class="line">targets += <span class="variable">$(modules)</span></span><br></pre></td></tr></table></figure>



<h4 id="4-1-4-æ‰€æœ‰å‡ºç°çš„ç›®æ ‡"><a href="#4-1-4-æ‰€æœ‰å‡ºç°çš„ç›®æ ‡" class="headerlink" title="4.1.4 æ‰€æœ‰å‡ºç°çš„ç›®æ ‡"></a><font size=3>4.1.4 æ‰€æœ‰å‡ºç°çš„ç›®æ ‡</font></h4><p>ç®€åŒ–ä¸€ä¸‹ï¼Œçœ‹çœ‹æ‰€æœ‰å‡ºç°çš„ç›®æ ‡å§ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">PHONY := _modpost</span><br><span class="line"><span class="section">_modpost: __modpost</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 1), find all modules listed in $(MODVERDIR)/</span></span><br><span class="line"><span class="comment"># Stop after building .o files if NOFINAL is set. Makes compile tests quicker</span></span><br><span class="line"><span class="section">_modpost: $(if <span class="variable">$(KBUILD_MODPOST_NOFINAL)</span>, $(modules:.ko:.o),<span class="variable">$(modules)</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 2), invoke modpost</span></span><br><span class="line"><span class="comment">#  Includes step 3,4</span></span><br><span class="line">PHONY += __modpost</span><br><span class="line"><span class="section">__modpost: $(modules:.ko=.o) FORCE</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> cmd,modpost)</span> <span class="variable">$(<span class="built_in">wildcard</span> vmlinux)</span></span><br><span class="line"></span><br><span class="line"><span class="section">vmlinux.o: FORCE</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> cmd,kernel-mod)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Declare generated files as targets for modpost</span></span><br><span class="line"><span class="section">$(modules:.ko=.mod.c): __modpost ;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 5), compile all *.mod.c files</span></span><br><span class="line"><span class="section">$(modules:.ko=.mod.o): %.mod.o: %.mod.c FORCE</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> if_changed_dep,cc_o_c)</span></span><br><span class="line">	</span><br><span class="line"><span class="variable">$(modules)</span>: %.ko :%.o %.mod.o FORCE</span><br><span class="line">	+<span class="variable">$(<span class="built_in">call</span> if_changed,ld_ko_o)</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ° _modpostæ˜¯å‡ºç°çš„ç¬¬ä¸€ä¸ªè§„åˆ™ï¼Œä»–åº”è¯¥æ˜¯é»˜è®¤è§„åˆ™ï¼Œè¿™ä¸ªè§„åˆ™ç¬¬ä¸€æ¬¡å‡ºç°çš„æ—¶å€™ä¾èµ–äº__modpostç›®æ ‡ï¼Œç„¶åå¾€åå°±ä¼šå‘ç°ï¼Œç¬¬7è¡Œåˆå‡ºç°äº†å®ƒçš„æ–°çš„ä¾èµ–ï¼Œé‚£ä¹ˆæ€ä¹ˆæ‰§è¡Œçš„ï¼Ÿæˆ‘ä»¬æ¥è¯•ä¸€ä¸‹ä¸€ä¸ªç›®æ ‡å…ˆåå‡ºç°ä¸åŒçš„è§„åˆ™çš„æ—¶å€™æ€ä¹ˆè¿è¡Œçš„ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PHONY += test</span><br><span class="line"><span class="section">test: test2</span></span><br><span class="line"></span><br><span class="line"><span class="section">test: test1</span></span><br><span class="line"></span><br><span class="line"><span class="section">test1:</span></span><br><span class="line">	@echo <span class="string">&quot;test1&quot;</span></span><br><span class="line">	</span><br><span class="line"><span class="section">test2:</span></span><br><span class="line">	@echo <span class="string">&quot;test2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: $(PHONY)</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ‰§è¡Œmakeï¼Œä¼šæœ‰å¦‚ä¸‹æ‰“å°ä¿¡æ¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">test1</span><br><span class="line">test2</span><br></pre></td></tr></table></figure>

<p>å®è·µè¯æ˜ï¼Œåªè¦æ˜¯ç›®æ ‡ä¾èµ–çš„ç›®æ ‡ä¸­çš„è§„åˆ™éƒ½ä¼šæ‰§è¡Œï¼Œå¹¶ä¸”å…ˆå‡ºç°çš„å…ˆæ‰§è¡Œã€‚æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å¤§æ¦‚å°±å¯ä»¥çŸ¥é“æ€ä¹ˆå»è·Ÿè¿™éƒ¨åˆ†çš„ä»£ç äº†ã€‚</p>
<h3 id="4-2-modpostç›®æ ‡"><a href="#4-2-modpostç›®æ ‡" class="headerlink" title="4.2Â _modpostç›®æ ‡"></a><font size=3>4.2Â _modpostç›®æ ‡</font></h3><p>é»˜è®¤ç›®æ ‡æ˜¯å“ªä¸ªï¼Ÿä¸€èˆ¬æ¥è¯´makefileçš„ç¬¬ä¸€ä¸ªç›®æ ‡å°±æ˜¯é»˜è®¤ç›®æ ‡ï¼Œåˆšæ‰å¤§åˆ†ææ–‡ä»¶ç»“æ„çš„æ—¶å€™å¤§æ¦‚å·²ç»æ¸…æ¥šé»˜è®¤ç›®æ ‡äº†ï¼Œæˆ‘ä»¬æ‰“å¼€<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.modpost#L41">Makefile.modpost - scripts&#x2F;Makefile.modpost</a>ï¼Œçœ‹åˆ°çš„ç¬¬ä¸€ä¸ªç›®æ ‡å°±æ˜¯ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PHONY := _modpost</span><br><span class="line"><span class="section">_modpost: __modpost</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°_modpoståˆä¾èµ–äº__modpostï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå…ˆå»å®Œæˆ__modpostç›®æ ‡ä¸­çš„è§„åˆ™ã€‚</p>
<h3 id="4-3-modpostç›®æ ‡"><a href="#4-3-modpostç›®æ ‡" class="headerlink" title="4.3Â __modpostç›®æ ‡"></a><font size=3>4.3Â __modpostç›®æ ‡</font></h3><p>æ¥ä¸‹æ¥å…ˆæ¥çœ‹è¿™ä¸ª__modpostç›®æ ‡ï¼Œå®ƒå®šä¹‰åœ¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.modpost#L91">Makefile.modpost - scripts&#x2F;Makefile.modpost - <em>__modpostç›®æ ‡</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PHONY += __modpost</span><br><span class="line"><span class="section">__modpost: $(modules:.ko=.o) FORCE</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">call</span> cmd,modpost)</span> <span class="variable">$(<span class="built_in">wildcard</span> vmlinux)</span></span><br></pre></td></tr></table></figure>

<h4 id="4-3-1-call-cmd-modpost"><a href="#4-3-1-call-cmd-modpost" class="headerlink" title="4.3.1 $(call cmd,modpost)"></a><font size=3>4.3.1 <code>$(call cmd,modpost)</code></font></h4><p>å…ˆæ¥çœ‹è¿™ä¸ª<code>$(call cmd,modpost)</code>å‘½ä»¤ï¼Œcmdå‡½æ•°å®šä¹‰åœ¨ï¼š<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Kbuild.include#L224">Kbuild.include - scripts&#x2F;Kbuild.include - <em>cmd</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo command.</span></span><br><span class="line"><span class="comment"># Short version is used, if $(quiet) equals `quiet_&#x27;, otherwise full one.</span></span><br><span class="line">echo-cmd = <span class="variable">$(<span class="built_in">if</span> $(<span class="variable">$(quiet)</span>cmd_$(1)</span>),\</span><br><span class="line">	echo &#x27;  <span class="variable">$(<span class="built_in">call</span> escsq,$(<span class="variable">$(quiet)</span>cmd_$(1)</span>))$(echo-why)&#x27;;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># printing commands</span></span><br><span class="line">cmd = @$(echo-cmd) $(cmd_$(1))</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥çœ‹<code>$(cmd_$(1))</code>ï¼Œå‰é¢cmdå‡½æ•°è°ƒç”¨çš„æ—¶å€™ä¼ å…¥çš„å‚æ•°æ˜¯modpostï¼Œæ‰€ä»¥<code>$(1)</code>&#x3D;modpostï¼Œè¿™é‡Œå°±æ˜¯<code>$(cmd_modpost)</code>ï¼Œå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.modpost#L88">Makefile.modpost - scripts&#x2F;Makefile.modpost - <em>cmd_modpost</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># We can go over command line length here, so be careful.</span></span><br><span class="line">quiet_cmd_modpost = MODPOST <span class="variable">$(words $(<span class="built_in">filter</span>-out vmlinux FORCE, <span class="variable">$^</span>)</span>) modules</span><br><span class="line">      cmd_modpost = <span class="variable">$(MODLISTCMD)</span> | sed &#x27;s/\.ko$$/.o/&#x27; | <span class="variable">$(modpost)</span> <span class="variable">$(MODPOST_OPT)</span> -s -T -</span><br></pre></td></tr></table></figure>

<p>MODLISTCMDå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.modpost#L64">Makefile.modpost - scripts&#x2F;Makefile.modpost - <em>MODLISTCMD</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MODLISTCMD := find <span class="variable">$(MODVERDIR)</span> -name &#x27;*.mod&#x27; | xargs -r grep -h &#x27;\.ko$$&#x27; | sort -u</span><br></pre></td></tr></table></figure>

<p>MODPOST_OPTå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.modpost#L84">Makefile.modpost - scripts&#x2F;Makefile.modpost - <em>MODPOST_OPT</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MODPOST_OPT=<span class="variable">$(<span class="built_in">subst</span> -i,-n,$(<span class="built_in">filter</span> -i,<span class="variable">$(MAKEFLAGS)</span>)</span>)</span><br></pre></td></tr></table></figure>

<p>modpostå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.modpost#L73">Makefile.modpost - scripts&#x2F;Makefile.modpost - <em>modpost</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">modpost = scripts/mod/modpost                    \</span><br><span class="line"> <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(CONFIG_MODVERSIONS)</span>,-m)</span>                  \</span><br><span class="line"> <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(CONFIG_MODULE_SRCVERSION_ALL)</span>,-a,)</span>       \</span><br><span class="line"> <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(KBUILD_EXTMOD)</span>,-i,-o)</span> <span class="variable">$(kernelsymfile)</span>   \</span><br><span class="line"> <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(KBUILD_EXTMOD)</span>,-I <span class="variable">$(modulesymfile)</span>)</span>      \</span><br><span class="line"> <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(KBUILD_EXTMOD)</span>,$(<span class="built_in">addprefix</span> -e ,<span class="variable">$(KBUILD_EXTRA_SYMBOLS)</span>)</span>) \</span><br><span class="line"> <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(KBUILD_EXTMOD)</span>,-o <span class="variable">$(modulesymfile)</span>)</span>      \</span><br><span class="line"> <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(CONFIG_DEBUG_SECTION_MISMATCH)</span>,,-S)</span>      \</span><br><span class="line"> <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(CONFIG_SECTION_MISMATCH_WARN_ONLY)</span>,,-E)</span>  \</span><br><span class="line"> <span class="variable">$(<span class="built_in">if</span> <span class="variable">$(KBUILD_EXTMOD)</span><span class="variable">$(KBUILD_MODPOST_WARN)</span>,-w)</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ¶‰åŠçš„å˜é‡è¾ƒå¤šï¼Œæˆ‘ä»¬ç›´æ¥çœ‹æ‰“å°ä¿¡æ¯å§ï¼Œå› ä¸ºå®ƒè°ƒç”¨çš„æ˜¯cmdå‡½æ•°ï¼Œæ‰€ä»¥æ˜¯å¸¦æœ‰å‘½ä»¤å›æ˜¾çš„ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find .tmp_versions -name &#x27;*.mod&#x27; | xargs -r grep -h &#x27;\.ko$&#x27; | sort -u | sed &#x27;s/\.ko$/.o/&#x27; | scripts/mod/modpost -m -a -o ./Module.symvers    -S    -s -T -</span><br></pre></td></tr></table></figure>

<p>è¿™è¡Œæ‰“å°æ–°å¥‡å…¶å®å°±æ˜¯åœ¨æ‰§è¡Œ<code>$(call cmd,modpost)</code>ã€‚è¿™é‡Œä¸æ·±ç©¶äº†å…ˆåˆ°æ­¤ä¸ºæ­¢ã€‚</p>
<h4 id="4-3-2-wildcard-vmlinux"><a href="#4-3-2-wildcard-vmlinux" class="headerlink" title="4.3.2 $(wildcard vmlinux)"></a><font size=3>4.3.2 <code>$(wildcard vmlinux)</code></font></h4><p>è¿™ä¸ª wildcard å‡½æ•°ç”¨äºæŸ¥æ‰¾åŒ¹é…æŒ‡å®šæ¨¡å¼çš„æ–‡ä»¶ï¼Œå¹¶è¿”å›è¿™äº›æ–‡ä»¶çš„åˆ—è¡¨ã€‚è¿™ä¸ªå‡½æ•°åœ¨å¤„ç†æ–‡ä»¶è·¯å¾„å’Œæ–‡ä»¶åæ—¶éå¸¸æœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦åŠ¨æ€ç”Ÿæˆæ–‡ä»¶åˆ—è¡¨çš„æƒ…å†µä¸‹ã€‚ä¸€èˆ¬ç”¨æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">wildcard</span> æŒ‡å®šæ–‡ä»¶ç±»å‹)</span></span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥è¿™é‡Œå…¶å®æ˜¯åœ¨åŒ¹é…å½“å‰è·¯å¾„ä¸‹çš„vmlinuxæ–‡ä»¶ã€‚æ˜¾ç„¶è¿™é‡Œä¸ºç©ºã€‚</p>
<h4 id="4-3-3-modules-ko-o"><a href="#4-3-3-modules-ko-o" class="headerlink" title="4.3.3Â $(modules:.ko=.o)"></a><font size=3>4.3.3Â <code>$(modules:.ko=.o)</code></font></h4><p>å‰é¢__modpostç›®æ ‡è¿˜ä¾èµ–äº<code>$(modules:.ko=.o)</code>ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™æ˜¯ä¸ªä»€ä¹ˆã€‚å†æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªä¾èµ–é¡¹ï¼Œè¿™ä¸ªå†…éƒ¨å…¶å®æ˜¯makefileä¸­çš„å­—ç¬¦ä¸²æ›¿æ¢è¯­æ³•ï¼Œå°±æ˜¯æŠŠmodulesä¸­æ‰€æœ‰æˆå‘˜çš„.koæ›¿æ¢æˆ.oã€‚moduleså˜é‡å®šä¹‰åœ¨ <a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.modpost#L66">Makefile.modpost - scripts&#x2F;Makefile.modpost - <em>modules</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">modules   := <span class="variable">$(<span class="built_in">patsubst</span> %.o,%.ko, $(<span class="built_in">wildcard</span> $(__modules:.ko=.o)</span>))</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œç›´æ¥åœ¨è¿™ä¸ªä½ç½®åŠ ä¸ªæ‰“å°ä¿¡æ¯å§ï¼š<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.modpost#L92">Makefile.modpost - scripts&#x2F;Makefile.modpost</a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PHONY += __modpost</span><br><span class="line"><span class="section">__modpost: $(modules:.ko=.o) FORCE</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">warning</span> &quot;info modules=<span class="variable">$(modules)</span> (modules:.ko=.o)</span>=$(modules:.ko=.o)<span class="string">&quot;)</span></span><br><span class="line"><span class="string">	$(call cmd,modpost) $(wildcard vmlinux)</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">make V=0 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- distclean</span><br><span class="line">make V=0 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- imx_v6_v7_defconfig</span><br><span class="line">make V=1 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- drivers/media/i2c/ov5640.ko -j16</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æ‰“å°ä¿¡æ¯ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">scripts/Makefile.modpost:94: &quot;info modules=drivers/media/i2c/ov5640.ko (modules:.ko=.o)=drivers/media/i2c/ov5640.o&quot;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå…¶å®å°±æ˜¯ä¾èµ–äºdrivers&#x2F;media&#x2F;i2c&#x2F;ov5640.oã€‚è¿™ä¸ªæ–‡ä»¶åœ¨å‰é¢å·²ç»ç”Ÿæˆäº†çš„ã€‚</p>
<h4 id="4-3-4-æ€»ç»“"><a href="#4-3-4-æ€»ç»“" class="headerlink" title="4.3.4 æ€»ç»“"></a><font size=3>4.3.4 æ€»ç»“</font></h4><p>æ‰€ä»¥è¿™ä¸ª__modpostç›®æ ‡ä¸­çš„è§„åˆ™æ˜¯åœ¨æ‰§è¡Œè¿™æ¡å‘½ä»¤ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find .tmp_versions -name &#x27;*.mod&#x27; | xargs -r grep -h &#x27;\.ko$&#x27; | sort -u | sed &#x27;s/\.ko$/.o/&#x27; | scripts/mod/modpost -m -a -o ./Module.symvers    -S    -s -T -</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¹Ÿå°±ä¸å†æ·±ç©¶äº†ã€‚</p>
<h3 id="4-4-modpostç›®æ ‡"><a href="#4-4-modpostç›®æ ‡" class="headerlink" title="4.4Â _modpostç›®æ ‡"></a><font size=3>4.4Â _modpostç›®æ ‡</font></h3><p>ä¸Šé¢å·²ç»åˆ†æå®Œäº†ï¼Œæ¥ä¸‹æ¥å†æ¥çœ‹ä¸‹ä¸€ä¸ª_modpostç›®æ ‡ï¼Œå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.modpost#L69">Makefile.modpost - scripts&#x2F;Makefile.modpost - <em>_modpost</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Stop after building .o files if NOFINAL is set. Makes compile tests quicker</span></span><br><span class="line"><span class="section">_modpost: $(if <span class="variable">$(KBUILD_MODPOST_NOFINAL)</span>, $(modules:.ko:.o),<span class="variable">$(modules)</span>)</span></span><br></pre></td></tr></table></figure>

<p>ç›´æ¥åœ¨è¿™é‡ŒåŠ æ‰“å°ä¿¡æ¯å§ï¼Œæˆ‘æ˜¯æ²¡æ‰¾åˆ°åœ¨å“ªå®šä¹‰ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">_modpost: $(if <span class="variable">$(KBUILD_MODPOST_NOFINAL)</span>, $(modules:.ko:.o),<span class="variable">$(modules)</span>)</span></span><br><span class="line">	<span class="variable">$(<span class="built_in">warning</span> KBUILD_MODPOST_NOFINAL=<span class="variable">$(KBUILD_MODPOST_NOFINAL)</span> (modules:.ko:.o)</span>=$(modules:.ko:.o) modules=<span class="variable">$(modules)</span>)</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹æ‰“å°ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">scripts/Makefile.modpost:70: KBUILD_MODPOST_NOFINAL= (modules:.ko:.o)= modules=drivers/media/i2c/ov5640.ko</span></span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥å…¶å®ä¸Šé¢å±•å¼€å°±æ˜¯ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Stop after building .o files if NOFINAL is set. Makes compile tests quicker</span></span><br><span class="line"><span class="section">_modpost: drivers/media/i2c/ov5640.ko</span></span><br></pre></td></tr></table></figure>

<p>å°±è¿™æ ·ï¼Œåˆäº§ç”Ÿäº†ä¸€ä¸ªè¦è¿½çš„ç›®æ ‡<code>$(modules)</code>ã€‚</p>
<h3 id="4-5-modules-ç›®æ ‡"><a href="#4-5-modules-ç›®æ ‡" class="headerlink" title="4.5 $(modules)ç›®æ ‡"></a><font size=3>4.5 <code>$(modules)</code>ç›®æ ‡</font></h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹<code>$(modules)</code>ç›®æ ‡ï¼Œå®ƒå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.modpost#L128">Makefile.modpost - scripts&#x2F;Makefile.modpost - <em>modules</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(modules)</span>: %.ko :%.o %.mod.o FORCE</span><br><span class="line">	+<span class="variable">$(<span class="built_in">call</span> if_changed,ld_ko_o)</span></span><br></pre></td></tr></table></figure>

<h4 id="4-5-1-if-changedå‡½æ•°"><a href="#4-5-1-if-changedå‡½æ•°" class="headerlink" title="4.5.1Â if_changedå‡½æ•°"></a><font size=3>4.5.1Â if_changedå‡½æ•°</font></h4><p>if_changedå‡½æ•°å®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Kbuild.include#L259">Kbuild.include - scripts&#x2F;Kbuild.include - <em>if_changed</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Execute command if command has changed or prerequisite(s) are updated.</span></span><br><span class="line">if_changed = <span class="variable">$(<span class="built_in">if</span> $(<span class="built_in">strip</span> $(any-prereq)</span> $(arg-check)),                       \</span><br><span class="line">	@set -e;                                                             \</span><br><span class="line">	$(echo-cmd) $(cmd_$(1));                                             \</span><br><span class="line">	printf &#x27;%s\n&#x27; &#x27;cmd_<span class="variable">$@</span> := $(make-cmd)&#x27; &gt; $(dot-target).cmd, @:)</span><br></pre></td></tr></table></figure>

<p>ç”±äºæˆ‘ä¹ˆè¦ç”Ÿæˆkoæ–‡ä»¶ï¼Œè¿™é‡Œ<code>$(any-prereq)</code>å’Œ <code>$(arg-check)</code>è‡³å°‘æœ‰ä¸€ä¸ªä¸ä¼šä¸ºç©ºï¼Œæ‰€ä»¥è¿™é‡Œç®€åŒ–ä¸ºï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Execute command if command has changed or prerequisite(s) are updated.</span></span><br><span class="line">if_changed =                                                             \</span><br><span class="line">	@set -e;                                                             \</span><br><span class="line">	$(echo-cmd) $(cmd_$(1));                                             \</span><br><span class="line">	printf &#x27;%s\n&#x27; &#x27;cmd_<span class="variable">$@</span> := $(make-cmd)&#x27; &gt; $(dot-target).cmd</span><br></pre></td></tr></table></figure>

<p>å‰é¢å…¶å®åˆ†æè¿‡<code>$(echo-cmd) $(cmd_$(1))</code>è¿™å¥åœ¨å¹²ä»€ä¹ˆï¼Œ<code>$(echo-cmd)</code>è´Ÿè´£å‘½ä»¤å›æ˜¾ï¼Œ<code>$(cmd_$(1))</code>è´Ÿè´£å‘½ä»¤æ‰§è¡Œã€‚æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ç›´æ¥çœ‹è¿™ä¸ª<code>$(cmd_$(1))</code>å³å¯ã€‚è¿™é‡Œå°±æ˜¯<code>$(cmd_ld_ko_o)</code>ã€‚</p>
<h4 id="4-5-2-cmd-ld-ko-o"><a href="#4-5-2-cmd-ld-ko-o" class="headerlink" title="4.5.2 cmd_ld_ko_o"></a><font size=3>4.5.2 <code>cmd_ld_ko_o</code></font></h4><p>cmd_ld_ko_oå®šä¹‰åœ¨<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/linux/v4.19.71/source/scripts/Makefile.modpost#L122">Makefile.modpost - scripts&#x2F;Makefile.modpost - <em>cmd_ld_ko_o</em></a>ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Step 6), final link of the modules with optional arch pass after final link</span></span><br><span class="line">quiet_cmd_ld_ko_o = LD [M]  <span class="variable">$@</span></span><br><span class="line">      cmd_ld_ko_o =                                                     \</span><br><span class="line">	<span class="variable">$(LD)</span> -r <span class="variable">$(KBUILD_LDFLAGS)</span>                                      \</span><br><span class="line">                 <span class="variable">$(KBUILD_LDFLAGS_MODULE)</span> <span class="variable">$(LDFLAGS_MODULE)</span>             \</span><br><span class="line">                 -o <span class="variable">$@</span> <span class="variable">$(<span class="built_in">filter</span>-out FORCE,<span class="variable">$^</span>)</span> ;                         \</span><br><span class="line">	<span class="variable">$(<span class="built_in">if</span> <span class="variable">$(ARCH_POSTLINK)</span>, <span class="variable">$(MAKE)</span> -f <span class="variable">$(ARCH_POSTLINK)</span> <span class="variable">$@</span>, true)</span></span><br></pre></td></tr></table></figure>

<p>é‚£è¿™å¥æ˜¯ä»€ä¹ˆï¼Ÿå…¶å®å§å‰é¢åˆ†æè¿‡çš„<code>$(echo-cmd)</code>å¯ä»¥å›æ˜¾å‘½ä»¤çš„ï¼Œæ˜¾ç¤ºçš„å°±æ˜¯åé¢çš„<code>$(cmd_$(1))</code>åœ¨è¿™é‡Œå°±æ˜¯cmd_ld_ko_oï¼Œä¸ºäº†æ–¹ä¾¿åŒºåˆ†ï¼Œæˆ‘ä»¬åœ¨è¿™é‡ŒåŠ ä¸€æ¡æ‰“å°ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">     cmd_ld_ko_o =                                                     \</span><br><span class="line">     echo <span class="string">&quot;cmd_ld_ko_o info &gt;&gt;&gt;&quot;</span>;\</span><br><span class="line"><span class="variable">$(LD)</span> -r <span class="variable">$(KBUILD_LDFLAGS)</span>                                      \</span><br><span class="line">                <span class="variable">$(KBUILD_LDFLAGS_MODULE)</span> <span class="variable">$(LDFLAGS_MODULE)</span>             \</span><br><span class="line">                -o <span class="variable">$@</span> <span class="variable">$(<span class="built_in">filter</span>-out FORCE,<span class="variable">$^</span>)</span> ;                         \</span><br><span class="line"><span class="variable">$(<span class="built_in">if</span> <span class="variable">$(ARCH_POSTLINK)</span>, <span class="variable">$(MAKE)</span> -f <span class="variable">$(ARCH_POSTLINK)</span> <span class="variable">$@</span>, true)</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¸èƒ½ç”¨<code>$(warning)</code>æ¥æ‰“å°ï¼Œä¼šæŠ¥é”™ã€‚ç„¶åæˆ‘ä»¬æ‰§è¡Œï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">make V=0 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- distclean</span><br><span class="line">make V=0 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- imx_v6_v7_defconfig</span><br><span class="line">make V=1 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- drivers/media/i2c/ov5640.ko -j16</span><br></pre></td></tr></table></figure>

<p>ä¼šçœ‹åˆ°å¦‚ä¸‹æ‰“å°ä¿¡æ¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  echo &quot;cmd_ld_ko_o info &gt;&gt;&gt;&quot;; arm-linux-gnueabihf-ld -r  -EL -T ./scripts/module-common.lds -T ./arch/arm/kernel/module.lds  --build-id  -o drivers/media/i2c/ov5640.ko drivers/media/i2c/ov5640.o drivers/media/i2c/ov5640.mod.o ;  true</span><br><span class="line">cmd_ld_ko_o info &gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥å…¶å®ä¸‹é¢è¿™æ¡å°±æ˜¯cmd_ld_ko_oçš„å‘½ä»¤å›æ˜¾å•¦ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;cmd_ld_ko_o info &gt;&gt;&gt;&quot;; arm-linux-gnueabihf-ld -r  -EL -T ./scripts/module-common.lds -T ./arch/arm/kernel/module.lds  --build-id  -o drivers/media/i2c/ov5640.ko drivers/media/i2c/ov5640.o drivers/media/i2c/ov5640.mod.o ;  true</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œå…¶å®å°±æ˜¯arm-linux-gnueabihf-ldå°†ç›¸å…³çš„.oæ–‡ä»¶é“¾æ¥æˆdrivers&#x2F;media&#x2F;i2c&#x2F;ov5640.koçš„å‘½ä»¤ï¼Œåˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬å°±ç”Ÿæˆäº†æœ€ç»ˆçš„ drivers&#x2F;media&#x2F;i2c&#x2F;ov5640.koï¼š</p>
<img data-src="https://fanhua-picture.oss-cn-hangzhou.aliyuncs.com/01%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/02IMX6ULL%E5%B9%B3%E5%8F%B0/LV05-%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F/LV05-03-Kernel-03-02-make-single-module/img/image-20241129001133528.png" alt="image-20241129001133528" />


    </div>

    
    
    

    <footer class="post-footer">




    <div>
        
            <div style="text-align:center;color: #ccc;font-size:14px;">
            ----------æœ¬æ–‡ç»“æŸ
            <i class="fas fa-fan fa-spin" style="color: #FF1493; font-size: 1rem"></i>
            æ„Ÿè°¢æ‚¨çš„é˜…è¯»----------
            </div>
        
    </div>





  
  <div class="my_post_copyright"> 
    <p><span>æ–‡ç« æ ‡é¢˜:</span><a href="/post/5d81934f.html">LV05-03-Kernel-03-02-make-single-module</a></p>
    <p><span>æ–‡ç« ä½œè€…:</span><a href="/" title="æ¬¢è¿è®¿é—® ã€Šè‹æœ¨ã€‹ çš„å­¦ä¹ ç¬”è®°">è‹æœ¨</a></p>
    <p><span>å‘å¸ƒæ—¶é—´:</span>2024å¹´11æœˆ29æ—¥ - 10:27</p>
    <p><span>æœ€åæ›´æ–°:</span>2025å¹´06æœˆ14æ—¥ - 00:25</p>
    <p><span>åŸå§‹é“¾æ¥:</span><a href="/post/5d81934f.html" title="LV05-03-Kernel-03-02-make-single-module">https://sumumm.github.io/post/5d81934f.html</a></p>
    <p><span>è®¸å¯åè®®:</span><i class="fab fa-creative-commons"></i> <a rel="license" href= "https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç¦æ­¢æ¼”ç» 4.0 å›½é™…</a> è½¬è½½è¯·ä¿ç•™åŸæ–‡é“¾æ¥åŠä½œè€…ã€‚</p>  
  </div>
  


          <div class="post-tags">
              <a href="/tags/LV05-%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F/" rel="tag"><i class="fa fa-tag"></i> LV05-ç³»ç»Ÿé•œåƒ</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/post/c9182535.html" rel="prev" title="LV05-04-æ ¹æ–‡ä»¶ç³»ç»Ÿ-01-æ ¹æ–‡ä»¶ç³»ç»ŸåŸºç¡€">
                  <i class="fa fa-angle-left"></i> LV05-04-æ ¹æ–‡ä»¶ç³»ç»Ÿ-01-æ ¹æ–‡ä»¶ç³»ç»ŸåŸºç¡€
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/post/2aa70834.html" rel="next" title="LV05-03-Kernel-03-01-é¡¶å±‚MakefileåŸºç¡€è§£æ">
                  LV05-03-Kernel-03-01-é¡¶å±‚MakefileåŸºç¡€è§£æ <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2017 â€“ 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">è‹æœ¨</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>ç«™ç‚¹æ€»å­—æ•°ï¼š</span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">3.7m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>ç«™ç‚¹é˜…è¯»æ—¶é•¿ &asymp;</span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">225:26</span>
  </span>
</div>




    <span id="sitetime"></span>
    <script defer language=javascript>
        function siteTime()
        {
            window.setTimeout("siteTime()", 1000);
            var seconds = 1000;
            var minutes = seconds * 60;
            var hours = minutes * 60;
            var days = hours * 24;
            var years = days * 365;
            var today = new Date();
            var todayYear = today.getFullYear();
            var todayMonth = today.getMonth()+1;
            var todayDate = today.getDate();
            var todayHour = today.getHours();
            var todayMinute = today.getMinutes();
            var todaySecond = today.getSeconds();
            /*==================================================
            Date.UTC() -- è¿”å›dateå¯¹è±¡è·ä¸–ç•Œæ ‡å‡†æ—¶é—´(UTC)1970å¹´1æœˆ1æ—¥åˆå¤œä¹‹é—´çš„æ¯«ç§’æ•°(æ—¶é—´æˆ³)
            year        - ä½œä¸ºdateå¯¹è±¡çš„å¹´ä»½ï¼Œä¸º4ä½å¹´ä»½å€¼
            month       - 0-11ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„æœˆä»½
            day         - 1-31ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„å¤©æ•°
            hours       - 0(åˆå¤œ24ç‚¹)-23ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„å°æ—¶æ•°
            minutes     - 0-59ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„åˆ†é’Ÿæ•°
            seconds     - 0-59ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„ç§’æ•°
            microseconds - 0-999ä¹‹é—´çš„æ•´æ•°ï¼Œåšä¸ºdateå¯¹è±¡çš„æ¯«ç§’æ•°
            ==================================================*/
            var t1 = Date.UTC(2017, 
                              5, 
                              19, 
                              0, 
                              0, 
                              0); //åŒ—äº¬æ—¶é—´
            var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond);
            var diff = t2-t1;
            var diffYears = Math.floor(diff/years);
            var diffDays = Math.floor((diff/days)-diffYears*365);
            var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours);
            var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes);
            var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds);
            document.getElementById("sitetime").innerHTML="å·²åœ¨è¿™é‡Œ "+diffYears+" å¹´ "+diffDays+" å¤© "+diffHours+" å°æ—¶ "+diffMinutes+" åˆ†é’Ÿ "+diffSeconds+" ç§’";
        }
        siteTime();
    </script>



    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.umd.js" integrity="sha256-ytMJGN3toR+a84u7g7NuHm91VIR06Q41kMWDr2pq7Zo=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>


  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


 
        <div id="click-show-text"
            data-mobile = false
            data-text = å¯Œå¼º,æ°‘ä¸»,æ–‡æ˜,å’Œè°,è‡ªç”±,å¹³ç­‰,å…¬æ­£,æ³•åˆ¶,çˆ±å›½,æ•¬ä¸š,è¯šä¿¡,å‹å–„
            data-fontsize = 15px
            data-random= false>
        </div>
       

      
        <script async src=https://cdn.jsdelivr.net/npm/hexo-next-mouse-effect@latest/click/showText.js></script>
      

      
    




    <script async src="/js/fancybox_param.js"></script>





<!-- APlayeræœ¬ä½“ -->



</body>
</html>
